<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Samsung AI Experience Group Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #1a1a1a;
            color: #e1e1e1;
            overflow-x: hidden;
        }

        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        ::-webkit-scrollbar-thumb {
            background: #2a2a2a;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #3a3a3a;
        }

        .dashboard-container {
            display: flex;
            height: 100vh;
            align-items: stretch;
        }

        /* ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ */
        .sidebar {
            width: 250px;
            background-color: #2a2a2a;
            color: #b1b1b1;
            border-right: 1px solid #3a3a3a;
            display: flex;
            flex-direction: column;
        }



        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: #b1b1b1;
            text-decoration: none;
            transition: all 0.2s ease;
            font-size: 14px;
            cursor: pointer;
            user-select: none;
        }

        .menu-item:hover {
            background-color: #3a3a3a;
            color: #fff;
        }

        .menu-item.active {
            background-color: #4a4a4a;
            color: #fff;
        }

        .refresh-button {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: #b1b1b1;
            text-decoration: none;
            transition: all 0.2s ease;
            font-size: 14px;
            cursor: pointer;
            user-select: none;
        }

        .refresh-button:hover {
            background-color: #3a3a3a;
            color: #fff;
        }

        .refresh-progress {
            position: absolute;
            bottom: -10px;
            left: 20px;
            right: 20px;
            height: 6px;
            background-color: #2a2a2a;
            border-radius: 3px;
            overflow: hidden;
            display: none;
        }

        .refresh-progress-bar {
            height: 100%;
            background-color: #4a9eff;
            border-radius: 3px;
            width: 0%;
            transition: width 0.3s ease;
        }

        .refresh-button {
            position: relative;
        }

        .menu-icon {
            width: 16px;
            height: 16px;
            margin-right: 12px;
            opacity: 0.7;
        }

        /* ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ */
        .main-content {
            flex: 1;
            background-color: #1a1a1a;
            display: flex;
            flex-direction: column;
        }

        .header {
            background-color: #1a1a1a; /* ë°°ê²½ìƒ‰ ê²€ì •ìœ¼ë¡œ ë³€ê²½ */
            padding: 20px 30px;
            height: 80px;
            box-sizing: border-box;
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* í—¤ë” ì•„ë˜ ì„ ì— ì—¬ë°± ì¶”ê°€ */
        .header::after {
            content: '';
            position: absolute;
            left: 30px;
            right: 30px;
            bottom: 0;
            height: 1px;
            background-color: #3a3a3a;
        }



        .header-left h1 {
            color: #fff;
            font-size: 24px;
            font-weight: 600;
        }

        .content-area {
            padding: 30px;
            min-height: calc(100vh - 80px);
            overflow-y: auto;
        }

        /* ê¸°ë³¸ ìˆ¨ê¹€ ì²˜ë¦¬ */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* Overview í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        .overview-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .overview-stat-box {
            background-color: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 8px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .overview-stat-box:hover {
            background-color: #3a3a3a;
            border-color: #4a4a4a;
        }

        .overview-stat-box.clickable {
            cursor: pointer;
        }

        .overview-stat-box.selected {
            background-color: #3a3a3a;
            border-color: #5a9eff;
            box-shadow: 0 0 10px rgba(90, 158, 255, 0.3);
        }

        .overview-stat-box.selected .stat-number,
        .overview-stat-box.selected .stat-label,
        .overview-stat-box.selected .stat-description {
            color: white;
        }

        .overview-stat-box .stat-number {
            font-size: 36px;
            font-weight: 700;
            color: #fff;
            margin-bottom: 8px;
        }

        .overview-stat-box .stat-label {
            font-size: 16px;
            font-weight: 600;
            color: #e1e1e1;
            margin-bottom: 4px;
        }

        .overview-stat-box .stat-description {
            font-size: 12px;
            color: #b1b1b1;
        }

        .overview-chart-container {
            background-color: #1a1a1a;
            border: 1px solid #3a3a3a;
            border-radius: 4px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-header h3 {
            color: #fff;
            font-size: 18px;
            font-weight: 600;
            background-color: transparent;
        }

        .chart-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .filter-period-display {
            background-color: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 4px;
            padding: 8px 16px;
            margin-right: 8px;
            min-width: 220px;
        }

        .filter-period-display span {
            color: #ff9800;
            font-size: 14px;
            font-weight: 600;
        }

        .chart-btn {
            background-color: #3a3a3a;
            border: 1px solid #4a4a4a;
            color: #b1b1b1;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .chart-btn:hover {
            background-color: #4a4a4a;
            color: #fff;
        }

        .chart-btn.active {
            background-color: #4a9eff;
            border-color: #4a9eff;
            color: white;
        }

        .overview-member-details {
            background-color: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 4px;
            overflow: hidden;
        }

        .member-details-header {
            background-color: #1a1a1a;
            color: #fff;
            padding: 15px 20px;
            margin: 0;
            border-bottom: 1px solid #3a3a3a;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .member-details-header h3 {
            font-size: 18px;
            font-weight: 600;
        }



        .member-list {
            display: grid;
            gap: 0;
        }

        .member-list-header {
            display: grid;
            grid-template-columns: 1.5fr 2fr 1fr 1.5fr 1fr 1fr 1fr;
            gap: 20px;
            padding: 12px 20px;
            background-color: #2a2a2a;
            color: #b1b1b1;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            border-bottom: 2px solid #3a3a3a;
        }

        .member-item {
            display: grid;
            grid-template-columns: 1.5fr 2fr 1fr 1.5fr 1fr 1fr 1fr;
            gap: 20px;
            align-items: center;
            padding: 12px 20px;
            background-color: #1a1a1a;
            border-bottom: 1px solid #3a3a3a;
            font-size: 14px;
        }

        .member-item:hover {
            background-color: #2a2a2a;
        }

        .member-item:last-child {
            border-bottom: none;
        }

        .member-date {
            color: #b1b1b1;
            font-size: 13px;
        }

        .member-email {
            color: #b1b1b1;
        }

        .clickable-email {
            color: #4a9eff;
            cursor: pointer;
            text-decoration: none;
            transition: color 0.2s ease;
        }

        .clickable-email:hover {
            color: #2196f3;
            text-decoration: underline;
        }

        .member-type {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .member-type.active {
            background-color: rgba(76, 175, 80, 0.2);
            color: #4caf50;
        }

        .member-type.inactive {
            background-color: rgba(255, 152, 0, 0.2);
            color: #ff9800;
        }

        .member-kind {
            color: #e1e1e1;
            font-size: 13px;
        }

        .member-request {
            color: #fff;
            font-weight: 500;
        }

        .member-spend {
            color: #4a9eff;
            font-weight: 600;
        }

        /* í™œë™ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ë„¤ì´ì…˜ ìŠ¤íƒ€ì¼ */
        .activity-pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            padding: 15px 20px;
            background-color: #2a2a2a;
            border-top: 1px solid #3a3a3a;
        }

        .activity-pagination button {
            background: #3a3a3a;
            border: 1px solid #4a4a4a;
            color: #e1e1e1;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .activity-pagination button:hover {
            background: #4a4a4a;
        }

        .activity-pagination button.active {
            background: #4a9eff;
            border-color: #4a9eff;
            color: white;
        }

        .activity-pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .activity-pagination .page-info {
            color: #b1b1b1;
            font-size: 12px;
            margin: 0 10px;
        }

        .activity-page-size-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
        }

        .activity-page-size-selector select {
            background: #3a3a3a;
            color: #fff;
            border: 1px solid #4a4a4a;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        /* ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ í˜ì´ì§€ë„¤ì´ì…˜ ìŠ¤íƒ€ì¼ */
        .user-cumulative-pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            padding: 15px 20px;
            background-color: #2a2a2a;
            border-top: 1px solid #3a3a3a;
        }
        
        .user-cumulative-pagination button {
            background: #3a3a3a;
            color: #e1e1e1;
            border: 1px solid #4a4a4a;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        
        .user-cumulative-pagination button:hover:not(:disabled) {
            background: #4a4a4a;
            border-color: #5a5a5a;
        }
        
        .user-cumulative-pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .user-cumulative-pagination .page-info {
            color: #b1b1b1;
            font-size: 14px;
            min-width: 120px;
            text-align: center;
        }
        
        .user-cumulative-page-size-selector {
            display: flex;
            align-items: center;
        }

        /* ì°¨íŠ¸ ì„ íƒê¸° ìŠ¤íƒ€ì¼ */
        .chart-selector {
            margin-bottom: 20px;
        }

        .chart-selector select {
            padding: 10px 16px;
            background-color: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 6px;
            color: #e1e1e1;
            font-size: 14px;
            cursor: pointer;
            min-width: 250px;
            transition: all 0.3s ease;
        }

        .chart-selector select:hover {
            border-color: #4a9eff;
        }

        .chart-selector select:focus {
            outline: none;
            border-color: #4a9eff;
            box-shadow: 0 0 0 2px rgba(74, 158, 255, 0.2);
        }

        .chart-content {
            display: none;
            background-color: #1a1a1a;
            border: 1px solid #3a3a3a;
            border-radius: 0 6px 6px 6px;
            padding: 20px;
        }

        .chart-content.active {
            display: block;
        }

        .user-cumulative-page-size-selector {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .user-cumulative-page-size-selector select {
            background: #3a3a3a;
            color: #fff;
            border: 1px solid #4a4a4a;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        /* Members í˜ì´ì§€ë„¤ì´ì…˜ ìŠ¤íƒ€ì¼ (All Raw Eventsì™€ ë™ì¼) */
        #members-pagination button {
            background: #3a3a3a;
            border: 1px solid #4a4a4a;
            color: #e1e1e1;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin: 0 2px;
            transition: all 0.2s ease;
        }

        #members-pagination button:hover {
            background: #4a4a4a;
            border-color: #5a5a5a;
        }

        #members-pagination button.active {
            background: #4a9eff;
            border-color: #4a9eff;
            color: white;
            font-weight: 600;
        }

        #members-pagination span {
            color: #7a7a7a;
            padding: 0 5px;
        }

        /* í•„í„° ë° ê²€ìƒ‰ ì˜ì—­ */
        .filter-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 15px 0;
            border-bottom: 1px solid #3a3a3a;
        }

        /* Members ì„¹ì…˜ì—ì„œ êµ¬ë¶„ì„  ì œê±° ë° ê°„ê²© ì¶•ì†Œ */
        #members .filter-controls {
            border-bottom: none;
            margin-bottom: 15px;
            padding: 10px 0;
        }

        .filter-controls         .chart-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .date-picker {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .date-picker input[type="date"] {
            background-color: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 4px;
            padding: 8px 12px;
            color: #fff;
            font-size: 14px;
        }

        /* ë‹¬ë ¥ ì•„ì´ì½˜ ìƒ‰ìƒ ë³€ê²½ */
        .date-picker input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(1) brightness(1.5) sepia(1) saturate(5) hue-rotate(45deg);
            cursor: pointer;
        }

        .date-picker input[type="date"]::-moz-calendar-picker-indicator {
            filter: invert(1) brightness(1.5) sepia(1) saturate(5) hue-rotate(45deg);
            cursor: pointer;
        }

        .date-picker span {
            color: #ccc;
            font-weight: 500;
        }

        .filter-controls .chart-btn {
            min-width: 40px;
        }

        /* ë°ì´í„° ë¡œë”© ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .data-loading-btn {
            background: linear-gradient(135deg, #4a9eff, #007bff);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(74, 158, 255, 0.3);
        }

        .data-loading-btn:hover {
            background: linear-gradient(135deg, #007bff, #0056b3);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(74, 158, 255, 0.4);
        }

        .data-loading-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(74, 158, 255, 0.3);
        }

        .data-loading-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .date-filter-btn {
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            color: #e1e1e1;
            padding: 6px 16px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .date-filter-btn:hover {
            background-color: #3a3a3a;
        }

        .analytics-btn {
            background: transparent;
            border: 1px solid #4a4a4a;
            color: #e1e1e1;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            height: 32px;
        }

        .analytics-btn:hover {
            background-color: #2a2a2a;
        }

        /* ë°°ì§€ ìŠ¤íƒ€ì¼ */
        .role-badge {
            background-color: #3a3a3a;
            color: #e1e1e1;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            display: inline-block;
        }

        .role-badge.admin {
            background-color: #4a9eff;
            color: white;
        }

        /* Members í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        .data-table {
            background-color: #1a1a1a;
            border: 1px solid #3a3a3a;
            border-radius: 8px;
            overflow: hidden;
            width: 100%;
        }

        .table-header {
            background-color: #2a2a2a;
            padding: 15px 20px;
            border-bottom: 1px solid #3a3a3a;
            display: grid;
            grid-template-columns: 2fr 2fr 1fr 1fr 1fr 0.5fr;
            gap: 20px;
            font-size: 12px;
            font-weight: 600;
            color: #b1b1b1;
            text-transform: uppercase;
        }

        .table-row {
            padding: 15px 20px;
            border-bottom: 1px solid #3a3a3a;
            display: grid;
            grid-template-columns: 2fr 2fr 1fr 1fr 1fr 0.5fr;
            gap: 20px;
            align-items: center;
            font-size: 14px;
            background-color: #1a1a1a;
        }

        .table-row:hover {
            background-color: #2a2a2a;
        }

        .table-row:last-child {
            border-bottom: none;
        }

        /* Usage í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        .usage-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .usage-card {
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #3a3a3a;
        }

        .usage-card-number {
            font-size: 32px;
            font-weight: 700;
            color: #fff;
            margin-bottom: 8px;
        }

        .usage-card-label {
            color: #b1b1b1;
            font-size: 14px;
        }

        .search-box {
            background-color: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 6px;
            padding: 8px 12px;
            color: #e1e1e1;
            font-size: 14px;
            width: 250px;
        }

        .search-container {
            position: relative;
            display: inline-block;
        }

        .search-clear-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #f44336;
            cursor: pointer;
            padding: 4px;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .search-clear-btn:hover {
            background-color: #f44336;
            color: white;
        }

        .search-clear-btn:active {
            background-color: #d32f2f;
            color: white;
        }

        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 6px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            margin-top: 2px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .autocomplete-item {
            padding: 10px 12px;
            cursor: pointer;
            border-bottom: 1px solid #3a3a3a;
            transition: background-color 0.2s ease;
        }

        .autocomplete-item:last-child {
            border-bottom: none;
        }

        .autocomplete-item:hover {
            background-color: #3a3a3a;
        }

        .autocomplete-item.selected {
            background-color: #4a9eff;
            color: white;
        }

        .autocomplete-item .user-name {
            font-weight: 600;
            color: #e1e1e1;
            font-size: 14px;
            margin-bottom: 2px;
        }

        .autocomplete-item .user-email {
            color: #b1b1b1;
            font-size: 12px;
        }

        .autocomplete-item.selected .user-name,
        .autocomplete-item.selected .user-email {
            color: white;
        }

        .user-cumulative-info {
            background-color: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 8px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .user-cumulative-header {
            background-color: #1a1a1a;
            color: #fff;
            padding: 15px 20px;
            margin: 0;
            border-bottom: 1px solid #3a3a3a;
            font-size: 18px;
            font-weight: 600;
        }

        .user-cumulative-table {
            background-color: #2a2a2a;
            padding: 15px 20px;
            border-bottom: 1px solid #3a3a3a;
            display: grid;
            grid-template-columns: 1.5fr 2fr 1fr 1.5fr 1fr 1fr;
            gap: 20px;
            font-size: 12px;
            font-weight: 600;
            color: #b1b1b1;
            text-transform: uppercase;
        }

        /* Overview í™œë™ í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .overview-activity-header {
            background-color: #1a1a1a;
            color: #fff;
            padding: 15px 20px;
            margin: 0;
            border-bottom: 1px solid #3a3a3a;
            font-size: 18px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .overview-activity-table {
            background-color: #2a2a2a;
            padding: 15px 20px;
            border-bottom: 1px solid #3a3a3a;
            display: grid;
            grid-template-columns: 1.5fr 2fr 1fr 1.5fr 1fr 1fr 1fr;
            gap: 20px;
            font-size: 12px;
            font-weight: 600;
            color: #b1b1b1;
            text-transform: uppercase;
        }

        /* Export CSV ë²„íŠ¼ í˜¸ë²„ íš¨ê³¼ */
        .export-csv-btn:hover {
            background-color: #45a049 !important;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .export-csv-btn:active {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        .user-cumulative-row {
            padding: 15px 20px;
            border-bottom: 1px solid #3a3a3a;
            display: grid;
            grid-template-columns: 1.5fr 2fr 1fr 1.5fr 1fr 1fr;
            gap: 20px;
            align-items: center;
            font-size: 14px;
            background-color: #1a1a1a;
        }

        .user-cumulative-row:hover {
            background-color: #2a2a2a;
        }

        .user-cumulative-row:last-child {
            border-bottom: none;
        }

        .user-email {
            color: #4a9eff;
            font-weight: 600;
        }

        /* Settings í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        .settings-section {
            background-color: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .accordion-header {
            background-color: #2a2a2a;
            padding: 20px;
            border-bottom: 1px solid #3a3a3a;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s ease;
        }

        .accordion-header:hover {
            background-color: #3a3a3a;
        }

        .accordion-title {
            font-size: 18px;
            font-weight: 600;
            color: #fff;
        }

        .accordion-arrow {
            font-size: 16px;
            color: #b1b1b1;
            transition: transform 0.2s ease;
        }

        .accordion-content {
            display: none;
            padding: 20px;
            background-color: #1a1a1a;
        }

        .accordion-content.active {
            display: block;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #3a3a3a;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-label {
            color: #fff;
            margin-bottom: 4px;
        }

        .setting-description {
            color: #7a7a7a;
            font-size: 12px;
        }

        .toggle-switch {
            width: 44px;
            height: 24px;
            background-color: #4a9eff;
            border-radius: 12px;
            position: relative;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .toggle-switch.off {
            background-color: #5a5a5a;
        }

        .toggle-switch::after {
            content: '';
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 50%;
            position: absolute;
            top: 2px;
            right: 2px;
            transition: all 0.2s ease;
        }

        .toggle-switch.off::after {
            right: 22px;
        }

        .setting-select {
            background: #3a3a3a;
            color: #fff;
            border: 1px solid #4a4a4a;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
        }

        .export-btn {
            background: #4a9eff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .export-btn:hover {
            background: #3a8edf;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }
           
            .menu-text {
                display: none;
            }

            .overview-stats {
                grid-template-columns: 1fr;
            }

            .member-item,
            .member-list-header,
            .table-row,
            .table-header,
            .user-cumulative-row,
            .user-cumulative-table {
                grid-template-columns: 1fr;
                gap: 8px;
            }
        }

        /* ì°¨íŠ¸ ê²€ìƒ‰ì°½ ìŠ¤íƒ€ì¼ ê°œì„  */
        #chart-search-input {
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        #chart-search-input:focus {
            border-color: #4a9eff !important;
            box-shadow: 0 0 0 2px rgba(74, 158, 255, 0.1) !important;
            outline: none;
        }

        /* ê²€ìƒ‰ clear ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .search-clear-btn:hover {
            background-color: #3a3a3a !important;
            color: #e1e1e1 !important;
        }

        /* ë°ì´í„°ë¦¬ìŠ¤íŠ¸ ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ */
        #heatmap-emails-datalist {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- ì‚¬ì´ë“œë°” -->
        <nav class="sidebar">
            <div style="height: 20px;"></div>
            <a href="javascript:void(0)" class="refresh-button" onclick="handleRefreshClick()">
                <span class="menu-icon">ğŸ”„</span>
                <span class="menu-text">ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸</span>
                <div class="refresh-progress">
                    <div class="refresh-progress-bar"></div>
                </div>
            </a>
            <div style="height: 1px; background-color: #3a3a3a; margin: 10px 20px;"></div>
            <a href="javascript:void(0)" class="menu-item active" data-section="overview">
                <span class="menu-icon">ğŸ“Š</span>
                <span class="menu-text">Overview</span>
            </a>
            <a href="javascript:void(0)" class="menu-item" data-section="settings">
                <span class="menu-icon">âš™ï¸</span>
                <span class="menu-text">Settings</span>
            </a>
            <a href="javascript:void(0)" class="menu-item" data-section="members">
                <span class="menu-icon">ğŸ‘¥</span>
                <span class="menu-text">Members</span>
            </a>
            <a href="javascript:void(0)" class="menu-item" data-section="usage">
                <span class="menu-icon">ğŸ“ˆ</span>
                <span class="menu-text">Usage</span>
            </a>
        </nav>

        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <main class="main-content">
            <header class="header">
                <div class="header-left">
                    <h1 id="page-title">Dashboard Overview</h1>
                </div>
                <div class="header-right">
                    <!-- Clear Cache button and Ready status removed -->
                </div>
            </header>

            <div class="content-area">
                <!-- Overview ì„¹ì…˜ -->
                <div id="overview" class="content-section active">
                    <!-- 2.1.1 í•„í„°ë§ ê¸°ëŠ¥ -->
                    <div class="filter-controls">
                        <div class="chart-controls">
                            <div class="filter-period-display">
                                <span id="filter-period-text">2025-08-03 ~ 2025-08-03</span>
                            </div>
                            <button class="chart-btn" data-days="1">1d</button>
                            <button class="chart-btn" data-days="7">7d</button>
                            <button class="chart-btn active" data-days="30">30d</button>
                            <div class="date-picker">
                                <input type="date" id="start-date" />
                                <span>~</span>
                                <input type="date" id="end-date" />
                                <button class="analytics-btn" onclick="applyDateFilter()">ì ìš©</button>
                            </div>
                        </div>

                    </div>

                    <!-- ì‚¬ìš©ëŸ‰ ê°œìš” ì¹´ë“œ (Usageì—ì„œ ì´ë™) -->
                    <div class="usage-cards">
                        <div class="usage-card">
                            <div class="usage-card-number">-</div>
                            <div class="usage-card-label">ì„ íƒëœ ê¸°ê°„ ë‚´ ì‹¤ì œ í™œë™í•œ ì‚¬ìš©ì ìˆ˜</div>
                        </div>
                        <div class="usage-card">
                            <div class="usage-card-number">-</div>
                            <div class="usage-card-label">ì„ íƒëœ ê¸°ê°„ ë‚´ ì—ì´ì „íŠ¸ í¸ì§‘ ë¼ì¸ ìˆ˜</div>
                        </div>
                        <div class="usage-card">
                            <div class="usage-card-number">-</div>
                            <div class="usage-card-label">ì„ íƒëœ ê¸°ê°„ ë‚´ ìˆ˜ë½ëœ íƒ­ ìˆ˜</div>
                        </div>
                        <div class="usage-card">
                            <div class="usage-card-number">-</div>
                            <div class="usage-card-label">ì„ íƒëœ ê¸°ê°„ ë‚´ ì±„íŒ… ìˆ˜</div>
                        </div>
                    </div>

                    <!-- ê·¸ë˜í”„ ì˜ì—­ -->
                    <div class="overview-chart-container">
                        <div class="chart-header">
                            <div class="chart-selector">
                                <select id="chartSelect" onchange="handleChartChange(this.value)">
                                    <option value="activity-trend">ğŸ“ˆ ì¼ë³„ í™œë™ ì¶”ì´</option>
                                    <option value="model-distribution">ğŸ“Š ëª¨ë¸ ì‚¬ìš© ë¶„í¬</option>
                                    <option value="cost-trend">ğŸ’° ë¹„ìš© ì¶”ì´</option>
                                    <option value="activity-type">ğŸ“Š í™œë™ ìœ í˜• ë¶„í¬</option>
                                    <option value="user-heatmap">ğŸ”¥ ì‚¬ìš©ì í™œë™ íˆíŠ¸ë§µ</option>
                                    <option value="cost-efficiency">ğŸ“Š ë¹„ìš© íš¨ìœ¨ì„± ë¶„ì„</option>
                                    <option value="model-preference">ğŸ¯ ëª¨ë¸ ì„ í˜¸ë„</option>
                                    <option value="user-performance">ğŸ† ì‚¬ìš©ìë³„ ì„±ê³¼</option>
                                    <option value="activity-type-detailed">ğŸ“ˆ í™œë™ ìœ í˜• ìƒì„¸</option>
                                </select>
                            </div>
                            <!-- ì°¨íŠ¸ë³„ ê²€ìƒ‰ì°½ (ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€) -->
                            <div id="chart-search-container" class="chart-search" style="display: none; margin-top: 10px;">
                                <div class="search-container">
                                    <div style="position: relative; display: flex; align-items: center; max-width: 300px;">
                                        <span style="position: absolute; left: 12px; color: #7a7a7a; font-size: 14px;">ğŸ”</span>
                                        <input type="text" class="search-box" id="chart-search-input" placeholder="Search..." onkeyup="handleChartSearch(this.value)" oninput="toggleSearchClearBtn('chart-search-input')" autocomplete="off" style="padding-left: 35px; border-radius: 8px; border: 1px solid #3a3a3a; background-color: #2a2a2a; color: #e1e1e1; padding-right: 35px;">
                                        <button class="search-clear-btn" id="chart-search-input-clear" onclick="clearChartSearch('chart-search-input')" style="display: none; position: absolute; right: 8px; background: none; border: none; color: #7a7a7a; font-size: 18px; cursor: pointer; padding: 4px; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">Ã—</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="activity-trend-chart" class="chart-content active">
                            <canvas id="overviewChart" style="width: 100%; height: 300px;"></canvas>
                        </div>
                        <div id="model-distribution-chart" class="chart-content">
                            <canvas id="modelDistributionChart" style="width: 100%; height: 300px;"></canvas>
                        </div>
                        <div id="cost-trend-chart" class="chart-content">
                            <canvas id="costTrendChart" style="width: 100%; height: 300px;"></canvas>
                        </div>
                        <div id="activity-type-chart" class="chart-content">
                            <canvas id="activityTypeChart" style="width: 100%; height: 300px;"></canvas>
                        </div>
                        <div id="user-heatmap-chart" class="chart-content">
                            <canvas id="userHeatmapChart" style="width: 100%; height: 300px;"></canvas>
                        </div>
                        <div id="cost-efficiency-chart" class="chart-content">
                            <canvas id="costEfficiencyChart" style="width: 100%; height: 300px;"></canvas>
                        </div>
                        <div id="model-preference-chart" class="chart-content">
                            <canvas id="modelPreferenceChart" style="width: 100%; height: 300px;"></canvas>
                        </div>
                        <div id="user-performance-chart" class="chart-content">
                            <canvas id="userPerformanceChart" style="width: 100%; height: 300px;"></canvas>
                        </div>
                        <div id="activity-type-detailed-chart" class="chart-content">
                            <canvas id="activityTypeDetailedChart" style="width: 100%; height: 300px;"></canvas>
                        </div>
                    </div>

                    <!-- 2.1.2 í†µê³„ ì¹´ë“œ -->
                    <div class="overview-stats">
                        <div class="overview-stat-box clickable" data-type="total" onclick="filterOverviewMembersByType('total')">
                            <div class="stat-number">20</div>
                            <div class="stat-label">
                                <span class="role-badge" style="background-color: #4a9eff; color: white;">ì „ì²´ ë©¤ë²„</span>
                            </div>
                            <div class="stat-description">ëª¨ë“  ë©¤ë²„ì˜ í™œë™ ê¸°ë¡</div>
                        </div>
                        <div class="overview-stat-box clickable" data-type="active" onclick="filterOverviewMembersByType('active')">
                            <div class="stat-number">13</div>
                            <div class="stat-label">
                                <span class="role-badge" style="background-color: #4caf50; color: white;">í™œì„± ë©¤ë²„</span>
                            </div>
                            <div class="stat-description">í™œì„± ë©¤ë²„ì˜ í™œë™ ê¸°ë¡</div>
                        </div>
                        <div class="overview-stat-box clickable" data-type="inactive" onclick="filterOverviewMembersByType('inactive')">
                            <div class="stat-number">7</div>
                            <div class="stat-label">
                                <span class="role-badge" style="background-color: #ff9800; color: white;">ë¹„í™œì„± ë©¤ë²„</span>
                            </div>
                            <div class="stat-description">ë¹„í™œì„± ë©¤ë²„ì˜ í™œë™ ê¸°ë¡</div>
                        </div>
                    </div>

                    <!-- ë©¤ë²„ ì„¸ë¶€ ë¦¬ìŠ¤íŠ¸ -->
                    <div class="overview-member-details">
                        <div class="overview-activity-header">ğŸ“‹ í™œë™ ë¦¬ìŠ¤íŠ¸</div>
                        <div class="overview-activity-table">
                            <div>ë§ˆì§€ë§‰ í™œë™</div>
                            <div>ì‚¬ìš©ì</div>
                            <div>ìƒíƒœ</div>
                            <div>í™œë™ ìœ í˜•</div>
                            <div>ìš”ì²­ ìˆ˜</div>
                            <div>ë¹„ìš©</div>
                            <div>ì œí•œ</div>
                        </div>
                        <div id="overview-activity-container">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  í…Œì´ë¸” ë‚´ìš© -->
                            <div style="padding: 20px; text-align: center; color: #7a7a7a; background-color: #1a1a1a;">
                                ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                            </div>
                        </div>
                        
                        <!-- Overview í™œë™ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ë„¤ì´ì…˜ (Members ìŠ¤íƒ€ì¼) -->
                        <div id="overview-activity-pagination" style="display: none; padding: 15px 20px; background-color: #2a2a2a; border-top: 1px solid #3a3a3a; text-align: center;">
                            <!-- ìˆ«ì í˜ì´ì§€ ë²„íŠ¼ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                        </div>
                    </div>
                </div>

                <!-- Members ì„¹ì…˜ -->
                <div id="members" class="content-section">
                    <div class="filter-controls" style="margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                            <div style="color: #e1e1e1; font-size: 14px; font-weight: 500; margin-left: 20px;">
                                Fast Requests last reset on: <span id="fast-requests-reset-date" style="color: #ffffff; font-weight: 600;">2025ë…„ 7ì›” 22ì¼</span> (ì˜¤ëŠ˜ ë‚ ì§œ: <span id="today-date" style="color: #ff9800; font-weight: 600;">2025-08-03</span>)
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px; margin-left: auto;">
                                <div class="search-container">
                                    <div style="position: relative; display: flex; align-items: center;">
                                        <span style="position: absolute; left: 12px; color: #7a7a7a; font-size: 14px;">ğŸ”</span>
                                        <input type="text" class="search-box" id="members-search" placeholder="Search name, email..." onkeyup="filterMembers(this.value)" oninput="toggleSearchClearBtn('members-search'); showAutocomplete('members-search')" autocomplete="off" style="padding-left: 35px;">
                                        <button class="search-clear-btn" id="members-search-clear" onclick="clearSearch('members-search')" style="display: none;">Ã—</button>
                                    </div>
                                    <div id="members-autocomplete" class="autocomplete-dropdown" style="display: none;"></div>
                                </div>
                                <button class="export-csv-btn" onclick="exportMembersToCSV()" style="background: #4caf50; color: white; border: none; padding: 8px 16px; border-radius: 4px; font-size: 14px; font-weight: 500; cursor: pointer; transition: background-color 0.2s ease;">
                                    ğŸ“Š Export CSV
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="data-table" id="members-table-container">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  í…Œì´ë¸” í—¤ë”ì™€ ë‚´ìš© -->
                        <div style="padding: 20px; text-align: center; color: #7a7a7a; background-color: #1a1a1a;">
                            ì‹¤ì œ ë©¤ë²„ ë°ì´í„°ë¥¼ ë¡œë”©í•˜ëŠ” ì¤‘...
                        </div>
                    </div>
                    
                    <!-- Members í˜ì´ì§€ë„¤ì´ì…˜ (All Raw Events ìŠ¤íƒ€ì¼) -->
                    <div id="members-pagination" style="display: none; padding: 15px 20px; background-color: #2a2a2a; border-top: 1px solid #3a3a3a; text-align: center;">
                        <!-- ìˆ«ì í˜ì´ì§€ ë²„íŠ¼ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                    </div>
                </div>

                <!-- Usage ì„¹ì…˜ -->
                <div id="usage" class="content-section">
                    <!-- ë‚ ì§œ í•„í„°ì™€ ê²€ìƒ‰ -->
                    <div class="filter-controls">
                        <div class="chart-controls">
                            <div class="filter-period-display">
                                <span id="usage-filter-period-text">2025-08-03 ~ 2025-08-03</span>
                            </div>
                            <button class="chart-btn" data-days="1">1d</button>
                            <button class="chart-btn" data-days="7">7d</button>
                            <button class="chart-btn active" data-days="30">30d</button>
                            <div class="date-picker">
                                <input type="date" id="usage-start-date" />
                                <span>~</span>
                                <input type="date" id="usage-end-date" />
                                <button class="analytics-btn" onclick="applyUsageDateFilter()">ì ìš©</button>
                            </div>
                        </div>
                        <div>
                            <div class="search-container">
                                <div style="position: relative; display: flex; align-items: center;">
                                    <span style="position: absolute; left: 12px; color: #7a7a7a; font-size: 14px;">ğŸ”</span>
                                    <input type="text" class="search-box" id="usage-search" placeholder="Search name, email..." onkeyup="filterUsageMembers(this.value)" oninput="toggleSearchClearBtn('usage-search'); showAutocomplete('usage-search')" autocomplete="off" style="padding-left: 35px;">
                                    <button class="search-clear-btn" id="usage-search-clear" onclick="clearSearch('usage-search')" style="display: none;">Ã—</button>
                                </div>
                                <div id="usage-autocomplete" class="autocomplete-dropdown" style="display: none;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- ì‚¬ìš©ìë³„ ëˆ„ì  ì •ë³´ -->
                    <div class="user-cumulative-info">
                        <div class="user-cumulative-header">ğŸ“Š ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´</div>
                        <div class="user-cumulative-table">
                            <div>NAME</div>
                            <div>EMAIL</div>
                            <div>ROLE</div>
                            <div>REQUEST</div>
                            <div>SPEND</div>
                            <div>LAST ACT</div>
                        </div>
                        <div id="user-cumulative-container">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  í…Œì´ë¸” ë‚´ìš© -->
                            <div style="padding: 20px; text-align: center; color: #7a7a7a; background-color: #1a1a1a;">
                                ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                            </div>
                        </div>
                        
                        <!-- ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ í˜ì´ì§€ë„¤ì´ì…˜ (All Raw Events ìŠ¤íƒ€ì¼) -->
                        <div id="user-cumulative-pagination" style="display: none; padding: 15px 20px; background-color: #2a2a2a; border-top: 1px solid #3a3a3a; text-align: center;">
                            <!-- ìˆ«ì í˜ì´ì§€ ë²„íŠ¼ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                        </div>
                    </div>

                    <!-- All Raw Events í…Œì´ë¸” -->
                    <div class="user-cumulative-info">
                        <div class="user-cumulative-header">ğŸ“‹ All Raw Events</div>
                        <div class="user-cumulative-table">
                            <div>DATE</div>
                            <div>USER</div>
                            <div>KIND</div>
                            <div>MAX_MODEL</div>
                            <div>MODEL</div>
                            <div>COST</div>
                        </div>
                        <div style="padding: 20px; text-align: center; color: #7a7a7a; background-color: #1a1a1a;">
                            ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                        </div>
                        
                        <!-- í•„í„°ë§ëœ ì´ë²¤íŠ¸ í˜ì´ì§€ë„¤ì´ì…˜ -->
                        <div class="filtered-events-pagination" style="display: none; padding: 15px 20px; background-color: #2a2a2a; border-top: 1px solid #3a3a3a; text-align: center;">
                            <!-- ìˆ«ì í˜ì´ì§€ ë²„íŠ¼ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                        </div>
                    </div>
                </div>

                <!-- Settings ì„¹ì…˜ -->
                <div id="settings" class="content-section">
                    <!-- í™œì„± ê¸°ê°„ ì„¤ì • -->
                    <div class="settings-section">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <div class="accordion-title">í™œì„± ê¸°ê°„ ì„¤ì •</div>
                            <div class="accordion-arrow">â–¼</div>
                        </div>
                        <div class="accordion-content">
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">í™œì„± ìƒíƒœ ìë™ ì „í™˜</div>
                                    <div class="setting-description">ì§€ì •ëœ ê¸°ê°„ ë™ì•ˆ í™œë™ì´ ì—†ìœ¼ë©´ ìë™ìœ¼ë¡œ ë¹„í™œì„± ìƒíƒœë¡œ ì „í™˜ë©ë‹ˆë‹¤</div>
                                </div>
                                <div class="toggle-switch" onclick="toggleSwitch(this)"></div>
                            </div>
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">ë¹„í™œì„± ì „í™˜ ê¸°ê°„</div>
                                    <div class="setting-description">í™œë™ì´ ì—†ì„ ê²½ìš° ë¹„í™œì„±ìœ¼ë¡œ ì „í™˜ë˜ëŠ” ê¸°ê°„</div>
                                </div>
                                <select class="setting-select">
                                    <option>7ì¼</option>
                                    <option>14ì¼</option>
                                    <option selected>30ì¼</option>
                                    <option>60ì¼</option>
                                    <option>90ì¼</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">í™œì„± ìƒíƒœ ì•Œë¦¼</div>
                                    <div class="setting-description">ë¹„í™œì„± ì „í™˜ ì „ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ì„ ë°œì†¡í•©ë‹ˆë‹¤</div>
                                </div>
                                <div class="toggle-switch" onclick="toggleSwitch(this)"></div>
                            </div>
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">ì•Œë¦¼ ë°œì†¡ ì‹œì </div>
                                    <div class="setting-description">ë¹„í™œì„± ì „í™˜ ëª‡ ì¼ ì „ì— ì•Œë¦¼ì„ ë°œì†¡í• ì§€ ì„¤ì •</div>
                                </div>
                                <select class="setting-select">
                                    <option>1ì¼ ì „</option>
                                    <option selected>3ì¼ ì „</option>
                                    <option>7ì¼ ì „</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Email Report ì„¤ì • -->
                    <div class="settings-section">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <div class="accordion-title">Email Report ì„¤ì •</div>
                            <div class="accordion-arrow">â–¼</div>
                        </div>
                        <div class="accordion-content">
                            <!-- ì˜ˆì•½ ë©”ì¼ ë°œì†¡ ê´€ë¦¬ -->
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">ì˜ˆì•½ ë©”ì¼ ë°œì†¡ ê´€ë¦¬</div>
                                    <div class="setting-description">ì˜ˆì•½ëœ ë©”ì¼ì˜ ìë™ ë°œì†¡ì„ ê´€ë¦¬í•©ë‹ˆë‹¤</div>
                                </div>
                                <div class="toggle-switch" onclick="toggleSwitch(this)"></div>
                            </div>

                            <!-- ë°œì†¡ ì£¼ê¸° -->
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">ë°œì†¡ ì£¼ê¸°</div>
                                    <div class="setting-description">ë¦¬í¬íŠ¸ë¥¼ ë°œì†¡í•  ì£¼ê¸°ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
                                </div>
                                <select class="setting-select" id="email-frequency-select" style="background-color: transparent;" onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'">
                                    <option value="daily">ë§¤ì¼</option>
                                    <option value="weekly" selected>ë§¤ì£¼</option>
                                    <option value="monthly">ë§¤ì›”</option>
                                </select>
                            </div>

                            <!-- ë°œì†¡ ì‹œê°„ ì„¤ì • -->
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">ë°œì†¡ ì‹œê°„ ì„¤ì •</div>
                                    <div class="setting-description">ë¦¬í¬íŠ¸ë¥¼ ë°œì†¡í•  êµ¬ì²´ì ì¸ ì‹œê°„ì„ ì„¤ì •í•˜ì„¸ìš”</div>
                                </div>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <select id="email-hour-select" style="
                                        background-color: transparent;
                                        border: 1px solid #3a3a3a;
                                        border-radius: 4px;
                                        padding: 8px 12px;
                                        color: #e1e1e1;
                                        font-size: 14px;
                                        font-family: inherit;
                                        transition: background-color 0.2s ease;
                                        min-width: 120px;
                                        max-height: 200px;
                                        overflow-y: auto;
                                    " onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'" onchange="updateTimeInput()">
                                        <option value="00">ì˜¤ì „ 12ì‹œ</option>
                                        <option value="01">ì˜¤ì „ 1ì‹œ</option>
                                        <option value="02">ì˜¤ì „ 2ì‹œ</option>
                                        <option value="03">ì˜¤ì „ 3ì‹œ</option>
                                        <option value="04">ì˜¤ì „ 4ì‹œ</option>
                                        <option value="05">ì˜¤ì „ 5ì‹œ</option>
                                        <option value="06">ì˜¤ì „ 6ì‹œ</option>
                                        <option value="07">ì˜¤ì „ 7ì‹œ</option>
                                        <option value="08">ì˜¤ì „ 8ì‹œ</option>
                                        <option value="09" selected>ì˜¤ì „ 9ì‹œ</option>
                                        <option value="10">ì˜¤ì „ 10ì‹œ</option>
                                        <option value="11">ì˜¤ì „ 11ì‹œ</option>
                                        <option value="12">ì˜¤í›„ 12ì‹œ</option>
                                        <option value="13">ì˜¤í›„ 1ì‹œ</option>
                                        <option value="14">ì˜¤í›„ 2ì‹œ</option>
                                        <option value="15">ì˜¤í›„ 3ì‹œ</option>
                                        <option value="16">ì˜¤í›„ 4ì‹œ</option>
                                        <option value="17">ì˜¤í›„ 5ì‹œ</option>
                                        <option value="18">ì˜¤í›„ 6ì‹œ</option>
                                        <option value="19">ì˜¤í›„ 7ì‹œ</option>
                                        <option value="20">ì˜¤í›„ 8ì‹œ</option>
                                        <option value="21">ì˜¤í›„ 9ì‹œ</option>
                                        <option value="22">ì˜¤í›„ 10ì‹œ</option>
                                        <option value="23">ì˜¤í›„ 11ì‹œ</option>
                                    </select>
                                    <select id="email-minute-select" style="
                                        background-color: transparent;
                                        border: 1px solid #3a3a3a;
                                        border-radius: 4px;
                                        padding: 8px 12px;
                                        color: #e1e1e1;
                                        font-size: 14px;
                                        font-family: inherit;
                                        transition: background-color 0.2s ease;
                                        min-width: 80px;
                                        max-height: 200px;
                                        overflow-y: auto;
                                    " onfocus="this.style.backgroundColor='#3a3a3a'" onblur="this.style.backgroundColor='transparent'" onchange="updateTimeInput()">
                                        <option value="00" selected>00ë¶„</option>
                                        <option value="01">01ë¶„</option>
                                        <option value="02">02ë¶„</option>
                                        <option value="03">03ë¶„</option>
                                        <option value="04">04ë¶„</option>
                                        <option value="05">05ë¶„</option>
                                        <option value="06">06ë¶„</option>
                                        <option value="07">07ë¶„</option>
                                        <option value="08">08ë¶„</option>
                                        <option value="09">09ë¶„</option>
                                        <option value="10">10ë¶„</option>
                                        <option value="11">11ë¶„</option>
                                        <option value="12">12ë¶„</option>
                                        <option value="13">13ë¶„</option>
                                        <option value="14">14ë¶„</option>
                                        <option value="15">15ë¶„</option>
                                        <option value="16">16ë¶„</option>
                                        <option value="17">17ë¶„</option>
                                        <option value="18">18ë¶„</option>
                                        <option value="19">19ë¶„</option>
                                        <option value="20">20ë¶„</option>
                                        <option value="21">21ë¶„</option>
                                        <option value="22">22ë¶„</option>
                                        <option value="23">23ë¶„</option>
                                        <option value="24">24ë¶„</option>
                                        <option value="25">25ë¶„</option>
                                        <option value="26">26ë¶„</option>
                                        <option value="27">27ë¶„</option>
                                        <option value="28">28ë¶„</option>
                                        <option value="29">29ë¶„</option>
                                        <option value="30">30ë¶„</option>
                                        <option value="31">31ë¶„</option>
                                        <option value="32">32ë¶„</option>
                                        <option value="33">33ë¶„</option>
                                        <option value="34">34ë¶„</option>
                                        <option value="35">35ë¶„</option>
                                        <option value="36">36ë¶„</option>
                                        <option value="37">37ë¶„</option>
                                        <option value="38">38ë¶„</option>
                                        <option value="39">39ë¶„</option>
                                        <option value="40">40ë¶„</option>
                                        <option value="41">41ë¶„</option>
                                        <option value="42">42ë¶„</option>
                                        <option value="43">43ë¶„</option>
                                        <option value="44">44ë¶„</option>
                                        <option value="45">45ë¶„</option>
                                        <option value="46">46ë¶„</option>
                                        <option value="47">47ë¶„</option>
                                        <option value="48">48ë¶„</option>
                                        <option value="49">49ë¶„</option>
                                        <option value="50">50ë¶„</option>
                                        <option value="51">51ë¶„</option>
                                        <option value="52">52ë¶„</option>
                                        <option value="53">53ë¶„</option>
                                        <option value="54">54ë¶„</option>
                                        <option value="55">55ë¶„</option>
                                        <option value="56">56ë¶„</option>
                                        <option value="57">57ë¶„</option>
                                        <option value="58">58ë¶„</option>
                                        <option value="59">59ë¶„</option>
                                    </select>
                                    <!-- ìˆ¨ê²¨ì§„ time input (ê¸°ì¡´ ë¡œì§ í˜¸í™˜ì„±ì„ ìœ„í•´) -->
                                    <input type="time" id="email-time-input" value="09:00" style="display: none;">
                                </div>
                            </div>

                            <!-- ë°œì†¡ ë©”ì‹œì§€ ì…ë ¥ -->
                            <div class="setting-item" style="flex-direction: column; align-items: flex-start;">
                                <div style="margin-bottom: 15px;">
                                    <div class="setting-label">ë°œì†¡ ë©”ì‹œì§€ ì…ë ¥</div>
                                    <div class="setting-description">ì´ë©”ì¼ ë¦¬í¬íŠ¸ì— í¬í•¨ë  ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”</div>
                                </div>
                                <div style="
                                    position: relative;
                                    background-color: #1a1a1a;
                                    border: 1px solid #3a3a3a;
                                    border-radius: 4px;
                                    transition: all 0.2s ease;
                                    width: 100%;
                                    max-width: 800px;
                                ">
                                    <textarea 
                                        id="email-report-message" 
                                        placeholder="ì´ë©”ì¼ì— í¬í•¨ë  ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
                                        style="
                                            width: 100%;
                                            height: 120px;
                                            padding: 12px;
                                            border: none;
                                            background: transparent;
                                            color: #ff9800;
                                            font-size: 14px;
                                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                                            line-height: 1.5;
                                            outline: none;
                                            resize: vertical;
                                            min-height: 120px;
                                            max-height: 200px;
                                            box-sizing: border-box;
                                        "
                                        onfocus="this.parentElement.style.backgroundColor='#2a2a2a'; this.parentElement.style.borderColor='#4a9eff'"
                                        onblur="this.parentElement.style.backgroundColor='#1a1a1a'; this.parentElement.style.borderColor='#3a3a3a'"
                                        oninput="updateMessageCharCount(); syncMessageInputs('email-report-message')"
                                    ></textarea>
                                </div>
                                <div style="
                                    color: #7a7a7a;
                                    font-size: 12px;
                                    margin-top: 5px;
                                    text-align: right;
                                    width: 100%;
                                    max-width: 800px;
                                ">
                                    <span id="report-message-char-count">0</span>/1000 ê¸€ì
                                </div>
                            </div>

                            <!-- ìˆ˜ì‹ ì ê·¸ë£¹ -->
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">ìˆ˜ì‹ ì ê·¸ë£¹</div>
                                    <div class="setting-description">ë¦¬í¬íŠ¸ë¥¼ ë°›ì„ ëŒ€ìƒì„ ì„¤ì •í•©ë‹ˆë‹¤</div>
                                </div>
                                <div style="display: flex; gap: 10px;">
                                    <label style="display: flex; align-items: center; gap: 5px;">
                                        <input type="checkbox" id="admin-checkbox" checked style="width: 16px; height: 16px;" onchange="updateRecipientCount()">
                                        <span style="color: #e1e1e1; font-size: 14px;">ê´€ë¦¬ì</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 5px;">
                                        <input type="checkbox" id="all-members-checkbox" style="width: 16px; height: 16px;" onchange="updateRecipientCount()">
                                        <span style="color: #e1e1e1; font-size: 14px;">ì „ì²´ ë©¤ë²„</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 5px;">
                                        <input type="checkbox" id="inactive-members-checkbox" style="width: 16px; height: 16px;" onchange="updateRecipientCount()">
                                        <span style="color: #e1e1e1; font-size: 14px;">ë¹„í™œì„± ë©¤ë²„</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 5px;">
                                        <input type="checkbox" id="custom-email-checkbox" style="width: 16px; height: 16px;" onclick="toggleCustomEmailInput(this)" onchange="updateRecipientCount()">
                                        <span style="color: #e1e1e1; font-size: 14px;">ì§ì ‘ ì…ë ¥</span>
                                    </label>
                                </div>
                                
                            </div>
                            
                            <!-- ì§ì ‘ ì…ë ¥ ì˜ì—­ -->
                            <div id="custom-email-input" style="display: none; margin-top: 10px;">
                                <div style="margin-bottom: 15px;">
                                    <div class="setting-label">ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ ì£¼ì†Œ</div>
                                    <div class="setting-description">ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì—¬ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”</div>
                                </div>
                                <div style="
                                    position: relative;
                                    background-color: #1a1a1a;
                                    border: 1px solid #3a3a3a;
                                    border-radius: 4px;
                                    transition: all 0.2s ease;
                                    width: 100%;
                                    max-width: 800px;
                                ">
                                    <textarea
                                        id="custom-emails"
                                        placeholder="emailì„ ì§ì ‘ ì…ë ¥ í•˜ì„¸ìš”.(example1@samsung.com, example2@samsung.com)"
                                        style="
                                            width: 100%;
                                            height: 120px;
                                            padding: 12px;
                                            border: none;
                                            background: transparent;
                                            color: #ff9800;
                                            font-size: 14px;
                                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                                            line-height: 1.5;
                                            outline: none;
                                            resize: vertical;
                                            min-height: 120px;
                                            max-height: 200px;
                                            box-sizing: border-box;
                                        "
                                        onfocus="this.parentElement.style.backgroundColor='#2a2a2a'; this.parentElement.style.borderColor='#4a9eff'"
                                        onblur="this.parentElement.style.backgroundColor='#1a1a1a'; this.parentElement.style.borderColor='#3a3a3a'"
                                    ></textarea>
                                </div>
                            </div>
                            
                            <!-- í•˜ë‹¨ ë²„íŠ¼ -->
                            <div class="setting-item" style="margin-top: 20px;">
                                <div>
                                    <div class="setting-label">ì„¤ì • ê´€ë¦¬</div>
                                    <div class="setting-description">í˜„ì¬ ì„¤ì •ì„ í™•ì¸í•˜ê³  ì €ì¥í•©ë‹ˆë‹¤</div>
                                </div>
                                <div style="display: flex; gap: 10px;">
                                    <button class="analytics-btn" onclick="showEmailScheduleList()">ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸</button>
                                    <button class="analytics-btn" onclick="showEmailRecipients()">ìˆ˜ì‹ ì ë³´ê¸°</button>
                                    <button class="analytics-btn" onclick="saveEmailSettings()">ì„¤ì • ì €ì¥</button>
                                </div>
                            </div>


                        </div>
                    </div>

                    <!-- Export Documents ì„¤ì • -->
                    <div class="settings-section">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <div class="accordion-title">Export Documents ì„¤ì •</div>
                            <div class="accordion-arrow">â–¼</div>
                        </div>
                        <div class="accordion-content">
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">ìë™ ë°±ì—…</div>
                                    <div class="setting-description">ë°ì´í„°ë¥¼ ì •ê¸°ì ìœ¼ë¡œ ìë™ ë°±ì—…í•©ë‹ˆë‹¤</div>
                                </div>
                                <div class="toggle-switch" onclick="toggleSwitch(this)"></div>
                            </div>
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">Export í˜•ì‹</div>
                                    <div class="setting-description">ë¬¸ì„œë¥¼ ë‚´ë³´ë‚¼ íŒŒì¼ í˜•ì‹ì„ ì„ íƒí•©ë‹ˆë‹¤</div>
                                </div>
                                <select class="setting-select">
                                    <option>CSV</option>
                                    <option selected>Excel (XLSX)</option>
                                    <option>PDF</option>
                                    <option>JSON</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <div>
                                    <div class="setting-label">Export ë²”ìœ„</div>
                                    <div class="setting-description">ë‚´ë³´ë‚¼ ë°ì´í„°ì˜ ê¸°ê°„ì„ ì„¤ì •í•©ë‹ˆë‹¤</div>
                                </div>
                                <select class="setting-select">
                                    <option>ìµœê·¼ 7ì¼</option>
                                    <option selected>ìµœê·¼ 30ì¼</option>
                                    <option>ìµœê·¼ 90ì¼</option>
                                    <option>ì „ì²´ ê¸°ê°„</option>
                                    <option>ì‚¬ìš©ì ì§€ì •</option>
                                </select>
                            </div>
                            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #3a3a3a;">
                                <button class="export-btn">ğŸ“¥ ì§€ê¸ˆ Export í•˜ê¸°</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // ë©¤ë²„ í™œë™ ë°ì´í„°
        const memberData = {
            total: [
                { date: "25ë…„ 7ì›” 25ì¼ (ì˜¤ëŠ˜)", email: "greenmold@samsung.com", type: "active", kind: "Chat Request", request: "3", spend: "$0.05" },
                { date: "25ë…„ 7ì›” 25ì¼ (ì˜¤ëŠ˜)", email: "ck9104.lee@samsung.com", type: "active", kind: "Code Generation", request: "2", spend: "$0.03" },
                { date: "25ë…„ 7ì›” 25ì¼ (ì˜¤ëŠ˜)", email: "by07.so@samsung.com", type: "active", kind: "Analysis", request: "5", spend: "$0.08" },
                { date: "25ë…„ 7ì›” 24ì¼ (1ì¼ì „)", email: "dynamic.choi@samsung.com", type: "inactive", kind: "Chat Request", request: "1", spend: "$0.01" },
                { date: "25ë…„ 7ì›” 24ì¼ (1ì¼ì „)", email: "darney.jeon@samsung.com", type: "inactive", kind: "Code Review", request: "2", spend: "$0.02" },
                { date: "25ë…„ 7ì›” 24ì¼ (1ì¼ì „)", email: "j0117.lee@samsung.com", type: "active", kind: "Documentation", request: "4", spend: "$0.04" },
                { date: "25ë…„ 7ì›” 24ì¼ (1ì¼ì „)", email: "kaeul.kim@samsung.com", type: "active", kind: "Chat Request", request: "6", spend: "$0.06" },
                { date: "25ë…„ 7ì›” 24ì¼ (1ì¼ì „)", email: "nw.aioffice@samsung.com", type: "inactive", kind: "Analysis", request: "1", spend: "$0.01" },
                { date: "25ë…„ 7ì›” 24ì¼ (1ì¼ì „)", email: "sh.ryan.park@samsung.com", type: "active", kind: "Code Generation", request: "7", spend: "$0.07" },
                { date: "25ë…„ 7ì›” 24ì¼ (1ì¼ì „)", email: "sejin.seo@samsung.com", type: "active", kind: "Chat Request", request: "3", spend: "$0.03" },
                { date: "25ë…„ 7ì›” 23ì¼ (2ì¼ì „)", email: "sol22.lee@samsung.com", type: "inactive", kind: "Documentation", request: "2", spend: "$0.02" },
                { date: "25ë…„ 7ì›” 23ì¼ (2ì¼ì „)", email: "shee.lim@samsung.com", type: "inactive", kind: "Analysis", request: "1", spend: "$0.01" },
                { date: "25ë…„ 7ì›” 23ì¼ (2ì¼ì „)", email: "joseph2.jeon@samsung.com", type: "active", kind: "Code Review", request: "5", spend: "$0.05" },
                { date: "25ë…„ 7ì›” 23ì¼ (2ì¼ì „)", email: "taewoo.bang@samsung.com", type: "inactive", kind: "Chat Request", request: "1", spend: "$0.01" },
                { date: "25ë…„ 7ì›” 23ì¼ (2ì¼ì „)", email: "baewj@samsung.com", type: "inactive", kind: "Code Generation", request: "3", spend: "$0.03" },
                { date: "25ë…„ 7ì›” 22ì¼ (3ì¼ì „)", email: "yj7.park@samsung.com", type: "active", kind: "Analysis", request: "4", spend: "$0.04" },
                { date: "25ë…„ 7ì›” 22ì¼ (3ì¼ì „)", email: "nemo.kim@samsung.com", type: "active", kind: "Chat Request", request: "6", spend: "$0.06" },
                { date: "25ë…„ 7ì›” 22ì¼ (3ì¼ì „)", email: "ms0402.kim@samsung.com", type: "active", kind: "Documentation", request: "3", spend: "$0.03" },
                { date: "25ë…„ 7ì›” 21ì¼ (4ì¼ì „)", email: "shx.kim@samsung.com", type: "active", kind: "Code Review", request: "5", spend: "$0.05" },
                { date: "25ë…„ 7ì›” 21ì¼ (4ì¼ì „)", email: "greenmold@samsung.com", type: "active", kind: "Analysis", request: "8", spend: "$0.08" }
            ]
        };

        // í™œì„±/ë¹„í™œì„± ë©¤ë²„ í™œë™ ë¶„ë¥˜
        memberData.active = memberData.total.filter(activity => activity.type === "active");
        memberData.inactive = memberData.total.filter(activity => activity.type === "inactive");

        // ë©¤ë²„ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
        function renderMemberList(type) {
            const memberList = document.getElementById('member-list');
            const memberListTitle = document.getElementById('member-list-title');
           
            let activities = [];
            let title = "";
            let icon = "";
           
            switch(type) {
                case 'active':
                    activities = memberData.active;
                    title = "í™œì„± ë©¤ë²„ í™œë™ ë¦¬ìŠ¤íŠ¸";
                    icon = "ğŸŸ¢";
                    break;
                case 'inactive':
                    activities = memberData.inactive;
                    title = "ë¹„í™œì„± ë©¤ë²„ í™œë™ ë¦¬ìŠ¤íŠ¸";
                    icon = "ğŸŸ ";
                    break;
                default:
                    activities = memberData.total;
                    title = "ì „ì²´ í™œë™ ë¦¬ìŠ¤íŠ¸";
                    icon = "ğŸ“Š";
            }
           
            memberListTitle.textContent = `${icon} ${title}`;
           
            memberList.innerHTML = `
                <div class="member-list-header">
                    <div>DATE</div>
                    <div>EMAIL</div>
                    <div>TYPE</div>
                    <div>KIND</div>
                    <div>REQUEST</div>
                    <div>SPEND</div>
                </div>
                ${activities.map(activity => `
                    <div class="member-item">
                        <div class="member-date">${activity.date}</div>
                        <div class="member-email">${activity.email}</div>
                        <div class="member-type ${activity.type}">${activity.type === 'active' ? 'í™œì„±' : 'ë¹„í™œì„±'}</div>
                        <div class="member-kind">${activity.kind}</div>
                        <div class="member-request">${activity.request}</div>
                        <div class="member-spend">${activity.spend}</div>
                    </div>
                `).join('')}
            `;
        }

        // í†µê³„ ë°•ìŠ¤ í´ë¦­ ì´ë²¤íŠ¸
        function initOverviewStats() {
            const statBoxes = document.querySelectorAll('.overview-stat-box');
           
            statBoxes.forEach(box => {
                box.addEventListener('click', function() {
                    // ëª¨ë“  ë°•ìŠ¤ì—ì„œ selected í´ë˜ìŠ¤ ì œê±°
                    statBoxes.forEach(b => b.classList.remove('selected'));
                   
                    // í´ë¦­ëœ ë°•ìŠ¤ì— selected í´ë˜ìŠ¤ ì¶”ê°€
                    this.classList.add('selected');
                   
                    // í•´ë‹¹ íƒ€ì…ì˜ ë©¤ë²„ ë¦¬ìŠ¤íŠ¸ í‘œì‹œ
                    const type = this.getAttribute('data-type');
                    renderMemberList(type);
                });
            });
           
            // ì´ˆê¸° ë¡œë“œ ì‹œ ì „ì²´ ë©¤ë²„ ë¦¬ìŠ¤íŠ¸ í‘œì‹œ
            renderMemberList('total');
        }

        // í˜„ì¬ í•„í„° ìƒíƒœë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
        function getCurrentFilterState() {
            let dateRange;
            if (currentDateRange) {
                dateRange = currentDateRange;
            } else {
                const filterDays = getCurrentFilterDays();
                dateRange = getDateRange(filterDays);
            }
            
            return {
                dateRange: dateRange,
                filterType: currentFilterType,
                members: currentMembers,
                rawEventsData: currentRawEventsData
            };
        }
        
        // í•„í„° ìƒíƒœê°€ ë™ì¼í•œì§€ ë¹„êµí•˜ëŠ” í•¨ìˆ˜
        function isFilterStateEqual(filter1, filter2) {
            if (!filter1 || !filter2) return false;
            
            // dateRangeëŠ” ì´ë¯¸ timestamp í˜•íƒœë¡œ ì €ì¥ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ì§ì ‘ ë¹„êµ
            return filter1.dateRange.startDate === filter2.dateRange.startDate &&
                   filter1.dateRange.endDate === filter2.dateRange.endDate &&
                   filter1.filterType === filter2.filterType &&
                   filter1.members.length === filter2.members.length &&
                   filter1.rawEventsData.length === filter2.rawEventsData.length;
        }
        
        // ìºì‹œëœ ì°¨íŠ¸ë¥¼ ìº”ë²„ìŠ¤ì— ë³µì›í•˜ëŠ” í•¨ìˆ˜
        function restoreCachedChart(chartType) {
            const cachedChart = chartCache[chartType];
            if (!cachedChart.data) return false;
            
            const canvas = getCanvasForChartType(chartType);
            if (!canvas) return false;
            
            const ctx = canvas.getContext('2d');
            
            // ìº”ë²„ìŠ¤ í¬ê¸° ì„¤ì •
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            // ìºì‹œëœ ì´ë¯¸ì§€ ë°ì´í„° ë³µì›
            ctx.putImageData(cachedChart.data, 0, 0);
            
            console.log(`ğŸ“Š ìºì‹œëœ ì°¨íŠ¸ ë³µì› ì™„ë£Œ: ${chartType}`);
            return true;
        }
        
        // ì°¨íŠ¸ íƒ€ì…ì— ë”°ë¥¸ ìº”ë²„ìŠ¤ ìš”ì†Œ ë°˜í™˜
        function getCanvasForChartType(chartType) {
            const canvasIds = {
                'activity-trend': 'overviewChart',
                'model-distribution': 'modelDistributionChart',
                'cost-trend': 'costTrendChart',
                'activity-type': 'activityTypeChart',
                'user-heatmap': 'userHeatmapChart',
                'cost-efficiency': 'costEfficiencyChart',
                'model-preference': 'modelPreferenceChart',
                'user-performance': 'userPerformanceChart',
                'activity-type-detailed': 'activityTypeDetailedChart'
            };
            
            return document.getElementById(canvasIds[chartType]);
        }
        
        // ì°¨íŠ¸ ë°ì´í„°ë¥¼ ìºì‹œì— ì €ì¥í•˜ëŠ” í•¨ìˆ˜
        function cacheChartData(chartType) {
            const canvas = getCanvasForChartType(chartType);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            
            chartCache[chartType].data = imageData;
            console.log(`ğŸ“Š ì°¨íŠ¸ ë°ì´í„° ìºì‹œ ì €ì¥: ${chartType}`);
        }
        
        // ì°¨íŠ¸ì— í•„ìš”í•œ ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” í•¨ìˆ˜
        async function checkAndLoadDataForChart(chartType) {
            console.log(`ğŸ” ${chartType} ì°¨íŠ¸ ë°ì´í„° ìƒíƒœ í™•ì¸ ì¤‘...`);
            
            // í†µí•© ë°ì´í„° ì €ì¥ì†Œ ìš°ì„  í™•ì¸
            const currentFilter = getCurrentFilterState();
            if (chartDataStore.isDataValid(currentFilter)) {
                console.log(`âœ… í†µí•© ë°ì´í„° ì €ì¥ì†Œì—ì„œ ${chartType} ì°¨íŠ¸ì— í•„ìš”í•œ ë°ì´í„°ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.`);
                return true;
            }
            
            // í†µí•© ë°ì´í„° ì €ì¥ì†Œì— ë°ì´í„°ê°€ ì—†ìœ¼ë©´ í˜„ì¬ ì „ì—­ ë³€ìˆ˜ í™•ì¸
            const members = currentMembersData || [];
            const rawEvents = currentRawEventsData || [];
            
            console.log(`ğŸ“Š ì „ì—­ ë³€ìˆ˜ ë°ì´í„° ìƒíƒœ - ë©¤ë²„: ${members.length}ëª…, ì´ë²¤íŠ¸: ${rawEvents.length}ê°œ`);
            
            // ëª¨ë¸ ë¶„í¬ ì°¨íŠ¸ëŠ” ì´ë²¤íŠ¸ ë°ì´í„°ë§Œ ìˆìœ¼ë©´ ë¨
            if (chartType === 'model-distribution') {
                if (rawEvents.length === 0) {
                    console.log('âŒ ëª¨ë¸ ë¶„í¬ ì°¨íŠ¸: ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë°ì´í„° ë¡œë”©ì„ ì‹œë„í•©ë‹ˆë‹¤.');
                    // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ Overview ë°ì´í„°ë¥¼ ë‹¤ì‹œ ë¡œë“œ
                    return false;
                }
                console.log('âœ… ëª¨ë¸ ë¶„í¬ ì°¨íŠ¸: ì´ë²¤íŠ¸ ë°ì´í„° í™•ì¸ ì™„ë£Œ');
                return true;
            }
            
            if (members.length === 0) {
                console.log('âŒ ì‚¬ìš© ê°€ëŠ¥í•œ ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return false;
            }
            
            if (rawEvents.length === 0) {
                console.log('âŒ ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return false;
            }
            
            // íŠ¹ì • ì°¨íŠ¸ë³„ ì¶”ê°€ ë°ì´í„° í™•ì¸
            if (chartType === 'cost-trend' || chartType === 'cost-efficiency') {
                // ë¹„ìš© ê´€ë ¨ ì°¨íŠ¸ëŠ” cost ë°ì´í„°ê°€ í•„ìš”
                const hasCostData = rawEvents.some(event => 
                    event.requestsCosts !== undefined && event.requestsCosts !== null
                );
                if (!hasCostData) {
                    console.log('âŒ ë¹„ìš© ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return false;
                }
            }
            
            console.log(`âœ… ${chartType} ì°¨íŠ¸ì— í•„ìš”í•œ ë°ì´í„°ê°€ ëª¨ë‘ ìˆìŠµë‹ˆë‹¤.`);
            return true;
        }
        
        // ì°¨íŠ¸ë¥¼ ìœ„í•œ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜
        async function refreshDataForChart(chartType) {
            console.log(`ğŸ”„ ${chartType} ì°¨íŠ¸ë¥¼ ìœ„í•œ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹œì‘...`);
            
            try {
                // ë¡œë”© ìƒíƒœ í‘œì‹œ
                showLoadingStatus(true);
                
                // ê¸°ë³¸ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
                await Promise.all([
                    updateMembersWithRealData(),
                    updateOverviewWithRealData()
                ]);
                
                console.log(`âœ… ${chartType} ì°¨íŠ¸ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ`);
                return true;
            } catch (error) {
                console.error(`âŒ ${chartType} ì°¨íŠ¸ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:`, error);
                showErrorMessage(`ì°¨íŠ¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
                return false;
            } finally {
                // ë¡œë”© ìƒíƒœ í•´ì œ
                showLoadingStatus(false);
            }
        }
        
        // ì°¨íŠ¸ ë³€ê²½ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        function handleChartChange(chartType) {
            console.log(`ğŸ”„ ì°¨íŠ¸ ë³€ê²½ ìš”ì²­: ${chartType}`);
            
            // ëª¨ë“  ì°¨íŠ¸ì—ì„œ ê²€ìƒ‰ì°½ ìˆ¨ê¹€
            const searchContainer = document.getElementById('chart-search-container');
            if (searchContainer) {
                searchContainer.style.display = 'none';
                // ê²€ìƒ‰ì°½ ì´ˆê¸°í™”
                const searchInput = document.getElementById('chart-search-input');
                if (searchInput) {
                    searchInput.value = '';
                    clearChartSearch('chart-search-input');
                }
            }
            
            // íŠ¹ë³„ ì²˜ë¦¬ê°€ í•„ìš”í•œ ì°¨íŠ¸ë“¤ (activity-trend ì œì™¸)
            if (chartType !== 'activity-trend') {
                // ì‚¬ìš©ì í™œë™ íˆíŠ¸ë§µê³¼ ëª¨ë¸ ì„ í˜¸ë„ì— ê²€ìƒ‰ì°½ í‘œì‹œ
                if (chartType === 'user-heatmap' || chartType === 'model-preference') {
                    const searchContainer = document.getElementById('chart-search-container');
                    if (searchContainer) {
                        searchContainer.style.display = 'block';
                        const searchInput = document.getElementById('chart-search-input');
                        if (searchInput) {
                            if (chartType === 'user-heatmap') {
                                searchInput.placeholder = 'ì‚¬ìš©ì ID ê²€ìƒ‰...';
                                // íˆíŠ¸ë§µìš© ì´ë©”ì¼ ë“œë¡­ë‹¤ìš´ ìƒì„±
                                populateHeatmapEmailDropdown();
                            } else if (chartType === 'model-preference') {
                                searchInput.placeholder = 'ì‚¬ìš©ì ID ê²€ìƒ‰...';
                                // ëª¨ë¸ ì„ í˜¸ë„ìš© ì´ë©”ì¼ ë“œë¡­ë‹¤ìš´ ìƒì„±
                                populateModelPreferenceDropdown();
                            }
                        }
                    }
                } else {
                    const searchContainer = document.getElementById('chart-search-container');
                    if (searchContainer) {
                        searchContainer.style.display = 'none';
                        const searchInput = document.getElementById('chart-search-input');
                        if (searchInput) {
                            searchInput.value = '';
                            clearChartSearch('chart-search-input');
                        }
                    }
                }
                console.log(`ğŸ¯ íŠ¹ë³„ ì²˜ë¦¬ ì°¨íŠ¸: ${chartType}`);
                
                // ë¨¼ì € ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ í‘œì‹œ
                document.querySelectorAll('.chart-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                const chartId = `${chartType}-chart`;
                const selectedChart = document.getElementById(chartId);
                if (selectedChart) {
                    selectedChart.classList.add('active');
                    console.log(`âœ… ${chartType} ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ í™œì„±í™” ì™„ë£Œ`);
                } else {
                    console.error(`âŒ ${chartId} ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!`);
                    return;
                }
                
                // ë°ì´í„° í™•ì¸ ë° ë¡œë”©
                const hasMembersData = currentMembersData && currentMembersData.length > 0;
                const hasEventsData = currentRawEventsData && currentRawEventsData.length > 0;
                
                console.log(`ğŸ“Š ë°ì´í„° ìƒíƒœ í™•ì¸: ë©¤ë²„ë°ì´í„°=${hasMembersData}, ì´ë²¤íŠ¸ë°ì´í„°=${hasEventsData}`);
                
                // ë°ì´í„° ìš”êµ¬ì‚¬í•­ë³„ í™•ì¸
                let needsData = false;
                if (chartType === 'model-distribution') {
                    needsData = !hasEventsData;
                } else if (chartType === 'user-performance') {
                    needsData = !hasMembersData || !hasEventsData;
                } else if (chartType === 'cost-trend' || chartType === 'cost-efficiency') {
                    needsData = !hasEventsData; // ë¹„ìš© ê´€ë ¨ ì°¨íŠ¸ëŠ” ì´ë²¤íŠ¸ ë°ì´í„°ë§Œ í•„ìš”
                } else {
                    needsData = !hasMembersData || !hasEventsData; // ê¸°íƒ€ ì°¨íŠ¸ëŠ” ë‘˜ ë‹¤ í•„ìš”
                }
                
                if (needsData) {
                    console.log(`ğŸ”„ ${chartType} ì°¨íŠ¸ë¥¼ ìœ„í•œ ë°ì´í„° ë¡œë”© ì‹œì‘...`);
                    
                    // ë¡œë”© ë©”ì‹œì§€ í‘œì‹œ - ì°¨íŠ¸ë³„ ìº”ë²„ìŠ¤ ID ë§¤í•‘
                    const canvasIdMap = {
                        'user-performance': 'userPerformanceChart',
                        'model-distribution': 'modelDistributionChart',
                        'cost-trend': 'costTrendChart',
                        'activity-type': 'activityTypeChart',
                        'user-heatmap': 'userHeatmapChart',
                        'cost-efficiency': 'costEfficiencyChart',
                        'model-preference': 'modelPreferenceChart',
                        'activity-type-detailed': 'activityTypeDetailedChart'
                    };
                    const canvasId = canvasIdMap[chartType] || 'overviewChart';
                    const canvas = document.getElementById(canvasId);
                    if (canvas) {
                        const rect = canvas.getBoundingClientRect();
                        canvas.width = rect.width;
                        canvas.height = 300;
                        const ctx = canvas.getContext('2d');
                        ctx.fillStyle = '#1a1a1a';
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                        ctx.fillStyle = '#7a7a7a';
                        ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                        ctx.textAlign = 'center';
                        ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', canvas.width / 2, canvas.height / 2);
                    }
                    
                    updateOverviewWithCurrentFilter(30).then(() => {
                        console.log('âœ… ë°ì´í„° ë¡œë”© ì™„ë£Œ, ì°¨íŠ¸ ìƒì„± ì‹œì‘');
                        // ì°¨íŠ¸ë³„ ìƒì„± í•¨ìˆ˜ í˜¸ì¶œ
                        if (chartType === 'user-performance') {
                            createUserPerformanceChart();
                        } else if (chartType === 'model-distribution') {
                            createModelDistributionChart();
                        } else if (chartType === 'cost-trend') {
                            createCostTrendChart();
                        } else if (chartType === 'activity-type') {
                            createActivityTypeChart();
                        } else if (chartType === 'user-heatmap') {
                            createUserHeatmapChart();
                        } else if (chartType === 'cost-efficiency') {
                            createCostEfficiencyChart();
                        } else if (chartType === 'model-preference') {
                            createModelPreferenceChart();
                        } else if (chartType === 'activity-type-detailed') {
                            createActivityTypeDetailedChart();
                        }
                    }).catch(error => {
                        console.error('ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', error);
                        const canvas = document.getElementById(canvasId);
                        if (canvas) {
                            const ctx = canvas.getContext('2d');
                            ctx.fillStyle = '#1a1a1a';
                            ctx.fillRect(0, 0, canvas.width, canvas.height);
                            ctx.fillStyle = '#f44336';
                            ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                            ctx.textAlign = 'center';
                            ctx.fillText('ë°ì´í„° ë¡œë”© ì‹¤íŒ¨', canvas.width / 2, canvas.height / 2);
                        }
                    });
                    return;
                } else {
                    // ë°ì´í„°ê°€ ì´ë¯¸ ìˆìœ¼ë©´ ë°”ë¡œ ì°¨íŠ¸ ìƒì„±
                    console.log('âœ… ë°ì´í„°ê°€ ì´ë¯¸ ì¡´ì¬í•¨, ë°”ë¡œ ì°¨íŠ¸ ìƒì„±');
                    if (chartType === 'user-performance') {
                        createUserPerformanceChart();
                    } else if (chartType === 'model-distribution') {
                        createModelDistributionChart();
                    } else if (chartType === 'cost-trend') {
                        createCostTrendChart();
                    } else if (chartType === 'activity-type') {
                        createActivityTypeChart();
                    } else if (chartType === 'user-heatmap') {
                        createUserHeatmapChart();
                    } else if (chartType === 'cost-efficiency') {
                        createCostEfficiencyChart();
                    } else if (chartType === 'model-preference') {
                        createModelPreferenceChart();
                    } else if (chartType === 'activity-type-detailed') {
                        createActivityTypeDetailedChart();
                    }
                    return;
                }
            }
            
            // ë‹¤ë¥¸ ì°¨íŠ¸ë“¤ì€ switchChart í•¨ìˆ˜ ì‚¬ìš©
            console.log(`ğŸ”„ ë‹¤ë¥¸ ì°¨íŠ¸ ì²˜ë¦¬: ${chartType}`);
            switchChart(chartType).catch(error => {
                console.error('ì°¨íŠ¸ ì „í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:', error);
                showErrorMessage('ì°¨íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
        }
        
        // ì°¨íŠ¸ ì „í™˜ í•¨ìˆ˜ (ë°ì´í„° ë¡œë”© í¬í•¨)
        async function switchChart(chartType) {
            console.log(`ğŸ“Š switchChart í˜¸ì¶œ: ${chartType}`);
            
            // ëª¨ë“  ì°¨íŠ¸ ë‚´ìš© ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.chart-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ì„ íƒëœ ì°¨íŠ¸ ë‚´ìš© í‘œì‹œ
            const selectedChart = document.getElementById(`${chartType}-chart`);
            if (selectedChart) {
                selectedChart.classList.add('active');
                console.log(`âœ… ${chartType} ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ í™œì„±í™” ì™„ë£Œ`);
            } else {
                console.error(`âŒ ${chartType}-chart ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!`);
                return;
            }
            
            // í˜„ì¬ í•„í„° ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
            const currentFilter = getCurrentFilterState();
            
            // ìºì‹œëœ ì°¨íŠ¸ê°€ ìˆê³  í•„í„°ê°€ ë™ì¼í•œì§€ í™•ì¸
            const cachedChart = chartCache[chartType];
            const shouldUseCache = cachedChart.rendered && cachedChart.data && isFilterStateEqual(cachedChart.filter, currentFilter);
            
            if (shouldUseCache) {
                console.log(`ğŸ“Š ìºì‹œëœ ì°¨íŠ¸ ì‚¬ìš©: ${chartType}`);
                if (restoreCachedChart(chartType)) {
                    return;
                }
            }
            
            // ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸ (í†µí•© ë°ì´í„° ì €ì¥ì†Œ ìš°ì„  ì‚¬ìš©)
            const hasRequiredData = await checkAndLoadDataForChart(chartType);
            if (!hasRequiredData) {
                console.log(`âš ï¸ ${chartType} ì°¨íŠ¸ì— í•„ìš”í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. Overview ì´ˆê¸° ë¡œë”©ì„ ë¨¼ì € ì™„ë£Œí•´ì£¼ì„¸ìš”.`);
                // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì°¨íŠ¸ì— ë©”ì‹œì§€ë¥¼ í‘œì‹œí•˜ê³  ë¦¬í„´
                const canvas = getCanvasForChartType(chartType);
                if (canvas) {
                    const ctx = canvas.getContext('2d');
                    const rect = canvas.getBoundingClientRect();
                    canvas.width = rect.width;
                    canvas.height = 300;
                    
                    ctx.fillStyle = '#1a1a1a';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    ctx.fillStyle = '#7a7a7a';
                    ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', canvas.width / 2, canvas.height / 2);
                }
                return;
            }
            
            // ìƒˆë¡œìš´ ì°¨íŠ¸ ìƒì„± ë˜ëŠ” ì—…ë°ì´íŠ¸
            console.log(`ğŸ“Š ì°¨íŠ¸ ìƒˆë¡œ ìƒì„±/ì—…ë°ì´íŠ¸: ${chartType}`);
            
            // ì°¨íŠ¸ íƒ€ì…ì— ë”°ë¼ ì ì ˆí•œ ì°¨íŠ¸ ë Œë”ë§
            console.log(`ğŸ“Š ì°¨íŠ¸ íƒ€ì… "${chartType}" ë Œë”ë§ ì‹œì‘...`);
            
            if (chartType === 'activity-trend') {
                console.log('ğŸ“ˆ ì¼ë³„ í™œë™ ì¶”ì´ ì°¨íŠ¸ ìƒì„±');
                createOverviewChart();
            } else if (chartType === 'model-distribution') {
                console.log('ğŸ“Š ëª¨ë¸ ì‚¬ìš© ë¶„í¬ ì°¨íŠ¸ ìƒì„±');
                createModelDistributionChart();
            } else if (chartType === 'cost-trend') {
                console.log('ğŸ’° ë¹„ìš© ì¶”ì´ ì°¨íŠ¸ ìƒì„±');
                createCostTrendChart();
            } else if (chartType === 'activity-type') {
                console.log('ğŸ“Š í™œë™ ìœ í˜• ë¶„í¬ ì°¨íŠ¸ ìƒì„±');
                createActivityTypeChart();
            } else if (chartType === 'user-heatmap') {
                console.log('ğŸ”¥ ì‚¬ìš©ì í™œë™ íˆíŠ¸ë§µ ì°¨íŠ¸ ìƒì„±');
                createUserHeatmapChart();
            } else if (chartType === 'cost-efficiency') {
                console.log('ğŸ“Š ë¹„ìš© íš¨ìœ¨ì„± ë¶„ì„ ì°¨íŠ¸ ìƒì„±');
                createCostEfficiencyChart();
            } else if (chartType === 'model-preference') {
                console.log('ğŸ¯ ëª¨ë¸ ì„ í˜¸ë„ ì°¨íŠ¸ ìƒì„±');
                createModelPreferenceChart();
            } else if (chartType === 'user-performance') {
                console.log('ğŸ† ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ ìƒì„±');
                
                // ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ë¥¼ ìœ„í•œ ë°ì´í„° í™•ì¸ ë° ë¡œë”©
                const hasMembersData = currentMembersData && currentMembersData.length > 0;
                const hasEventsData = currentRawEventsData && currentRawEventsData.length > 0;
                
                console.log(`ğŸ“Š ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ ë°ì´í„° ìƒíƒœ: ë©¤ë²„ ${hasMembersData ? currentMembersData.length : 0}ëª…, ì´ë²¤íŠ¸ ${hasEventsData ? currentRawEventsData.length : 0}ê°œ`);
                
                if (!hasMembersData || !hasEventsData) {
                    console.log('âš ï¸ ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ì— í•„ìš”í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë°ì´í„°ë¥¼ ë¨¼ì € ë¡œë“œí•´ì£¼ì„¸ìš”.');
                    // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë©”ì‹œì§€ í‘œì‹œ
                    const canvas = document.getElementById('userPerformanceChart');
                    if (canvas) {
                        const ctx = canvas.getContext('2d');
                        const width = canvas.width;
                        const height = canvas.height;
                        
                        ctx.fillStyle = '#1a1a1a';
                        ctx.fillRect(0, 0, width, height);
                        
                        ctx.fillStyle = '#7a7a7a';
                        ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                        ctx.textAlign = 'center';
                        ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                    }
                    return;
                }
                
                createUserPerformanceChart();
            } else if (chartType === 'activity-type-detailed') {
                console.log('ğŸ“ˆ í™œë™ ìœ í˜• ìƒì„¸ ì°¨íŠ¸ ìƒì„±');
                createActivityTypeDetailedChart();
            } else {
                console.log('âŒ ì•Œ ìˆ˜ ì—†ëŠ” ì°¨íŠ¸ íƒ€ì…:', chartType);
            }
            
            // ì°¨íŠ¸ ë Œë”ë§ ì™„ë£Œ í›„ ìºì‹œì— ì €ì¥
            setTimeout(() => {
                cacheChartData(chartType);
                chartCache[chartType].filter = currentFilter;
                chartCache[chartType].rendered = true;
            }, 100);
            
            console.log(`ğŸ“Š ì°¨íŠ¸ ì „í™˜ ì™„ë£Œ: ${chartType}`);
        }

        // ëª¨ë¸ ì‚¬ìš© ë¶„í¬ ë§‰ëŒ€ ì°¨íŠ¸ ìƒì„±
        function createModelDistributionChart() {
            console.log('ğŸ” createModelDistributionChart ì‹œì‘...');
            console.log('ğŸ” ì „ì—­ ë³€ìˆ˜ ìƒíƒœ í™•ì¸:');
            console.log('- currentRawEventsData:', currentRawEventsData);
            console.log('- currentRawEventsData ê¸¸ì´:', currentRawEventsData ? currentRawEventsData.length : 'undefined');
            console.log('- chartDataStore.rawEvents ê¸¸ì´:', chartDataStore.rawEvents ? chartDataStore.rawEvents.length : 'undefined');
            
            const canvas = document.getElementById('modelDistributionChart');
            if (!canvas) {
                console.error('âŒ modelDistributionChart ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            console.log('âœ… ìº”ë²„ìŠ¤ ì°¾ìŒ:', canvas);
            
            // Canvas í¬ê¸° ì„¤ì •
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            console.log('ğŸ“ ìº”ë²„ìŠ¤ í¬ê¸° ì„¤ì •:', canvas.width, 'x', canvas.height);
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // ë°°ê²½ ì„¤ì •
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            console.log('âœ… ë°°ê²½ ì„¤ì • ì™„ë£Œ');
            
            // ëª¨ë¸ ì‚¬ìš© ë°ì´í„° ìƒì„±
            console.log('ğŸ“Š ëª¨ë¸ ë°ì´í„° ìƒì„± ì‹œì‘...');
            const modelData = generateModelDistributionData();
            console.log('ğŸ“Š ìƒì„±ëœ ëª¨ë¸ ë°ì´í„°:', modelData);
            
            if (modelData.length === 0) {
                console.log('âš ï¸ ëª¨ë¸ ë°ì´í„°ê°€ ë¹„ì–´ìˆì–´ ë¹ˆ ì°¨íŠ¸ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.');
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            // ë§‰ëŒ€ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
            console.log('ğŸ“Š ë§‰ëŒ€ ì°¨íŠ¸ ê·¸ë¦¬ê¸° ì‹œì‘...');
            drawModelDistributionBarChart(ctx, width, height, modelData);
            console.log('âœ… ëª¨ë¸ ë¶„í¬ ì°¨íŠ¸ ìƒì„± ì™„ë£Œ');
        }

        // ëª¨ë¸ ì‚¬ìš© ë¶„í¬ ë°ì´í„° ìƒì„±
        function generateModelDistributionData() {
            console.log('ğŸ” generateModelDistributionData ì‹œì‘...');
            
            const modelUsage = new Map();
            
            // ì „ì—­ ë³€ìˆ˜ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (chartDataStore ìš°ì„ , ì—†ìœ¼ë©´ ì „ì—­ ë³€ìˆ˜ ì‚¬ìš©)
            const rawEvents = (chartDataStore.rawEvents && chartDataStore.rawEvents.length > 0) ? 
                chartDataStore.rawEvents : (currentRawEventsData || []);
            
            console.log('ğŸ“Š ë°ì´í„° ì†ŒìŠ¤ í™•ì¸:');
            console.log('- chartDataStore.rawEvents:', chartDataStore.rawEvents ? chartDataStore.rawEvents.length : 0);
            console.log('- currentRawEventsData:', currentRawEventsData ? currentRawEventsData.length : 0);
            console.log('- ì‚¬ìš©í•  rawEvents.length:', rawEvents ? rawEvents.length : 0);
            
            if (rawEvents && rawEvents.length > 0) {
                console.log('ğŸ¯ ì´ë²¤íŠ¸ ë°ì´í„° ìƒ˜í”Œ (ì²˜ìŒ 3ê°œ):');
                rawEvents.slice(0, 3).forEach((event, index) => {
                    console.log(`ì´ë²¤íŠ¸ ${index}:`, {
                        model: event.model,
                        timestamp: event.timestamp,
                        userEmail: event.userEmail || event.email,
                        kind: event.kind,
                        ì „ì²´: event
                    });
                });
                
                // ëª¨ë¸ë³„ ì‚¬ìš© íšŸìˆ˜ ì§‘ê³„
                rawEvents.forEach((event, index) => {
                    const model = event.model || 'unknown';
                    modelUsage.set(model, (modelUsage.get(model) || 0) + 1);
                    
                    // ì²˜ìŒ 5ê°œ ì´ë²¤íŠ¸ì˜ ëª¨ë¸ ì •ë³´ ë¡œê·¸
                    if (index < 5) {
                        console.log(`- ì´ë²¤íŠ¸ ${index}: model="${model}", ì „ì²´ ì´ë²¤íŠ¸:`, event);
                    }
                });
                
                console.log('ğŸ“Š ëª¨ë¸ë³„ ì‚¬ìš© íšŸìˆ˜ ì§‘ê³„ ê²°ê³¼:');
                modelUsage.forEach((count, model) => {
                    console.log(`- ${model}: ${count}íšŒ`);
                });
                console.log('ğŸ“Š modelUsage Map í¬ê¸°:', modelUsage.size);
            } else {
                console.log('âš ï¸ generateModelDistributionData: ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                console.log('âš ï¸ rawEvents ê°’:', rawEvents);
                return [];
            }
            
            // ë°ì´í„°ë¥¼ ë°°ì—´ë¡œ ë³€í™˜í•˜ê³  ìƒ‰ìƒ ì¶”ê°€
            const colors = ['#4a9eff', '#4caf50', '#ff9800', '#f44336', '#9c27b0', '#00bcd4'];
            const data = [];
            let colorIndex = 0;
            
            modelUsage.forEach((count, model) => {
                data.push({
                    label: model,
                    value: count,
                    color: colors[colorIndex % colors.length]
                });
                colorIndex++;
            });
            
            console.log(`ğŸ“Š ëª¨ë¸ ë¶„í¬ ë°ì´í„° ìƒì„± ì™„ë£Œ: ${data.length}ê°œ ëª¨ë¸ (ë°ì´í„° ì†ŒìŠ¤: ${rawEvents.length}ê°œ ì´ë²¤íŠ¸)`);
            console.log('ğŸ“Š ìµœì¢… ë°ì´í„°:', data);
            return data;
        }

        // íŒŒì´ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        function drawPieChart(ctx, width, height, data) {
            const centerX = width / 2;
            const centerY = height / 2;
            const radius = Math.min(width, height) / 3;
            
            let total = data.reduce((sum, item) => sum + item.value, 0);
            let currentAngle = 0;
            
            data.forEach(item => {
                const sliceAngle = (item.value / total) * 2 * Math.PI;
                
                // íŒŒì´ ìŠ¬ë¼ì´ìŠ¤ ê·¸ë¦¬ê¸°
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                ctx.closePath();
                ctx.fillStyle = item.color;
                ctx.fill();
                
                // í…Œë‘ë¦¬ ê·¸ë¦¬ê¸°
                ctx.strokeStyle = '#1a1a1a';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // ë ˆì´ë¸” ê·¸ë¦¬ê¸°
                const labelAngle = currentAngle + sliceAngle / 2;
                const labelX = centerX + (radius * 0.7) * Math.cos(labelAngle);
                const labelY = centerY + (radius * 0.7) * Math.sin(labelAngle);
                
                ctx.fillStyle = '#fff';
                ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(`${item.label} (${item.value})`, labelX, labelY);
                
                currentAngle += sliceAngle;
            });
            
            // ë²”ë¡€ ê·¸ë¦¬ê¸°
            drawPieChartLegend(ctx, width, height, data);
        }

        // ëª¨ë¸ ì‚¬ìš© ë¶„í¬ ë§‰ëŒ€ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        function drawModelDistributionBarChart(ctx, width, height, data) {
            console.log('ğŸ” drawModelDistributionBarChart ì‹œì‘...');
            console.log('ğŸ“Š ì…ë ¥ ë°ì´í„°:', data);
            console.log('ğŸ“ ìº”ë²„ìŠ¤ í¬ê¸°:', width, 'x', height);
            
            if (data.length === 0) {
                console.log('âš ï¸ ë°ì´í„°ê°€ ë¹„ì–´ìˆì–´ ë¡œë”© ë©”ì‹œì§€ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.');
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            const padding = 60;
            const chartWidth = width - (padding * 2);
            const chartHeight = height - (padding * 2);
            const barWidth = chartWidth / data.length * 0.8;
            const barSpacing = chartWidth / data.length * 0.2;
            
            // ìµœëŒ€ê°’ ê³„ì‚°
            const maxValue = Math.max(...data.map(d => d.value));
            
            // Yì¶• ê·¸ë¦¬ê¸°
            ctx.strokeStyle = '#3a3a3a';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, height - padding);
            ctx.stroke();
            
            // Xì¶• ê·¸ë¦¬ê¸°
            ctx.beginPath();
            ctx.moveTo(padding, height - padding);
            ctx.lineTo(width - padding, height - padding);
            ctx.stroke();
            
            // Yì¶• ë ˆì´ë¸”
            ctx.fillStyle = '#7a7a7a';
            ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'right';
            ctx.textBaseline = 'middle';
            
            const ySteps = 5;
            for (let i = 0; i <= ySteps; i++) {
                const y = padding + (chartHeight / ySteps) * i;
                const value = Math.round((maxValue / ySteps) * (ySteps - i));
                ctx.fillText(value.toString(), padding - 10, y);
            }
            
            // ë§‰ëŒ€ ê·¸ë¦¬ê¸°
            const colors = ['#4a9eff', '#4caf50', '#ff9800', '#f44336', '#9c27b0', '#00bcd4'];
            
            data.forEach((item, index) => {
                const x = padding + (chartWidth / data.length) * index + barSpacing / 2;
                const barHeight = (item.value / maxValue) * chartHeight;
                const y = height - padding - barHeight;
                
                // ë§‰ëŒ€ ê·¸ë¦¬ê¸°
                ctx.fillStyle = colors[index % colors.length];
                ctx.fillRect(x, y, barWidth, barHeight);
                
                // ë§‰ëŒ€ ìœ„ì— ê°’ í‘œì‹œ
                ctx.fillStyle = '#e1e1e1';
                ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(item.value.toString(), x + barWidth / 2, y - 10);
                
                // Xì¶• ë ˆì´ë¸” (ëª¨ë¸ëª…)
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '11px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(item.label, x + barWidth / 2, height - padding + 20);
            });
            
            // ì œëª©
            ctx.fillStyle = '#e1e1e1';
            ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('AI ëª¨ë¸ë³„ ì‚¬ìš© ë¶„í¬', width / 2, 25);
        }
        
        // íŒŒì´ ì°¨íŠ¸ ë²”ë¡€ ê·¸ë¦¬ê¸°
        function drawPieChartLegend(ctx, width, height, data) {
            const legendX = 20;
            const legendY = height - 100;
            const itemHeight = 20;
            
            data.forEach((item, index) => {
                const y = legendY + index * itemHeight;
                
                // ìƒ‰ìƒ ë°•ìŠ¤
                ctx.fillStyle = item.color;
                ctx.fillRect(legendX, y, 15, 15);
                
                // í…ìŠ¤íŠ¸
                ctx.fillStyle = '#fff';
                ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'left';
                ctx.fillText(`${item.label}: ${item.value}íšŒ`, legendX + 20, y + 10);
            });
        }

        // ë¹„ìš© ì¶”ì´ ë¼ì¸ ì°¨íŠ¸ ìƒì„±
        function createCostTrendChart() {
            console.log('ğŸ’° createCostTrendChart ì‹œì‘...');
            console.log('ğŸ’° ì „ì—­ ë³€ìˆ˜ ìƒíƒœ í™•ì¸:');
            console.log('- currentRawEventsData:', currentRawEventsData ? currentRawEventsData.length : 'undefined');
            console.log('- chartDataStore.rawEvents:', chartDataStore.rawEvents ? chartDataStore.rawEvents.length : 'undefined');
            
            const canvas = document.getElementById('costTrendChart');
            if (!canvas) {
                console.error('âŒ costTrendChart ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            console.log('âœ… ìº”ë²„ìŠ¤ ì°¾ìŒ:', canvas);
            
            // Canvas í¬ê¸° ì„¤ì •
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // ë°°ê²½ ì„¤ì •
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            // ë¹„ìš© ë°ì´í„° ìƒì„±
            const costData = generateCostTrendData();
            console.log('ğŸ’° ìƒì„±ëœ ë¹„ìš© ë°ì´í„°:', costData);
            
            if (costData.length === 0) {
                console.log('âš ï¸ ë¹„ìš© ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¹ˆ ì°¨íŠ¸ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.');
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë¹„ìš© ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            // ë¼ì¸ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
            drawLineChart(ctx, width, height, costData);
            console.log('âœ… ë¹„ìš© ì¶”ì´ ì°¨íŠ¸ ìƒì„± ì™„ë£Œ');
        }

        // ë¹„ìš© ì¶”ì´ ë°ì´í„° ìƒì„±
        function generateCostTrendData() {
            console.log('ğŸ’° generateCostTrendData ì‹œì‘...');
            const dailyCosts = new Map();
            
            // í†µí•© ë°ì´í„° ì €ì¥ì†Œì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const rawEvents = (chartDataStore.rawEvents && chartDataStore.rawEvents.length > 0) ? 
                chartDataStore.rawEvents : (currentRawEventsData || []);
            
            console.log('ğŸ’° ë°ì´í„° ì†ŒìŠ¤ í™•ì¸:');
            console.log('- chartDataStore.rawEvents:', chartDataStore.rawEvents ? chartDataStore.rawEvents.length : 0);
            console.log('- currentRawEventsData:', currentRawEventsData ? currentRawEventsData.length : 0);
            console.log('- ì‚¬ìš©í•  rawEvents.length:', rawEvents ? rawEvents.length : 0);
            
            if (rawEvents && rawEvents.length > 0) {
                rawEvents.forEach(event => {
                    const eventDate = new Date(parseInt(event.timestamp));
                    const dateKey = eventDate.toISOString().split('T')[0];
                    const cost = (event.requestsCosts || 0) / 100; // cents to dollars
                    
                    if (dailyCosts.has(dateKey)) {
                        dailyCosts.set(dateKey, dailyCosts.get(dateKey) + cost);
                    } else {
                        dailyCosts.set(dateKey, cost);
                    }
                });
            } else {
                console.log('âš ï¸ generateCostTrendData: ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return [];
            }
            
            // ë‚ ì§œìˆœìœ¼ë¡œ ì •ë ¬
            const sortedDates = Array.from(dailyCosts.keys()).sort();
            const data = sortedDates.map(date => ({
                date: date,
                cost: dailyCosts.get(date)
            }));
            
            console.log(`ğŸ“Š ë¹„ìš© ì¶”ì´ ë°ì´í„° ìƒì„± ì™„ë£Œ: ${data.length}ì¼ê°„ì˜ ë°ì´í„° (ë°ì´í„° ì†ŒìŠ¤: ${rawEvents.length}ê°œ ì´ë²¤íŠ¸)`);
            return data;
        }

        // ë¼ì¸ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        function drawLineChart(ctx, width, height, data) {
            if (data.length === 0) {
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            const padding = 40;
            const chartWidth = width - 2 * padding;
            const chartHeight = height - 2 * padding;
            
            // Yì¶• ìµœëŒ€ê°’ ê³„ì‚°
            const maxCost = Math.max(...data.map(d => d.cost));
            const minCost = Math.min(...data.map(d => d.cost));
            const costRange = maxCost - minCost;
            
            // ê·¸ë¦¬ë“œ ê·¸ë¦¬ê¸°
            ctx.strokeStyle = '#3a3a3a';
            ctx.lineWidth = 1;
            
            // ê°€ë¡œ ê·¸ë¦¬ë“œ
            for (let i = 0; i <= 5; i++) {
                const y = padding + (chartHeight / 5) * i;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(width - padding, y);
                ctx.stroke();
            }
            
            // ì„¸ë¡œ ê·¸ë¦¬ë“œ
            for (let i = 0; i <= data.length - 1; i++) {
                const x = padding + (chartWidth / (data.length - 1)) * i;
                ctx.beginPath();
                ctx.moveTo(x, padding);
                ctx.lineTo(x, height - padding);
                ctx.stroke();
            }
            
            // ë¼ì¸ ê·¸ë¦¬ê¸°
            ctx.strokeStyle = '#4a9eff';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            data.forEach((point, index) => {
                const x = padding + (chartWidth / (data.length - 1)) * index;
                const y = height - padding - ((point.cost - minCost) / costRange) * chartHeight;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            
            ctx.stroke();
            
            // ë°ì´í„° í¬ì¸íŠ¸ ê·¸ë¦¬ê¸°
            data.forEach((point, index) => {
                const x = padding + (chartWidth / (data.length - 1)) * index;
                const y = height - padding - ((point.cost - minCost) / costRange) * chartHeight;
                
                ctx.fillStyle = '#4a9eff';
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fill();
            });
            
            // ì¶• ë ˆì´ë¸” ê·¸ë¦¬ê¸°
            ctx.fillStyle = '#7a7a7a';
            ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'center';
            
            // Xì¶• ë ˆì´ë¸” (ë‚ ì§œ)
            data.forEach((point, index) => {
                const x = padding + (chartWidth / (data.length - 1)) * index;
                const date = new Date(point.date);
                const dateStr = `${date.getMonth() + 1}/${date.getDate()}`;
                ctx.fillText(dateStr, x, height - 10);
            });
            
            // Yì¶• ë ˆì´ë¸” (ë¹„ìš©)
            for (let i = 0; i <= 5; i++) {
                const y = padding + (chartHeight / 5) * i;
                const cost = maxCost - (costRange / 5) * i;
                ctx.fillText(`$${cost.toFixed(2)}`, 10, y + 4);
            }
        }

        // í™œë™ ìœ í˜• ë¶„í¬ ë°” ì°¨íŠ¸ ìƒì„±
        function createActivityTypeChart() {
            console.log('ğŸ“Š createActivityTypeChart ì‹œì‘...');
            const canvas = document.getElementById('activityTypeChart');
            if (!canvas) {
                console.error('âŒ activityTypeChart ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            console.log('âœ… ìº”ë²„ìŠ¤ ì°¾ìŒ:', canvas);
            
            // Canvas í¬ê¸° ì„¤ì •
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // ë°°ê²½ ì„¤ì •
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            // í™œë™ ìœ í˜• ë°ì´í„° ìƒì„±
            const activityData = generateActivityTypeData();
            console.log('ğŸ“Š ìƒì„±ëœ í™œë™ ìœ í˜• ë°ì´í„°:', activityData);
            
            if (activityData.length === 0) {
                console.log('âš ï¸ í™œë™ ìœ í˜• ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¹ˆ ì°¨íŠ¸ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.');
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('í™œë™ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            // ë°” ì°¨íŠ¸ ê·¸ë¦¬ê¸°
            drawBarChart(ctx, width, height, activityData);
            console.log('âœ… í™œë™ ìœ í˜• ë¶„í¬ ì°¨íŠ¸ ìƒì„± ì™„ë£Œ');
        }

        // í™œë™ ìœ í˜• ë°ì´í„° ìƒì„±
        function generateActivityTypeData() {
            console.log('ğŸ“Š generateActivityTypeData ì‹œì‘...');
            const activityTypes = new Map();
            
            // í†µí•© ë°ì´í„° ì €ì¥ì†Œì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const rawEvents = (chartDataStore.rawEvents && chartDataStore.rawEvents.length > 0) ? 
                chartDataStore.rawEvents : (currentRawEventsData || []);
            
            console.log('ğŸ“Š ë°ì´í„° ì†ŒìŠ¤ í™•ì¸:');
            console.log('- chartDataStore.rawEvents:', chartDataStore.rawEvents ? chartDataStore.rawEvents.length : 0);
            console.log('- currentRawEventsData:', currentRawEventsData ? currentRawEventsData.length : 0);
            console.log('- ì‚¬ìš©í•  rawEvents.length:', rawEvents ? rawEvents.length : 0);
            
            if (rawEvents && rawEvents.length > 0) {
                rawEvents.forEach(event => {
                    const type = event.kind || 'unknown';
                    activityTypes.set(type, (activityTypes.get(type) || 0) + 1);
                });
            } else {
                console.log('âš ï¸ generateActivityTypeData: ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return [];
            }
            
            // ë°ì´í„°ë¥¼ ë°°ì—´ë¡œ ë³€í™˜í•˜ê³  ìƒ‰ìƒ ì¶”ê°€
            const colors = ['#4a9eff', '#4caf50', '#ff9800', '#f44336', '#9c27b0'];
            const data = [];
            let colorIndex = 0;
            
            activityTypes.forEach((count, type) => {
                data.push({
                    label: type,
                    value: count,
                    color: colors[colorIndex % colors.length]
                });
                colorIndex++;
            });
            
            console.log(`ğŸ“Š í™œë™ ìœ í˜• ë°ì´í„° ìƒì„± ì™„ë£‰: ${data.length}ê°œ ìœ í˜• (ë°ì´í„° ì†ŒìŠ¤: ${rawEvents.length}ê°œ ì´ë²¤íŠ¸)`);
            return data;
        }

        // ë°” ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        function drawBarChart(ctx, width, height, data) {
            if (data.length === 0) {
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            const padding = 60;
            const chartWidth = width - 2 * padding;
            const chartHeight = height - 2 * padding;
            const barWidth = chartWidth / data.length;
            const maxValue = Math.max(...data.map(d => d.value));
            
            // ê·¸ë¦¬ë“œ ê·¸ë¦¬ê¸°
            ctx.strokeStyle = '#3a3a3a';
            ctx.lineWidth = 1;
            
            // ê°€ë¡œ ê·¸ë¦¬ë“œ
            for (let i = 0; i <= 5; i++) {
                const y = padding + (chartHeight / 5) * i;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(width - padding, y);
                ctx.stroke();
            }
            
            // ë°” ê·¸ë¦¬ê¸°
            data.forEach((item, index) => {
                const x = padding + barWidth * index + barWidth * 0.1;
                const barHeight = (item.value / maxValue) * chartHeight;
                const y = height - padding - barHeight;
                
                // ë°” ê·¸ë¦¬ê¸°
                ctx.fillStyle = item.color;
                ctx.fillRect(x, y, barWidth * 0.8, barHeight);
                
                // ê°’ í…ìŠ¤íŠ¸
                ctx.fillStyle = '#fff';
                ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(item.value.toString(), x + barWidth * 0.4, y - 10);
                
                // ë ˆì´ë¸”
                ctx.fillStyle = '#7a7a7a';
                ctx.fillText(item.label, x + barWidth * 0.4, height - 10);
            });
            
            // Yì¶• ë ˆì´ë¸”
            ctx.fillStyle = '#7a7a7a';
            ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'right';
            
            for (let i = 0; i <= 5; i++) {
                const y = padding + (chartHeight / 5) * i;
                const value = maxValue - (maxValue / 5) * i;
                ctx.fillText(value.toString(), padding - 10, y + 4);
            }
        }

        // ì‚¬ìš©ì í™œë™ íˆíŠ¸ë§µ ì°¨íŠ¸ ìƒì„± (ë§‰ëŒ€ ê·¸ë˜í”„)
        function createUserHeatmapChart() {
            console.log('ğŸ”¥ createUserHeatmapChart ì‹œì‘...');
            const canvas = document.getElementById('userHeatmapChart');
            if (!canvas) {
                console.error('âŒ userHeatmapChart ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            console.log('âœ… ìº”ë²„ìŠ¤ ì°¾ìŒ:', canvas);
            
            // Canvas í¬ê¸° ì„¤ì •
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // ë°°ê²½ ì„¤ì •
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            // íˆíŠ¸ë§µ ë°ì´í„° ìƒì„± (ë§‰ëŒ€ ê·¸ë˜í”„ìš©)
            const heatmapData = generateHeatmapBarData();
            console.log('ğŸ”¥ ìƒì„±ëœ íˆíŠ¸ë§µ ë°ì´í„°:', heatmapData);
            
            if (heatmapData.length === 0) {
                console.log('âš ï¸ íˆíŠ¸ë§µ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¹ˆ ì°¨íŠ¸ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.');
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('í™œë™ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            // ë§‰ëŒ€ ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
            drawHeatmapBarChart(ctx, width, height, heatmapData);
            console.log('âœ… ì‚¬ìš©ì í™œë™ íˆíŠ¸ë§µ ì°¨íŠ¸ ìƒì„± ì™„ë£Œ');
        }

        // íˆíŠ¸ë§µ ë§‰ëŒ€ ê·¸ë˜í”„ìš© ë°ì´í„° ìƒì„±
        function generateHeatmapBarData() {
            console.log('ğŸ”¥ generateHeatmapBarData ì‹œì‘...');
            const userActivityMap = new Map();
            
            // í†µí•© ë°ì´í„° ì €ì¥ì†Œì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const members = (chartDataStore.members && chartDataStore.members.length > 0) ? 
                chartDataStore.members : (currentMembers || []);
            const rawEvents = (chartDataStore.rawEvents && chartDataStore.rawEvents.length > 0) ? 
                chartDataStore.rawEvents : (currentRawEventsData || []);
            
            console.log('ğŸ”¥ ë°ì´í„° ì†ŒìŠ¤ í™•ì¸:');
            console.log('- chartDataStore.members:', chartDataStore.members ? chartDataStore.members.length : 0);
            console.log('- currentMembers:', currentMembers ? currentMembers.length : 0);
            console.log('- chartDataStore.rawEvents:', chartDataStore.rawEvents ? chartDataStore.rawEvents.length : 0);
            console.log('- currentRawEventsData:', currentRawEventsData ? currentRawEventsData.length : 0);
            
            if (!members || members.length === 0) {
                console.log('âš ï¸ generateHeatmapBarData: ì‚¬ìš© ê°€ëŠ¥í•œ ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return [];
            }
            
            if (!rawEvents || rawEvents.length === 0) {
                console.log('âš ï¸ generateHeatmapBarData: ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return [];
            }
            
            // ì‚¬ìš©ìë³„ í™œë™ ìˆ˜ ê³„ì‚°
            members.forEach((member, userIndex) => {
                const userEmail = member.email;
                const userName = member.name;
                const userId = userEmail.split('@')[0]; // ID ì¶”ì¶œ
                
                const userEvents = rawEvents.filter(event => 
                    event.userEmail === userEmail || event.email === userEmail
                );
                
                const totalActivity = userEvents.length;
                
                userActivityMap.set(userIndex, {
                    name: userName,
                    email: userEmail,
                    id: userId,
                    totalActivity: totalActivity
                });
            });
            
            // í™œë™ ìˆ˜ë¡œ ì •ë ¬í•˜ì—¬ ìƒìœ„ 20ëª… ì„ íƒ
            const sortedUsers = Array.from(userActivityMap.entries())
                .sort((a, b) => b[1].totalActivity - a[1].totalActivity)
                .slice(0, 20);
            
            const data = sortedUsers.map(([userIndex, userData]) => ({
                userId: userData.id,
                userName: userData.name,
                email: userData.email,
                activity: userData.totalActivity
            }));
            
            console.log(`ğŸ”¥ íˆíŠ¸ë§µ ë§‰ëŒ€ ë°ì´í„° ìƒì„± ì™„ë£Œ: ${data.length}ëª…ì˜ ì‚¬ìš©ì (ë°ì´í„° ì†ŒìŠ¤: ${members.length}ëª…, ${rawEvents.length}ê°œ ì´ë²¤íŠ¸)`);
            console.log('ğŸ”¥ ìµœì¢… ë°ì´í„°:', data);
            return data;
        }

        // ê¸°ì¡´ íˆíŠ¸ë§µ ë°ì´í„° ìƒì„± (ì°¸ê³ ìš©)
        function generateHeatmapData() {
            const userActivityMap = new Map();
            
            // í†µí•© ë°ì´í„° ì €ì¥ì†Œì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const members = chartDataStore.members.length > 0 ? chartDataStore.members : currentMembers;
            const rawEvents = chartDataStore.rawEvents.length > 0 ? chartDataStore.rawEvents : currentRawEventsData;
            
            if (!members || members.length === 0) {
                console.log('âš ï¸ generateHeatmapData: ì‚¬ìš© ê°€ëŠ¥í•œ ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return [];
            }
            
            if (!rawEvents || rawEvents.length === 0) {
                console.log('âš ï¸ generateHeatmapData: ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return [];
            }
            
            members.forEach((member, userIndex) => {
                const userEmail = member.email;
                const userName = member.name;
                
                const userEvents = rawEvents.filter(event => 
                    event.userEmail === userEmail
                );
                
                const dailyActivity = new Map();
                
                userEvents.forEach(event => {
                    const eventDate = new Date(parseInt(event.timestamp));
                    const dateKey = eventDate.toISOString().split('T')[0];
                    
                    if (dailyActivity.has(dateKey)) {
                        dailyActivity.set(dateKey, dailyActivity.get(dateKey) + 1);
                    } else {
                        dailyActivity.set(dateKey, 1);
                    }
                });
                
                userActivityMap.set(userIndex, {
                    name: userName,
                    email: userEmail,
                    dailyActivity: dailyActivity
                });
            });
            
            const data = [];
            const days = 7;
            
            for (let userIndex = 0; userIndex < Math.min(userActivityMap.size, 5); userIndex++) {
                const userData = userActivityMap.get(userIndex);
                if (!userData) continue;
                
                for (let dayIndex = 0; dayIndex < days; dayIndex++) {
                    const targetDate = new Date();
                    targetDate.setDate(targetDate.getDate() - (days - 1 - dayIndex));
                    const dateKey = targetDate.toISOString().split('T')[0];
                    
                    const activity = userData.dailyActivity.get(dateKey) || 0;
                    
                    data.push({
                        user: userIndex,
                        day: dayIndex,
                        activity: activity,
                        userName: userData.name
                    });
                }
            }
            
            console.log(`ğŸ“Š íˆíŠ¸ë§µ ë°ì´í„° ìƒì„± ì™„ë£Œ: ${data.length}ê°œ ì…€ (ë°ì´í„° ì†ŒìŠ¤: ${members.length}ëª…, ${rawEvents.length}ê°œ ì´ë²¤íŠ¸)`);
            return data;
        }

        // íˆíŠ¸ë§µ ê·¸ë¦¬ê¸°
        function drawHeatmap(ctx, width, height, data) {
            if (data.length === 0) {
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            const cellWidth = (width - 100) / 7;
            const cellHeight = (height - 80) / 5;
            const startX = 80;
            const startY = 20;
            const cellSpacing = 8; // ì…€ ê°„ê²© ì¶”ê°€
            
            const maxActivity = Math.max(...data.map(d => d.activity));
            
            data.forEach(item => {
                const x = startX + item.day * cellWidth;
                const y = startY + item.user * cellHeight;
                
                const intensity = item.activity / maxActivity;
                const color = getHeatmapColor(intensity);
                
                ctx.fillStyle = color;
                // ì…€ ê°„ê²©ì„ ê³ ë ¤í•˜ì—¬ í¬ê¸° ì¡°ì •
                ctx.fillRect(x + cellSpacing/2, y + cellSpacing/2, cellWidth - cellSpacing, cellHeight - cellSpacing);
                
                if (item.activity > 0) {
                    ctx.fillStyle = intensity > 0.5 ? '#000' : '#fff';
                    ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(item.activity.toString(), x + cellWidth/2, y + cellHeight/2);
                }
            });
        }

        // íˆíŠ¸ë§µ ë§‰ëŒ€ ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
        function drawHeatmapBarChart(ctx, width, height, data) {
            if (data.length === 0) {
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            const padding = 80;
            const chartWidth = width - 2 * padding;
            const chartHeight = height - 2 * padding;
            const barWidth = chartWidth / data.length;
            const colors = ['#4a9eff', '#4caf50', '#ff9800', '#f44336', '#9c27b0'];
            
            // ìµœëŒ€ í™œë™ ìˆ˜ ì°¾ê¸°
            const maxActivity = Math.max(...data.map(item => item.activity));
            
            // Yì¶• ë ˆì´ë¸” ê·¸ë¦¬ê¸°
            ctx.fillStyle = '#7a7a7a';
            ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'right';
            ctx.textBaseline = 'middle';
            
            const ySteps = 5;
            for (let i = 0; i <= ySteps; i++) {
                const y = padding + (chartHeight / ySteps) * i;
                const value = Math.round((maxActivity / ySteps) * (ySteps - i));
                ctx.fillText(value.toString(), padding - 10, y);
            }
            
            // ë§‰ëŒ€ ê·¸ë¦¬ê¸°
            data.forEach((item, index) => {
                const x = padding + (chartWidth / data.length) * index + barWidth * 0.1;
                const barHeight = (item.activity / maxActivity) * chartHeight;
                const y = height - padding - barHeight;
                
                // ë§‰ëŒ€ ê·¸ë¦¬ê¸°
                ctx.fillStyle = colors[index % colors.length];
                ctx.fillRect(x, y, barWidth * 0.8, barHeight);
                
                // ë§‰ëŒ€ ìœ„ì— ê°’ í‘œì‹œ
                ctx.fillStyle = '#e1e1e1';
                ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(item.activity.toString(), x + barWidth * 0.4, y - 10);
                
                // Xì¶• ë ˆì´ë¸” (ì‚¬ìš©ì ID)
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '11px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(item.userId.substring(0, 15), x + barWidth * 0.4, height - padding + 20);
            });
            
            // ì œëª©
            ctx.fillStyle = '#e1e1e1';
            ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('ì‚¬ìš©ìë³„ í™œë™ íˆíŠ¸ë§µ (ìƒìœ„ 20ëª…)', width / 2, 25);
        }

        // íˆíŠ¸ë§µ ìƒ‰ìƒ ê³„ì‚°
        function getHeatmapColor(intensity) {
            const r = Math.floor(255 * intensity);
            const g = Math.floor(100 * (1 - intensity));
            const b = Math.floor(255 * (1 - intensity));
            return `rgb(${r}, ${g}, ${b})`;
        }

        // íˆíŠ¸ë§µ ë ˆì´ë¸” ê·¸ë¦¬ê¸°
        function drawHeatmapLabels(ctx, width, height) {
            const users = [];
            if (currentMembers && currentMembers.length > 0) {
                currentMembers.slice(0, 5).forEach(member => {
                    users.push(member.name);
                });
            }
            
            const days = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dayName = date.toLocaleDateString('ko-KR', { weekday: 'short' });
                days.push(dayName);
            }
            
            ctx.fillStyle = '#7a7a7a';
            ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'center';
            
            const cellHeight = (height - 80) / 5;
            users.forEach((user, index) => {
                const y = 20 + index * cellHeight + cellHeight/2;
                const displayName = user.length > 8 ? user.substring(0, 8) + '...' : user;
                ctx.fillText(displayName, 40, y);
            });
            
            const cellWidth = (width - 100) / 7;
            days.forEach((day, index) => {
                const x = 80 + index * cellWidth + cellWidth/2;
                ctx.fillText(day, x, 10);
            });
        }

        // ë¹„ìš© íš¨ìœ¨ì„± ë¶„ì„ ì°¨íŠ¸ ìƒì„±
        function createCostEfficiencyChart() {
            const canvas = document.getElementById('costEfficiencyChart');
            if (!canvas) return;
            
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            const efficiencyData = generateCostEfficiencyData();
            drawScatterPlot(ctx, width, height, efficiencyData);
        }

        // ë¹„ìš© íš¨ìœ¨ì„± ë°ì´í„° ìƒì„±
        function generateCostEfficiencyData() {
            const userEfficiency = new Map();
            
            // í†µí•© ë°ì´í„° ì €ì¥ì†Œì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const members = chartDataStore.members.length > 0 ? chartDataStore.members : currentMembers;
            const rawEvents = chartDataStore.rawEvents.length > 0 ? chartDataStore.rawEvents : currentRawEventsData;
            
            if (!members || members.length === 0) {
                console.log('âš ï¸ generateCostEfficiencyData: ì‚¬ìš© ê°€ëŠ¥í•œ ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return [];
            }
            
            if (!rawEvents || rawEvents.length === 0) {
                console.log('âš ï¸ generateCostEfficiencyData: ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return [];
            }
            
            members.forEach(member => {
                const userEmail = member.email;
                const userName = member.name;
                
                const userEvents = rawEvents.filter(event => 
                    event.userEmail === userEmail
                );
                
                const totalRequests = userEvents.length;
                const totalCost = userEvents.reduce((sum, event) => 
                    sum + (event.requestsCosts || 0), 0) / 100;
                
                if (totalRequests > 0) {
                    userEfficiency.set(userName, {
                        requests: totalRequests,
                        cost: totalCost,
                        efficiency: totalCost / totalRequests
                    });
                }
            });
            
            const result = Array.from(userEfficiency.values());
            console.log(`ğŸ“Š ë¹„ìš© íš¨ìœ¨ì„± ë°ì´í„° ìƒì„± ì™„ë£‰: ${result.length}ëª…ì˜ ì‚¬ìš©ì (ë°ì´í„° ì†ŒìŠ¤: ${members.length}ëª…, ${rawEvents.length}ê°œ ì´ë²¤íŠ¸)`);
            return result;
        }

        // ìŠ¤ìºí„° í”Œë¡¯ ê·¸ë¦¬ê¸°
        function drawScatterPlot(ctx, width, height, data) {
            if (data.length === 0) {
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            const padding = 60;
            const chartWidth = width - 2 * padding;
            const chartHeight = height - 2 * padding;
            
            const maxRequests = Math.max(...data.map(d => d.requests));
            const maxCost = Math.max(...data.map(d => d.cost));
            
            // ê·¸ë¦¬ë“œ ê·¸ë¦¬ê¸°
            ctx.strokeStyle = '#3a3a3a';
            ctx.lineWidth = 1;
            
            for (let i = 0; i <= 5; i++) {
                const x = padding + (chartWidth / 5) * i;
                const y = padding + (chartHeight / 5) * i;
                
                ctx.beginPath();
                ctx.moveTo(x, padding);
                ctx.lineTo(x, height - padding);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(width - padding, y);
                ctx.stroke();
            }
            
            // ë°ì´í„° í¬ì¸íŠ¸ ê·¸ë¦¬ê¸°
            data.forEach(item => {
                const x = padding + (item.requests / maxRequests) * chartWidth;
                const y = height - padding - (item.cost / maxCost) * chartHeight;
                
                ctx.fillStyle = '#4a9eff';
                ctx.beginPath();
                ctx.arc(x, y, 6, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#fff';
                ctx.font = '10px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(`${item.requests}`, x, y - 10);
            });
            
            // ì¶• ë ˆì´ë¸”
            ctx.fillStyle = '#7a7a7a';
            ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('ìš”ì²­ ìˆ˜', width / 2, height - 10);
            
            ctx.save();
            ctx.translate(10, height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('ë¹„ìš© ($)', 0, 0);
            ctx.restore();
        }

        // ëª¨ë¸ ì„ í˜¸ë„ ì°¨íŠ¸ ìƒì„±
        function createModelPreferenceChart() {
            const canvas = document.getElementById('modelPreferenceChart');
            if (!canvas) return;
            
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            const preferenceData = generateModelPreferenceData();
            drawStackedBarChart(ctx, width, height, preferenceData);
        }

        // ëª¨ë¸ ì„ í˜¸ë„ ë°ì´í„° ìƒì„± (í™œë™ ê¸°ì¤€ ìƒìœ„ 20ëª…, í™œë™ ì—†ëŠ” ì‚¬ìš©ì ì œì™¸)
        function generateModelPreferenceData() {
            // í†µí•© ë°ì´í„° ì €ì¥ì†Œì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const members = chartDataStore.members.length > 0 ? chartDataStore.members : currentMembers;
            const rawEvents = chartDataStore.rawEvents.length > 0 ? chartDataStore.rawEvents : currentRawEventsData;
            
            if (!members || members.length === 0) {
                console.log('âš ï¸ generateModelPreferenceData: ì‚¬ìš© ê°€ëŠ¥í•œ ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return new Map();
            }
            
            if (!rawEvents || rawEvents.length === 0) {
                console.log('âš ï¸ generateModelPreferenceData: ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return new Map();
            }
            
            // ì‚¬ìš©ìë³„ í™œë™ ë° ëª¨ë¸ ì‚¬ìš©ëŸ‰ ê³„ì‚°
            const userActivityData = [];
            members.forEach(member => {
                const userEmail = member.email;
                const userName = member.name;
                const userId = userEmail.split('@')[0];
                
                const userEvents = rawEvents.filter(event => 
                    event.userEmail === userEmail || event.email === userEmail
                );
                
                // í™œë™ì´ ì—†ëŠ” ì‚¬ìš©ìëŠ” ì œì™¸
                if (userEvents.length === 0) {
                    return;
                }
                
                const modelUsage = new Map();
                userEvents.forEach(event => {
                    const model = event.model || 'unknown';
                    modelUsage.set(model, (modelUsage.get(model) || 0) + 1);
                });
                
                userActivityData.push({
                    userName: userName,
                    userId: userId,
                    email: userEmail,
                    totalActivity: userEvents.length,
                    modelUsage: modelUsage
                });
            });
            
            // í™œë™ ìˆ˜ë¡œ ì •ë ¬í•˜ì—¬ ìƒìœ„ 20ëª… ì„ íƒ
            const sortedUsers = userActivityData
                .sort((a, b) => b.totalActivity - a.totalActivity)
                .slice(0, 20);
            
            // Map í˜•íƒœë¡œ ë³€í™˜ (ê¸°ì¡´ ì½”ë“œì™€ì˜ í˜¸í™˜ì„±ì„ ìœ„í•´)
            const userModelPreference = new Map();
            sortedUsers.forEach(user => {
                userModelPreference.set(user.userId, user.modelUsage); // userIdë¡œ í‚¤ ë³€ê²½
            });
            
            console.log(`ğŸ“Š ëª¨ë¸ ì„ í˜¸ë„ ë°ì´í„° ìƒì„± ì™„ë£Œ: ${userModelPreference.size}ëª…ì˜ í™œì„± ì‚¬ìš©ì (ì „ì²´ ${members.length}ëª… ì¤‘ ìƒìœ„ 20ëª…, ${rawEvents.length}ê°œ ì´ë²¤íŠ¸)`);
            return userModelPreference;
        }

        // ìŠ¤íƒ ë°” ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        function drawStackedBarChart(ctx, width, height, data) {
            if (data.size === 0) {
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            const padding = 80;
            const chartWidth = width - 2 * padding;
            const chartHeight = height - 2 * padding;
            const barWidth = chartWidth / data.size;
            const colors = ['#4a9eff', '#4caf50', '#ff9800', '#f44336', '#9c27b0'];
            
            let userIndex = 0;
            data.forEach((modelUsage, userName) => {
                const x = padding + barWidth * userIndex + barWidth * 0.1;
                const totalUsage = Array.from(modelUsage.values()).reduce((sum, count) => sum + count, 0);
                
                // ì‚¬ìš©ì ID (userNameì´ ì´ë¯¸ userIdë¡œ ì„¤ì •ë¨)
                const userId = userName;
                
                let currentY = height - padding;
                let colorIndex = 0;
                
                modelUsage.forEach((count, model) => {
                    const barHeight = (count / totalUsage) * chartHeight;
                    currentY -= barHeight;
                    
                    ctx.fillStyle = colors[colorIndex % colors.length];
                    ctx.fillRect(x, currentY, barWidth * 0.8, barHeight);
                    
                    if (barHeight > 20) {
                        ctx.fillStyle = '#fff';
                        ctx.font = '10px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                        ctx.textAlign = 'center';
                        ctx.fillText(model, x + barWidth * 0.4, currentY + barHeight / 2);
                    }
                    
                    colorIndex++;
                });
                
                // ì‚¬ìš©ì ID (Xì¶•) - ìµœëŒ€ 15ìë¡œ ì œí•œ
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(userId.substring(0, 15), x + barWidth * 0.4, height - 10);
                
                userIndex++;
            });
        }

        // ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ ìƒì„±
        function createUserPerformanceChart() {
            console.log('ğŸ† createUserPerformanceChart ì‹œì‘');
            
            const canvas = document.getElementById('userPerformanceChart');
            if (!canvas) {
                console.error('âŒ userPerformanceChart ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            console.log(`ğŸ“ ìº”ë²„ìŠ¤ í¬ê¸°: ${width}x${height}`);
            
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            const performanceData = generateUserPerformanceData();
            console.log(`ğŸ“Š ì„±ê³¼ ë°ì´í„° ìƒì„± ì™„ë£Œ: ${performanceData.length}ëª…ì˜ ì‚¬ìš©ì`);
            
            if (performanceData.length === 0) {
                console.log('âš ï¸ ì„±ê³¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¡œë”© ë©”ì‹œì§€ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.');
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            console.log('ğŸ”„ ì°¨íŠ¸ ê·¸ë¦¬ê¸° ì‹œì‘...', performanceData);
            drawPerformanceChart(ctx, width, height, performanceData);
            console.log('âœ… ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ ìƒì„± ì™„ë£Œ');
        }

        // í•„í„°ë§ëœ ì‚¬ìš©ì í™œë™ íˆíŠ¸ë§µ ì°¨íŠ¸ ìƒì„± (ìš”ì¼ë³„ ë§‰ëŒ€ ê·¸ë˜í”„)
        function createFilteredUserHeatmapChart(searchTerm) {
            console.log('ğŸ”¥ createFilteredUserHeatmapChart ì‹œì‘:', searchTerm);
            const canvas = document.getElementById('userHeatmapChart');
            if (!canvas) {
                console.error('âŒ userHeatmapChart ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            // ê²€ìƒ‰ëœ ì‚¬ìš©ìì˜ ìš”ì¼ë³„ í™œë™ ë°ì´í„° ìƒì„±
            const weeklyData = generateWeeklyActivityData(searchTerm);
            console.log('ğŸ”¥ ìƒì„±ëœ ìš”ì¼ë³„ ë°ì´í„°:', weeklyData);
            
            if (!weeklyData || !weeklyData.data || weeklyData.data.length === 0) {
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(`ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤: "${searchTerm}"`, width / 2, height / 2);
                return;
            }
            
            // ìš”ì¼ë³„ ë§‰ëŒ€ ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
            drawWeeklyBarChart(ctx, width, height, weeklyData.data, weeklyData.userName);
            console.log('âœ… í•„í„°ë§ëœ ì‚¬ìš©ì í™œë™ íˆíŠ¸ë§µ ì°¨íŠ¸ ìƒì„± ì™„ë£Œ');
        }

        // ìš”ì¼ë³„ í™œë™ ë°ì´í„° ìƒì„±
        function generateWeeklyActivityData(searchTerm) {
            console.log('ğŸ”¥ generateWeeklyActivityData ì‹œì‘:', searchTerm);
            
            const members = (chartDataStore.members && chartDataStore.members.length > 0) ? 
                chartDataStore.members : (currentMembers || []);
            const rawEvents = (chartDataStore.rawEvents && chartDataStore.rawEvents.length > 0) ? 
                chartDataStore.rawEvents : (currentRawEventsData || []);
            
            if (!members || members.length === 0 || !rawEvents || rawEvents.length === 0) {
                console.log('âš ï¸ ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.');
                return [];
            }
            
            // ê²€ìƒ‰ì–´ì™€ ì¼ì¹˜í•˜ëŠ” ì‚¬ìš©ì ì°¾ê¸° (ID ê¸°ë°˜)
            const matchedUser = members.find(member => {
                const emailId = member.email.split('@')[0];
                return emailId.toLowerCase() === searchTerm.toLowerCase();
            });
            
            if (!matchedUser) {
                console.log('âš ï¸ ê²€ìƒ‰ëœ ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return null;
            }
            
            // í•´ë‹¹ ì‚¬ìš©ìì˜ ì´ë²¤íŠ¸ í•„í„°ë§
            const userEvents = rawEvents.filter(event => 
                event.userEmail === matchedUser.email || event.email === matchedUser.email
            );
            
            // ìš”ì¼ë³„ í™œë™ ìˆ˜ ê³„ì‚°
            const weeklyActivity = new Map();
            const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            
            userEvents.forEach(event => {
                const eventDate = new Date(parseInt(event.timestamp));
                const dayOfWeek = eventDate.getDay();
                const dayName = dayNames[dayOfWeek];
                
                weeklyActivity.set(dayName, (weeklyActivity.get(dayName) || 0) + 1);
            });
            
            // ëª¨ë“  ìš”ì¼ì— ëŒ€í•´ ë°ì´í„° ìƒì„± (í™œë™ì´ ì—†ëŠ” ìš”ì¼ì€ 0)
            const data = dayNames.map(dayName => ({
                day: dayName,
                activity: weeklyActivity.get(dayName) || 0
            }));
            
            console.log(`ğŸ”¥ ìš”ì¼ë³„ í™œë™ ë°ì´í„° ìƒì„± ì™„ë£Œ: ${matchedUser.name} (${data.length}ì¼)`);
            console.log('ğŸ”¥ ìµœì¢… ë°ì´í„°:', data);
            return {
                data: data,
                userName: matchedUser.name,
                userEmail: matchedUser.email
            };
        }

        // ìš”ì¼ë³„ ë§‰ëŒ€ ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
        function drawWeeklyBarChart(ctx, width, height, data, userName) {
            const padding = 80;
            const chartWidth = width - 2 * padding;
            const chartHeight = height - 2 * padding;
            const barWidth = chartWidth / data.length;
            const colors = ['#4a9eff', '#4caf50', '#ff9800', '#f44336', '#9c27b0', '#00bcd4', '#ff5722'];
            
            // ìµœëŒ€ í™œë™ ìˆ˜ ì°¾ê¸°
            const maxActivity = Math.max(...data.map(item => item.activity));
            
            // Yì¶• ë ˆì´ë¸” ê·¸ë¦¬ê¸° (íˆíŠ¸ìˆ˜)
            ctx.fillStyle = '#7a7a7a';
            ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'right';
            ctx.textBaseline = 'middle';
            
            const ySteps = 5;
            for (let i = 0; i <= ySteps; i++) {
                const y = padding + (chartHeight / ySteps) * i;
                const value = Math.round((maxActivity / ySteps) * (ySteps - i));
                ctx.fillText(value.toString(), padding - 10, y);
            }
            
            // Yì¶• ì œëª© (íˆíŠ¸ìˆ˜)
            ctx.fillStyle = '#7a7a7a';
            ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'center';
            ctx.save();
            ctx.translate(20, height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('íˆíŠ¸ìˆ˜', 0, 0);
            ctx.restore();
            
            // ë§‰ëŒ€ ê·¸ë¦¬ê¸°
            data.forEach((item, index) => {
                const x = padding + (chartWidth / data.length) * index + barWidth * 0.1;
                const barHeight = maxActivity > 0 ? (item.activity / maxActivity) * chartHeight : 0;
                const y = height - padding - barHeight;
                
                // ë§‰ëŒ€ ê·¸ë¦¬ê¸°
                ctx.fillStyle = colors[index % colors.length];
                ctx.fillRect(x, y, barWidth * 0.8, barHeight);
                
                // ë§‰ëŒ€ ìœ„ì— ê°’ í‘œì‹œ
                ctx.fillStyle = '#e1e1e1';
                ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(item.activity.toString(), x + barWidth * 0.4, y - 10);
                
                // Xì¶• ë ˆì´ë¸” (ìš”ì¼)
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '11px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(item.day, x + barWidth * 0.4, height - padding + 20);
            });
            
            // ì œëª©
            ctx.fillStyle = '#e1e1e1';
            ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(`${userName}ì˜ ìš”ì¼ë³„ íˆíŠ¸ìˆ˜`, width / 2, 25);
        }

        // í•„í„°ë§ëœ ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ ìƒì„±
        function createFilteredUserPerformanceChart(searchTerm) {
            const canvas = document.getElementById('userPerformanceChart');
            if (!canvas) return;
            
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            // ì „ì²´ ì„±ê³¼ ë°ì´í„°ì—ì„œ ê²€ìƒ‰ì–´ì™€ ì¼ì¹˜í•˜ëŠ” ì‚¬ìš©ìë§Œ í•„í„°ë§
            const allPerformanceData = generateUserPerformanceData();
            const filteredData = allPerformanceData.filter(user => 
                user.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                user.email.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            if (filteredData.length === 0) {
                // ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì„ ë•Œ ë©”ì‹œì§€ í‘œì‹œ
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(`ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤: "${searchTerm}"`, width / 2, height / 2);
                return;
            }
            
            // í•„í„°ë§ëœ ë°ì´í„°ë¡œ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
            drawPerformanceChart(ctx, width, height, filteredData);
            
            console.log(`âœ… í•„í„°ë§ëœ ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ ìƒì„± ì™„ë£Œ: "${searchTerm}" - ${filteredData.length}ëª…ì˜ ì‚¬ìš©ì`);
        }

        // í•„í„°ë§ëœ ì‚¬ìš©ì í™œë™ íˆíŠ¸ë§µ ì°¨íŠ¸ ìƒì„± (ìš”ì¼ë³„ íˆíŠ¸ìˆ˜)
        function createFilteredUserHeatmapChart(searchTerm) {
            console.log('ğŸ”¥ createFilteredUserHeatmapChart ì‹œì‘:', searchTerm);
            const canvas = document.getElementById('userHeatmapChart');
            if (!canvas) {
                console.error('âŒ userHeatmapChart ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            // ê²€ìƒ‰ëœ ì‚¬ìš©ìì˜ ìš”ì¼ë³„ í™œë™ ë°ì´í„° ìƒì„±
            const weeklyData = generateWeeklyActivityData(searchTerm);
            console.log('ğŸ”¥ ìƒì„±ëœ ìš”ì¼ë³„ ë°ì´í„°:', weeklyData);
            
            if (!weeklyData || !weeklyData.data || weeklyData.data.length === 0) {
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(`ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤: "${searchTerm}"`, width / 2, height / 2);
                return;
            }
            
            // ìš”ì¼ë³„ ë§‰ëŒ€ ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
            drawWeeklyBarChart(ctx, width, height, weeklyData.data, weeklyData.userName);
            console.log('âœ… í•„í„°ë§ëœ ì‚¬ìš©ì í™œë™ íˆíŠ¸ë§µ ì°¨íŠ¸ ìƒì„± ì™„ë£Œ');
        }

        // í•„í„°ë§ëœ ëª¨ë¸ ì„ í˜¸ë„ ì°¨íŠ¸ ìƒì„±
        function createFilteredModelPreferenceChart(searchTerm) {
            const canvas = document.getElementById('modelPreferenceChart');
            if (!canvas) return;
            
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            // ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì„ ë•Œ ë©”ì‹œì§€ í‘œì‹œ
            ctx.fillStyle = '#7a7a7a';
            ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(`ëª¨ë¸ ì„ í˜¸ë„ ê²€ìƒ‰ ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘...`, width / 2, height / 2);
            
            console.log(`âœ… í•„í„°ë§ëœ ëª¨ë¸ ì„ í˜¸ë„ ì°¨íŠ¸ ìƒì„± ì™„ë£Œ: "${searchTerm}"`);
        }

        // ì‚¬ìš©ìë³„ ì„±ê³¼ ë°ì´í„° ìƒì„±
        function generateUserPerformanceData() {
            const userPerformance = [];
            
            // í˜„ì¬ ë°ì´í„°ì—ì„œ ê°€ì ¸ì˜¤ê¸° (chartDataStore ìš°ì„ , ì—†ìœ¼ë©´ ì „ì—­ ë³€ìˆ˜ ì‚¬ìš©)
            const members = (chartDataStore.members && chartDataStore.members.length > 0) ? 
                chartDataStore.members : (currentMembersData || []);
            const rawEvents = (chartDataStore.rawEvents && chartDataStore.rawEvents.length > 0) ? 
                chartDataStore.rawEvents : (currentRawEventsData || []);
            
            console.log(`ğŸ” ì‚¬ìš©ìë³„ ì„±ê³¼ ë°ì´í„° ìƒì„± ì‹œì‘: ë©¤ë²„ ${members.length}ëª…, ì´ë²¤íŠ¸ ${rawEvents.length}ê°œ`);
            
            if (!members || members.length === 0) {
                console.log('âš ï¸ generateUserPerformanceData: ì‚¬ìš© ê°€ëŠ¥í•œ ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return [];
            }
            
            if (!rawEvents || rawEvents.length === 0) {
                console.log('âš ï¸ generateUserPerformanceData: ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return [];
            }
            
            members.forEach(member => {
                const userEmail = member.email;
                const userName = member.name;
                
                // ì´ë©”ì¼ í•„ë“œëª… í™•ì¸ (userEmail ë˜ëŠ” email)
                const userEvents = rawEvents.filter(event => {
                    const eventEmail = event.userEmail || event.email;
                    return eventEmail === userEmail;
                });
                
                const totalRequests = userEvents.length;
                const totalCost = userEvents.reduce((sum, event) => 
                    sum + (event.requestsCosts || 0), 0) / 100;
                const uniqueDays = new Set(userEvents.map(event => 
                    new Date(parseInt(event.timestamp)).toDateString())).size;
                
                if (totalRequests > 0) {
                    userPerformance.push({
                        name: userName,
                        email: userEmail,
                        requests: totalRequests,
                        cost: totalCost,
                        activeDays: uniqueDays,
                        efficiency: totalRequests / uniqueDays || 0
                    });
                }
            });
            
            const result = userPerformance.sort((a, b) => b.requests - a.requests).slice(0, 50);
            console.log(`ğŸ“Š ì‚¬ìš©ìë³„ ì„±ê³¼ ë°ì´í„° ìƒì„± ì™„ë£Œ: ${result.length}ëª…ì˜ ì‚¬ìš©ì (ìƒìœ„ 50ëª…, ì „ì²´: ${userPerformance.length}ëª…)`);
            return result;
        }

        // ì„±ê³¼ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        function drawPerformanceChart(ctx, width, height, data) {
            console.log(`ğŸ¨ ì°¨íŠ¸ ê·¸ë¦¬ê¸° ì‹œì‘: ë°ì´í„° ${data.length}ê°œ, ìº”ë²„ìŠ¤ í¬ê¸° ${width}x${height}`);
            
            if (data.length === 0) {
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            const padding = 80;
            const chartWidth = width - 2 * padding;
            const chartHeight = height - 2 * padding;
            const barWidth = Math.max(4, chartWidth / data.length); // ìµœì†Œ 4px ë„ˆë¹„ ë³´ì¥
            const maxRequests = Math.max(...data.map(d => d.requests));
            
            console.log(`ğŸ“Š ì°¨íŠ¸ ì„¤ì •: íŒ¨ë”©=${padding}, ì°¨íŠ¸í¬ê¸°=${chartWidth}x${chartHeight}, ë°”ë„ˆë¹„=${barWidth}, ìµœëŒ€ìš”ì²­=${maxRequests}`);
            
            // ë°°ê²½ ì§€ìš°ê¸°
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            // ê·¸ë¦¬ë“œ
            ctx.strokeStyle = '#3a3a3a';
            ctx.lineWidth = 1;
            
            for (let i = 0; i <= 5; i++) {
                const y = padding + (chartHeight / 5) * i;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(width - padding, y);
                ctx.stroke();
                
                // Yì¶• ë¼ë²¨
                const value = Math.round((maxRequests * (5 - i)) / 5);
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'right';
                ctx.fillText(value.toString(), padding - 10, y + 4);
            }
            
            // ë°” ì°¨íŠ¸
            data.forEach((user, index) => {
                const x = padding + barWidth * index + barWidth * 0.1;
                const barHeight = Math.max(1, (user.requests / maxRequests) * chartHeight);
                const y = height - padding - barHeight;
                
                // ë°” ê·¸ë¦¬ê¸°
                ctx.fillStyle = '#4a9eff';
                ctx.fillRect(x, y, barWidth * 0.8, barHeight);
                
                // ìš”ì²­ ìˆ˜ (ë°” ìœ„ì—)
                if (barHeight > 20) {
                    ctx.fillStyle = '#fff';
                    ctx.font = '10px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText(user.requests.toString(), x + barWidth * 0.4, y - 5);
                }
                
                // ì´ë©”ì¼ ID (Xì¶• ì•„ë˜) - @samsung.com ì œì™¸
                if (barWidth > 20) {
                    ctx.fillStyle = '#7a7a7a';
                    ctx.font = '10px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.save();
                    ctx.translate(x + barWidth * 0.4, height - 15);
                    ctx.rotate(-Math.PI / 4);
                    const emailId = user.email.split('@')[0]; // @samsung.com ì œì™¸í•˜ê³  IDë§Œ ì¶”ì¶œ
                    ctx.fillText(emailId.substring(0, 8), 0, 0); // ìµœëŒ€ 8ê¸€ìê¹Œì§€ í‘œì‹œ
                    ctx.restore();
                }
            });
            
            // ë²”ë¡€ ê·¸ë¦¬ê¸° (ì˜¤ë¥¸ìª½ ìƒë‹¨)
            drawPerformanceLegend(ctx, width, height);
            
            console.log('âœ… ì°¨íŠ¸ ê·¸ë¦¬ê¸° ì™„ë£Œ');
        }

        // ì„±ê³¼ ì°¨íŠ¸ ë²”ë¡€ ê·¸ë¦¬ê¸°
        function drawPerformanceLegend(ctx, width, height) {
            const legendX = width - 200;
            const legendY = 30;
            const itemHeight = 18;
            const itemSpacing = 5;
            
            // ë²”ë¡€ ë°°ê²½
            ctx.fillStyle = 'rgba(26, 26, 26, 0.9)';
            ctx.fillRect(legendX - 10, legendY - 10, 190, 120);
            
            // ë²”ë¡€ í…Œë‘ë¦¬
            ctx.strokeStyle = '#3a3a3a';
            ctx.lineWidth = 1;
            ctx.strokeRect(legendX - 10, legendY - 10, 190, 120);
            
            // ë²”ë¡€ ì œëª©
            ctx.fillStyle = '#e1e1e1';
            ctx.font = 'bold 12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('ğŸ“Š ê³„ì‚° ì§€í‘œ', legendX, legendY);
            
            // ë²”ë¡€ í•­ëª©ë“¤
            const legendItems = [
                { label: 'ì´ ìš”ì²­ ìˆ˜', description: 'ì‚¬ìš©ìë³„ ì´ë²¤íŠ¸ ê°œìˆ˜' },
                { label: 'ì´ ë¹„ìš©', description: 'requestsCosts í•©ê³„ Ã· 100' },
                { label: 'í™œë™ ì¼ìˆ˜', description: 'ê³ ìœ í•œ í™œë™ ë‚ ì§œ ìˆ˜' },
                { label: 'íš¨ìœ¨ì„±', description: 'ì´ ìš”ì²­ ìˆ˜ Ã· í™œë™ ì¼ìˆ˜' },
                { label: 'ì •ë ¬ ê¸°ì¤€', description: 'ìš”ì²­ ìˆ˜ ë‚´ë¦¼ì°¨ìˆœ' }
            ];
            
            legendItems.forEach((item, index) => {
                const y = legendY + 20 + (itemHeight + itemSpacing) * index;
                
                // ë¼ë²¨
                ctx.fillStyle = '#4a9eff';
                ctx.font = '11px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'left';
                ctx.fillText(item.label, legendX, y);
                
                // ì„¤ëª…
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '10px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.fillText(item.description, legendX, y + 12);
            });
        }

        // í™œë™ ìœ í˜• ìƒì„¸ ì°¨íŠ¸ ìƒì„±
        function createActivityTypeDetailedChart() {
            const canvas = document.getElementById('activityTypeDetailedChart');
            if (!canvas) return;
            
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            const detailedData = generateActivityTypeDetailedData();
            drawDetailedBarChart(ctx, width, height, detailedData);
        }

        // í™œë™ ìœ í˜• ìƒì„¸ ë°ì´í„° ìƒì„±
        function generateActivityTypeDetailedData() {
            const activityDetails = new Map();
            
            // í†µí•© ë°ì´í„° ì €ì¥ì†Œì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const rawEvents = chartDataStore.rawEvents.length > 0 ? chartDataStore.rawEvents : currentRawEventsData;
            
            if (!rawEvents || rawEvents.length === 0) {
                console.log('âš ï¸ generateActivityTypeDetailedData: ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return new Map();
            }
            
            rawEvents.forEach(event => {
                const type = event.kind || 'unknown';
                const model = event.model || 'unknown';
                const cost = (event.requestsCosts || 0) / 100;
                
                if (!activityDetails.has(type)) {
                    activityDetails.set(type, {
                        count: 0,
                        totalCost: 0,
                        models: new Map(),
                        users: new Set()
                    });
                }
                
                const details = activityDetails.get(type);
                details.count++;
                details.totalCost += cost;
                details.models.set(model, (details.models.get(model) || 0) + 1);
                details.users.add(event.userEmail);
            });
            
            console.log(`ğŸ“Š í™œë™ ìœ í˜• ìƒì„¸ ë°ì´í„° ìƒì„± ì™„ë£‰: ${activityDetails.size}ê°œ ìœ í˜• (ë°ì´í„° ì†ŒìŠ¤: ${rawEvents.length}ê°œ ì´ë²¤íŠ¸)`);
            return activityDetails;
        }

        // ìƒì„¸ ë°” ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        function drawDetailedBarChart(ctx, width, height, data) {
            if (data.size === 0) {
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            const padding = 80;
            const chartWidth = width - 2 * padding;
            const chartHeight = height - 2 * padding;
            const barWidth = chartWidth / data.size;
            const maxCount = Math.max(...Array.from(data.values()).map(d => d.count));
            
            let index = 0;
            data.forEach((details, type) => {
                const x = padding + barWidth * index + barWidth * 0.1;
                const barHeight = (details.count / maxCount) * chartHeight;
                const y = height - padding - barHeight;
                
                // ë©”ì¸ ë°”
                ctx.fillStyle = '#4a9eff';
                ctx.fillRect(x, y, barWidth * 0.8, barHeight);
                
                // ì •ë³´ í…ìŠ¤íŠ¸
                ctx.fillStyle = '#fff';
                ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(details.count.toString(), x + barWidth * 0.4, y - 10);
                
                // í™œë™ ìœ í˜•
                ctx.fillStyle = '#7a7a7a';
                ctx.fillText(type, x + barWidth * 0.4, height - 10);
                
                // ì¶”ê°€ ì •ë³´
                ctx.fillStyle = '#ff9800';
                ctx.fillText(`$${details.totalCost.toFixed(2)}`, x + barWidth * 0.4, height - 25);
                ctx.fillStyle = '#4caf50';
                ctx.fillText(`${details.users.size}ëª…`, x + barWidth * 0.4, height - 40);
                
                index++;
            });
        }

        // ì°¨íŠ¸ ìƒì„± (Overviewìš©)
        function createOverviewChart() {
            const canvas = document.getElementById('overviewChart');
            if (!canvas) return;
           
            // Canvas í¬ê¸° ì„¤ì •
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
           
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
           
            // ë°°ê²½ ì„¤ì •
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            // í˜„ì¬ í•„í„° ìƒíƒœ í™•ì¸
            let dateRange;
            if (currentDateRange) {
                dateRange = currentDateRange;
            } else {
                const filterDays = getCurrentFilterDays();
                dateRange = getDateRange(filterDays);
            }
            
            // ì¼ë³„ í™œë™ ë°ì´í„° ìƒì„±
            const dailyData = generateDailyActivityData(dateRange);
            
            if (dailyData.length === 0) {
                // ë°ì´í„°ê°€ ì—†ì„ ë•Œ ë©”ì‹œì§€ í‘œì‹œ
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
           
            // ê·¸ë¦¬ë“œ ê·¸ë¦¬ê¸°
            ctx.strokeStyle = '#3a3a3a';
            ctx.lineWidth = 1;
           
            // ì„¸ë¡œ ê·¸ë¦¬ë“œ
            for (let i = 0; i <= dailyData.length; i++) {
                const x = (width / dailyData.length) * i;
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
            }
           
            // ê°€ë¡œ ê·¸ë¦¬ë“œ
            for (let i = 0; i <= 5; i++) {
                const y = (height / 5) * i;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
            
            // ìµœëŒ€ê°’ ê³„ì‚°
            const maxValue = Math.max(...dailyData.map(d => d.value));
            
            // ë°ì´í„° í¬ì¸íŠ¸ ìƒì„±
            const dataPoints = dailyData.map((data, index) => ({
                x: (width / dailyData.length) * index + (width / dailyData.length / 2),
                y: height - (height * (data.value / maxValue)) - 20
            }));
           
            // ì„  ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
            ctx.strokeStyle = '#4a9eff';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(dataPoints[0].x, dataPoints[0].y);
           
            for (let i = 1; i < dataPoints.length; i++) {
                ctx.lineTo(dataPoints[i].x, dataPoints[i].y);
            }
            ctx.stroke();
           
            // ë°ì´í„° í¬ì¸íŠ¸ ì› ê·¸ë¦¬ê¸°
            dataPoints.forEach(point => {
                ctx.fillStyle = '#4a9eff';
                ctx.beginPath();
                ctx.arc(point.x, point.y, 4, 0, Math.PI * 2);
                ctx.fill();
            });
           
            // ë‚ ì§œ ë ˆì´ë¸”
            ctx.fillStyle = '#7a7a7a';
            ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'center';
           
            dailyData.forEach((data, index) => {
                const x = (width / dailyData.length) * index + (width / dailyData.length / 2);
                ctx.fillText(data.date, x, height - 10);
            });
        }
        
        // ì¼ë³„ í™œë™ ë°ì´í„° ìƒì„± í•¨ìˆ˜
        function generateDailyActivityData(dateRange) {
            const dailyData = [];
            
            // í†µí•© ë°ì´í„° ì €ì¥ì†Œì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const rawEvents = chartDataStore.rawEvents.length > 0 ? chartDataStore.rawEvents : currentRawEventsData;
            
            console.log('ğŸ“Š generateDailyActivityData ë””ë²„ê¹…:');
            console.log('- chartDataStore.rawEvents.length:', chartDataStore.rawEvents ? chartDataStore.rawEvents.length : 0);
            console.log('- currentRawEventsData.length:', currentRawEventsData ? currentRawEventsData.length : 0);
            console.log('- ì‚¬ìš©í•  rawEvents.length:', rawEvents ? rawEvents.length : 0);
            console.log('- dateRange:', {
                start: new Date(dateRange.startDate).toLocaleString('ko-KR'),
                end: new Date(dateRange.endDate).toLocaleString('ko-KR')
            });
            
            if (!rawEvents || rawEvents.length === 0) {
                console.log('âš ï¸ generateDailyActivityData: ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return dailyData;
            }
            
            // ìƒ˜í”Œ ì´ë²¤íŠ¸ í™•ì¸
            if (rawEvents.length > 0) {
                const sampleEvent = rawEvents[0];
                console.log('ğŸ“ ìƒ˜í”Œ ì´ë²¤íŠ¸:', {
                    timestamp: sampleEvent.timestamp,
                    date: new Date(parseInt(sampleEvent.timestamp)).toLocaleString('ko-KR'),
                    userEmail: sampleEvent.userEmail,
                    kind: sampleEvent.kind
                });
            }
            
            // ë‚ ì§œë³„ í™œë™ ìˆ˜ ì§‘ê³„
            const dailyActivity = new Map();
            let processedEvents = 0;
            let filteredEvents = 0;
            
            rawEvents.forEach(event => {
                processedEvents++;
                const eventDate = new Date(parseInt(event.timestamp));
                const dateKey = eventDate.toISOString().split('T')[0];
                
                // ë‚ ì§œ ë²”ìœ„ í™•ì¸ì„ ìœ„í•´ timestampë¥¼ Dateë¡œ ë³€í™˜
                const startDate = new Date(dateRange.startDate);
                const endDate = new Date(dateRange.endDate);
                
                if (eventDate >= startDate && eventDate <= endDate) {
                    filteredEvents++;
                    dailyActivity.set(dateKey, (dailyActivity.get(dateKey) || 0) + 1);
                }
            });
            
            console.log(`ğŸ“Š ì´ë²¤íŠ¸ ì²˜ë¦¬ ê²°ê³¼: ì „ì²´ ${processedEvents}ê°œ, í•„í„°ë§ëœ ${filteredEvents}ê°œ`);
            console.log('ğŸ“… ë‚ ì§œë³„ í™œë™ ì§‘ê³„:', Array.from(dailyActivity.entries()));
            
            // ë‚ ì§œ ë²”ìœ„ ë‚´ ëª¨ë“  ë‚ ì§œì— ëŒ€í•´ ë°ì´í„° ìƒì„±
            const startDate = new Date(dateRange.startDate);
            const endDate = new Date(dateRange.endDate);
            
            for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                const dateKey = d.toISOString().split('T')[0];
                const dateStr = `${d.getMonth() + 1}/${d.getDate()}`;
                const activityCount = dailyActivity.get(dateKey) || 0;
                
                dailyData.push({
                    date: dateStr,
                    value: activityCount
                });
            }
            
            console.log('ğŸ“Š ìµœì¢… ì¼ë³„ ë°ì´í„°:', dailyData);
            return dailyData;
        }

        // ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ê´€ë¦¬ ê°ì²´
        const scrollPositions = {
            overview: 0,
            members: 0,
            usage: 0,
            settings: 0
        };
        
        // ì„¹ì…˜ë³„ ìµœì´ˆ ë°©ë¬¸ ì—¬ë¶€ ì¶”ì 
        const sectionVisited = {
            overview: false,
            members: false,
            usage: false,
            settings: false
        };

        // ë©”ë‰´ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
        document.querySelectorAll('.menu-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
               
                // í˜„ì¬ í™œì„± ì„¹ì…˜ì˜ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ì €ì¥
                const currentActiveSection = document.querySelector('.content-section.active');
                if (currentActiveSection) {
                    const currentSectionName = currentActiveSection.id;
                    scrollPositions[currentSectionName] = currentActiveSection.scrollTop;
                }
               
                // ëª¨ë“  ë©”ë‰´ ì•„ì´í…œì—ì„œ active í´ë˜ìŠ¤ ì œê±°
                document.querySelectorAll('.menu-item').forEach(menu => {
                    menu.classList.remove('active');
                });
               
                // í´ë¦­ëœ ë©”ë‰´ì— active í´ë˜ìŠ¤ ì¶”ê°€
                this.classList.add('active');
               
                // ëª¨ë“  ì½˜í…ì¸  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
                document.querySelectorAll('.content-section').forEach(section => {
                    section.classList.remove('active');
                });
               
                // ì„ íƒëœ ì„¹ì…˜ í‘œì‹œ
                const sectionName = this.getAttribute('data-section');
                const targetSection = document.getElementById(sectionName);
                if (targetSection) {
                    targetSection.classList.add('active');
                    
                    // ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ì„¤ì •
                    setTimeout(() => {
                        if (!sectionVisited[sectionName]) {
                            // ìµœì´ˆ ë°©ë¬¸ ì‹œ ìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
                            targetSection.scrollTop = 0;
                            sectionVisited[sectionName] = true;
                            console.log(`${sectionName} ì„¹ì…˜ ìµœì´ˆ ë°©ë¬¸ - ìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤`);
                        } else {
                            // ì´í›„ ë°©ë¬¸ ì‹œ ì´ì „ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ë¡œ ë³µì›
                            targetSection.scrollTop = scrollPositions[sectionName];
                            console.log(`${sectionName} ì„¹ì…˜ ì¬ë°©ë¬¸ - ì´ì „ ìœ„ì¹˜ë¡œ ìŠ¤í¬ë¡¤: ${scrollPositions[sectionName]}px`);
                        }
                    }, 50);
                }
               
                // í—¤ë” ì œëª© ì—…ë°ì´íŠ¸
                const pageTitle = document.getElementById('page-title');
               
                switch(sectionName) {
                    case 'overview':
                        pageTitle.textContent = 'Dashboard Overview';
                        // Overview ë©”ë‰´ í´ë¦­ ì‹œ í˜„ì¬ í•„í„° ìƒíƒœ ìœ ì§€í•˜ë©´ì„œ ë°ì´í„°ë§Œ ìƒˆë¡œê³ ì¹¨
                        setTimeout(async () => {
                            console.log('=== Overview ë©”ë‰´ í´ë¦­ ì‹œ ìë™ ì‹¤ì œ API ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹œì‘ ===');
                            await refreshAllRealData(); // ìë™ ìƒˆë¡œê³ ì¹¨ (í˜„ì¬ í•„í„° ìƒíƒœ ìœ ì§€)
                        }, 100);
                        break;
                    case 'members':
                        pageTitle.textContent = 'Dashboard Members';
                        // Members ë©”ë‰´ í´ë¦­ ì‹œ ìë™ ìƒˆë¡œê³ ì¹¨
                        setTimeout(async () => {
                            console.log('=== Members ë©”ë‰´ í´ë¦­ ì‹œ ìë™ ì‹¤ì œ API ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹œì‘ ===');
                            await updateMembersWithRealData();
                        }, 100);
                        break;
                    case 'usage':
                        pageTitle.textContent = 'Usage Analytics';
                        // Usage ë©”ë‰´ í´ë¦­ ì‹œ ì¡°ê±´ë¶€ ë°ì´í„° ë¡œë”©
                        setTimeout(async () => {
                            if (!isUsageDataLoaded) {
                                console.log('=== Usage ë©”ë‰´ ì²« ë²ˆì§¸ í´ë¦­ - ë°ì´í„° ë¡œë”© ì‹œì‘ ===');
                                // ì´ˆê¸° í•„í„° ê¸°ê°„ í‘œì‹œ ì„¤ì • (30ì¼)
                                const initialDateRange = getDateRange(30);
                                updateUsageFilterPeriodDisplay(initialDateRange.startDate, initialDateRange.endDate);
                                await updateUsageWithCurrentFilter(30, true); // ì²« ë²ˆì§¸ ë¡œë”©
                            } else {
                                console.log('=== Usage ë©”ë‰´ ì¬í´ë¦­ - ë°±ê·¸ë¼ìš´ë“œ ë°ì´í„° ê°±ì‹  ===');
                                updateUsageWithCurrentFilter(30, false); // ë°±ê·¸ë¼ìš´ë“œ ë¡œë”©
                            }
                        }, 100);
                        break;
                    case 'settings':
                        pageTitle.textContent = 'Settings';
                        break;
                    default:
                        pageTitle.textContent = sectionName.charAt(0).toUpperCase() + sectionName.slice(1);
                }
            });
        });

        // ì•„ì½”ë””ì–¸ í† ê¸€ í•¨ìˆ˜
        function toggleAccordion(header) {
            const content = header.nextElementSibling;
            const arrow = header.querySelector('.accordion-arrow');
           
            // ë‹¤ë¥¸ ëª¨ë“  ì•„ì½”ë””ì–¸ ë‹«ê¸°
            document.querySelectorAll('.accordion-content').forEach(otherContent => {
                if (otherContent !== content) {
                    otherContent.classList.remove('active');
                    otherContent.previousElementSibling.querySelector('.accordion-arrow').textContent = 'â–¼';
                }
            });
           
            // í˜„ì¬ ì•„ì½”ë””ì–¸ í† ê¸€
            if (content.classList.contains('active')) {
                content.classList.remove('active');
                arrow.textContent = 'â–¼';
            } else {
                content.classList.add('active');
                arrow.textContent = 'â–²';
            }
        }

        // í† ê¸€ ìŠ¤ìœ„ì¹˜ í•¨ìˆ˜
        function toggleSwitch(toggle) {
            toggle.classList.toggle('off');
        }

        // Overview í†µê³„ ì¹´ë“œ í´ë¦­ ì‹œ ë©¤ë²„ íƒ€ì…ë³„ í•„í„°ë§
        function filterOverviewMembersByType(type) {
            console.log(`=== Overview í†µê³„ ì¹´ë“œ í´ë¦­: ${type} ===`);
            
            // ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
            updateOverviewSelection(type);
            currentFilterType = type;
            
            // ë©¤ë²„ ë°ì´í„° í•„í„°ë§ ë° í‘œì‹œ
            filterAndDisplayMembers(type);
            
            console.log(`í†µê³„ ì¹´ë“œ ì„ íƒ ì™„ë£Œ: ${type} - í•„í„°ë§ëœ ë°ì´í„° í‘œì‹œ`);
        }

        // ë©¤ë²„ ë°ì´í„°ë¥¼ íƒ€ì…ë³„ë¡œ í•„í„°ë§í•˜ê³  í‘œì‹œ
        function filterAndDisplayMembers(type) {
            console.log(`=== ë©¤ë²„ ë°ì´í„° í•„í„°ë§ ì‹œì‘: ${type} ===`);
            
            if (!originalMembersData || originalMembersData.length === 0) {
                console.log('í•„í„°ë§í•  ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            let filteredMembers = [];
            
            if (type === 'total') {
                // ì „ì²´ ë©¤ë²„ í‘œì‹œ
                filteredMembers = [...originalMembersData];
                console.log(`ì „ì²´ ë©¤ë²„ í‘œì‹œ: ${filteredMembers.length}ëª…`);
            } else if (type === 'active') {
                // í™œì„± ë©¤ë²„ë§Œ í•„í„°ë§ (Premium Requestsê°€ ìˆëŠ” ë©¤ë²„)
                filteredMembers = originalMembersData.filter(member => 
                    member.spendData.premiumRequests > 0
                );
                console.log(`í™œì„± ë©¤ë²„ í•„í„°ë§: ${filteredMembers.length}ëª…`);
            } else if (type === 'inactive') {
                // ë¹„í™œì„± ë©¤ë²„ë§Œ í•„í„°ë§ (Premium Requestsê°€ ì—†ëŠ” ë©¤ë²„)
                filteredMembers = originalMembersData.filter(member => 
                    member.spendData.premiumRequests === 0
                );
                console.log(`ë¹„í™œì„± ë©¤ë²„ í•„í„°ë§: ${filteredMembers.length}ëª…`);
            }
            
            // í•„í„°ë§ëœ ë°ì´í„°ë¡œ í…Œì´ë¸” ì—…ë°ì´íŠ¸
            if (filteredMembers.length > 0) {
                currentMembersData = filteredMembers;
                currentMembersPage = 1; // í˜ì´ì§€ ë¦¬ì…‹
                renderMembersTableWithPagination(filteredMembers);
            } else {
                // ë°ì´í„°ê°€ ì—†ì„ ê²½ìš° ë¹ˆ í…Œì´ë¸” í‘œì‹œ
                const container = document.getElementById('members-table-container');
                if (container) {
                    container.innerHTML = `
                        <div style="padding: 20px; text-align: center; color: #7a7a7a; background-color: #1a1a1a;">
                            ${type === 'active' ? 'í™œì„± ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤.' : 
                              type === 'inactive' ? 'ë¹„í™œì„± ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤.' : 
                              'ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'}
                        </div>
                    `;
                }
            }
            
            // í™œë™ ë¦¬ìŠ¤íŠ¸ë„ í•¨ê»˜ ì—…ë°ì´íŠ¸
            updateActivityListByType(type);
            
            console.log(`=== ë©¤ë²„ ë°ì´í„° í•„í„°ë§ ì™„ë£Œ: ${type} ===`);
        }

        // í™œë™ ë¦¬ìŠ¤íŠ¸ë¥¼ íƒ€ì…ë³„ë¡œ í•„í„°ë§í•˜ê³  ì—…ë°ì´íŠ¸
        function updateActivityListByType(type) {
            console.log(`=== í™œë™ ë¦¬ìŠ¤íŠ¸ í•„í„°ë§ ì‹œì‘: ${type} ===`);
            
            if (!currentActivities || currentActivities.length === 0) {
                console.log('í•„í„°ë§í•  í™œë™ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                updateActivityList([]);
                return;
            }
            
            let filteredActivities = [];
            
            if (type === 'total') {
                // ì „ì²´ í™œë™ í‘œì‹œ
                filteredActivities = [...currentActivities];
                console.log(`ì „ì²´ í™œë™ í‘œì‹œ: ${filteredActivities.length}ê°œ`);
            } else if (type === 'active') {
                // í™œì„± í™œë™ë§Œ í•„í„°ë§
                filteredActivities = currentActivities.filter(activity => 
                    activity.type === 'active'
                );
                console.log(`í™œì„± í™œë™ í•„í„°ë§: ${filteredActivities.length}ê°œ`);
            } else if (type === 'inactive') {
                // ë¹„í™œì„± í™œë™ë§Œ í•„í„°ë§
                filteredActivities = currentActivities.filter(activity => 
                    activity.type === 'inactive'
                );
                console.log(`ë¹„í™œì„± í™œë™ í•„í„°ë§: ${filteredActivities.length}ê°œ`);
            }
            
            // í•„í„°ë§ëœ í™œë™ ë°ì´í„°ë¡œ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            updateActivityList(filteredActivities);
            
            console.log(`=== í™œë™ ë¦¬ìŠ¤íŠ¸ í•„í„°ë§ ì™„ë£Œ: ${type} ===`);
        }

        // Overview í†µê³„ ì¹´ë“œ ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateOverviewSelection(type) {
            // ëª¨ë“  í†µê³„ ì¹´ë“œì—ì„œ selected í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll('.overview-stat-box').forEach(box => {
                box.classList.remove('selected');
            });
            
            // í´ë¦­ëœ ì¹´ë“œì— selected í´ë˜ìŠ¤ ì¶”ê°€
            const targetBox = document.querySelector(`.overview-stat-box[data-type="${type}"]`);
            if (targetBox) {
                targetBox.classList.add('selected');
            }
            
            console.log(`í†µê³„ ì¹´ë“œ ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸: ${type}`);
        }

        // íƒ€ì…ë³„ ë©¤ë²„ ë°ì´í„°ë¥¼ ì‹¤ì œ APIì—ì„œ ê°€ì ¸ì™€ì„œ í‘œì‹œ
        async function updateMembersByTypeWithRealData(type) {
            console.log(`=== ${type} ë©¤ë²„ ì‹¤ì œ API ë°ì´í„° ë¡œë“œ ì‹œì‘ ===`);
            console.log(`ìš”ì²­ëœ íƒ€ì…: ${type}, í˜„ì¬ í•„í„° íƒ€ì…: ${currentFilterType}`);
           
            // í˜„ì¬ í•„í„° ê¸°ê°„ ê²°ì •
            let dateRange;
            if (currentDateRange) {
                dateRange = currentDateRange;
            } else {
                const filterDays = getCurrentFilterDays();
                dateRange = getDateRange(filterDays);
            }
           
            console.log(`í•„í„° ê¸°ê°„: ${new Date(dateRange.startDate).toLocaleDateString()} ~ ${new Date(dateRange.endDate).toLocaleDateString()}`);
           
            // ì‹¤ì œ API ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const [membersData, eventsData] = await Promise.all([
                getTeamMembers(),
                getFilteredEvents(dateRange.startDate, dateRange.endDate)
            ]);
           
            if (!membersData || !membersData.teamMembers) {
                throw new Error('ë©¤ë²„ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
           
            console.log(`API ì‘ë‹µ: ë©¤ë²„ ${membersData.teamMembers.length}ëª…, ì´ë²¤íŠ¸ ${eventsData?.usageEvents?.length || 0}ê°œ`);
           
            if (type === 'inactive') {
                // ë¹„í™œì„± ë©¤ë²„ ì²˜ë¦¬
                await showInactiveMembersWithData(membersData, eventsData);
            } else if (type === 'active') {
                // í™œì„± ë©¤ë²„ ì²˜ë¦¬
                await showActiveMembersWithData(membersData, eventsData, 'active');
            } else if (type === 'total') {
                // ì „ì²´ ë©¤ë²„ ì²˜ë¦¬
                await showActiveMembersWithData(membersData, eventsData, 'total');
            } else {
                console.error(`ì•Œ ìˆ˜ ì—†ëŠ” íƒ€ì…: ${type}`);
                currentActivityPage = 1; // í˜ì´ì§€ë„¤ì´ì…˜ ì´ˆê¸°í™”
                updateActivityList([]);
                // ì œëª©ì€ ë™ì ìœ¼ë¡œ ìƒì„±ë¨
            }
           
            console.log(`=== ${type} ë©¤ë²„ ì‹¤ì œ API ë°ì´í„° ë¡œë“œ ì™„ë£Œ ===`);
        }

        // í™œì„± ë©¤ë²„ ë˜ëŠ” ì „ì²´ ë©¤ë²„ í‘œì‹œ
        async function showActiveMembersWithData(membersData, eventsData, type) {
            console.log(`=== ${type} ë©¤ë²„ ë°ì´í„° í‘œì‹œ ì‹œì‘ ===`);
           
            if (!eventsData || !eventsData.usageEvents) {
                console.log('í™œë™ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                currentActivityPage = 1; // í˜ì´ì§€ë„¤ì´ì…˜ ì´ˆê¸°í™”
                updateActivityList([]);
                // ì œëª©ì€ ë™ì ìœ¼ë¡œ ìƒì„±ë¨
                return;
            }
           
            // ì§€ì¶œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const spendingData = await getTeamSpendingData();
            const memberSpendMap = {};
            if (spendingData && spendingData.teamMemberSpend) {
                spendingData.teamMemberSpend.forEach(spendInfo => {
                    memberSpendMap[spendInfo.email] = {
                        premiumRequests: spendInfo.fastPremiumRequests || 0,
                        spend: (spendInfo.spendCents || 0) / 100,
                        hardLimitOverride: spendInfo.hardLimitOverrideDollars || 0
                    };
                });
            }
           
            // ì‹¤ì œ í™œë™ ë¦¬ìŠ¤íŠ¸ ìƒì„±
            const activities = createActivityListWithLastActivity(eventsData.usageEvents, membersData.teamMembers, memberSpendMap);
            console.log(`ìƒì„±ëœ í™œë™ ë¦¬ìŠ¤íŠ¸: ${activities.length}ëª…`);
           
            let filteredActivities;
            if (type === 'active') {
                // í™œì„± ë©¤ë²„: request > 0ì¸ ë©¤ë²„ë§Œ
                filteredActivities = activities.filter(activity => activity.request > 0);
            } else if (type === 'total') {
                // ì „ì²´ ë©¤ë²„: ì‹¤ì œ í™œë™ì´ ìˆëŠ” ëª¨ë“  ë©¤ë²„
                filteredActivities = activities;
            } else {
                // ê¸°ë³¸ê°’: ì „ì²´ ë©¤ë²„
                filteredActivities = activities;
                console.log(`ê¸°ë³¸ ì „ì²´ ë©¤ë²„ í‘œì‹œ: ${filteredActivities.length}ëª…`);
            }
           
            console.log(`${type} ë©¤ë²„ ìµœì¢… ë°ì´í„°: ${filteredActivities.length}ëª…`);
            console.log('í‘œì‹œë  ë©¤ë²„ ëª©ë¡:', filteredActivities.map(a => `${a.email} (${a.request} requests)`));
           
            updateActivityList(filteredActivities);
            // ì œëª©ì€ ë™ì ìœ¼ë¡œ ìƒì„±ë¨
           
            console.log(`=== ${type} ë©¤ë²„ ë°ì´í„° í‘œì‹œ ì™„ë£Œ ===`);
        }

        // ë¹„í™œì„± ë©¤ë²„ í‘œì‹œ í•¨ìˆ˜ (ë°ì´í„°ì™€ í•¨ê»˜)
        async function showInactiveMembersWithData(membersData, eventsData) {
            console.log('=== ë¹„í™œì„± ë©¤ë²„ í‘œì‹œ ì‹œì‘ ===');
           
            // ì§€ì¶œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const spendingData = await getTeamSpendingData();
            const memberSpendMap = {};
            if (spendingData && spendingData.teamMemberSpend) {
                spendingData.teamMemberSpend.forEach(spendInfo => {
                    memberSpendMap[spendInfo.email] = {
                        premiumRequests: spendInfo.fastPremiumRequests || 0,
                        spend: (spendInfo.spendCents || 0) / 100,
                        hardLimitOverride: spendInfo.hardLimitOverrideDollars || 0
                    };
                });
            }
           
            // í™œë™ì´ ìˆëŠ” ì‚¬ìš©ì ëª©ë¡ ìƒì„±
            const activeUserEmails = new Set();
            if (eventsData && eventsData.usageEvents) {
                eventsData.usageEvents.forEach(event => {
                    if (event.userEmail && event.requestsCosts > 0) {
                        activeUserEmails.add(event.userEmail);
                    }
                });
            }
           
            // ë¹„í™œì„± ë©¤ë²„ í•„í„°ë§
            const inactiveMembers = membersData.teamMembers.filter(member =>
                !activeUserEmails.has(member.email)
            );
           
            console.log(`ë¹„í™œì„± ë©¤ë²„: ${inactiveMembers.length}ëª…`);
            console.log('ë¹„í™œì„± ë©¤ë²„ ëª©ë¡:', inactiveMembers.map(m => m.email));
           
            // ë¹„í™œì„± ë©¤ë²„ë¥¼ í™œë™ ë¦¬ìŠ¤íŠ¸ í˜•íƒœë¡œ ë³€í™˜
            const inactiveActivities = inactiveMembers.map(member => {
                const spendData = memberSpendMap[member.email] || {};
                const actualSpend = spendData.spend || 0; // ì‹¤ì œ ì§€ì¶œ ë°ì´í„° ì‚¬ìš©
                const premiumRequests = spendData.premiumRequests || 0;
                const hardLimit = spendData.hardLimitOverride || 0;
                const limitDisplay = hardLimit > 0 ? `$${hardLimit}` : '$0';
               
                return {
                    date: 'No Activity',
                    timestamp: 0,
                    email: member.email,
                    name: member.name || 'Unnamed',
                    type: 'inactive',
                    kind: 'No Activity',
                    request: premiumRequests, // Premium Requests ì‚¬ìš©
                    spend: `$${actualSpend.toFixed(2)}`, // ì‹¤ì œ ì§€ì¶œ ë°ì´í„° ì‚¬ìš©
                    limit: limitDisplay
                };
            });
           
            currentActivityPage = 1; // í˜ì´ì§€ë„¤ì´ì…˜ ì´ˆê¸°í™”
            updateActivityList(inactiveActivities);
            // ì œëª©ì€ ë™ì ìœ¼ë¡œ ìƒì„±ë¨
        }

        // ë¹„í™œì„± ë©¤ë²„ í‘œì‹œ í•¨ìˆ˜ (ê¸°ì¡´ í˜¸í™˜ì„± ìœ ì§€)
        async function showInactiveMembers() {
            try {
                console.log('=== ë¹„í™œì„± ë©¤ë²„ í‘œì‹œ ì‹œì‘ (ê¸°ì¡´ í•¨ìˆ˜) ===');
               
                // í˜„ì¬ í•„í„° ê¸°ê°„ì˜ ì´ë²¤íŠ¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                let dateRange;
                if (currentDateRange) {
                    dateRange = currentDateRange;
                } else {
                    const filterDays = getCurrentFilterDays();
                    dateRange = getDateRange(filterDays);
                }
               
                const [membersData, eventsData] = await Promise.all([
                    getTeamMembers(),
                    getFilteredEvents(dateRange.startDate, dateRange.endDate)
                ]);
               
                if (!membersData || !membersData.teamMembers) {
                    console.error('ë©¤ë²„ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
               
                await showInactiveMembersWithData(membersData, eventsData);
               
            } catch (error) {
                console.error('âŒ ë¹„í™œì„± ë©¤ë²„ í‘œì‹œ ì‹¤íŒ¨:', error);
            }
        }

        // í™œë™ ë°ì´í„°ë¥¼ íƒ€ì…ë³„ë¡œ í•„í„°ë§ (ì‹¤ì œ í™œë™ ê¸°ì¤€) - ì‚¬ìš© ì¤‘ë‹¨ë¨
        // ì´ì œ ê° í†µê³„ ì¹´ë“œ í´ë¦­ ì‹œ ì‹¤ì œ API ë°ì´í„°ë¥¼ ìƒˆë¡œ ê°€ì ¸ì™€ì„œ í‘œì‹œí•¨
        function filterActivitiesByType(activities, type) {
            console.log(`âš ï¸ filterActivitiesByType ì‚¬ìš© ì¤‘ë‹¨ë¨. ëŒ€ì‹  updateMembersByTypeWithRealData ì‚¬ìš©`);
            console.log(`í•„í„°ë§ ìš”ì²­: ${type}, ì „ì²´ í™œë™ ìˆ˜: ${activities.length}`);
           
            let filteredActivities;
            switch (type) {
                case 'active':
                    filteredActivities = activities.filter(activity => activity.type === 'active' && activity.request > 0);
                    break;
                case 'inactive':
                    // ë¹„í™œì„± ë©¤ë²„ë„ í‘œì‹œí•˜ë„ë¡ ìˆ˜ì •
                    filteredActivities = activities.filter(activity => activity.type === 'inactive');
                    break;
                case 'total':
                default:
                    filteredActivities = activities;
                    break;
            }
           
            console.log(`í•„í„°ë§ ê²°ê³¼: ${filteredActivities.length}ëª…`);
            return filteredActivities;
        }

        // Overview í™œë™ë¦¬ìŠ¤íŠ¸ ì œëª© ì—…ë°ì´íŠ¸ (ë™ì ìœ¼ë¡œ í—¤ë”ì— í¬í•¨ë¨)
        function updateOverviewActivityTitle(type, count, totalCount) {
            // ì œëª©ì€ renderOverviewActivityTableWithPaginationì—ì„œ ë™ì ìœ¼ë¡œ ìƒì„±ë¨
            let title, emoji;
            switch (type) {
                case 'active':
                    title = 'í™œì„± ë©¤ë²„ í™œë™ ë¦¬ìŠ¤íŠ¸';
                    emoji = 'âœ…';
                    break;
                case 'inactive':
                    title = 'ë¹„í™œì„± ë©¤ë²„ í™œë™ ë¦¬ìŠ¤íŠ¸';
                    emoji = 'ğŸ’¤';
                    break;
                case 'total':
                default:
                    title = 'ì „ì²´ í™œë™ ë¦¬ìŠ¤íŠ¸';
                    emoji = 'ğŸ“Š';
                    break;
            }
           
            // ë™ì ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ì œëª©ì— ì‚¬ìš©ë  ê¸°ë³¸ ì •ë³´ ë°˜í™˜
            return { title, emoji };
        }

        // í˜„ì¬ Overview í•„í„° ê¸°ê°„ì„ í…ìŠ¤íŠ¸ë¡œ ë°˜í™˜
        function getCurrentOverviewPeriodText() {
            let dateRange;
            if (currentDateRange) {
                dateRange = currentDateRange;
            } else {
                const filterDays = getCurrentFilterDays();
                dateRange = getDateRange(filterDays);
            }
            
            const startDate = new Date(dateRange.startDate).toLocaleDateString('ko-KR');
            const endDate = new Date(dateRange.endDate).toLocaleDateString('ko-KR');
            
            // ë‚ ì§œ ëì˜ "." ì œê±°
            const cleanStartDate = startDate.replace(/\.$/, '');
            const cleanEndDate = endDate.replace(/\.$/, '');
            
            return `${cleanStartDate} ~ ${cleanEndDate}`;
        }

        // ì°¨íŠ¸ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ (ì¦‰ì‹œ ë°˜ì‘)
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('chart-btn')) {
                // ì¦‰ì‹œ ì‹œê°ì  í”¼ë“œë°±
                e.target.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    e.target.style.transform = '';
                }, 150);
                
                // í˜„ì¬ ì„¹ì…˜ì˜ ì°¨íŠ¸ ë²„íŠ¼ë“¤ë§Œ ì²˜ë¦¬
                const parentSection = e.target.closest('.content-section');
                if (parentSection) {
                    // ì¦‰ì‹œ ë²„íŠ¼ ìƒíƒœ ë³€ê²½
                    parentSection.querySelectorAll('.chart-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    e.target.classList.add('active');
                   
                    // Overview ì„¹ì…˜ì˜ í•„í„° ë²„íŠ¼ì¸ ê²½ìš°
                    if (parentSection.id === 'overview') {
                        const days = e.target.getAttribute('data-days') || 1;
                        console.log(`Overview í•„í„° ë²„íŠ¼ í´ë¦­: ${days}ì¼`);
                        
                        // ì°¨íŠ¸ ìºì‹œ ì´ˆê¸°í™” (í•„í„°ê°€ ë³€ê²½ë˜ì—ˆìœ¼ë¯€ë¡œ)
                        clearChartCache();
                        
                        // ì¦‰ì‹œ í•„í„° ê¸°ê°„ í‘œì‹œ ì—…ë°ì´íŠ¸ (ë°ì´í„° ë¡œë”© ì „)
                        const dateRange = getDateRange(parseInt(days));
                        updateFilterPeriodDisplay(dateRange.startDate, dateRange.endDate);
                        
                        // ë¹„ë™ê¸°ë¡œ ë°ì´í„° ì—…ë°ì´íŠ¸
                        setTimeout(() => {
                            updateOverviewWithCurrentFilter();
                        }, 10);
                    }
                    // Usage ì„¹ì…˜ì˜ í•„í„° ë²„íŠ¼ì¸ ê²½ìš°
                    else if (parentSection.id === 'usage') {
                        const days = e.target.getAttribute('data-days') || 30;
                        console.log(`Usage í•„í„° ë²„íŠ¼ í´ë¦­: ${days}ì¼`);
                        
                        // ì¦‰ì‹œ í•„í„° ê¸°ê°„ í‘œì‹œ ì—…ë°ì´íŠ¸ (ë°ì´í„° ë¡œë”© ì „)
                        const dateRange = getDateRange(parseInt(days));
                        updateUsageFilterPeriodDisplay(dateRange.startDate, dateRange.endDate);
                        
                        // ë¹„ë™ê¸°ë¡œ ë°ì´í„° ì—…ë°ì´íŠ¸
                        setTimeout(() => {
                            updateUsageWithCurrentFilter(days);
                        }, 10);
                    }
                }
            }
        });

        // ë‚ ì§œ í•„í„° ì ìš© í•¨ìˆ˜
        async function applyDateFilter() {
            const startDateInput = document.getElementById('start-date');
            const endDateInput = document.getElementById('end-date');
           
            if (!startDateInput.value || !endDateInput.value) {
                alert('ì‹œì‘ ë‚ ì§œì™€ ì¢…ë£Œ ë‚ ì§œë¥¼ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
           
            const startDate = new Date(startDateInput.value).getTime();
            const endDate = new Date(endDateInput.value).getTime() + (24 * 60 * 60 * 1000 - 1); // í•˜ë£¨ ëê¹Œì§€
           
            if (startDate > endDate) {
                alert('ì‹œì‘ ë‚ ì§œëŠ” ì¢…ë£Œ ë‚ ì§œë³´ë‹¤ ë¹ ë¥¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
           
            console.log(`Overview ì‚¬ìš©ì ì •ì˜ ë‚ ì§œ ë²”ìœ„ ì ìš©: ${new Date(startDate).toLocaleDateString()} ~ ${new Date(endDate).toLocaleDateString()}`);
           
            // í˜„ì¬ ë‚ ì§œ ë²”ìœ„ ì €ì¥
            currentDateRange = { startDate, endDate };
           
            // ì°¨íŠ¸ ìºì‹œ ì´ˆê¸°í™” (í•„í„°ê°€ ë³€ê²½ë˜ì—ˆìœ¼ë¯€ë¡œ)
            clearChartCache();
           
            // ì¦‰ì‹œ í•„í„° ê¸°ê°„ í‘œì‹œ ì—…ë°ì´íŠ¸
            updateFilterPeriodDisplay(startDate, endDate);
           
            // ë²„íŠ¼ active ìƒíƒœ ì œê±°
            document.querySelectorAll('#overview .chart-btn').forEach(btn => {
                btn.classList.remove('active');
            });
           
            // ë¹„ë™ê¸°ë¡œ Overview ì—…ë°ì´íŠ¸
            setTimeout(async () => {
                await updateOverviewWithCurrentFilter();
            }, 10);
        }

        // Usage ë‚ ì§œ í•„í„° ì ìš© í•¨ìˆ˜
        async function applyUsageDateFilter() {
            const startDateInput = document.getElementById('usage-start-date');
            const endDateInput = document.getElementById('usage-end-date');
           
            if (!startDateInput.value || !endDateInput.value) {
                alert('ì‹œì‘ ë‚ ì§œì™€ ì¢…ë£Œ ë‚ ì§œë¥¼ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
           
            const startDate = new Date(startDateInput.value).getTime();
            const endDate = new Date(endDateInput.value).getTime() + (24 * 60 * 60 * 1000 - 1); // í•˜ë£¨ ëê¹Œì§€
           
            if (startDate > endDate) {
                alert('ì‹œì‘ ë‚ ì§œëŠ” ì¢…ë£Œ ë‚ ì§œë³´ë‹¤ ë¹ ë¥¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
           
            console.log(`Usage ì‚¬ìš©ì ì •ì˜ ë‚ ì§œ ë²”ìœ„ ì ìš©: ${new Date(startDate).toLocaleDateString()} ~ ${new Date(endDate).toLocaleDateString()}`);
           
            // í˜„ì¬ ë‚ ì§œ ë²”ìœ„ ì €ì¥
            currentUsageDateRange = { startDate, endDate };
           
            // ì¦‰ì‹œ í•„í„° ê¸°ê°„ í‘œì‹œ ì—…ë°ì´íŠ¸
            updateUsageFilterPeriodDisplay(startDate, endDate);
           
            // ë²„íŠ¼ active ìƒíƒœ ì œê±°
            document.querySelectorAll('#usage .chart-btn').forEach(btn => {
                btn.classList.remove('active');
            });
           
            // ë¹„ë™ê¸°ë¡œ Usage ì—…ë°ì´íŠ¸
            setTimeout(async () => {
                await updateUsageWithDateRange(startDate, endDate);
            }, 10);
        }

        // í˜„ì¬ í•„í„° ì„¤ì •ìœ¼ë¡œ Overview ì—…ë°ì´íŠ¸
        async function updateOverviewWithCurrentFilter() {
            try {
                console.log('=== í˜„ì¬ í•„í„°ë¡œ Overview ì—…ë°ì´íŠ¸ ì‹œì‘ ===');
               
                // ì°¨íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì€ ê²½ìš°ì—ë§Œ ê¸°ë³¸ ì°¨íŠ¸ ìƒì„±
                if (!window.overviewChartInitialized) {
                    console.log('ì°¨íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•„ ê¸°ë³¸ ì°¨íŠ¸ ìƒì„±');
                    createOverviewChart();
                    window.overviewChartInitialized = true;
                }
               
                // ë‚ ì§œ ë²”ìœ„ ê²°ì •
                let dateRange;
                if (currentDateRange) {
                    dateRange = currentDateRange;
                    console.log('ì‚¬ìš©ì ì •ì˜ ë‚ ì§œ ë²”ìœ„ ì‚¬ìš©');
                } else {
                    const filterDays = getCurrentFilterDays();
                    dateRange = getDateRange(filterDays);
                    console.log(`ê¸°ë³¸ í•„í„° ê¸°ê°„ ì‚¬ìš©: ${filterDays}ì¼`);
                }
                
                // í•„í„° ê¸°ê°„ í‘œì‹œ ì—…ë°ì´íŠ¸
                updateFilterPeriodDisplay(dateRange.startDate, dateRange.endDate);
               
                // íŒ€ì› ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const membersData = await getTeamMembers();
                if (!membersData || !membersData.teamMembers) {
                    console.error('íŒ€ì› ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                currentMembers = membersData.teamMembers;
               
                // í™œë™ ì´ë²¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
                const eventsData = await getFilteredEvents(dateRange.startDate, dateRange.endDate);
               
                // ì§€ì¶œ ë°ì´í„°ë¡œ í†µê³„ ê³„ì‚° (ì„ íƒëœ ê¸°ê°„)
                const spendingData = await getTeamSpendingData();
               
                // ì§€ì¶œ ë°ì´í„° ë§¤í•‘
                const memberSpendMap = {};
                if (spendingData && spendingData.teamMemberSpend) {
                    console.log('ğŸ” ì›ë³¸ ì§€ì¶œ ë°ì´í„°:', spendingData.teamMemberSpend);
                    spendingData.teamMemberSpend.forEach(spendInfo => {
                        memberSpendMap[spendInfo.email] = {
                            premiumRequests: spendInfo.fastPremiumRequests || 0,
                            spend: (spendInfo.spendCents || 0) / 100,
                            hardLimitOverride: spendInfo.hardLimitOverrideDollars || 0
                        };
                        console.log(`ğŸ’° ${spendInfo.email}: requests=${spendInfo.fastPremiumRequests}, spend=$${((spendInfo.spendCents || 0) / 100).toFixed(2)}, limit=$${spendInfo.hardLimitOverrideDollars || 0}`);
                    });
                    console.log('ğŸ“Š ìµœì¢… ì§€ì¶œ ë°ì´í„° ë§µ:', memberSpendMap);
                }
               
                if (eventsData && eventsData.usageEvents) {
                    console.log(`âœ… ${eventsData.usageEvents.length}ê±´ì˜ í™œë™ ì´ë²¤íŠ¸ë¥¼ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.`);
                    currentActivities = createActivityListWithLastActivity(eventsData.usageEvents, membersData.teamMembers, memberSpendMap);
                    
                    // í˜„ì¬ Raw Events ë°ì´í„° ì—…ë°ì´íŠ¸
                    currentRawEventsData = eventsData.usageEvents;
                    console.log('ğŸ”„ currentRawEventsData ì—…ë°ì´íŠ¸ ì™„ë£Œ:', currentRawEventsData.length, 'ê°œ ì´ë²¤íŠ¸');
                    
                    // í†µí•© ì°¨íŠ¸ ë°ì´í„° ì €ì¥ì†Œ ì—…ë°ì´íŠ¸
                    const currentFilter = getCurrentFilterState();
                    chartDataStore.updateData(
                        membersData.teamMembers,
                        eventsData.usageEvents,
                        spendingData,
                        null, // usageDataëŠ” ë³„ë„ í˜¸ì¶œë¨
                        currentFilter
                    );
                   
                    // ì„ íƒëœ ê¸°ê°„ ë‚´ ì‹¤ì œ í™œì„± ë©¤ë²„ ê³„ì‚°
                    const periodActiveMembers = calculatePeriodActiveMembers(eventsData.usageEvents);
                    const totalMembers = membersData.teamMembers.length;
                    const inactiveMembers = totalMembers - periodActiveMembers;
                   
                    console.log(`í†µê³„ ê³„ì‚° ê²°ê³¼: ì „ì²´ ${totalMembers}ëª…, í™œì„± ${periodActiveMembers}ëª…, ë¹„í™œì„± ${inactiveMembers}ëª…`);
                    console.log(`í™œë™ ë¦¬ìŠ¤íŠ¸ì— ì‹¤ì œ í‘œì‹œë  ë©¤ë²„ ìˆ˜: ${currentActivities.length}ëª…`);
                   
                    // í†µê³„ ì¹´ë“œ ì—…ë°ì´íŠ¸
                    updateStatsCards(totalMembers, periodActiveMembers, inactiveMembers);
                   
                    // í˜„ì¬ ì„ íƒëœ íƒ€ì…ì— ë”°ë¼ í•„í„°ë§
                    const filteredActivities = filterActivitiesByType(currentActivities, currentFilterType);
                    currentActivityPage = 1; // í˜ì´ì§€ë„¤ì´ì…˜ ì´ˆê¸°í™”
                    updateActivityList(filteredActivities);
                    // ì œëª©ì€ ë™ì ìœ¼ë¡œ ìƒì„±ë¨
                    
                    // Overview ì„¹ì…˜ì˜ ì‚¬ìš©ëŸ‰ ì¹´ë“œ ì—…ë°ì´íŠ¸ (í˜„ì¬ í•„í„° ê¸°ê°„ ì‚¬ìš©)
                    console.log('Overview ì„¹ì…˜ ì‚¬ìš©ëŸ‰ ì¹´ë“œ ì—…ë°ì´íŠ¸ ì¤‘...');
                    const overviewUsageData = await getUsageData(dateRange.startDate, dateRange.endDate);
                    updateUsageCards(overviewUsageData, eventsData);
                    console.log('âœ… Overview ì„¹ì…˜ ì‚¬ìš©ëŸ‰ ì¹´ë“œ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                    
                    // ì°¨íŠ¸ ì—…ë°ì´íŠ¸ (ì„ íƒëœ í•„í„° ê¸°ê°„ ê¸°ì¤€)
                    console.log('Overview ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì¤‘...');
                    if (overviewUsageData && overviewUsageData.data) {
                        const chartData = createChartData(overviewUsageData.data);
                        updateChart(chartData);
                        console.log(`âœ… ${overviewUsageData.data.length}ê±´ì˜ ì°¨íŠ¸ ë°ì´í„°ë¥¼ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤.`);
                    }
                    console.log('âœ… Overview ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                } else {
                    console.log('í™œë™ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    currentActivities = [];
                    const totalMembers = membersData ? membersData.teamMembers.length : 0;
                    updateStatsCards(totalMembers, 0, totalMembers);
                    currentActivityPage = 1; // í˜ì´ì§€ë„¤ì´ì…˜ ì´ˆê¸°í™”
                    updateActivityList([]);
                    
                    // Overview ì„¹ì…˜ì˜ ì‚¬ìš©ëŸ‰ ì¹´ë“œ ì—…ë°ì´íŠ¸ (í˜„ì¬ í•„í„° ê¸°ê°„ ì‚¬ìš©)
                    console.log('Overview ì„¹ì…˜ ì‚¬ìš©ëŸ‰ ì¹´ë“œ ì—…ë°ì´íŠ¸ ì¤‘...');
                    const overviewUsageData = await getUsageData(dateRange.startDate, dateRange.endDate);
                    updateUsageCards(overviewUsageData, eventsData);
                    console.log('âœ… Overview ì„¹ì…˜ ì‚¬ìš©ëŸ‰ ì¹´ë“œ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                    
                    // í˜„ì¬ í™œì„±í™”ëœ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                    console.log('í˜„ì¬ í™œì„±í™”ëœ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì¤‘...');
                    const activeChart = document.querySelector('.chart-content.active');
                    if (activeChart) {
                        const chartSelect = document.getElementById('chartSelect');
                        const currentChartType = chartSelect ? chartSelect.value : 'activity-trend';
                        
                        console.log(`í˜„ì¬ í™œì„±í™”ëœ ì°¨íŠ¸: ${currentChartType}`);
                        
                        // ìºì‹œë¥¼ ë¬´ì‹œí•˜ê³  ì°¨íŠ¸ë¥¼ ìƒˆë¡œ ìƒì„±
                        chartCache[currentChartType] = { data: null, filter: null, rendered: false };
                        
                        // ì°¨íŠ¸ íƒ€ì…ì— ë”°ë¼ ì ì ˆí•œ ì°¨íŠ¸ ë Œë”ë§
                        if (currentChartType === 'activity-trend') {
                            createOverviewChart();
                        } else if (currentChartType === 'model-distribution') {
                            createModelDistributionChart();
                        } else if (currentChartType === 'cost-trend') {
                            createCostTrendChart();
                        } else if (currentChartType === 'activity-type') {
                            createActivityTypeChart();
                        } else if (currentChartType === 'user-heatmap') {
                            createUserHeatmapChart();
                        } else if (currentChartType === 'cost-efficiency') {
                            createCostEfficiencyChart();
                        } else if (currentChartType === 'model-preference') {
                            createModelPreferenceChart();
                        } else if (currentChartType === 'user-performance') {
                            createUserPerformanceChart();
                        } else if (currentChartType === 'activity-type-detailed') {
                            createActivityTypeDetailedChart();
                        }
                        
                        // ì°¨íŠ¸ ë Œë”ë§ ì™„ë£Œ í›„ ìºì‹œì— ì €ì¥
                        setTimeout(() => {
                            cacheChartData(currentChartType);
                            chartCache[currentChartType].filter = getCurrentFilterState();
                            chartCache[currentChartType].rendered = true;
                        }, 100);
                        
                        console.log(`âœ… ${currentChartType} ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì™„ë£Œ`);
                    } else {
                        console.log('í™œì„±í™”ëœ ì°¨íŠ¸ê°€ ì—†ìŒ');
                    }
                }
               
                console.log('=== í˜„ì¬ í•„í„°ë¡œ Overview ì—…ë°ì´íŠ¸ ì™„ë£Œ ===');
            } catch (error) {
                console.error('âŒ Overview ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
            }
        }

        // ì„ íƒëœ ê¸°ê°„ ë‚´ í™œì„± ë©¤ë²„ ìˆ˜ ê³„ì‚° (ì‹¤ì œ í™œë™ ê¸°ì¤€)
        function calculatePeriodActiveMembers(events) {
            const activeUsers = new Set();
            events.forEach(event => {
                // ì‹¤ì œ í™œë™ì´ ìˆëŠ” ì‚¬ìš©ìë§Œ ì¹´ìš´íŠ¸ (ìš”ì²­ ë¹„ìš©ì´ 0ë³´ë‹¤ í¬ê±°ë‚˜ í† í° ê¸°ë°˜ í˜¸ì¶œ)
                if (event.userEmail && event.requestsCosts > 0) {
                    activeUsers.add(event.userEmail);
                }
            });
            console.log(`ì„ íƒëœ ê¸°ê°„ ë‚´ í™œì„± ë©¤ë²„: ${activeUsers.size}ëª…`, Array.from(activeUsers));
            return activeUsers.size;
        }

        // Overview í™œë™ ë¦¬ìŠ¤íŠ¸ë§Œ ì—…ë°ì´íŠ¸ (ê¸°ì¡´ í•¨ìˆ˜ í˜¸í™˜ì„± ìœ ì§€)
        async function updateOverviewActivityList() {
            await updateOverviewWithCurrentFilter();
        }

        // ì „ì²´ ì‹¤ì œ API ë°ì´í„° ìƒˆë¡œê³ ì¹¨
        async function refreshAllRealData() {
            // ë¡œë”© ìƒíƒœ í‘œì‹œ
            showLoadingStatus(true);
            
            // ë°ì´í„°ê°€ ìƒˆë¡œ ë¡œë“œë˜ë¯€ë¡œ ì°¨íŠ¸ ìºì‹œ ì´ˆê¸°í™”
            clearChartCache();
           
            // Overviewì™€ Membersë¥¼ ë™ì‹œì— ë¡œë“œí•˜ì—¬ ì‹œê°„ ë‹¨ì¶•
            await Promise.all([
                updateOverviewWithRealData(),
                updateMembersWithRealData()
            ]);
           
            // ë¡œë”© ìƒíƒœ í•´ì œ
            showLoadingStatus(false);
        }

        // ìµœì í™”ëœ ë¡œë”© ìƒíƒœ í‘œì‹œ/í•´ì œ
        function showLoadingStatus(isLoading) {
            const pageTitle = document.getElementById('page-title');
           
            if (isLoading) {
                // Overview ì„¹ì…˜ì—ì„œëŠ” ë¡œë”© ë©”ì‹œì§€ë¥¼ í‘œì‹œí•˜ì§€ ì•ŠìŒ
                if (pageTitle.textContent === 'Overview' || pageTitle.textContent === 'Dashboard Overview') {
                    return;
                }
                pageTitle.innerHTML = 'ğŸ”„ Loading Real API Data...';
            } else {
                // ì›ë˜ ì œëª©ìœ¼ë¡œ ë³µì›
                if (pageTitle.textContent === 'ğŸ”„ Loading Real API Data...') {
                    pageTitle.textContent = 'Dashboard Overview';
                }
            }
        }

        // ì „ì—­ ë³€ìˆ˜
        let currentFilterType = 'total'; // í˜„ì¬ ì„ íƒëœ í•„í„° íƒ€ì…
        let currentActivities = []; // í˜„ì¬ í™œë™ ë°ì´í„°
        let currentMembers = []; // í˜„ì¬ ë©¤ë²„ ë°ì´í„°
        let currentDateRange = null; // í˜„ì¬ ì„ íƒëœ ë‚ ì§œ ë²”ìœ„ (Overviewìš©)
        let currentUsageDateRange = null; // í˜„ì¬ ì„ íƒëœ ë‚ ì§œ ë²”ìœ„ (Usageìš©)
        let currentRawEventsData = []; // í˜„ì¬ Raw Events ì „ì²´ ë°ì´í„°
        let currentRawEventsPage = 1; // í˜„ì¬ Raw Events í˜ì´ì§€
        let currentRawEventsPageSize = 10; // í˜„ì¬ Raw Events í˜ì´ì§€ í¬ê¸°
        
        // í†µí•© ì°¨íŠ¸ ë°ì´í„° ì €ì¥ì†Œ
        let chartDataStore = {
            members: [], // íŒ€ ë©¤ë²„ ë°ì´í„°
            rawEvents: [], // ì›ì‹œ ì´ë²¤íŠ¸ ë°ì´í„°
            spendingData: null, // ì§€ì¶œ ë°ì´í„°
            usageData: null, // ì‚¬ìš©ëŸ‰ ë°ì´í„°
            lastUpdated: null, // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„
            currentFilter: null, // í˜„ì¬ ì ìš©ëœ í•„í„° ìƒíƒœ
            
            // ë°ì´í„° ì—…ë°ì´íŠ¸ í•¨ìˆ˜
            updateData: function(members, rawEvents, spendingData, usageData, filterState) {
                this.members = members || [];
                this.rawEvents = rawEvents || [];
                this.spendingData = spendingData;
                this.usageData = usageData;
                this.currentFilter = filterState;
                this.lastUpdated = new Date();
                console.log(`ğŸ“Š í†µí•© ì°¨íŠ¸ ë°ì´í„° ì €ì¥ì†Œ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${this.members.length}ëª…, ${this.rawEvents.length}ê°œ ì´ë²¤íŠ¸`);
            },
            
            // ë°ì´í„° ìœ íš¨ì„± í™•ì¸
            isDataValid: function(filterState) {
                if (!this.members.length || !this.rawEvents.length || !this.lastUpdated) {
                    return false;
                }
                
                // í•„í„° ìƒíƒœê°€ ë™ì¼í•œì§€ í™•ì¸
                if (filterState && this.currentFilter) {
                    return isFilterStateEqual(this.currentFilter, filterState);
                }
                
                return true;
            },
            
            // ë°ì´í„° ì´ˆê¸°í™”
            clearData: function() {
                this.members = [];
                this.rawEvents = [];
                this.spendingData = null;
                this.usageData = null;
                this.lastUpdated = null;
                this.currentFilter = null;
                console.log('ğŸ“Š í†µí•© ì°¨íŠ¸ ë°ì´í„° ì €ì¥ì†Œ ì´ˆê¸°í™”');
            }
        };
        
        // Usage ë°ì´í„° ë¡œë”© ìƒíƒœ ì¶”ì 
        let isUsageDataLoaded = false; // Usage ë°ì´í„°ê°€ í•œ ë²ˆì´ë¼ë„ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
        let isUsageLoading = false; // Usage ë°ì´í„° ë¡œë”© ì¤‘ì¸ì§€ í™•ì¸
        
        // í™œë™ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ë„¤ì´ì…˜ ë³€ìˆ˜
        let currentActivityPage = 1; // í˜„ì¬ í™œë™ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€
        let currentActivityPageSize = 20; // í˜„ì¬ í™œë™ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ í¬ê¸°
        
        // ì°¨íŠ¸ ìºì‹± ì‹œìŠ¤í…œ
        let chartCache = {
            'activity-trend': { data: null, filter: null, rendered: false },
            'model-distribution': { data: null, filter: null, rendered: false },
            'cost-trend': { data: null, filter: null, rendered: false },
            'activity-type': { data: null, filter: null, rendered: false },
            'user-heatmap': { data: null, filter: null, rendered: false },
            'cost-efficiency': { data: null, filter: null, rendered: false },
            'model-preference': { data: null, filter: null, rendered: false },
            'user-performance': { data: null, filter: null, rendered: false },
            'activity-type-detailed': { data: null, filter: null, rendered: false }
        };
        
        // ì°¨íŠ¸ ìºì‹œ ì´ˆê¸°í™” í•¨ìˆ˜
        function clearChartCache() {
            Object.keys(chartCache).forEach(key => {
                chartCache[key] = { data: null, filter: null, rendered: false };
            });
            console.log('ğŸ“Š ëª¨ë“  ì°¨íŠ¸ ìºì‹œ ì´ˆê¸°í™”');
        }
        let currentActivityData = []; // í˜„ì¬ í™œë™ë¦¬ìŠ¤íŠ¸ ë°ì´í„°
        
        // ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ í˜ì´ì§€ë„¤ì´ì…˜ ë³€ìˆ˜
        let currentUserCumulativePage = 1; // í˜„ì¬ ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ í˜ì´ì§€
        let currentUserCumulativePageSize = 20; // í˜„ì¬ ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ í˜ì´ì§€ í¬ê¸°
        let currentUserCumulativeData = []; // í˜„ì¬ ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ ë°ì´í„°
        let currentUserCumulativeStartDate = null; // í˜„ì¬ ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ ì‹œì‘ ë‚ ì§œ
        let currentUserCumulativeEndDate = null; // í˜„ì¬ ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ ì¢…ë£Œ ë‚ ì§œ
        
        // Members í˜ì´ì§€ë„¤ì´ì…˜ ë³€ìˆ˜
        let currentMembersPage = 1; // í˜„ì¬ Members í˜ì´ì§€
        let currentMembersPageSize = 20; // í˜„ì¬ Members í˜ì´ì§€ í¬ê¸°
        let currentMembersData = []; // í˜„ì¬ Members ë°ì´í„°
        let originalMembersData = []; // ì›ë³¸ ë©¤ë²„ ë°ì´í„° (í•„í„°ë§ìš©)

        // ============================================================================
        // ì„±ëŠ¥ ìµœì í™” ì‹œìŠ¤í…œ (2025.07.29 ì¶”ê°€)
        // ============================================================================









        // API í˜¸ì¶œì„ ìœ„í•œ ì„¤ì •
        const API_CONFIG = {
            baseUrl: window.location.origin, // í˜„ì¬ ë„ë©”ì¸ ì‚¬ìš© (Vercel ë°°í¬ìš©)
            apiKey: 'key_e46368ce482125bbd568b7d55090c657e30e4b73c824f522cbc9ef9b1bf3f0d3',
            headers: {
                'Content-Type': 'application/json'
            }
        };

        // API í˜¸ì¶œ í•¨ìˆ˜ (ì‹¤ì œ API í˜¸ì¶œ)
        async function callAPI(endpoint, method = 'GET', data = null) {
            try {
                // Basic Auth ì„¤ì •
                const credentials = `${API_CONFIG.apiKey}:`;
                const encodedCredentials = btoa(credentials);
                
                const options = {
                    method: method,
                    headers: {
                        ...API_CONFIG.headers,
                        'Authorization': `Basic ${encodedCredentials}`
                    }
                };

                if (data && method === 'POST') {
                    options.body = JSON.stringify(data);
                }

                console.log(`ì‹¤ì œ Cursor Admin API í˜¸ì¶œ: ${method} ${API_CONFIG.baseUrl}/api${endpoint}`, data);
               
                const response = await fetch(API_CONFIG.baseUrl + '/api' + endpoint, options);
               
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`API í˜¸ì¶œ ì‹¤íŒ¨: ${response.status} - ${response.statusText}\n${errorText}`);
                }

                const result = await response.json();
                console.log('ì‹¤ì œ API ì‘ë‹µ ë°ì´í„°:', result);
               
                // API ì‘ë‹µì— ì˜¤ë¥˜ê°€ ìˆëŠ”ì§€ í™•ì¸
                if (result.error) {
                    throw new Error(`API ì˜¤ë¥˜: ${result.error} - ${result.message}`);
                }
               
                return result;
               
            } catch (error) {
                console.error('API í˜¸ì¶œ ì˜¤ë¥˜:', error);
                throw error; // ì˜¤ë¥˜ë¥¼ ë‹¤ì‹œ ë˜ì ¸ì„œ í˜¸ì¶œìê°€ ì²˜ë¦¬í•˜ë„ë¡ í•¨
            }
        }



        // API ì—°ê²° ìƒíƒœ í™•ì¸
        async function checkAPIConnection() {
            try {
                const response = await fetch(API_CONFIG.baseUrl + '/api/teams/members', {
                    method: 'GET',
                    headers: API_CONFIG.headers
                });
                return response.ok;
            } catch (error) {
                return false;
            }
        }

        // íŒ€ì› ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        async function getTeamMembers() {
            return await callAPI('/teams/members');
        }

        // ì‚¬ìš©ëŸ‰ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        async function getUsageData(startDate, endDate) {
            return await callAPI('/teams/daily-usage-data', 'POST', {
                startDate: startDate,
                endDate: endDate
            });
        }

        // íŒ€ ì§€ì¶œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ì „ì²´ ë©¤ë²„)
        async function getTeamSpendingData() {
            try {
                console.log('ğŸ” ì „ì²´ ë©¤ë²„ ì§€ì¶œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹œì‘...');
                
                // ì§ì ‘ í° pageSizeë¡œ ëª¨ë“  ë©¤ë²„ ë°ì´í„° ìš”ì²­
                console.log('ğŸ“¡ API í˜¸ì¶œ: /teams/spend (pageSize: 1000)');
                const spendingData = await callAPI('/teams/spend', 'POST', {
                    page: 1,
                    pageSize: 1000
                });
                
                if (!spendingData || !spendingData.teamMemberSpend) {
                    throw new Error('ì§€ì¶œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                const retrievedCount = spendingData.teamMemberSpend.length;
                const totalMembers = spendingData.totalMembers || retrievedCount;
                const totalPages = spendingData.totalPages || 1;
                
                console.log(`âœ… ì§€ì¶œ ë°ì´í„° ì¡°íšŒ ì™„ë£Œ:`);
                console.log(`   - ì¡°íšŒëœ ë©¤ë²„: ${retrievedCount}ëª…`);
                console.log(`   - ì „ì²´ ë©¤ë²„: ${totalMembers}ëª…`);
                console.log(`   - ì „ì²´ í˜ì´ì§€: ${totalPages}í˜ì´ì§€`);
                
                // ëª¨ë“  ë°ì´í„°ë¥¼ ê°€ì ¸ì™”ëŠ”ì§€ í™•ì¸
                if (retrievedCount < totalMembers && totalPages > 1) {
                    console.log('âš ï¸ ì¶”ê°€ ë°ì´í„°ê°€ ìˆìŠµë‹ˆë‹¤. ë” í° pageSizeë¡œ ì¬ìš”ì²­...');
                    
                    const largerData = await callAPI('/teams/spend', 'POST', {
                        page: 1,
                        pageSize: Math.max(totalMembers + 100, 2000) // ì—¬ìœ ìˆê²Œ ì„¤ì •
                    });
                    
                    if (largerData && largerData.teamMemberSpend && largerData.teamMemberSpend.length > retrievedCount) {
                        console.log(`âœ… ì¬ìš”ì²­ ì„±ê³µ: ${largerData.teamMemberSpend.length}ëª…ì˜ ë°ì´í„° í™•ë³´`);
                        return largerData;
                    }
                }
                
                console.log(`ğŸ¯ ìµœì¢… ê²°ê³¼: ${retrievedCount}ëª…ì˜ ë©¤ë²„ ë°ì´í„° ë°˜í™˜`);
                return spendingData;
                
            } catch (error) {
                console.error('âŒ ì§€ì¶œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                throw error;
            }
        }

        // í•„í„°ë§ëœ ì´ë²¤íŠ¸ ê°€ì ¸ì˜¤ê¸° (ëª¨ë“  í˜ì´ì§€ ë°ì´í„° ìˆ˜ì§‘)
        async function getFilteredEvents(startDate, endDate) {
            try {
                console.log('=== í•„í„°ë§ëœ ì´ë²¤íŠ¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹œì‘ ===');
                
                // ì²« ë²ˆì§¸ í˜ì´ì§€ ìš”ì²­
                let allEvents = [];
                let currentPage = 1;
                let hasMorePages = true;
                
                while (hasMorePages) {
                    console.log(`ğŸ“„ í˜ì´ì§€ ${currentPage} ìš”ì²­ ì¤‘...`);
                    
                    const pageData = await callAPI('/teams/filtered-usage-events', 'POST', {
                        startDate: startDate,
                        endDate: endDate,
                        page: currentPage,
                        pageSize: 1000
                    });
                    
                    if (pageData && pageData.usageEvents) {
                        allEvents = allEvents.concat(pageData.usageEvents);
                        console.log(`âœ… í˜ì´ì§€ ${currentPage}: ${pageData.usageEvents.length}ê°œ ì´ë²¤íŠ¸ ìˆ˜ì§‘ (ëˆ„ì : ${allEvents.length}ê°œ)`);
                        
                        // ë” ë§ì€ í˜ì´ì§€ê°€ ìˆëŠ”ì§€ í™•ì¸
                        hasMorePages = pageData.pagination && pageData.pagination.hasNextPage;
                        currentPage++;
                        
                        // ë¬´í•œ ë£¨í”„ ë°©ì§€ (ìµœëŒ€ 10í˜ì´ì§€)
                        if (currentPage > 10) {
                            console.log('âš ï¸ ìµœëŒ€ í˜ì´ì§€ ìˆ˜ ë„ë‹¬ - ë¬´í•œ ë£¨í”„ ë°©ì§€');
                            break;
                        }
                    } else {
                        console.log(`âŒ í˜ì´ì§€ ${currentPage} ë°ì´í„° ì—†ìŒ`);
                        hasMorePages = false;
                    }
                }
                
                console.log(`=== í•„í„°ë§ëœ ì´ë²¤íŠ¸ ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ: ì´ ${allEvents.length}ê°œ ì´ë²¤íŠ¸ ===`);
                
                // ê¸°ì¡´ í˜•ì‹ìœ¼ë¡œ ë°˜í™˜
                return {
                    totalUsageEventsCount: allEvents.length,
                    usageEvents: allEvents,
                    period: {
                        startDate: startDate,
                        endDate: endDate
                    }
                };
                
            } catch (error) {
                console.error('âŒ í•„í„°ë§ëœ ì´ë²¤íŠ¸ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                throw error;
            }
        }

        // í˜„ì¬ ì„ íƒëœ í•„í„° ê¸°ê°„ ê°€ì ¸ì˜¤ê¸°
        function getCurrentFilterDays() {
            const activeBtn = document.querySelector('#overview .chart-btn.active');
            if (!activeBtn) return 30; // ê¸°ë³¸ê°’ 30ì¼
           
            const days = activeBtn.getAttribute('data-days');
            return days ? parseInt(days) : 30;
        }

        // ë‚ ì§œë¥¼ epoch millisecondsë¡œ ë³€í™˜ (í•œêµ­ ì‹œê°„ ê¸°ì¤€)
        function getDateRange(days = 7) {
            // í•œêµ­ ì‹œê°„ëŒ€ ê¸°ì¤€ìœ¼ë¡œ í˜„ì¬ ë‚ ì§œ ê³„ì‚°
            const now = new Date();
            const koreaTime = new Date(now.getTime() + (9 * 60 * 60 * 1000)); // UTC+9
            
            const endDate = new Date(koreaTime);
            const startDate = new Date(koreaTime);
            startDate.setDate(startDate.getDate() - days);
           
            return {
                startDate: startDate.getTime(),
                endDate: endDate.getTime()
            };
        }

        // í•„í„° ê¸°ê°„ í‘œì‹œ ì—…ë°ì´íŠ¸ (í•œêµ­ ì‹œê°„ ê¸°ì¤€)
        function updateFilterPeriodDisplay(startDate, endDate) {
            const filterPeriodText = document.getElementById('filter-period-text');
            if (!filterPeriodText) return;

            // í•œêµ­ ì‹œê°„ëŒ€ ê¸°ì¤€ìœ¼ë¡œ ë‚ ì§œ ë³€í™˜
            const startDateKorea = new Date(startDate + (9 * 60 * 60 * 1000));
            const endDateKorea = new Date(endDate + (9 * 60 * 60 * 1000));
            
            const startDateStr = startDateKorea.toISOString().split('T')[0];
            const endDateStr = endDateKorea.toISOString().split('T')[0];
            
            filterPeriodText.textContent = `${startDateStr} ~ ${endDateStr}`;
            console.log(`âœ… í•„í„° ê¸°ê°„ í‘œì‹œ ì—…ë°ì´íŠ¸: ${startDateStr} ~ ${endDateStr}`);
        }

        // Usage ì„¹ì…˜ í•„í„° ê¸°ê°„ í‘œì‹œ ì—…ë°ì´íŠ¸ (í•œêµ­ ì‹œê°„ ê¸°ì¤€)
        function updateUsageFilterPeriodDisplay(startDate, endDate) {
            const filterPeriodText = document.getElementById('usage-filter-period-text');
            if (!filterPeriodText) return;

            // í•œêµ­ ì‹œê°„ëŒ€ ê¸°ì¤€ìœ¼ë¡œ ë‚ ì§œ ë³€í™˜
            const startDateKorea = new Date(startDate + (9 * 60 * 60 * 1000));
            const endDateKorea = new Date(endDate + (9 * 60 * 60 * 1000));
            
            const startDateStr = startDateKorea.toISOString().split('T')[0];
            const endDateStr = endDateKorea.toISOString().split('T')[0];
            
            filterPeriodText.textContent = `${startDateStr} ~ ${endDateStr}`;
            console.log(`âœ… Usage í•„í„° ê¸°ê°„ í‘œì‹œ ì—…ë°ì´íŠ¸: ${startDateStr} ~ ${endDateStr}`);
        }

        // Overview ë°ì´í„° ì—…ë°ì´íŠ¸ (ì´ˆê¸° ë¡œë“œìš©)
        async function updateOverviewWithRealData() {
            try {
                console.log('=== ì‹¤ì œ Cursor Admin API ë°ì´í„°ë¡œ Overview ì´ˆê¸° ë¡œë“œ ì‹œì‘ ===');
               
                // ì´ˆê¸°í™”
                currentFilterType = 'total';
                currentDateRange = null;
               
                // í˜„ì¬ í•„í„°ë¡œ ì—…ë°ì´íŠ¸
                await updateOverviewWithCurrentFilter();

                // ì°¨íŠ¸ëŠ” updateOverviewWithCurrentFilterì—ì„œ ì²˜ë¦¬ë¨ (ê¸°ë³¸ 30ì¼ í•„í„°)
                console.log('ì°¨íŠ¸ëŠ” ê¸°ë³¸ í•„í„° ì—…ë°ì´íŠ¸ì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤.');

                // ì´ˆê¸° ë¡œë“œ í›„ ê¸°ë³¸ ì„ íƒëœ 'total' ì¹´ë“œì— ë§ëŠ” ì‹¤ì œ ë°ì´í„° í‘œì‹œ
                console.log('ì´ˆê¸° ë¡œë“œ í›„ ì „ì²´ ë©¤ë²„ ë°ì´í„° í‘œì‹œ');
                await updateMembersByTypeWithRealData('total');
               
                // ì„ íƒ ìƒíƒœì™€ ë°ì´í„° ì¼ì¹˜ í™•ì¸
                console.log(`í˜„ì¬ ì„ íƒëœ íƒ€ì…: ${currentFilterType}`);
                console.log('ì „ì²´ ë©¤ë²„ ì¹´ë“œ ì„ íƒ ìƒíƒœ í™•ì¸ ì™„ë£Œ');

                console.log('=== ì‹¤ì œ API ë°ì´í„°ë¡œ Overview ì´ˆê¸° ë¡œë“œ ì™„ë£Œ! ===');
            } catch (error) {
                console.error('âŒ Overview ì´ˆê¸° ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('Overview ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ê³¼ API ì„œë²„ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }
        }

        // í†µê³„ ì¹´ë“œ ì—…ë°ì´íŠ¸ (ì‹¤ì œ API ë°ì´í„° ì‚¬ìš©)
        function updateStatsCards(total, active, inactive) {
            const totalBox = document.querySelector('.overview-stat-box[data-type="total"] .stat-number');
            const activeBox = document.querySelector('.overview-stat-box[data-type="active"] .stat-number');
            const inactiveBox = document.querySelector('.overview-stat-box[data-type="inactive"] .stat-number');

            if (totalBox) {
                totalBox.textContent = total;
                console.log(`âœ… ì´ ë©¤ë²„ ìˆ˜ ì—…ë°ì´íŠ¸: ${total}ëª…`);
            }
            if (activeBox) {
                activeBox.textContent = active;
                console.log(`âœ… í™œì„± ë©¤ë²„ ìˆ˜ ì—…ë°ì´íŠ¸: ${active}ëª…`);
            }
            if (inactiveBox) {
                inactiveBox.textContent = inactive;
                console.log(`âœ… ë¹„í™œì„± ë©¤ë²„ ìˆ˜ ì—…ë°ì´íŠ¸: ${inactive}ëª…`);
            }

            // ë©¤ë²„ ìˆ˜ ì¹´ìš´í„° ì—…ë°ì´íŠ¸
            const memberCount = document.getElementById('member-count');
            if (memberCount) {
                memberCount.textContent = `(${total}ëª…)`;
            }
        }

        // ì°¨íŠ¸ ë°ì´í„° ìƒì„± (ì¼ë³„ ì§‘ê³„)
        function createChartData(usageData) {
            const dailyTotals = {};
           
            // ì¼ë³„ë¡œ ëª¨ë“  ì‚¬ìš©ìì˜ í™œë™ ì§‘ê³„
            usageData.forEach(dayData => {
                const dateKey = new Date(dayData.date).toDateString();
               
                if (!dailyTotals[dateKey]) {
                    dailyTotals[dateKey] = {
                        date: dayData.date,
                        totalApplies: 0,
                        totalAccepts: 0,
                        chatRequests: 0,
                        agentRequests: 0
                    };
                }
               
                dailyTotals[dateKey].totalApplies += (dayData.totalApplies || 0);
                dailyTotals[dateKey].totalAccepts += (dayData.totalAccepts || 0);
                dailyTotals[dateKey].chatRequests += (dayData.chatRequests || 0);
                dailyTotals[dateKey].agentRequests += (dayData.agentRequests || 0);
            });
           
            // ì°¨íŠ¸ ë°ì´í„° ìƒì„±
            const chartData = Object.values(dailyTotals)
                .sort((a, b) => a.date - b.date)
                .map(dayTotal => {
                    const date = new Date(dayTotal.date);
                    const activityScore = dayTotal.totalApplies + dayTotal.totalAccepts +
                                        dayTotal.chatRequests + dayTotal.agentRequests;
                   
                    // í•œêµ­ ì‹œê°„ ê¸°ì¤€ìœ¼ë¡œ ë‚ ì§œ í‘œì‹œ
                    const koreaDate = new Date(date.getTime() + (9 * 60 * 60 * 1000));
                    const formatDate = koreaDate.toLocaleDateString('ko-KR', { 
                        month: 'numeric', 
                        day: 'numeric' 
                    }).replace(/\.$/, ''); // ëì˜ ì  ì œê±°
                    
                    return {
                        date: formatDate,
                        activity: activityScore,
                        applies: dayTotal.totalApplies,
                        accepts: dayTotal.totalAccepts,
                        chats: dayTotal.chatRequests,
                        agents: dayTotal.agentRequests
                    };
                });

            console.log('ì°¨íŠ¸ ë°ì´í„° ìƒì„±:', chartData);
            return chartData;
        }

        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateChart(chartData) {
            const canvas = document.getElementById('overviewChart');
            if (!canvas || !chartData.length) return;

            // ìº”ë²„ìŠ¤ í¬ê¸°ê°€ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš° ë‹¤ì‹œ ì„¤ì •
            if (canvas.width === 0 || canvas.height === 0) {
                const rect = canvas.getBoundingClientRect();
                canvas.width = rect.width;
                canvas.height = 300;
            }

            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            // ê¸°ì¡´ ì°¨íŠ¸ ì§€ìš°ê¸°
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);

            // ê·¸ë¦¬ë“œ ê·¸ë¦¬ê¸°
            ctx.strokeStyle = '#3a3a3a';
            ctx.lineWidth = 1;
           
            // ì„¸ë¡œ ê·¸ë¦¬ë“œ
            for (let i = 0; i <= chartData.length; i++) {
                const x = (width / chartData.length) * i;
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
            }

            // ê°€ë¡œ ê·¸ë¦¬ë“œ
            for (let i = 0; i <= 5; i++) {
                const y = (height / 5) * i;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }

            // ë°ì´í„° í¬ì¸íŠ¸ ê³„ì‚°
            const maxActivity = Math.max(...chartData.map(d => d.activity));
            const dataPoints = chartData.map((data, index) => ({
                x: (width / (chartData.length - 1)) * index,
                y: height - (height * (data.activity / maxActivity))
            }));

            // ì„  ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
            if (dataPoints.length > 1) {
                ctx.strokeStyle = '#4a9eff';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(dataPoints[0].x, dataPoints[0].y);
               
                for (let i = 1; i < dataPoints.length; i++) {
                    ctx.lineTo(dataPoints[i].x, dataPoints[i].y);
                }
                ctx.stroke();
            }

            // ë°ì´í„° í¬ì¸íŠ¸ ì› ê·¸ë¦¬ê¸°
            dataPoints.forEach(point => {
                ctx.fillStyle = '#4a9eff';
                ctx.beginPath();
                ctx.arc(point.x, point.y, 4, 0, Math.PI * 2);
                ctx.fill();
            });

            // ë‚ ì§œ ë ˆì´ë¸”
            ctx.fillStyle = '#7a7a7a';
            ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'center';
           
            chartData.forEach((data, index) => {
                const x = (width / (chartData.length - 1)) * index;
                ctx.fillText(data.date, x, height - 10);
            });
        }

        // í™œë™ ë¦¬ìŠ¤íŠ¸ ìƒì„± (ì‹¤ì œ í™œë™ì´ ìˆëŠ” ë©¤ë²„ë§Œ, ì •í™•í•œ í†µê³„ ë°˜ì˜)
        function createActivityListWithLastActivity(events, members, memberSpendMap = {}) {
            console.log('=== í™œë™ ë¦¬ìŠ¤íŠ¸ ìƒì„± ì‹œì‘ ===');
            console.log(`ì „ì²´ ì´ë²¤íŠ¸ ìˆ˜: ${events.length}ê°œ`);
            console.log(`ì „ì²´ ë©¤ë²„ ìˆ˜: ${members.length}ëª…`);
            console.log('ì§€ì¶œ ë°ì´í„° ë§µ:', memberSpendMap);
           
            // ì‚¬ìš©ìë³„ ë§ˆì§€ë§‰ í™œë™ ë‚ ì§œ ë° í†µê³„ ê³„ì‚°
            const userActivity = {};
           
            events.forEach(event => {
                const userEmail = event.userEmail;
                const timestamp = parseInt(event.timestamp);
                const requestCost = event.requestsCosts || 0;
               
                if (!userActivity[userEmail]) {
                    userActivity[userEmail] = {
                        lastTimestamp: timestamp,
                        totalRequests: 0,
                        events: []
                    };
                }
               
                // ë§ˆì§€ë§‰ í™œë™ ì‹œê°„ ì—…ë°ì´íŠ¸
                if (timestamp > userActivity[userEmail].lastTimestamp) {
                    userActivity[userEmail].lastTimestamp = timestamp;
                }
               
                // ìš”ì²­ ìˆ˜ë§Œ ëˆ„ì  (ì‹¤ì œ ì§€ì¶œì€ /teams/spend APIì—ì„œ ê°€ì ¸ì˜´)
                userActivity[userEmail].totalRequests += requestCost;
                userActivity[userEmail].events.push(event);
            });
           
            console.log('ì‚¬ìš©ìë³„ í™œë™ í†µê³„:', userActivity);
           
            // ëª¨ë“  ë©¤ë²„ë¥¼ í¬í•¨í•˜ì—¬ í™œë™ ì •ë³´ ìƒì„± (í™œì„± + ë¹„í™œì„±)
            const activities = [];
            let activeCount = 0;
            let inactiveCount = 0;
           
            members.forEach(member => {
                const userStats = userActivity[member.email];
                const spendData = memberSpendMap[member.email] || {};
                
                // ì‹¤ì œ ì§€ì¶œ ë°ì´í„° ì‚¬ìš© (/teams/spend APIì—ì„œ)
                const actualSpend = spendData.spend || 0;
                const premiumRequests = spendData.premiumRequests || 0;
                const hardLimit = spendData.hardLimitOverride || 0;
                const limitDisplay = hardLimit > 0 ? `$${hardLimit}` : '$0';
               
                if (userStats && userStats.totalRequests > 0) {
                    // í™œë™ì´ ìˆëŠ” ë©¤ë²„
                    const lastActivityDate = new Date(userStats.lastTimestamp);
                   
                    // ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ì •í™•í•œ ì¼ìˆ˜ ì°¨ì´ ê³„ì‚°
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                   
                    const activityDate = new Date(userStats.lastTimestamp);
                    activityDate.setHours(0, 0, 0, 0);
                   
                    const daysDiff = Math.floor((today - activityDate) / (1000 * 60 * 60 * 24));
                   
                    activeCount++;
                   
                    activities.push({
                        date: lastActivityDate.toLocaleDateString('ko-KR', {
                            month: '2-digit',
                            day: '2-digit'
                        }) + ` (${daysDiff === 0 ? 'ì˜¤ëŠ˜' : daysDiff + 'ì¼ ì „'})`,
                        timestamp: userStats.lastTimestamp,
                        email: member.email,
                        name: member.name || 'Unnamed',
                        type: 'active',
                        kind: userStats.events.length > 0 ? userStats.events[0].kindLabel || 'Unknown' : 'Unknown',
                        request: premiumRequests, // Premium Requests ì‚¬ìš©
                        spend: `$${actualSpend.toFixed(2)}`, // ì‹¤ì œ ì§€ì¶œ ë°ì´í„° ì‚¬ìš©
                        limit: limitDisplay
                    });
                } else {
                    // í™œë™ì´ ì—†ëŠ” ë©¤ë²„ (ë¹„í™œì„±)
                    inactiveCount++;
                   
                    activities.push({
                        date: 'No Activity',
                        timestamp: 0,
                        email: member.email,
                        name: member.name || 'Unnamed',
                        type: 'inactive',
                        kind: 'No Activity',
                        request: 0,
                        spend: `$${actualSpend.toFixed(2)}`, // ì‹¤ì œ ì§€ì¶œ ë°ì´í„° ì‚¬ìš©
                        limit: limitDisplay
                    });
                }
            });
           
            console.log(`í™œë™ ë¦¬ìŠ¤íŠ¸ ê²°ê³¼: ì´ ${activities.length}ëª… (í™œì„±: ${activeCount}ëª…, ë¹„í™œì„±: ${inactiveCount}ëª…)`);
           
            // ë§ˆì§€ë§‰ í™œë™ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ (ìµœì‹ ìˆœ - ë‚´ë¦¼ì°¨ìˆœ)
            return activities.sort((a, b) => {
                return b.timestamp - a.timestamp;
            });
        }

        // ê¸°ì¡´ í™œë™ ë¦¬ìŠ¤íŠ¸ ìƒì„± (í˜¸í™˜ì„± ìœ ì§€)
        function createActivityList(events) {
            return events.slice(0, 20).map(event => {
                const timestamp = new Date(parseInt(event.timestamp));
                return {
                    date: timestamp.toLocaleDateString('ko-KR', {
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    }),
                    email: event.userEmail || 'Unknown',
                    type: event.isTokenBasedCall ? 'active' : 'inactive',
                    kind: event.kindLabel || 'Unknown',
                    request: event.requestsCosts || 0,
                    spend: event.isTokenBasedCall ?
                        `$${(event.tokenUsage?.totalCents || 0) / 100}` :
                        '$0.00'
                };
            });
        }



        // ì´ë©”ì¼ í´ë¦­ ì‹œ Usage ì„¹ì…˜ìœ¼ë¡œ ì´ë™ ë° ê²€ìƒ‰
        function navigateToUsageWithEmail(email) {
            console.log(`ì´ë©”ì¼ í´ë¦­: ${email} - Usage ì„¹ì…˜ìœ¼ë¡œ ì´ë™ ì‹œì‘`);
            
            // ê²€ìƒ‰ ì˜ˆì • í”Œë˜ê·¸ ì„¤ì • (ìë™ ìƒˆë¡œê³ ì¹¨ ë°©ì§€ìš©)
            window.pendingEmailSearch = email;
            
            // ìˆ˜ë™ìœ¼ë¡œ ì„¹ì…˜ ì „í™˜ (ìë™ ë°ì´í„° ë¡œë“œ ë°©ì§€)
            const usageMenuItem = document.querySelector('.menu-item[data-section="usage"]');
            const allMenuItems = document.querySelectorAll('.menu-item');
            const allSections = document.querySelectorAll('.content-section');
            
            // ë©”ë‰´ ìƒíƒœ ì—…ë°ì´íŠ¸
            allMenuItems.forEach(menu => menu.classList.remove('active'));
            if (usageMenuItem) {
                usageMenuItem.classList.add('active');
            }
            
            // ì„¹ì…˜ ì „í™˜
            allSections.forEach(section => section.classList.remove('active'));
            const usageSection = document.getElementById('usage');
            if (usageSection) {
                usageSection.classList.add('active');
            }
            
            // í˜ì´ì§€ ì œëª© ì—…ë°ì´íŠ¸
            const pageTitle = document.getElementById('page-title');
            if (pageTitle) {
                pageTitle.textContent = 'Usage Analytics';
            }
            
            // Usage ë°ì´í„°ê°€ ì´ë¯¸ ë¡œë“œë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
            const hasData = currentRawEventsData && currentRawEventsData.length > 0;
            
            if (hasData) {
                // ë°ì´í„°ê°€ ì´ë¯¸ ìˆìœ¼ë©´ ì¦‰ì‹œ ê²€ìƒ‰ ì‹¤í–‰
                executeEmailSearch(email);
            } else {
                // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë¨¼ì € ë¡œë“œí•œ í›„ ê²€ìƒ‰
                console.log('Usage ë°ì´í„°ë¥¼ ë¨¼ì € ë¡œë“œí•©ë‹ˆë‹¤...');
                updateUsageWithCurrentFilter(30).then(() => {
                    // ë°ì´í„° ë¡œë“œ ì™„ë£Œ í›„ ê²€ìƒ‰ ì‹¤í–‰
                    setTimeout(() => {
                        executeEmailSearch(email);
                    }, 500);
                }).catch(error => {
                    console.error('Usage ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                    // ë¡œë“œ ì‹¤íŒ¨í•´ë„ ê²€ìƒ‰ì€ ì‹œë„
                    executeEmailSearch(email);
                });
            }
            
            console.log(`ğŸ“§ ì´ë©”ì¼ í´ë¦­ ì²˜ë¦¬ ì™„ë£Œ: ${email}`);
        }
        
        // ì´ë©”ì¼ ê²€ìƒ‰ ì‹¤í–‰ í•¨ìˆ˜
        function executeEmailSearch(email) {
            const searchBox = document.querySelector('#usage .search-box');
            if (searchBox) {
                searchBox.value = email;
                // X ë²„íŠ¼ í‘œì‹œ
                toggleSearchClearBtn('usage-search');
                filterUsageMembers(email);
                console.log(`âœ… ì´ë©”ì¼ ê²€ìƒ‰ ì™„ë£Œ: ${email}`);
                
                // ê²€ìƒ‰ ì™„ë£Œ í›„ í”Œë˜ê·¸ ì œê±°
                delete window.pendingEmailSearch;
            } else {
                console.error('âŒ Usage ì„¹ì…˜ì˜ ê²€ìƒ‰ì°½ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        // í™œë™ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ (Members ìŠ¤íƒ€ì¼ í˜ì´ì§€ë„¤ì´ì…˜)
        function updateActivityList(activities) {
            currentActivityData = activities; // ë°ì´í„° ì €ì¥
            renderOverviewActivityTableWithPagination(activities);
        }

        // Overview í™œë™ë¦¬ìŠ¤íŠ¸ í…Œì´ë¸” ë Œë”ë§ (Members ìŠ¤íƒ€ì¼)
        function renderOverviewActivityTableWithPagination(activities) {
            // í—¤ë” ì—…ë°ì´íŠ¸
            const headerElement = document.querySelector('.overview-activity-header');
            if (headerElement) {
                if (!activities || activities.length === 0) {
                    headerElement.innerHTML = 'ğŸ“‹ í™œë™ ë¦¬ìŠ¤íŠ¸';
                } else {
                    const totalActivities = activities.length;
                    const totalPages = Math.ceil(totalActivities / currentActivityPageSize);
                    const startIndex = (currentActivityPage - 1) * currentActivityPageSize;
                    const endIndex = Math.min(startIndex + currentActivityPageSize, totalActivities);
                    
                    // í˜„ì¬ í•„í„° íƒ€ì…ì— ë”°ë¥¸ ì œëª© ê²°ì •
                    const titleInfo = updateOverviewActivityTitle(currentFilterType, totalActivities, totalActivities);
                    const periodText = getCurrentOverviewPeriodText();
                    
                    headerElement.innerHTML = `
                        <span>${titleInfo.emoji} ${titleInfo.title} (${periodText})(${startIndex + 1}-${endIndex} of ${totalActivities})</span>
                        <select id="overviewActivityPageSize" onchange="changeOverviewActivityPageSize(this.value)" style="background: #3a3a3a; color: #fff; border: 1px solid #4a4a4a; padding: 5px 10px; border-radius: 4px; font-size: 12px;">
                            <option value="10" ${currentActivityPageSize === 10 ? 'selected' : ''}>10ê°œ ë³´ê¸°</option>
                            <option value="20" ${currentActivityPageSize === 20 ? 'selected' : ''}>20ê°œ ë³´ê¸°</option>
                            <option value="30" ${currentActivityPageSize === 30 ? 'selected' : ''}>30ê°œ ë³´ê¸°</option>
                            <option value="50" ${currentActivityPageSize === 50 ? 'selected' : ''}>50ê°œ ë³´ê¸°</option>
                            <option value="100" ${currentActivityPageSize === 100 ? 'selected' : ''}>100ê°œ ë³´ê¸°</option>
                        </select>
                    `;
                }
            }
            
            if (!activities || activities.length === 0) {
                const container = document.getElementById('overview-activity-container');
                if (container) {
                    container.innerHTML = `
                        <div style="padding: 20px; text-align: center; color: #7a7a7a; background-color: #1a1a1a;">
                            í™œë™ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
                        </div>
                    `;
                }
                // í˜ì´ì§€ë„¤ì´ì…˜ ìˆ¨ê¸°ê¸°
                const pagination = document.getElementById('overview-activity-pagination');
                if (pagination) pagination.style.display = 'none';
                return;
            }

            // í˜ì´ì§€ë„¤ì´ì…˜ ê³„ì‚°
            const totalActivities = activities.length;
            const totalPages = Math.ceil(totalActivities / currentActivityPageSize);
            const startIndex = (currentActivityPage - 1) * currentActivityPageSize;
            const endIndex = Math.min(startIndex + currentActivityPageSize, totalActivities);
            const pageActivities = activities.slice(startIndex, endIndex);

            console.log(`ğŸ“„ Overview í™œë™ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ë„¤ì´ì…˜: ${startIndex + 1}-${endIndex} of ${totalActivities} (í˜ì´ì§€ ${currentActivityPage}/${totalPages})`);

            // í…Œì´ë¸” ë‚´ìš©ë§Œ ì—…ë°ì´íŠ¸
            const tableContent = pageActivities.map(activity => `
                <div class="member-item">
                    <div class="member-date">${activity.date}</div>
                    <div class="member-email clickable-email" title="View usage for ${activity.email}" onclick="navigateToUsageWithEmail('${activity.email}')">${activity.email}</div>
                    <div class="member-type ${activity.type}">${activity.type === 'active' ? 'í™œì„±' : 'ë¹„í™œì„±'}</div>
                    <div class="member-kind">${activity.kind}</div>
                    <div class="member-request">${activity.request}</div>
                    <div class="member-spend">${activity.spend}</div>
                    <div class="member-limit">${activity.limit || '$0'}</div>
                </div>
            `).join('');

            // ì»¨í…Œì´ë„ˆì— í…Œì´ë¸” ë‚´ìš©ë§Œ ì‚½ì…
            const container = document.getElementById('overview-activity-container');
            if (container) {
                container.innerHTML = tableContent;
            }

            // í˜ì´ì§€ë„¤ì´ì…˜ ì—…ë°ì´íŠ¸
            const paginationContainer = document.getElementById('overview-activity-pagination');
            if (paginationContainer && totalPages > 1) {
                paginationContainer.innerHTML = generateOverviewActivityPagination(totalPages);
                paginationContainer.style.display = 'block';
            } else if (paginationContainer) {
                paginationContainer.style.display = 'none';
            }
           
            // í†µê³„ ì—…ë°ì´íŠ¸
            const activeCount = activities.filter(a => a.type === 'active').length;
            const totalRequests = activities.reduce((sum, a) => sum + (typeof a.request === 'number' ? a.request : 0), 0);
           
            console.log(`ğŸ“Š Overview í™œë™ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸: ì´ ${activities.length}ëª…, í™œì„± ${activeCount}ëª…, ì´ ìš”ì²­ ${totalRequests}ê±´ (í˜ì´ì§€ ${currentActivityPage}/${totalPages})`);
        }



        // í•„í„° ê¸°ê°„ ì—…ë°ì´íŠ¸
        function updateFilterPeriod(startDate, endDate) {
            const start = new Date(startDate).toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric'
            });
            const end = new Date(endDate).toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric'
            });
           
            const dateFilterBtn = document.querySelector('.date-filter-btn');
            if (dateFilterBtn) {
                dateFilterBtn.textContent = `${start} - ${end}`;
            }
        }



        // ë©¤ë²„ í…Œì´ë¸”ì„ ì‹¤ì œ API ë°ì´í„°ë¡œ ì—…ë°ì´íŠ¸
        async function updateMembersWithRealData() {
            try {
                console.log('=== ì‹¤ì œ Cursor Admin API ë°ì´í„°ë¡œ ë©¤ë²„ í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì‹œì‘ ===');
               
                // 1. ì‹¤ì œ íŒ€ì› ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                console.log('1. íŒ€ì› ì •ë³´ API í˜¸ì¶œ ì¤‘...');
                const membersData = await getTeamMembers();
                console.log('íŒ€ì› ë°ì´í„° ì‘ë‹µ:', membersData);
               
                if (!membersData || !membersData.teamMembers) {
                    throw new Error('íŒ€ì› ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }

                console.log(`âœ… ì´ ${membersData.teamMembers.length}ëª…ì˜ íŒ€ì› ì •ë³´ë¥¼ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.`);

                // 2. ì‹¤ì œ ì§€ì¶œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ì˜¬ë°”ë¥¸ API ì‚¬ìš©)
                console.log('2. íŒ€ ì§€ì¶œ ë°ì´í„° API í˜¸ì¶œ ì¤‘... (/teams/spend)');
                const spendingData = await getTeamSpendingData();
                console.log('ì§€ì¶œ ë°ì´í„° ì‘ë‹µ:', spendingData);
               
                if (!spendingData || !spendingData.teamMemberSpend) {
                    throw new Error('ì§€ì¶œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }

                console.log(`âœ… ${spendingData.teamMemberSpend.length}ëª…ì˜ ì§€ì¶œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.`);
                console.log(`ğŸ“Š API ì‘ë‹µ ì •ë³´: ì´ ë©¤ë²„ ${spendingData.totalMembers || 'ì •ë³´ì—†ìŒ'}ëª…, ì´ í˜ì´ì§€ ${spendingData.totalPages || 'ì •ë³´ì—†ìŒ'}ê°œ`);
                
                // ì‹¤ì œë¡œ ê°€ì ¸ì˜¨ ë©¤ë²„ ìˆ˜ì™€ API ë©¤ë²„ ìˆ˜ ë¹„êµ ë¡œê¹…
                if (membersData.teamMembers.length !== spendingData.teamMemberSpend.length) {
                    console.log(`âš ï¸ ë©¤ë²„ ìˆ˜ ë¶ˆì¼ì¹˜: ë©¤ë²„ API ${membersData.teamMembers.length}ëª… vs ì§€ì¶œ API ${spendingData.teamMemberSpend.length}ëª…`);
                }

                // 3. ì´ë©”ì¼ ê¸°ì¤€ìœ¼ë¡œ ë©¤ë²„ì™€ ì§€ì¶œ ë°ì´í„° ë§¤í•‘
                console.log('3. ë©¤ë²„ì™€ ì§€ì¶œ ë°ì´í„° ë§¤í•‘ ì¤‘...');
                const memberSpendMap = {};
               
                spendingData.teamMemberSpend.forEach(spendInfo => {
                    memberSpendMap[spendInfo.email] = {
                        premiumRequests: spendInfo.fastPremiumRequests || 0,
                        spend: (spendInfo.spendCents || 0) / 100, // centsë¥¼ dollarsë¡œ ë³€í™˜
                        hardLimitOverride: spendInfo.hardLimitOverrideDollars || 0
                    };
                });

                console.log('ì§€ì¶œ ë°ì´í„° ë§¤í•‘ ê²°ê³¼:', memberSpendMap);

                // 4. Fast Requests ë¦¬ì…‹ ë‚ ì§œ í‘œì‹œ
                console.log('4. Fast Requests ë¦¬ì…‹ ë‚ ì§œ í‘œì‹œ ì¤‘...');
                updateFastRequestsResetDate(spendingData.teamMemberSpend);
                
                // 5. ë©¤ë²„ í…Œì´ë¸” ì—…ë°ì´íŠ¸
                console.log('5. ë©¤ë²„ í…Œì´ë¸” UI ì—…ë°ì´íŠ¸ ì¤‘...');
                updateMembersTable(membersData.teamMembers, memberSpendMap);
               
                console.log('=== ì‹¤ì œ API ë°ì´í„°ë¡œ ë©¤ë²„ í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì™„ë£Œ! ===');
               
            } catch (error) {
                console.error('âŒ ì‹¤ì œ API ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                
                // ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
                alert(`ì‹¤ì œ API ë°ì´í„° ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:\n${error.message}\n\ní”„ë¡ì‹œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.`);
            }
        }

        // Fast Requests ë¦¬ì…‹ ë‚ ì§œ í‘œì‹œ
        function updateFastRequestsResetDate(teamMemberSpend) {
            try {
                // Premium Requestsê°€ 0ì¸ ë©¤ë²„ë“¤ì„ ì°¾ì•„ì„œ ë¦¬ì…‹ ë‚ ì§œ ê³„ì‚°
                const zeroRequestMembers = teamMemberSpend.filter(member => 
                    member.fastPremiumRequests === 0
                );
                
                // ì‹¤ì œë¡œëŠ” APIì—ì„œ ì œê³µí•˜ëŠ” ë¦¬ì…‹ ë‚ ì§œ ì •ë³´ê°€ í•„ìš”í•˜ì§€ë§Œ,
                // í˜„ì¬ë¡œì„œëŠ” ê³ ì •ëœ ë‚ ì§œë¥¼ ì‚¬ìš©
                const resetDate = '2025ë…„ 7ì›” 22ì¼';
                
                const resetDateElement = document.getElementById('fast-requests-reset-date');
                if (resetDateElement) {
                    resetDateElement.textContent = resetDate;
                }
                
                // í•œêµ­ ì‹œê°„ ê¸°ì¤€ ì˜¤ëŠ˜ ë‚ ì§œ ì—…ë°ì´íŠ¸
                updateTodayDate();
                
                console.log(`ğŸ“… Fast Requests ë¦¬ì…‹ ë‚ ì§œ: ${resetDate} (Premium Requests 0ì¸ ë©¤ë²„: ${zeroRequestMembers.length}ëª…)`);
            } catch (error) {
                console.error('âŒ Fast Requests ë¦¬ì…‹ ë‚ ì§œ ê³„ì‚° ì˜¤ë¥˜:', error);
                const resetDateElement = document.getElementById('fast-requests-reset-date');
                if (resetDateElement) {
                    resetDateElement.textContent = '2025ë…„ 7ì›” 22ì¼';
                }
                // ì˜¤ë¥˜ ë°œìƒ ì‹œì—ë„ ì˜¤ëŠ˜ ë‚ ì§œëŠ” ì—…ë°ì´íŠ¸
                updateTodayDate();
            }
        }

        // í•œêµ­ ì‹œê°„ ê¸°ì¤€ ì˜¤ëŠ˜ ë‚ ì§œ ì—…ë°ì´íŠ¸
        function updateTodayDate() {
            try {
                // í•œêµ­ ì‹œê°„ ê¸°ì¤€ (UTC+9)
                const now = new Date();
                const koreaTime = new Date(now.getTime() + (9 * 60 * 60 * 1000)); // UTC+9
                const todayDate = koreaTime.toISOString().split('T')[0]; // YYYY-MM-DD í˜•ì‹
                
                const todayDateElement = document.getElementById('today-date');
                if (todayDateElement) {
                    todayDateElement.textContent = todayDate;
                    todayDateElement.style.color = '#ff9800'; // ì˜¤ë Œì§€ìƒ‰
                }
                
                console.log(`ğŸ“… ì˜¤ëŠ˜ ë‚ ì§œ (í•œêµ­ ì‹œê°„): ${todayDate}`);
            } catch (error) {
                console.error('âŒ ì˜¤ëŠ˜ ë‚ ì§œ ê³„ì‚° ì˜¤ë¥˜:', error);
                const todayDateElement = document.getElementById('today-date');
                if (todayDateElement) {
                    todayDateElement.textContent = '2025-08-03';
                    todayDateElement.style.color = '#ff9800'; // ì˜¤ë Œì§€ìƒ‰
                }
            }
        }

        // Export CSV ê¸°ëŠ¥
        function exportMembersToCSV() {
            try {
                if (!currentMembersData || currentMembersData.length === 0) {
                    alert('ë‚´ë³´ë‚¼ ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                // CSV í—¤ë”
                const headers = ['Name', 'Email', 'Role', 'Premium Requests', 'Spend ($)', 'Hard Limit Override ($)'];
                
                // CSV ë°ì´í„° ìƒì„±
                const csvData = currentMembersData.map(member => [
                    member.name || '',
                    member.email || '',
                    member.role || '',
                    member.spendData?.premiumRequests || 0,
                    (member.spendData?.spend || 0).toFixed(2),
                    (member.spendData?.hardLimitOverride || 0).toFixed(2)
                ]);
                
                // CSV ë¬¸ìì—´ ìƒì„±
                const csvContent = [
                    headers.join(','),
                    ...csvData.map(row => row.join(','))
                ].join('\n');
                
                // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `members_export_${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                console.log(`ğŸ“Š CSV ë‚´ë³´ë‚´ê¸° ì™„ë£Œ: ${currentMembersData.length}ëª…ì˜ ë©¤ë²„ ë°ì´í„°`);
            } catch (error) {
                console.error('âŒ CSV ë‚´ë³´ë‚´ê¸° ì˜¤ë¥˜:', error);
                alert('CSV ë‚´ë³´ë‚´ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë©¤ë²„ í…Œì´ë¸” ì—…ë°ì´íŠ¸ (ì‹¤ì œ ì§€ì¶œ ë°ì´í„° ì‚¬ìš©)
        function updateMembersTable(members, memberSpendMap) {
            console.log(`ğŸ”„ ë©¤ë²„ í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì‹œì‘: ${members.length}ëª…ì˜ ë©¤ë²„ ë°ì´í„°`);
            console.log('ğŸ“Š ì§€ì¶œ ë°ì´í„° ë§¤í•‘ ì •ë³´:', Object.keys(memberSpendMap));
           
            // ë©¤ë²„ ì •ë³´ì™€ ì‹¤ì œ ì§€ì¶œ ë°ì´í„° ê²°í•©
            const membersWithSpending = members.map(member => {
                const spendData = memberSpendMap[member.email] || {
                    premiumRequests: 0,
                    spend: 0,
                    hardLimitOverride: 0
                };
               
                return {
                    ...member,
                    spendData: spendData
                };
            });
           
            console.log(`ğŸ“‹ ì²˜ë¦¬ëœ ë©¤ë²„ ë°ì´í„°: ${membersWithSpending.length}ëª…`);
           
            // Premium Requests ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ (ë†’ì€ ìˆœ)
            membersWithSpending.sort((a, b) => b.spendData.premiumRequests - a.spendData.premiumRequests);
           
            // ì „ì—­ ë°ì´í„° ì €ì¥
            currentMembersData = membersWithSpending;
            originalMembersData = [...membersWithSpending]; // ì›ë³¸ ë°ì´í„° ë³´ì¡´
            currentMembersPage = 1; // í˜ì´ì§€ ë¦¬ì…‹
            
            // í˜ì´ì§€ë„¤ì´ì…˜ê³¼ í•¨ê»˜ ë Œë”ë§
            renderMembersTableWithPagination(membersWithSpending);
        }
        
        // Members í…Œì´ë¸” í˜ì´ì§€ë„¤ì´ì…˜ê³¼ í•¨ê»˜ ë Œë”ë§ (All Raw Events ìŠ¤íƒ€ì¼)
        function renderMembersTableWithPagination(membersWithSpending) {
            const tableContainer = document.querySelector('#members-table-container');
            if (!tableContainer) {
                console.error('âŒ ë©¤ë²„ í…Œì´ë¸” ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // í˜ì´ì§€ë„¤ì´ì…˜ ì ìš©
            const totalMembers = membersWithSpending.length;
            const totalPages = Math.ceil(totalMembers / currentMembersPageSize);
            const startIndex = (currentMembersPage - 1) * currentMembersPageSize;
            const endIndex = Math.min(startIndex + currentMembersPageSize, totalMembers);
            const pageMembers = membersWithSpending.slice(startIndex, endIndex);
            
            console.log(`ğŸ“„ í˜ì´ì§€ë„¤ì´ì…˜: ${startIndex + 1}-${endIndex} of ${totalMembers} (í˜ì´ì§€ ${currentMembersPage}/${totalPages})`);
           
            // í…Œì´ë¸” ì œëª© ë™ì  ìƒì„±
            const getTableTitle = () => {
                if (currentFilterType === 'active') {
                    return `ğŸ‘¥ í™œì„± ë©¤ë²„ ë³´ê¸° (${startIndex + 1}-${endIndex} of ${totalMembers})`;
                } else if (currentFilterType === 'inactive') {
                    return `ğŸ‘¥ ë¹„í™œì„± ë©¤ë²„ ë³´ê¸° (${startIndex + 1}-${endIndex} of ${totalMembers})`;
                } else {
                    return `ğŸ‘¥ ì „ì²´ ë©¤ë²„ ë³´ê¸° (${startIndex + 1}-${endIndex} of ${totalMembers})`;
                }
            };

            // í…Œì´ë¸” HTML ìƒì„± (All Raw Events ìŠ¤íƒ€ì¼)
            const tableHtml = `
                <div class="user-cumulative-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <span>${getTableTitle()}</span>
                    <select id="membersPageSize" onchange="changeMembersPageSize(this.value)" style="background: #3a3a3a; color: #fff; border: 1px solid #4a4a4a; padding: 5px 10px; border-radius: 4px; font-size: 12px;">
                        <option value="10" ${currentMembersPageSize === 10 ? 'selected' : ''}>10ê°œ ë³´ê¸°</option>
                        <option value="20" ${currentMembersPageSize === 20 ? 'selected' : ''}>20ê°œ ë³´ê¸°</option>
                        <option value="30" ${currentMembersPageSize === 30 ? 'selected' : ''}>30ê°œ ë³´ê¸°</option>
                        <option value="50" ${currentMembersPageSize === 50 ? 'selected' : ''}>50ê°œ ë³´ê¸°</option>
                        <option value="100" ${currentMembersPageSize === 100 ? 'selected' : ''}>100ê°œ ë³´ê¸°</option>
                    </select>
                </div>
                <div class="table-header">
                    <div onclick="sortMembers('name')" style="cursor: pointer;">NAME â†•</div>
                    <div onclick="sortMembers('email')" style="cursor: pointer;">EMAIL â†•</div>
                    <div onclick="sortMembers('requests')" style="cursor: pointer;">PREMIUM REQUESTS â†•</div>
                    <div onclick="sortMembers('spend')" style="cursor: pointer;">SPEND â†•</div>
                    <div onclick="sortMembers('role')" style="cursor: pointer;">ROLE â†•</div>
                    <div></div>
                </div>
                ${pageMembers.length > 0 ? pageMembers.map(member => {
                const roleBadgeClass = member.role === 'owner' ? 'admin' : '';
                const roleText = member.role === 'owner' ? 'Admin' : 'Member';
                const requestColor = member.spendData.premiumRequests > 100 ? '#4caf50' :
                                   member.spendData.premiumRequests > 20 ? '#ff9800' :
                                   member.spendData.premiumRequests > 0 ? '#2196f3' : '#f44336';
               
                    return `
                        <div class="table-row">
                    <div>${member.name || 'Unnamed'}</div>
                    <div class="clickable-email" title="View usage for ${member.email}" onclick="navigateToUsageWithEmail('${member.email}')">${member.email}</div>
                    <div style="color: ${requestColor}; font-weight: 600;">${member.spendData.premiumRequests}</div>
                    <div>$${member.spendData.spend.toFixed(2)}</div>
                    <div><span class="role-badge ${roleBadgeClass}">${roleText}</span></div>
                    <div>â‹¯</div>
                        </div>
                    `;
                }).join('') : '<div style="padding: 20px; text-align: center; color: #7a7a7a; background-color: #1a1a1a; grid-column: 1 / -1;">ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>'}
            `;
            
            tableContainer.innerHTML = tableHtml;
            
            // í˜ì´ì§€ë„¤ì´ì…˜ í‘œì‹œ/ìˆ¨ê¹€
            const paginationContainer = document.getElementById('members-pagination');
            if (paginationContainer) {
                if (totalMembers > currentMembersPageSize) {
                    paginationContainer.style.display = 'block';
                    paginationContainer.innerHTML = generateMembersPagination(totalPages);
                } else {
                    paginationContainer.style.display = 'none';
                }
            }
            
            console.log(`âœ… Members í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì™„ë£Œ: í˜ì´ì§€ ${currentMembersPage}/${totalPages}, ${pageMembers.length}ê°œ ë©¤ë²„ í‘œì‹œ`);
           
            // í†µê³„ ì •ë³´ í‘œì‹œ
            const totalRequests = membersWithSpending.reduce((sum, member) => sum + member.spendData.premiumRequests, 0);
            const totalSpend = membersWithSpending.reduce((sum, member) => sum + member.spendData.spend, 0);
            const activeMembers = membersWithSpending.filter(member => member.spendData.premiumRequests > 0).length;
           
            console.log(`ğŸ“Š ë©¤ë²„ í†µê³„ (ì‹¤ì œ API ë°ì´í„°):`);
            console.log(`   - ì´ ë©¤ë²„: ${membersWithSpending.length}ëª…`);
            console.log(`   - í™œì„± ë©¤ë²„: ${activeMembers}ëª… (Premium Requests > 0)`);
            console.log(`   - ì´ Premium Requests: ${totalRequests}ê±´`);
            console.log(`   - ì´ ì§€ì¶œ: $${totalSpend.toFixed(2)}`);
        }
        
        // ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ í˜ì´ì§€ë„¤ì´ì…˜ ìƒì„± (All Raw Events ìŠ¤íƒ€ì¼)
        function generateUserCumulativePagination(totalPages) {
            let pagination = '';
            
            // ì´ì „ ë²„íŠ¼
            if (currentUserCumulativePage > 1) {
                pagination += `<button onclick="changeUserCumulativePage(${currentUserCumulativePage - 1})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin: 0 2px;">â€¹</button>`;
            }
            
            // í˜ì´ì§€ ë²ˆí˜¸ë“¤
            let startPage = Math.max(1, currentUserCumulativePage - 2);
            let endPage = Math.min(totalPages, currentUserCumulativePage + 2);
            
            // ì²« í˜ì´ì§€ê°€ ë²”ìœ„ì— ì—†ìœ¼ë©´ ì¶”ê°€
            if (startPage > 1) {
                pagination += `<button onclick="changeUserCumulativePage(1)" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin: 0 2px;">1</button>`;
                if (startPage > 2) {
                    pagination += `<span style="color: #7a7a7a; padding: 0 5px;">...</span>`;
                }
            }
            
            // í˜„ì¬ ë²”ìœ„ì˜ í˜ì´ì§€ë“¤
            for (let i = startPage; i <= endPage; i++) {
                const isActive = i === currentUserCumulativePage;
                pagination += `<button onclick="changeUserCumulativePage(${i})" style="background: ${isActive ? '#4a9eff' : '#3a3a3a'}; border: 1px solid ${isActive ? '#4a9eff' : '#4a4a4a'}; color: ${isActive ? 'white' : '#e1e1e1'}; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: ${isActive ? '600' : 'normal'}; margin: 0 2px;">${i}</button>`;
            }
            
            // ë§ˆì§€ë§‰ í˜ì´ì§€ê°€ ë²”ìœ„ì— ì—†ìœ¼ë©´ ì¶”ê°€
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    pagination += `<span style="color: #7a7a7a; padding: 0 5px;">...</span>`;
                }
                pagination += `<button onclick="changeUserCumulativePage(${totalPages})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin: 0 2px;">${totalPages}</button>`;
            }
            
            // ë‹¤ìŒ ë²„íŠ¼
            if (currentUserCumulativePage < totalPages) {
                pagination += `<button onclick="changeUserCumulativePage(${currentUserCumulativePage + 1})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin: 0 2px;">â€º</button>`;
            }
            
            return pagination;
        }

        // Overview í™œë™ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ë„¤ì´ì…˜ ìƒì„± (Membersì™€ ë™ì¼)
        function generateOverviewActivityPagination(totalPages) {
            let pagination = '';
            
            // ì´ì „ ë²„íŠ¼
            if (currentActivityPage > 1) {
                pagination += `<button onclick="changeOverviewActivityPage(${currentActivityPage - 1})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin: 0 2px;">â€¹</button>`;
            }
            
            // í˜ì´ì§€ ë²ˆí˜¸ë“¤
            let startPage = Math.max(1, currentActivityPage - 2);
            let endPage = Math.min(totalPages, currentActivityPage + 2);
            
            // ì²« í˜ì´ì§€ê°€ ë²”ìœ„ì— ì—†ìœ¼ë©´ ì¶”ê°€
            if (startPage > 1) {
                pagination += `<button onclick="changeOverviewActivityPage(1)" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin: 0 2px;">1</button>`;
                if (startPage > 2) {
                    pagination += `<span style="color: #7a7a7a; padding: 0 5px;">...</span>`;
                }
            }
            
            // í˜„ì¬ ë²”ìœ„ì˜ í˜ì´ì§€ë“¤
            for (let i = startPage; i <= endPage; i++) {
                const isActive = i === currentActivityPage;
                pagination += `<button onclick="changeOverviewActivityPage(${i})" style="background: ${isActive ? '#4a9eff' : '#3a3a3a'}; border: 1px solid ${isActive ? '#4a9eff' : '#4a4a4a'}; color: ${isActive ? 'white' : '#e1e1e1'}; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: ${isActive ? '600' : 'normal'}; margin: 0 2px;">${i}</button>`;
            }
            
            // ë§ˆì§€ë§‰ í˜ì´ì§€ê°€ ë²”ìœ„ì— ì—†ìœ¼ë©´ ì¶”ê°€
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    pagination += `<span style="color: #7a7a7a; padding: 0 5px;">...</span>`;
                }
                pagination += `<button onclick="changeOverviewActivityPage(${totalPages})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin: 0 2px;">${totalPages}</button>`;
            }
            
            // ë‹¤ìŒ ë²„íŠ¼
            if (currentActivityPage < totalPages) {
                pagination += `<button onclick="changeOverviewActivityPage(${currentActivityPage + 1})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin: 0 2px;">â€º</button>`;
            }
            
            return pagination;
        }

        // Overview í™œë™ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ ë³€ê²½
        function changeOverviewActivityPage(page) {
            currentActivityPage = page;
            renderOverviewActivityTableWithPagination(currentActivityData);
        }

        // Overview í™œë™ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ í¬ê¸° ë³€ê²½
        function changeOverviewActivityPageSize(pageSize) {
            currentActivityPageSize = parseInt(pageSize);
            currentActivityPage = 1; // í˜ì´ì§€ í¬ê¸° ë³€ê²½ì‹œ ì²« í˜ì´ì§€ë¡œ ì´ë™
            renderOverviewActivityTableWithPagination(currentActivityData);
        }

        // Members í˜ì´ì§€ë„¤ì´ì…˜ ìƒì„± (All Raw Eventsì™€ ë™ì¼)
        function generateMembersPagination(totalPages) {
            let pagination = '';
            
            // ì´ì „ ë²„íŠ¼
            if (currentMembersPage > 1) {
                pagination += `<button onclick="changeMembersPage(${currentMembersPage - 1})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin: 0 2px;">â€¹</button>`;
            }
            
            // í˜ì´ì§€ ë²ˆí˜¸ë“¤
            let startPage = Math.max(1, currentMembersPage - 2);
            let endPage = Math.min(totalPages, currentMembersPage + 2);
            
            // ì²« í˜ì´ì§€ê°€ ë²”ìœ„ì— ì—†ìœ¼ë©´ ì¶”ê°€
            if (startPage > 1) {
                pagination += `<button onclick="changeMembersPage(1)" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin: 0 2px;">1</button>`;
                if (startPage > 2) {
                    pagination += `<span style="color: #7a7a7a; padding: 0 5px;">...</span>`;
                }
            }
            
            // í˜„ì¬ ë²”ìœ„ì˜ í˜ì´ì§€ë“¤
            for (let i = startPage; i <= endPage; i++) {
                const isActive = i === currentMembersPage;
                pagination += `<button onclick="changeMembersPage(${i})" style="background: ${isActive ? '#4a9eff' : '#3a3a3a'}; border: 1px solid ${isActive ? '#4a9eff' : '#4a4a4a'}; color: ${isActive ? 'white' : '#e1e1e1'}; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: ${isActive ? '600' : 'normal'}; margin: 0 2px;">${i}</button>`;
            }
            
            // ë§ˆì§€ë§‰ í˜ì´ì§€ê°€ ë²”ìœ„ì— ì—†ìœ¼ë©´ ì¶”ê°€
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    pagination += `<span style="color: #7a7a7a; padding: 0 5px;">...</span>`;
                }
                pagination += `<button onclick="changeMembersPage(${totalPages})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin: 0 2px;">${totalPages}</button>`;
            }
            
            // ë‹¤ìŒ ë²„íŠ¼
            if (currentMembersPage < totalPages) {
                pagination += `<button onclick="changeMembersPage(${currentMembersPage + 1})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; margin: 0 2px;">â€º</button>`;
            }
            
            return pagination;
        }

        // Members í˜ì´ì§€ ë³€ê²½
        function changeMembersPage(page) {
            currentMembersPage = page;
            renderMembersTableWithPagination(currentMembersData);
        }

        // Members í˜ì´ì§€ í¬ê¸° ë³€ê²½
        function changeMembersPageSize(pageSize) {
            currentMembersPageSize = parseInt(pageSize);
            currentMembersPage = 1; // í˜ì´ì§€ í¬ê¸° ë³€ê²½ì‹œ ì²« í˜ì´ì§€ë¡œ ì´ë™
            renderMembersTableWithPagination(currentMembersData);
        }

        // ê²€ìƒ‰ì°½ X ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€ í† ê¸€
        function toggleSearchClearBtn(searchId) {
            const searchInput = document.getElementById(searchId);
            const clearBtn = document.getElementById(searchId + '-clear');
            
            if (searchInput && clearBtn) {
                if (searchInput.value.length > 0) {
                    clearBtn.style.display = 'flex';
                } else {
                    clearBtn.style.display = 'none';
                }
            }
        }

        // ê²€ìƒ‰ì°½ ë¹„ìš°ê¸°
        function clearSearch(searchId) {
            const searchInput = document.getElementById(searchId);
            const clearBtn = document.getElementById(searchId + '-clear');
            const autocomplete = document.getElementById(searchId.replace('-search', '-autocomplete'));
            
            if (searchInput) {
                searchInput.value = '';
                clearBtn.style.display = 'none';
                
                // ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ ìˆ¨ê¸°ê¸°
                if (autocomplete) {
                    autocomplete.style.display = 'none';
                }
                
                // ê²€ìƒ‰ í•„í„° ì´ˆê¸°í™”
                if (searchId === 'members-search') {
                    filterMembers('');
                } else if (searchId === 'usage-search') {
                    filterUsageMembers('');
                } else if (searchId === 'user-performance-search') {
                    filterUserPerformance('');
                }
            }
        }

        // ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ ê²€ìƒ‰ì°½ ë¹„ìš°ê¸°
        function clearUserPerformanceSearch(searchId) {
            const searchInput = document.getElementById(searchId);
            const clearBtn = document.getElementById(searchId + '-clear');
            const autocomplete = document.getElementById(searchId.replace('-search', '-autocomplete'));
            
            if (searchInput) {
                searchInput.value = '';
                clearBtn.style.display = 'none';
                
                // ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ ìˆ¨ê¸°ê¸°
                if (autocomplete) {
                    autocomplete.style.display = 'none';
                }
                
                // ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ ì¬ìƒì„± (ì „ì²´ ì‚¬ìš©ì)
                filterUserPerformance('');
            }
        }

        // ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ í‘œì‹œ
        function showAutocomplete(searchId) {
            const searchInput = document.getElementById(searchId);
            const autocomplete = document.getElementById(searchId.replace('-search', '-autocomplete'));
            
            if (!searchInput || !autocomplete) return;
            
            const searchTerm = searchInput.value.toLowerCase().trim();
            
            if (searchTerm.length === 0) {
                autocomplete.style.display = 'none';
                return;
            }
            
            // ì‚¬ìš©ì ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            let users = [];
            if (searchId === 'members-search') {
                users = getMembersUsers();
            } else if (searchId === 'usage-search') {
                users = getUsageUsers();
            }
            
            // ê²€ìƒ‰ì–´ì™€ ë§¤ì¹­ë˜ëŠ” ì‚¬ìš©ì í•„í„°ë§
            const filteredUsers = users.filter(user => 
                user.name.toLowerCase().includes(searchTerm) || 
                user.email.toLowerCase().includes(searchTerm)
            );
            
            if (filteredUsers.length === 0) {
                autocomplete.style.display = 'none';
                return;
            }
            
            // ë“œë¡­ë‹¤ìš´ HTML ìƒì„±
            const dropdownHTML = filteredUsers.map(user => `
                <div class="autocomplete-item" onclick="selectUser('${searchId}', '${user.email}')">
                    <div class="user-name">${user.name}</div>
                    <div class="user-email">${user.email}</div>
                </div>
            `).join('');
            
            autocomplete.innerHTML = dropdownHTML;
            autocomplete.style.display = 'block';
        }

        // ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ í‘œì‹œ
        function showUserPerformanceAutocomplete(searchId) {
            const searchInput = document.getElementById(searchId);
            const autocomplete = document.getElementById(searchId.replace('-search', '-autocomplete'));
            
            if (!searchInput || !autocomplete) return;
            
            const searchTerm = searchInput.value.toLowerCase().trim();
            
            if (searchTerm.length === 0) {
                autocomplete.style.display = 'none';
                return;
            }
            
            // ì‚¬ìš©ìë³„ ì„±ê³¼ ë°ì´í„°ì—ì„œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const users = getUserPerformanceUsers();
            
            // ê²€ìƒ‰ì–´ì™€ ë§¤ì¹­ë˜ëŠ” ì‚¬ìš©ì í•„í„°ë§
            const filteredUsers = users.filter(user => 
                user.name.toLowerCase().includes(searchTerm) || 
                user.email.toLowerCase().includes(searchTerm)
            );
            
            if (filteredUsers.length === 0) {
                autocomplete.style.display = 'none';
                return;
            }
            
            // ë“œë¡­ë‹¤ìš´ HTML ìƒì„±
            const dropdownHTML = filteredUsers.map(user => `
                <div class="autocomplete-item" onclick="selectUserPerformanceUser('${searchId}', '${user.email}')">
                    <div class="user-name">${user.name}</div>
                    <div class="user-email">${user.email}</div>
                </div>
            `).join('');
            
            autocomplete.innerHTML = dropdownHTML;
            autocomplete.style.display = 'block';
        }

        // ì‚¬ìš©ì ì„ íƒ
        function selectUser(searchId, userEmail) {
            const searchInput = document.getElementById(searchId);
            const autocomplete = document.getElementById(searchId.replace('-search', '-autocomplete'));
            
            if (searchInput) {
                searchInput.value = userEmail;
                
                // ê²€ìƒ‰ ì‹¤í–‰
                if (searchId === 'members-search') {
                    filterMembers(userEmail);
                } else if (searchId === 'usage-search') {
                    filterUsageMembers(userEmail);
                }
                
                // X ë²„íŠ¼ í‘œì‹œ
                toggleSearchClearBtn(searchId);
            }
            
            // ë“œë¡­ë‹¤ìš´ ìˆ¨ê¸°ê¸°
            if (autocomplete) {
                autocomplete.style.display = 'none';
            }
        }

        // ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ ì‚¬ìš©ì ì„ íƒ
        function selectUserPerformanceUser(searchId, userEmail) {
            const searchInput = document.getElementById(searchId);
            const autocomplete = document.getElementById(searchId.replace('-search', '-autocomplete'));
            
            if (searchInput) {
                searchInput.value = userEmail;
                
                // ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ í•„í„°ë§
                filterUserPerformance(userEmail);
                
                // X ë²„íŠ¼ í‘œì‹œ
                toggleSearchClearBtn(searchId);
            }
            
            // ë“œë¡­ë‹¤ìš´ ìˆ¨ê¸°ê¸°
            if (autocomplete) {
                autocomplete.style.display = 'none';
            }
        }

        // Members ì„¹ì…˜ ì‚¬ìš©ì ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function getMembersUsers() {
            if (!currentMembersData || currentMembersData.length === 0) {
                return [];
            }
            
            return currentMembersData.map(member => ({
                name: member.name || 'Unnamed',
                email: member.email
            }));
        }

        // Usage ì„¹ì…˜ ì‚¬ìš©ì ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function getUsageUsers() {
            if (!currentUserCumulativeData || currentUserCumulativeData.length === 0) {
                return [];
            }
            
            return currentUserCumulativeData.map(user => ({
                name: user.name || 'Unnamed',
                email: user.email
            }));
        }

        // ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ ì‚¬ìš©ì ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function getUserPerformanceUsers() {
            const members = currentMembersData || [];
            const rawEvents = currentRawEventsData || [];
            
            if (members.length === 0 || rawEvents.length === 0) {
                return [];
            }
            
            // ì‚¬ìš©ìë³„ ì„±ê³¼ ë°ì´í„° ìƒì„±
            const userPerformance = [];
            const userMap = new Map();
            
            // ë©¤ë²„ ì •ë³´ë¡œ ì´ˆê¸°í™”
            members.forEach(member => {
                userMap.set(member.email, {
                    name: member.name || 'Unnamed',
                    email: member.email,
                    requests: 0,
                    costs: 0,
                    activeDays: 0
                });
            });
            
            // ì´ë²¤íŠ¸ ë°ì´í„°ë¡œ ì„±ê³¼ ê³„ì‚°
            rawEvents.forEach(event => {
                const userEmail = event.email;
                const user = userMap.get(userEmail);
                
                if (user) {
                    user.requests += event.requests || 0;
                    user.costs += event.requestsCosts || 0;
                    
                    // í™œë™ ì¼ìˆ˜ ê³„ì‚° (ë‚ ì§œë³„ë¡œ í•œ ë²ˆë§Œ ì¹´ìš´íŠ¸)
                    const eventDate = new Date(parseInt(event.timestamp)).toDateString();
                    if (!user.activeDaysSet) {
                        user.activeDaysSet = new Set();
                    }
                    user.activeDaysSet.add(eventDate);
                }
            });
            
            // Setì„ ê°œìˆ˜ë¡œ ë³€í™˜
            userMap.forEach(user => {
                user.activeDays = user.activeDaysSet ? user.activeDaysSet.size : 0;
                delete user.activeDaysSet;
                userPerformance.push(user);
            });
            
            return userPerformance;
        }

        // ë©¤ë²„ ê²€ìƒ‰ ê¸°ëŠ¥
        function filterMembers(searchTerm) {
            const rows = document.querySelectorAll('#members .table-row');
            const searchLower = searchTerm.toLowerCase();
           
            rows.forEach(row => {
                const name = row.children[0].textContent.toLowerCase();
                const email = row.children[1].textContent.toLowerCase();
               
                if (name.includes(searchLower) || email.includes(searchLower)) {
                    row.style.display = 'grid';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ í•„í„°ë§
        function filterUserPerformance(searchTerm) {
            console.log(`ğŸ” ì‚¬ìš©ìë³„ ì„±ê³¼ ì°¨íŠ¸ í•„í„°ë§: "${searchTerm}"`);
            
            const searchLower = searchTerm.toLowerCase().trim();
            
            // ê²€ìƒ‰ì–´ê°€ ë¹„ì–´ìˆìœ¼ë©´ ì „ì²´ ì‚¬ìš©ì ì„±ê³¼ ì°¨íŠ¸ í‘œì‹œ
            if (searchLower === '') {
                createUserPerformanceChart();
                return;
            }
            
            // íŠ¹ì • ì‚¬ìš©ìì— ëŒ€í•œ ì„±ê³¼ ì°¨íŠ¸ ìƒì„±
            createFilteredUserPerformanceChart(searchLower);
        }

        // ì°¨íŠ¸ ë°ì´í„° í•„í„°ë§ (ì¼ë°˜ì ì¸ ì°¨íŠ¸ ê²€ìƒ‰)
        function filterChartData(searchTerm) {
            console.log(`ğŸ” ì°¨íŠ¸ ë°ì´í„° í•„í„°ë§: "${searchTerm}"`);
            
            const searchLower = searchTerm.toLowerCase().trim();
            const chartSelect = document.getElementById('chartSelect');
            const currentChartType = chartSelect ? chartSelect.value : 'activity-trend';
            
            // ê²€ìƒ‰ì–´ê°€ ë¹„ì–´ìˆìœ¼ë©´ í˜„ì¬ ì°¨íŠ¸ ì¬ìƒì„±
            if (searchLower === '') {
                switchChart(currentChartType).catch(error => {
                    console.error('ì°¨íŠ¸ ì¬ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:', error);
                });
                return;
            }
            
            // ì°¨íŠ¸ íƒ€ì…ì— ë”°ë¼ ì ì ˆí•œ í•„í„°ë§ ì ìš©
            switch (currentChartType) {
                case 'user-performance':
                    filterUserPerformance(searchTerm);
                    break;
                case 'user-heatmap':
                    // ì‚¬ìš©ì í™œë™ íˆíŠ¸ë§µ í•„í„°ë§
                    createFilteredUserHeatmapChart(searchTerm);
                    break;
                case 'model-preference':
                    // ëª¨ë¸ ì„ í˜¸ë„ í•„í„°ë§
                    createFilteredModelPreferenceChart(searchTerm);
                    break;
                default:
                    // ê¸°ë³¸ì ìœ¼ë¡œëŠ” ì°¨íŠ¸ ì¬ìƒì„±
                    switchChart(currentChartType).catch(error => {
                        console.error('ì°¨íŠ¸ ì¬ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:', error);
                    });
                    break;
            }
        }

        // ì°¨íŠ¸ ê²€ìƒ‰ì°½ ë¹„ìš°ê¸°
        function clearChartSearch(searchId) {
            const searchInput = document.getElementById(searchId);
            const clearBtn = document.getElementById(searchId + '-clear');
            
            if (searchInput) {
                searchInput.value = '';
                clearBtn.style.display = 'none';
                
                // í˜„ì¬ ì°¨íŠ¸ íƒ€ì… í™•ì¸
                const chartSelect = document.getElementById('chartSelect');
                const currentChartType = chartSelect ? chartSelect.value : 'activity-trend';
                
                // ê²€ìƒ‰ì°½ì´ ìˆëŠ” ì°¨íŠ¸ë“¤ì˜ ê²½ìš° ì¦‰ì‹œ ê¸°ë³¸ ì°¨íŠ¸ë¡œ ì „í™˜
                if (currentChartType === 'user-heatmap') {
                    console.log('ğŸ”¥ ê²€ìƒ‰ì°½ í´ë¦¬ì–´ - ìƒìœ„ 20ëª… íˆíŠ¸ë§µìœ¼ë¡œ ì „í™˜');
                    createUserHeatmapChart();
                } else if (currentChartType === 'model-preference') {
                    console.log('ğŸ”¥ ê²€ìƒ‰ì°½ í´ë¦¬ì–´ - ìƒìœ„ 20ëª… ëª¨ë¸ ì„ í˜¸ë„ë¡œ ì „í™˜');
                    createModelPreferenceChart();
                } else {
                    // ë‹¤ë¥¸ ì°¨íŠ¸ëŠ” ê¸°ì¡´ ë°©ì‹ìœ¼ë¡œ ì¬ìƒì„±
                    switchChart(currentChartType).catch(error => {
                        console.error('ì°¨íŠ¸ ì¬ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:', error);
                    });
                }
            }
        }

        // ì°¨íŠ¸ ê²€ìƒ‰ ì²˜ë¦¬ (íˆíŠ¸ë§µ ë° ëª¨ë¸ ì„ í˜¸ë„)
        function handleChartSearch(searchTerm) {
            console.log('ğŸ” ì°¨íŠ¸ ê²€ìƒ‰ ì²˜ë¦¬:', searchTerm);
            
            const chartSelect = document.getElementById('chartSelect');
            if (!chartSelect) return;
            
            const selectedChart = chartSelect.value;
            
            // íˆíŠ¸ë§µ ì°¨íŠ¸ ê²€ìƒ‰ ì²˜ë¦¬
            if (selectedChart === 'user-heatmap') {
                if (searchTerm.trim() === '') {
                    // ê²€ìƒ‰ì–´ê°€ ì—†ìœ¼ë©´ ì¦‰ì‹œ ê¸°ë³¸ íˆíŠ¸ë§µ í‘œì‹œ (ìƒìœ„ 20ëª…)
                    createUserHeatmapChart();
                } else {
                    // ê²€ìƒ‰ì–´ë¡œ ì‚¬ìš©ì í•„í„°ë§
                    const filteredUsers = getFilteredUsers(searchTerm);
                    
                    if (filteredUsers.length === 1) {
                        // ì •í™•íˆ 1ëª…ì´ë©´ ìš”ì¼ë³„ ì°¨íŠ¸ í‘œì‹œ
                        createFilteredUserHeatmapChart(filteredUsers[0].email.split('@')[0]);
                    } else if (filteredUsers.length > 1) {
                        // ì—¬ëŸ¬ ëª…ì´ë©´ ìƒìœ„ 20ëª…ê¹Œì§€ ë§‰ëŒ€ ì°¨íŠ¸ í‘œì‹œ
                        createMultiUserHeatmapChart(filteredUsers.slice(0, 20));
                    } else {
                        // ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ
                        showNoSearchResults(searchTerm);
                    }
                }
            }
            // ëª¨ë¸ ì„ í˜¸ë„ ì°¨íŠ¸ ê²€ìƒ‰ ì²˜ë¦¬
            else if (selectedChart === 'model-preference') {
                if (searchTerm.trim() === '') {
                    // ê²€ìƒ‰ì–´ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ëª¨ë¸ ì„ í˜¸ë„ í‘œì‹œ (ìƒìœ„ 20ëª…)
                    createModelPreferenceChart();
                } else {
                    // ê²€ìƒ‰ì–´ë¡œ ì‚¬ìš©ì í•„í„°ë§
                    const filteredUsers = getFilteredUsers(searchTerm);
                    
                    if (filteredUsers.length === 1) {
                        // ì •í™•íˆ 1ëª…ì´ë©´ í•´ë‹¹ ì‚¬ìš©ìì˜ ëª¨ë¸ ì‚¬ìš©ëŸ‰ ì°¨íŠ¸ í‘œì‹œ
                        createFilteredModelPreferenceChart(filteredUsers[0].email.split('@')[0]);
                    } else if (filteredUsers.length > 1) {
                        // ì—¬ëŸ¬ ëª…ì´ë©´ ìƒìœ„ 20ëª…ê¹Œì§€ ëª¨ë¸ ì„ í˜¸ë„ ì°¨íŠ¸ í‘œì‹œ
                        createMultiUserModelPreferenceChart(filteredUsers.slice(0, 20));
                    } else {
                        // ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ
                        showNoSearchResults(searchTerm);
                    }
                }
            }
        }

        // ê²€ìƒ‰ì–´ë¡œ ì‚¬ìš©ì í•„í„°ë§ (ID ê¸°ë°˜)
        function getFilteredUsers(searchTerm) {
            const members = (chartDataStore.members && chartDataStore.members.length > 0) ? 
                chartDataStore.members : (currentMembers || []);
            
            if (!members || members.length === 0) return [];
            
            // IDë¡œë§Œ ê²€ìƒ‰ (ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ê²½ìš°)
            const exactMatch = members.find(member => {
                const emailId = member.email.split('@')[0];
                return emailId.toLowerCase() === searchTerm.toLowerCase();
            });
            
            if (exactMatch) {
                return [exactMatch]; // ì •í™•íˆ 1ëª…ë§Œ ë°˜í™˜
            }
            
            // ë¶€ë¶„ ê²€ìƒ‰ (IDì— í¬í•¨ë˜ëŠ” ê²½ìš°)
            return members.filter(member => {
                const emailId = member.email.split('@')[0];
                return emailId.toLowerCase().includes(searchTerm.toLowerCase());
            });
        }

        // ì—¬ëŸ¬ ì‚¬ìš©ì íˆíŠ¸ë§µ ì°¨íŠ¸ ìƒì„± (ë¶€ë¶„ ê²€ìƒ‰ ê²°ê³¼)
        function createMultiUserHeatmapChart(filteredUsers) {
            console.log('ğŸ”¥ createMultiUserHeatmapChart ì‹œì‘:', filteredUsers.length, 'ëª…');
            const canvas = document.getElementById('userHeatmapChart');
            if (!canvas) return;
            
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            // í•„í„°ëœ ì‚¬ìš©ìë“¤ì˜ í™œë™ ë°ì´í„° ìƒì„±
            const heatmapData = generateFilteredHeatmapBarData(filteredUsers);
            
            if (heatmapData.length === 0) {
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('í™œë™ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', width / 2, height / 2);
                return;
            }
            
            // ë§‰ëŒ€ ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
            drawHeatmapBarChart(ctx, width, height, heatmapData);
        }

        // í•„í„°ëœ ì‚¬ìš©ìë“¤ì˜ íˆíŠ¸ë§µ ë°ì´í„° ìƒì„±
        function generateFilteredHeatmapBarData(filteredUsers) {
            console.log('ğŸ”¥ generateFilteredHeatmapBarData ì‹œì‘:', filteredUsers.length, 'ëª…');
            
            const rawEvents = (chartDataStore.rawEvents && chartDataStore.rawEvents.length > 0) ? 
                chartDataStore.rawEvents : (currentRawEventsData || []);
            
            if (!rawEvents || rawEvents.length === 0) {
                console.log('âš ï¸ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return [];
            }
            
            // ì‚¬ìš©ìë³„ í™œë™ ìˆ˜ ê³„ì‚°
            const userActivityMap = new Map();
            filteredUsers.forEach((member, userIndex) => {
                const userEmail = member.email;
                const userName = member.name;
                const userId = userEmail.split('@')[0];
                
                const userEvents = rawEvents.filter(event => 
                    event.userEmail === userEmail || event.email === userEmail
                );
                
                const totalActivity = userEvents.length;
                
                userActivityMap.set(userIndex, {
                    name: userName,
                    email: userEmail,
                    id: userId,
                    totalActivity: totalActivity
                });
            });
            
            // í™œë™ ìˆ˜ë¡œ ì •ë ¬
            const sortedUsers = Array.from(userActivityMap.entries())
                .sort((a, b) => b[1].totalActivity - a[1].totalActivity);
            
            const data = sortedUsers.map(([userIndex, userData]) => ({
                userId: userData.id,
                userName: userData.name,
                email: userData.email,
                activity: userData.totalActivity
            }));
            
            console.log(`ğŸ”¥ í•„í„°ëœ íˆíŠ¸ë§µ ë°ì´í„° ìƒì„± ì™„ë£Œ: ${data.length}ëª…`);
            return data;
        }

        // ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ í‘œì‹œ
        function showNoSearchResults(searchTerm) {
            const canvas = document.getElementById('userHeatmapChart');
            if (!canvas) return;
            
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            ctx.fillStyle = '#7a7a7a';
            ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(`ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤: "${searchTerm}"`, width / 2, height / 2);
        }

        // íˆíŠ¸ë§µìš© ì»¤ìŠ¤í…€ ë“œë¡­ë‹¤ìš´ ìƒì„±
        function populateHeatmapEmailDropdown() {
            console.log('ğŸ“§ íˆíŠ¸ë§µìš© ì»¤ìŠ¤í…€ ë“œë¡­ë‹¤ìš´ ìƒì„± ì¤‘...');
            
            const searchInput = document.getElementById('chart-search-input');
            if (!searchInput) {
                console.error('âŒ chart-search-input ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ê¸°ì¡´ ì»¤ìŠ¤í…€ ë“œë¡­ë‹¤ìš´ ì œê±°
            const existingDropdown = document.getElementById('custom-heatmap-dropdown');
            if (existingDropdown) {
                existingDropdown.remove();
            }
            
            // ìƒˆ ì»¤ìŠ¤í…€ ë“œë¡­ë‹¤ìš´ ìƒì„±
            const dropdown = document.createElement('div');
            dropdown.id = 'custom-heatmap-dropdown';
            dropdown.style.cssText = `
                position: absolute;
                top: calc(100% + 4px);
                left: 0;
                right: 0;
                background-color: #2a2a2a;
                border: 1px solid #3a3a3a;
                border-radius: 8px;
                max-height: 200px;
                overflow-y: auto;
                z-index: 1000;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                display: none;
            `;
            
            // ë©¤ë²„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const members = (chartDataStore.members && chartDataStore.members.length > 0) ? 
                chartDataStore.members : (currentMembers || []);
            
            if (!members || members.length === 0) {
                console.log('âš ï¸ ì‚¬ìš© ê°€ëŠ¥í•œ ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ì „ì²´ ë©¤ë²„ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•˜ëŠ” ë“œë¡­ë‹¤ìš´ ëª©ë¡ ìƒì„±
            const allMembers = [];
            members.forEach(member => {
                const emailId = member.email.split('@')[0];
                allMembers.push({
                    id: emailId,
                    name: member.name,
                    email: member.email
                });
            });
            
            console.log(`ğŸ“‹ ì „ì²´ ë©¤ë²„ ëª©ë¡ ìƒì„±: ${allMembers.length}ëª…`);
            
            // ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ì‹¤ì‹œê°„ í•„í„°ë§)
            function updateDropdownOptions(searchTerm = '') {
                dropdown.innerHTML = '';
                
                // ê²€ìƒ‰ì–´ê°€ ì—†ìœ¼ë©´ ì „ì²´ ë©¤ë²„ í‘œì‹œ (ìµœëŒ€ 50ê°œ)
                if (searchTerm.trim() === '') {
                    const displayMembers = allMembers.slice(0, 50);
                    displayMembers.forEach(member => {
                        const option = createDropdownOption(member, '');
                        dropdown.appendChild(option);
                    });
                    return;
                }
                
                // ê²€ìƒ‰ì–´ê°€ ìˆìœ¼ë©´ í•„í„°ë§ëœ ë©¤ë²„ë§Œ í‘œì‹œ
                const filteredMembers = allMembers.filter(member => 
                    member.id.toLowerCase().includes(searchTerm.toLowerCase())
                );
                
                if (filteredMembers.length === 0) {
                    const noResult = document.createElement('div');
                    noResult.style.cssText = `
                        padding: 12px;
                        color: #7a7a7a;
                        text-align: center;
                        font-size: 14px;
                    `;
                    noResult.textContent = 'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤';
                    dropdown.appendChild(noResult);
                    return;
                }
                
                // í•„í„°ë§ëœ ê²°ê³¼ëŠ” ìµœëŒ€ 30ê°œê¹Œì§€ í‘œì‹œ
                const displayMembers = filteredMembers.slice(0, 30);
                
                displayMembers.forEach(member => {
                    const option = createDropdownOption(member, searchTerm);
                    dropdown.appendChild(option);
                });
            }
            
            // ë“œë¡­ë‹¤ìš´ ì˜µì…˜ ìƒì„± í•¨ìˆ˜
            function createDropdownOption(member, searchTerm) {
                const option = document.createElement('div');
                option.style.cssText = `
                    padding: 8px 12px;
                    cursor: pointer;
                    color: #e1e1e1;
                    border-bottom: 1px solid #3a3a3a;
                    transition: background-color 0.2s ease;
                `;
                
                // ê²€ìƒ‰ì–´ê°€ ìˆìœ¼ë©´ í•˜ì´ë¼ì´íŠ¸, ì—†ìœ¼ë©´ ì¼ë°˜ í‘œì‹œ
                let displayId = member.id;
                if (searchTerm && searchTerm.trim() !== '') {
                    displayId = member.id.replace(
                        new RegExp(searchTerm, 'gi'),
                        match => `<span style="background-color: #4a9eff; color: white; padding: 1px 2px; border-radius: 2px;">${match}</span>`
                    );
                }
                
                option.innerHTML = `
                    <div style="font-weight: 500; font-size: 14px;">${displayId}</div>
                    <div style="font-size: 12px; color: #7a7a7a;">${member.name} â€¢ ${member.email}</div>
                `;
                
                // í˜¸ë²„ íš¨ê³¼
                option.addEventListener('mouseenter', () => {
                    option.style.backgroundColor = '#3a3a3a';
                });
                option.addEventListener('mouseleave', () => {
                    option.style.backgroundColor = 'transparent';
                });
                
                // í´ë¦­ ì´ë²¤íŠ¸
                option.addEventListener('click', () => {
                    searchInput.value = member.id;
                    dropdown.style.display = 'none';
                    handleChartSearch(member.id);
                });
                
                return option;
            }
            
            // ê²€ìƒ‰ ì…ë ¥ ì»¨í…Œì´ë„ˆì— ë“œë¡­ë‹¤ìš´ ì¶”ê°€
            const inputContainer = searchInput.parentElement;
            inputContainer.style.position = 'relative';
            inputContainer.appendChild(dropdown);
            
            // ì…ë ¥ ì´ë²¤íŠ¸ë¡œ ì‹¤ì‹œê°„ í•„í„°ë§
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value;
                if (dropdown.style.display !== 'none') {
                    updateDropdownOptions(searchTerm);
                }
            });
            
            // í¬ì»¤ìŠ¤ ì´ë²¤íŠ¸ë¡œ ë“œë¡­ë‹¤ìš´ í‘œì‹œ
            searchInput.addEventListener('focus', () => {
                updateDropdownOptions(searchInput.value);
                dropdown.style.display = 'block';
            });
            
            // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ì²˜ë¦¬
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    dropdown.style.display = 'none';
                }
            });
            
            // ë¸”ëŸ¬ ì´ë²¤íŠ¸ë¡œ ë“œë¡­ë‹¤ìš´ ìˆ¨ê¹€
            searchInput.addEventListener('blur', (e) => {
                setTimeout(() => {
                    if (!dropdown.contains(document.activeElement)) {
                        dropdown.style.display = 'none';
                    }
                }, 200);
            });
            
            console.log(`âœ… ì „ì²´ ë©¤ë²„ ëŒ€ìƒ ì‹¤ì‹œê°„ í•„í„°ë§ ë“œë¡­ë‹¤ìš´ ìƒì„± ì™„ë£Œ: ${allMembers.length}ëª…ì˜ ì‚¬ìš©ì`);
        }

        // ëª¨ë¸ ì„ í˜¸ë„ìš© ì»¤ìŠ¤í…€ ë“œë¡­ë‹¤ìš´ ìƒì„±
        function populateModelPreferenceDropdown() {
            console.log('ğŸ“§ ëª¨ë¸ ì„ í˜¸ë„ìš© ì»¤ìŠ¤í…€ ë“œë¡­ë‹¤ìš´ ìƒì„± ì¤‘...');
            
            const searchInput = document.getElementById('chart-search-input');
            if (!searchInput) {
                console.error('âŒ chart-search-input ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ê¸°ì¡´ ì»¤ìŠ¤í…€ ë“œë¡­ë‹¤ìš´ ì œê±°
            const existingDropdown = document.getElementById('custom-model-preference-dropdown');
            if (existingDropdown) {
                existingDropdown.remove();
            }
            
            // ìƒˆ ì»¤ìŠ¤í…€ ë“œë¡­ë‹¤ìš´ ìƒì„±
            const dropdown = document.createElement('div');
            dropdown.id = 'custom-model-preference-dropdown';
            dropdown.style.cssText = `
                position: absolute;
                top: calc(100% + 4px);
                left: 0;
                right: 0;
                background-color: #2a2a2a;
                border: 1px solid #3a3a3a;
                border-radius: 8px;
                max-height: 200px;
                overflow-y: auto;
                z-index: 1000;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                display: none;
            `;
            
            // ë©¤ë²„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const members = (chartDataStore.members && chartDataStore.members.length > 0) ? 
                chartDataStore.members : (currentMembers || []);
            
            if (!members || members.length === 0) {
                console.log('âš ï¸ ì‚¬ìš© ê°€ëŠ¥í•œ ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ì „ì²´ ë©¤ë²„ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•˜ëŠ” ë“œë¡­ë‹¤ìš´ ëª©ë¡ ìƒì„±
            const allMembers = [];
            members.forEach(member => {
                const emailId = member.email.split('@')[0];
                allMembers.push({
                    id: emailId,
                    name: member.name,
                    email: member.email
                });
            });
            
            console.log(`ğŸ“‹ ì „ì²´ ë©¤ë²„ ëª©ë¡ ìƒì„±: ${allMembers.length}ëª…`);
            
            // ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ì‹¤ì‹œê°„ í•„í„°ë§)
            function updateDropdownOptions(searchTerm = '') {
                dropdown.innerHTML = '';
                
                // ê²€ìƒ‰ì–´ê°€ ì—†ìœ¼ë©´ ì „ì²´ ë©¤ë²„ í‘œì‹œ (ìµœëŒ€ 50ê°œ)
                if (searchTerm.trim() === '') {
                    const displayMembers = allMembers.slice(0, 50);
                    displayMembers.forEach(member => {
                        const option = createModelPreferenceDropdownOption(member, '');
                        dropdown.appendChild(option);
                    });
                    return;
                }
                
                // ê²€ìƒ‰ì–´ê°€ ìˆìœ¼ë©´ í•„í„°ë§ëœ ë©¤ë²„ë§Œ í‘œì‹œ
                const filteredMembers = allMembers.filter(member => 
                    member.id.toLowerCase().includes(searchTerm.toLowerCase())
                );
                
                if (filteredMembers.length === 0) {
                    const noResult = document.createElement('div');
                    noResult.style.cssText = `
                        padding: 12px;
                        color: #7a7a7a;
                        text-align: center;
                        font-size: 14px;
                    `;
                    noResult.textContent = 'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤';
                    dropdown.appendChild(noResult);
                    return;
                }
                
                // í•„í„°ë§ëœ ê²°ê³¼ëŠ” ìµœëŒ€ 30ê°œê¹Œì§€ í‘œì‹œ
                const displayMembers = filteredMembers.slice(0, 30);
                
                displayMembers.forEach(member => {
                    const option = createModelPreferenceDropdownOption(member, searchTerm);
                    dropdown.appendChild(option);
                });
            }
            
            // ë“œë¡­ë‹¤ìš´ ì˜µì…˜ ìƒì„± í•¨ìˆ˜
            function createModelPreferenceDropdownOption(member, searchTerm) {
                const option = document.createElement('div');
                option.style.cssText = `
                    padding: 8px 12px;
                    cursor: pointer;
                    color: #e1e1e1;
                    border-bottom: 1px solid #3a3a3a;
                    transition: background-color 0.2s ease;
                `;
                
                // ê²€ìƒ‰ì–´ê°€ ìˆìœ¼ë©´ í•˜ì´ë¼ì´íŠ¸, ì—†ìœ¼ë©´ ì¼ë°˜ í‘œì‹œ
                let displayId = member.id;
                if (searchTerm && searchTerm.trim() !== '') {
                    displayId = member.id.replace(
                        new RegExp(searchTerm, 'gi'),
                        match => `<span style="background-color: #4a9eff; color: white; padding: 1px 2px; border-radius: 2px;">${match}</span>`
                    );
                }
                
                option.innerHTML = `
                    <div style="font-weight: 500; font-size: 14px;">${displayId}</div>
                    <div style="font-size: 12px; color: #7a7a7a;">${member.name} â€¢ ${member.email}</div>
                `;
                
                // í˜¸ë²„ íš¨ê³¼
                option.addEventListener('mouseenter', () => {
                    option.style.backgroundColor = '#3a3a3a';
                });
                option.addEventListener('mouseleave', () => {
                    option.style.backgroundColor = 'transparent';
                });
                
                // í´ë¦­ ì´ë²¤íŠ¸
                option.addEventListener('click', () => {
                    searchInput.value = member.id;
                    dropdown.style.display = 'none';
                    handleChartSearch(member.id);
                });
                
                return option;
            }
            
            // ê²€ìƒ‰ ì…ë ¥ ì»¨í…Œì´ë„ˆì— ë“œë¡­ë‹¤ìš´ ì¶”ê°€
            const inputContainer = searchInput.parentElement;
            inputContainer.style.position = 'relative';
            inputContainer.appendChild(dropdown);
            
            // ì…ë ¥ ì´ë²¤íŠ¸ë¡œ ì‹¤ì‹œê°„ í•„í„°ë§
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value;
                if (dropdown.style.display !== 'none') {
                    updateDropdownOptions(searchTerm);
                }
            });
            
            // í¬ì»¤ìŠ¤ ì´ë²¤íŠ¸ë¡œ ë“œë¡­ë‹¤ìš´ í‘œì‹œ
            searchInput.addEventListener('focus', () => {
                updateDropdownOptions(searchInput.value);
                dropdown.style.display = 'block';
            });
            
            // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ì²˜ë¦¬
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    dropdown.style.display = 'none';
                }
            });
            
            // ë¸”ëŸ¬ ì´ë²¤íŠ¸ë¡œ ë“œë¡­ë‹¤ìš´ ìˆ¨ê¹€
            searchInput.addEventListener('blur', (e) => {
                setTimeout(() => {
                    if (!dropdown.contains(document.activeElement)) {
                        dropdown.style.display = 'none';
                    }
                }, 200);
            });
            
            console.log(`âœ… ëª¨ë¸ ì„ í˜¸ë„ìš© ì‹¤ì‹œê°„ í•„í„°ë§ ë“œë¡­ë‹¤ìš´ ìƒì„± ì™„ë£Œ: ${allMembers.length}ëª…ì˜ ì‚¬ìš©ì`);
        }

        // íŠ¹ì • ì‚¬ìš©ìì˜ ëª¨ë¸ ì‚¬ìš©ëŸ‰ ì°¨íŠ¸ ìƒì„± (ë§‰ëŒ€ ê·¸ë˜í”„)
        function createFilteredModelPreferenceChart(userId) {
            console.log('ğŸ”¥ createFilteredModelPreferenceChart ì‹œì‘:', userId);
            
            const canvas = document.getElementById('modelPreferenceChart');
            if (!canvas) return;
            
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            // íŠ¹ì • ì‚¬ìš©ìì˜ ëª¨ë¸ ì‚¬ìš©ëŸ‰ ë°ì´í„° ìƒì„±
            const userModelData = generateUserModelUsageData(userId);
            
            if (!userModelData || userModelData.length === 0) {
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(`${userId}ì˜ ëª¨ë¸ ì‚¬ìš© ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.`, width / 2, height / 2);
                return;
            }
            
            // ë§‰ëŒ€ ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
            drawUserModelBarChart(ctx, width, height, userModelData, userId);
        }

        // íŠ¹ì • ì‚¬ìš©ìì˜ ëª¨ë¸ ì‚¬ìš©ëŸ‰ ë°ì´í„° ìƒì„±
        function generateUserModelUsageData(userId) {
            console.log('ğŸ”¥ generateUserModelUsageData ì‹œì‘:', userId);
            
            const members = (chartDataStore.members && chartDataStore.members.length > 0) ? 
                chartDataStore.members : (currentMembers || []);
            const rawEvents = (chartDataStore.rawEvents && chartDataStore.rawEvents.length > 0) ? 
                chartDataStore.rawEvents : (currentRawEventsData || []);
            
            if (!members || members.length === 0 || !rawEvents || rawEvents.length === 0) {
                console.log('âš ï¸ ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.');
                return [];
            }
            
            // ì‚¬ìš©ì ì°¾ê¸°
            const user = members.find(member => {
                const emailId = member.email.split('@')[0];
                return emailId.toLowerCase() === userId.toLowerCase();
            });
            
            if (!user) {
                console.log('âš ï¸ ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return [];
            }
            
            // í•´ë‹¹ ì‚¬ìš©ìì˜ ì´ë²¤íŠ¸ í•„í„°ë§
            const userEvents = rawEvents.filter(event => 
                event.userEmail === user.email || event.email === user.email
            );
            
            // ëª¨ë¸ë³„ ì‚¬ìš© íšŸìˆ˜ ê³„ì‚°
            const modelUsage = new Map();
            userEvents.forEach(event => {
                const model = event.model || 'unknown';
                modelUsage.set(model, (modelUsage.get(model) || 0) + 1);
            });
            
            // ë°°ì—´ë¡œ ë³€í™˜ ë° ì‚¬ìš© íšŸìˆ˜ ìˆœìœ¼ë¡œ ì •ë ¬
            const data = Array.from(modelUsage.entries())
                .map(([model, count]) => ({ model, count }))
                .sort((a, b) => b.count - a.count);
            
            console.log(`ğŸ”¥ ${userId}ì˜ ëª¨ë¸ ì‚¬ìš©ëŸ‰ ë°ì´í„°:`, data);
            return data;
        }

        // ì‚¬ìš©ìë³„ ëª¨ë¸ ì‚¬ìš©ëŸ‰ ë§‰ëŒ€ ê·¸ë˜í”„ ê·¸ë¦¬ê¸° (ëª¨ë¸ ì‚¬ìš© ë¶„í¬ ìŠ¤íƒ€ì¼)
        function drawUserModelBarChart(ctx, width, height, data, userId) {
            console.log('ğŸ” drawUserModelBarChart ì‹œì‘...');
            console.log('ğŸ“Š ì…ë ¥ ë°ì´í„°:', data);
            console.log('ğŸ“ ìº”ë²„ìŠ¤ í¬ê¸°:', width, 'x', height);
            
            if (data.length === 0) {
                console.log('âš ï¸ ë°ì´í„°ê°€ ë¹„ì–´ìˆì–´ ë¡œë”© ë©”ì‹œì§€ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.');
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', width / 2, height / 2);
                return;
            }
            
            const padding = 60;
            const chartWidth = width - (padding * 2);
            const chartHeight = height - (padding * 2);
            const barWidth = chartWidth / data.length * 0.8;
            const barSpacing = chartWidth / data.length * 0.2;
            
            // ìµœëŒ€ê°’ ê³„ì‚°
            const maxValue = Math.max(...data.map(d => d.count));
            
            // Yì¶• ê·¸ë¦¬ê¸°
            ctx.strokeStyle = '#3a3a3a';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, height - padding);
            ctx.stroke();
            
            // Xì¶• ê·¸ë¦¬ê¸°
            ctx.beginPath();
            ctx.moveTo(padding, height - padding);
            ctx.lineTo(width - padding, height - padding);
            ctx.stroke();
            
            // Yì¶• ë ˆì´ë¸”
            ctx.fillStyle = '#7a7a7a';
            ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'right';
            ctx.textBaseline = 'middle';
            
            const ySteps = 5;
            for (let i = 0; i <= ySteps; i++) {
                const y = padding + (chartHeight / ySteps) * i;
                const value = Math.round((maxValue / ySteps) * (ySteps - i));
                ctx.fillText(value.toString(), padding - 10, y);
            }
            
            // ë§‰ëŒ€ ê·¸ë¦¬ê¸° (ë‹¤ì–‘í•œ ìƒ‰ìƒ)
            const colors = ['#4a9eff', '#4caf50', '#ff9800', '#f44336', '#9c27b0', '#00bcd4', '#ff5722', '#795548', '#607d8b', '#e91e63'];
            
            data.forEach((item, index) => {
                const x = padding + (chartWidth / data.length) * index + barSpacing / 2;
                const barHeight = (item.count / maxValue) * chartHeight;
                const y = height - padding - barHeight;
                
                // ë§‰ëŒ€ ê·¸ë¦¬ê¸° (ë‹¤ì–‘í•œ ìƒ‰ìƒ)
                ctx.fillStyle = colors[index % colors.length];
                ctx.fillRect(x, y, barWidth, barHeight);
                
                // ë§‰ëŒ€ ìœ„ì— ê°’ í‘œì‹œ
                ctx.fillStyle = '#e1e1e1';
                ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(item.count.toString(), x + barWidth / 2, y - 10);
                
                // Xì¶• ë ˆì´ë¸” (ëª¨ë¸ëª…)
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '11px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                const modelName = item.model.length > 12 ? item.model.substring(0, 12) + '...' : item.model;
                ctx.fillText(modelName, x + barWidth / 2, height - padding + 20);
            });
            
            // ì œëª©
            ctx.fillStyle = '#e1e1e1';
            ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(`${userId}ì˜ ëª¨ë¸ ì‚¬ìš©ëŸ‰`, width / 2, 25);
            
            // Yì¶• ì œëª©
            ctx.fillStyle = '#7a7a7a';
            ctx.font = '12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textAlign = 'center';
            ctx.save();
            ctx.translate(20, height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('ì‚¬ìš© íšŸìˆ˜', 0, 0);
            ctx.restore();
        }

        // ì—¬ëŸ¬ ì‚¬ìš©ì ëª¨ë¸ ì„ í˜¸ë„ ì°¨íŠ¸ ìƒì„± (ë¶€ë¶„ ê²€ìƒ‰ ê²°ê³¼)
        function createMultiUserModelPreferenceChart(filteredUsers) {
            console.log('ğŸ”¥ createMultiUserModelPreferenceChart ì‹œì‘:', filteredUsers.length, 'ëª…');
            
            const canvas = document.getElementById('modelPreferenceChart');
            if (!canvas) return;
            
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = 300;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, width, height);
            
            // í•„í„°ëœ ì‚¬ìš©ìë“¤ì˜ ëª¨ë¸ ì„ í˜¸ë„ ë°ì´í„° ìƒì„±
            const preferenceData = generateFilteredModelPreferenceData(filteredUsers);
            
            if (preferenceData.size === 0) {
                ctx.fillStyle = '#7a7a7a';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('ëª¨ë¸ ì„ í˜¸ë„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', width / 2, height / 2);
                return;
            }
            
            // ìŠ¤íƒ ë°” ì°¨íŠ¸ ê·¸ë¦¬ê¸°
            drawStackedBarChart(ctx, width, height, preferenceData);
        }

        // í•„í„°ëœ ì‚¬ìš©ìë“¤ì˜ ëª¨ë¸ ì„ í˜¸ë„ ë°ì´í„° ìƒì„±
        function generateFilteredModelPreferenceData(filteredUsers) {
            console.log('ğŸ”¥ generateFilteredModelPreferenceData ì‹œì‘:', filteredUsers.length, 'ëª…');
            
            const rawEvents = (chartDataStore.rawEvents && chartDataStore.rawEvents.length > 0) ? 
                chartDataStore.rawEvents : (currentRawEventsData || []);
            
            if (!rawEvents || rawEvents.length === 0) {
                console.log('âš ï¸ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return new Map();
            }
            
            // ì‚¬ìš©ìë³„ í™œë™ ë° ëª¨ë¸ ì‚¬ìš©ëŸ‰ ê³„ì‚°
            const userActivityData = [];
            filteredUsers.forEach(member => {
                const userEmail = member.email;
                const userId = userEmail.split('@')[0];
                
                const userEvents = rawEvents.filter(event => 
                    event.userEmail === userEmail || event.email === userEmail
                );
                
                // í™œë™ì´ ì—†ëŠ” ì‚¬ìš©ìëŠ” ì œì™¸
                if (userEvents.length === 0) {
                    return;
                }
                
                const modelUsage = new Map();
                userEvents.forEach(event => {
                    const model = event.model || 'unknown';
                    modelUsage.set(model, (modelUsage.get(model) || 0) + 1);
                });
                
                userActivityData.push({
                    userId: userId,
                    email: userEmail,
                    totalActivity: userEvents.length,
                    modelUsage: modelUsage
                });
            });
            
            // í™œë™ ìˆ˜ë¡œ ì •ë ¬í•˜ì—¬ ìƒìœ„ 20ëª… ì„ íƒ
            const sortedUsers = userActivityData
                .sort((a, b) => b.totalActivity - a.totalActivity)
                .slice(0, 20);
            
            // Map í˜•íƒœë¡œ ë³€í™˜
            const userModelPreference = new Map();
            sortedUsers.forEach(user => {
                userModelPreference.set(user.userId, user.modelUsage);
            });
            
            console.log(`ğŸ“Š í•„í„°ëœ ëª¨ë¸ ì„ í˜¸ë„ ë°ì´í„° ìƒì„± ì™„ë£Œ: ${userModelPreference.size}ëª…ì˜ í™œì„± ì‚¬ìš©ì`);
            return userModelPreference;
        }

        // Usage ì„¹ì…˜ í˜„ì¬ í•„í„°ë¡œ ì—…ë°ì´íŠ¸
        async function updateUsageWithCurrentFilter(days = 30, showLoading = true) {
            try {
                // ì´ë¯¸ ë¡œë”© ì¤‘ì´ë©´ ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
                if (isUsageLoading) {
                    console.log('âš ï¸ Usage ë°ì´í„° ë¡œë”© ì¤‘ - ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€');
                    return;
                }
                
                console.log(`=== Usage ì„¹ì…˜ ${days}ì¼ í•„í„°ë¡œ ì—…ë°ì´íŠ¸ ì‹œì‘ (ë¡œë”© í‘œì‹œ: ${showLoading}) ===`);
                
                isUsageLoading = true;
                
                // ë‚ ì§œ ë²”ìœ„ ê³„ì‚°
                const dateRange = getDateRange(days);
                currentUsageDateRange = null; // ì‚¬ìš©ì ì •ì˜ ë²”ìœ„ ì´ˆê¸°í™”
                
                // í•„í„° ê¸°ê°„ í‘œì‹œ ì—…ë°ì´íŠ¸
                updateUsageFilterPeriodDisplay(dateRange.startDate, dateRange.endDate);
                
                await updateUsageWithDateRange(dateRange.startDate, dateRange.endDate, showLoading);
                
                // ì²« ë²ˆì§¸ ë¡œë”© ì™„ë£Œ í‘œì‹œ
                if (showLoading) {
                    isUsageDataLoaded = true;
                }
                
                isUsageLoading = false;
                console.log(`=== Usage ì„¹ì…˜ ${days}ì¼ í•„í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ ===`);
            } catch (error) {
                console.error('âŒ Usage í•„í„° ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                isUsageLoading = false;
            }
        }

        // Usage ì„¹ì…˜ íŠ¹ì • ë‚ ì§œ ë²”ìœ„ë¡œ ì—…ë°ì´íŠ¸
        async function updateUsageWithDateRange(startDate, endDate, showLoading = true) {
            try {
                console.log(`=== Usage ì„¹ì…˜ ë‚ ì§œ ë²”ìœ„ ì—…ë°ì´íŠ¸ ì‹œì‘: ${new Date(startDate).toLocaleDateString()} ~ ${new Date(endDate).toLocaleDateString()} (ë¡œë”© í‘œì‹œ: ${showLoading}) ===`);
                
                // ë¡œë”© ìƒíƒœ í‘œì‹œ (ì²« ë²ˆì§¸ ë¡œë”©ì—ë§Œ)
                if (showLoading) {
                    showUsageLoadingState(true);
                }
                
                // API ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const [membersData, eventsData, usageData, spendingData] = await Promise.all([
                    getTeamMembers(),
                    getFilteredEvents(startDate, endDate),
                    getUsageData(startDate, endDate),
                    getTeamSpendingData()
                ]);
                
                // Usage ì¹´ë“œ ì—…ë°ì´íŠ¸
                updateUsageCards(usageData, eventsData);
                
                // ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ ì—…ë°ì´íŠ¸
                updateUserCumulativeInfo(membersData, eventsData, spendingData, startDate, endDate);
                
                // All Raw Events ì—…ë°ì´íŠ¸ (í˜ì´ì§€ ì´ˆê¸°í™”)
                currentRawEventsPage = 1;
                updateRawEventsTable(eventsData);
                
                // ë¡œë”© ìƒíƒœ í•´ì œ (ì²« ë²ˆì§¸ ë¡œë”©ì—ë§Œ)
                if (showLoading) {
                    showUsageLoadingState(false);
                }
                
                console.log(`=== Usage ì„¹ì…˜ ë‚ ì§œ ë²”ìœ„ ì—…ë°ì´íŠ¸ ì™„ë£Œ ===`);
            } catch (error) {
                console.error('âŒ Usage ë‚ ì§œ ë²”ìœ„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                if (showLoading) {
                    showUsageLoadingState(false);
                }
            }
        }

        // Usage ë¡œë”© ìƒíƒœ í‘œì‹œ/í•´ì œ
        function showUsageLoadingState(isLoading) {
            const usageCards = document.querySelectorAll('#usage .usage-card-number');
            const userTables = document.querySelectorAll('#usage .user-cumulative-info');
            
            if (isLoading) {
                usageCards.forEach(card => {
                    card.textContent = '-';
                });
                userTables.forEach(table => {
                    table.style.opacity = '0.5';
                });
            } else {
                userTables.forEach(table => {
                    table.style.opacity = '1';
                });
            }
        }

        // Usage ì¹´ë“œ ì—…ë°ì´íŠ¸ (Overviewì™€ Usage ì„¹ì…˜ ëª¨ë‘)
        function updateUsageCards(usageData, eventsData) {
            // Overview ì„¹ì…˜ê³¼ Usage ì„¹ì…˜ ëª¨ë‘ì˜ ì¹´ë“œë¥¼ ì°¾ìŒ
            const overviewCards = document.querySelectorAll('#overview .usage-card-number');
            const usageCards = document.querySelectorAll('#usage .usage-card-number');
            const allCards = [...overviewCards, ...usageCards];
            
            if (!usageData || !usageData.data) {
                allCards.forEach((card, index) => {
                    const cardIndex = index % 4; // 4ê°œ ì¹´ë“œ ë°˜ë³µ
                    card.textContent = '0';
                });
                console.log('ğŸ“Š Usage ì¹´ë“œ ì—…ë°ì´íŠ¸: ë°ì´í„° ì—†ìŒ - ëª¨ë“  ê°’ì„ 0ìœ¼ë¡œ ì„¤ì •');
                return;
            }
            
            // ì‹¤ì œ í™œë™í•œ ì‚¬ìš©ì ìˆ˜ ê³„ì‚°
            const activeUsers = new Set();
            if (eventsData && eventsData.usageEvents) {
                eventsData.usageEvents.forEach(event => {
                    if (event.userEmail && event.requestsCosts > 0) {
                        activeUsers.add(event.userEmail);
                    }
                });
            }
            
            // ì§‘ê³„ ê³„ì‚°
            let totalLinesAdded = 0;
            let totalLinesAccepted = 0;
            let totalTabsAccepted = 0;
            let totalChats = 0;
            
            usageData.data.forEach(dayData => {
                totalLinesAdded += (dayData.totalLinesAdded || 0);
                totalLinesAccepted += (dayData.acceptedLinesAdded || 0);
                totalTabsAccepted += (dayData.totalTabsAccepted || 0);
                totalChats += (dayData.chatRequests || 0);
            });
            
            // ì¹´ë“œ ì—…ë°ì´íŠ¸ (Overviewì™€ Usage ì„¹ì…˜ ëª¨ë‘)
            const values = [
                activeUsers.size.toLocaleString(), // Total Users
                (totalLinesAdded + totalLinesAccepted).toLocaleString(), // Lines of Agent Edits
                totalTabsAccepted.toLocaleString(), // Tabs Accepted
                totalChats.toLocaleString() // Chats
            ];
            
            allCards.forEach((card, index) => {
                const cardIndex = index % 4; // 4ê°œ ì¹´ë“œ ë°˜ë³µ
                card.textContent = values[cardIndex];
            });
            
            console.log(`Usage ì¹´ë“œ ì—…ë°ì´íŠ¸: ì‚¬ìš©ì ${activeUsers.size}ëª…, ë¼ì¸ ${totalLinesAdded + totalLinesAccepted}ì¤„, íƒ­ ${totalTabsAccepted}ê°œ, ì±„íŒ… ${totalChats}ê±´`);
        }

        // ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ í…Œì´ë¸” ë Œë”ë§ (All Raw Events ìŠ¤íƒ€ì¼)
        function renderUserCumulativeTableWithPagination(userInfos, startDate, endDate) {
            console.log('ğŸ¨ renderUserCumulativeTableWithPagination í•¨ìˆ˜ í˜¸ì¶œë¨');
            console.log('ğŸ“Š ë Œë”ë§ ë°ì´í„°:', {
                userInfos: userInfos ? `${userInfos.length}ëª…` : 'null',
                startDate: startDate,
                endDate: endDate
            });
            
            // í—¤ë” ì—…ë°ì´íŠ¸
            const headerElement = document.querySelector('.user-cumulative-info .user-cumulative-header');
            if (headerElement) {
                if (!userInfos || userInfos.length === 0) {
                    headerElement.innerHTML = 'ğŸ“Š ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´';
                } else {
                    const totalUsers = userInfos.length;
                    const totalPages = Math.ceil(totalUsers / currentUserCumulativePageSize);
                    const startIndex = (currentUserCumulativePage - 1) * currentUserCumulativePageSize;
                    const endIndex = Math.min(startIndex + currentUserCumulativePageSize, totalUsers);
                    
                    // ë‚ ì§œ í˜•ì‹ ë³€ê²½ (ë‚ ì§œ ëì˜ "." ì œê±°)
                    const cleanStartDate = new Date(startDate).toLocaleDateString('ko-KR').replace(/\.$/, '');
                    const cleanEndDate = new Date(endDate).toLocaleDateString('ko-KR').replace(/\.$/, '');
                    
                    headerElement.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>ğŸ“Š ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ (${cleanStartDate} ~ ${cleanEndDate})(${startIndex + 1}-${endIndex} of ${totalUsers})</span>
                            <select id="userCumulativePageSize" onchange="changeUserCumulativePageSize(this.value)" style="background: #3a3a3a; color: #fff; border: 1px solid #4a4a4a; padding: 5px 10px; border-radius: 4px; font-size: 12px;">
                                <option value="10" ${currentUserCumulativePageSize === 10 ? 'selected' : ''}>10ê°œ ë³´ê¸°</option>
                                <option value="20" ${currentUserCumulativePageSize === 20 ? 'selected' : ''}>20ê°œ ë³´ê¸°</option>
                                <option value="30" ${currentUserCumulativePageSize === 30 ? 'selected' : ''}>30ê°œ ë³´ê¸°</option>
                                <option value="50" ${currentUserCumulativePageSize === 50 ? 'selected' : ''}>50ê°œ ë³´ê¸°</option>
                                <option value="100" ${currentUserCumulativePageSize === 100 ? 'selected' : ''}>100ê°œ ë³´ê¸°</option>
                            </select>
                        </div>
                    `;
                }
            }
            
            if (!userInfos || userInfos.length === 0) {
                const container = document.getElementById('user-cumulative-container');
                if (container) {
                    container.innerHTML = `
                        <div style="padding: 20px; text-align: center; color: #7a7a7a; background-color: #1a1a1a;">
                            ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
                        </div>
                    `;
                }
                // í˜ì´ì§€ë„¤ì´ì…˜ ìˆ¨ê¸°ê¸°
                const pagination = document.getElementById('user-cumulative-pagination');
                if (pagination) pagination.style.display = 'none';
                return;
            }
            
            // í˜ì´ì§€ë„¤ì´ì…˜ ê³„ì‚°
            const totalUsers = userInfos.length;
            const totalPages = Math.ceil(totalUsers / currentUserCumulativePageSize);
            const startIndex = (currentUserCumulativePage - 1) * currentUserCumulativePageSize;
            const endIndex = Math.min(startIndex + currentUserCumulativePageSize, totalUsers);
            const pageUsers = userInfos.slice(startIndex, endIndex);

            console.log(`ğŸ“„ ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ í˜ì´ì§€ë„¤ì´ì…˜: ${startIndex + 1}-${endIndex} of ${totalUsers} (í˜ì´ì§€ ${currentUserCumulativePage}/${totalPages})`);
            
            // í…Œì´ë¸” ë‚´ìš©ë§Œ ì—…ë°ì´íŠ¸
            const tableContent = pageUsers.map(user => `
                <div class="user-cumulative-row">
                    <div>${user.name}</div>
                    <div class="user-email clickable-email" title="View usage for ${user.email}" onclick="navigateToUsageWithEmail('${user.email}')">${user.email}</div>
                    <div><span class="role-badge ${user.role === 'owner' ? 'admin' : ''}">${user.role === 'owner' ? 'Admin' : 'Member'}</span></div>
                    <div style="font-weight: 600;">${user.periodRequests}</div>
                    <div>$${user.spend.toFixed(2)}</div>
                    <div>${user.lastActivity}</div>
                </div>
            `).join('');
            
            // ì»¨í…Œì´ë„ˆì— í…Œì´ë¸” ë‚´ìš©ë§Œ ì‚½ì…
            const container = document.getElementById('user-cumulative-container');
            if (container) {
                container.innerHTML = tableContent;
            }

            // í˜ì´ì§€ë„¤ì´ì…˜ ì—…ë°ì´íŠ¸
            const paginationContainer = document.getElementById('user-cumulative-pagination');
            if (paginationContainer && totalPages > 1) {
                paginationContainer.innerHTML = generateUserCumulativePagination(totalPages);
                paginationContainer.style.display = 'block';
            } else if (paginationContainer) {
                paginationContainer.style.display = 'none';
            }
            
            console.log('âœ… ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ í…Œì´ë¸” HTML ë Œë”ë§ ì™„ë£Œ');
            console.log(`ğŸ“Š ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ ì—…ë°ì´íŠ¸: ì´ ${userInfos.length}ëª… (í˜ì´ì§€ ${currentUserCumulativePage}/${totalPages})`);
        }
        

        
        // ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ í˜ì´ì§€ ë³€ê²½ (All Raw Events ìŠ¤íƒ€ì¼)
        function changeUserCumulativePage(page) {
            currentUserCumulativePage = page;
            renderUserCumulativeTableWithPagination(currentUserCumulativeData, currentUserCumulativeStartDate, currentUserCumulativeEndDate);
        }
        
        // ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ í˜ì´ì§€ í¬ê¸° ë³€ê²½ (All Raw Events ìŠ¤íƒ€ì¼)
        function changeUserCumulativePageSize(pageSize) {
            currentUserCumulativePageSize = parseInt(pageSize);
            currentUserCumulativePage = 1; // í˜ì´ì§€ í¬ê¸° ë³€ê²½ì‹œ ì²« í˜ì´ì§€ë¡œ ì´ë™
            renderUserCumulativeTableWithPagination(currentUserCumulativeData, currentUserCumulativeStartDate, currentUserCumulativeEndDate);
        }

        // ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateUserCumulativeInfo(membersData, eventsData, spendingData, startDate, endDate) {
            console.log('ğŸ” updateUserCumulativeInfo í•¨ìˆ˜ í˜¸ì¶œë¨');
            console.log('ğŸ“Š ì „ë‹¬ë°›ì€ ë°ì´í„°:', {
                membersData: membersData ? `${membersData.teamMembers?.length || 0}ëª…` : 'null',
                eventsData: eventsData ? `${eventsData.usageEvents?.length || 0}ê°œ ì´ë²¤íŠ¸` : 'null',
                spendingData: spendingData ? `${spendingData.teamMemberSpend?.length || 0}ê°œ ì§€ì¶œ` : 'null',
                startDate: startDate,
                endDate: endDate
            });
            
            if (!membersData || !membersData.teamMembers) {
                console.log('âš ï¸ ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´: ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                console.log('ìƒì„¸ ì •ë³´:', {
                    membersData: !!membersData,
                    teamMembers: membersData?.teamMembers?.length || 0
                });
                return;
            }
            
            console.log('=== ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ ì—…ë°ì´íŠ¸ ì‹œì‘ ===');
            
            // ì§€ì¶œ ë°ì´í„° ë§¤í•‘
            const memberSpendMap = {};
            if (spendingData && spendingData.teamMemberSpend) {
                spendingData.teamMemberSpend.forEach(spendInfo => {
                    memberSpendMap[spendInfo.email] = {
                        premiumRequests: spendInfo.fastPremiumRequests || 0,
                        spend: (spendInfo.spendCents || 0) / 100,
                        hardLimitOverride: spendInfo.hardLimitOverrideDollars || 0
                    };
                });
            }
            
            // ì„ íƒëœ ê¸°ê°„ ë‚´ ì‚¬ìš©ìë³„ í™œë™ í†µê³„ ê³„ì‚°
            const userPeriodStats = {};
            if (eventsData && eventsData.usageEvents) {
                eventsData.usageEvents.forEach(event => {
                    const userEmail = event.userEmail;
                    const timestamp = parseInt(event.timestamp);
                    
                    if (!userPeriodStats[userEmail]) {
                        userPeriodStats[userEmail] = {
                            lastTimestamp: timestamp,
                            periodRequests: 0
                        };
                    }
                    
                    // ë§ˆì§€ë§‰ í™œë™ ì‹œê°„ ì—…ë°ì´íŠ¸
                    if (timestamp > userPeriodStats[userEmail].lastTimestamp) {
                        userPeriodStats[userEmail].lastTimestamp = timestamp;
                    }
                    
                    // ì„ íƒëœ ê¸°ê°„ ë‚´ ìš”ì²­ ë¹„ìš© ëˆ„ì  (All Raw Eventsì˜ COSTê°’ê³¼ ë™ì¼)
                    const requestCost = event.requestsCosts || 0;
                    userPeriodStats[userEmail].periodRequests += requestCost;
                    
                    // ë””ë²„ê¹…ì„ ìœ„í•œ ë¡œê·¸ (ì²˜ìŒ 5ê°œ ì´ë²¤íŠ¸ë§Œ)
                    if (Object.keys(userPeriodStats).length <= 5 && userPeriodStats[userEmail].periodRequests <= requestCost * 3) {
                        console.log(`ğŸ’° ${userEmail}: +${requestCost} (ëˆ„ì : ${userPeriodStats[userEmail].periodRequests})`);
                    }
                });
            }
            
            // ì‚¬ìš©ì ì •ë³´ ìƒì„±
            const userInfos = membersData.teamMembers.map(member => {
                const spendData = memberSpendMap[member.email] || {};
                const periodStats = userPeriodStats[member.email] || {};
                const actualSpend = spendData.spend || 0;
                const totalPremiumRequests = spendData.premiumRequests || 0; // ì „ì²´ ê¸°ê°„ Premium Requests
                const periodRequests = periodStats.periodRequests || 0; // ì„ íƒëœ ê¸°ê°„ ë‚´ ìš”ì²­ ìˆ˜
                
                // ë§ˆì§€ë§‰ í™œë™ ë‚ ì§œ ê³„ì‚°
                let lastActivityText = 'No Activity';
                if (periodStats.lastTimestamp) {
                    const lastDate = new Date(periodStats.lastTimestamp);
                    const today = new Date();
                    const daysDiff = Math.floor((today - lastDate) / (1000 * 60 * 60 * 24));
                    
                    if (daysDiff === 0) {
                        lastActivityText = 'ì˜¤ëŠ˜';
                    } else if (daysDiff === 1) {
                        lastActivityText = 'ì–´ì œ';
                    } else {
                        lastActivityText = `${daysDiff}ì¼ ì „`;
                    }
                }
                
                return {
                    name: member.name || 'Unnamed',
                    email: member.email,
                    role: member.role,
                    totalPremiumRequests: totalPremiumRequests, // ì „ì²´ Premium Requests
                    periodRequests: periodRequests, // ì„ íƒëœ ê¸°ê°„ ë‚´ ìš”ì²­ ìˆ˜
                    spend: actualSpend,
                    lastActivity: lastActivityText,
                    lastTimestamp: periodStats.lastTimestamp || 0
                };
            });
            
            // 1. Last Act ìµœì‹ ìˆœ, 2. Request ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬
            userInfos.sort((a, b) => {
                // 1ì°¨ ì •ë ¬: Last Act (ë§ˆì§€ë§‰ í™œë™) ìµœì‹ ìˆœ - timestamp ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ
                if (b.lastTimestamp !== a.lastTimestamp) {
                    return b.lastTimestamp - a.lastTimestamp;
                }
                // 2ì°¨ ì •ë ¬: Request ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ
                return b.periodRequests - a.periodRequests;
            });
            
            // ë°ì´í„° ì €ì¥ ë° í˜ì´ì§€ë„¤ì´ì…˜ ì ìš©
            currentUserCumulativeData = userInfos;
            currentUserCumulativeStartDate = startDate;
            currentUserCumulativeEndDate = endDate;
            currentUserCumulativePage = 1; // ì²« í˜ì´ì§€ë¡œ ë¦¬ì…‹
            
            // í˜ì´ì§€ë„¤ì´ì…˜ ì ìš©
            renderUserCumulativeTableWithPagination(userInfos, startDate, endDate);
            
            console.log(`ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${userInfos.length}ëª…`);
            console.log(`ì„ íƒëœ ê¸°ê°„ ë‚´ ì´ ìš”ì²­ ìˆ˜: ${userInfos.reduce((sum, user) => sum + user.periodRequests, 0)}ê±´`);
        }

        // All Raw Events í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateRawEventsTable(eventsData) {
            const tableContainer = document.querySelector('#usage .user-cumulative-info:last-child');
            if (!tableContainer || !eventsData || !eventsData.usageEvents) return;
            
            // ê²€ìƒ‰ ì¤‘ì¸ ê²½ìš° ìë™ ì—…ë°ì´íŠ¸ ë°©ì§€
            if (window.pendingEmailSearch) {
                console.log(`â³ ì´ë©”ì¼ ê²€ìƒ‰ ëŒ€ê¸° ì¤‘ (${window.pendingEmailSearch}) - Raw Events í…Œì´ë¸” ìë™ ì—…ë°ì´íŠ¸ ê±´ë„ˆëœ€`);
                // ë°ì´í„°ëŠ” ì €ì¥í•˜ë˜ í…Œì´ë¸” ë Œë”ë§ì€ í•˜ì§€ ì•ŠìŒ
                currentRawEventsData = eventsData.usageEvents.sort((a, b) => {
                    const timestampA = parseInt(a.timestamp) || 0;
                    const timestampB = parseInt(b.timestamp) || 0;
                    return timestampB - timestampA; // ë‚´ë¦¼ì°¨ìˆœ (ìµœì‹  â†’ ê³¼ê±°)
                });
                return;
            }
            
            // ì „ì²´ ë°ì´í„° ì €ì¥ ë° DATE ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬ (ìµœì‹ ìˆœ)
            currentRawEventsData = eventsData.usageEvents.sort((a, b) => {
                const timestampA = parseInt(a.timestamp) || 0;
                const timestampB = parseInt(b.timestamp) || 0;
                return timestampB - timestampA; // ë‚´ë¦¼ì°¨ìˆœ (ìµœì‹  â†’ ê³¼ê±°)
            });
            
            // í˜ì´ì§€ë„¤ì´ì…˜ ì ìš©
            renderRawEventsTableWithPagination();
        }

        // Raw Events í…Œì´ë¸” í˜ì´ì§€ë„¤ì´ì…˜ê³¼ í•¨ê»˜ ë Œë”ë§
        function renderRawEventsTableWithPagination() {
            const tableContainer = document.querySelector('#usage .user-cumulative-info:last-child');
            if (!tableContainer || !currentRawEventsData.length) return;
            
            const totalEvents = currentRawEventsData.length;
            const totalPages = Math.ceil(totalEvents / currentRawEventsPageSize);
            const startIndex = (currentRawEventsPage - 1) * currentRawEventsPageSize;
            const endIndex = Math.min(startIndex + currentRawEventsPageSize, totalEvents);
            const pageEvents = currentRawEventsData.slice(startIndex, endIndex);
            
            const tableHtml = `
                <div class="user-cumulative-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <span>ğŸ“‹ All Raw Events (${startIndex + 1}-${endIndex} of ${totalEvents})</span>
                    <select id="rawEventsPageSize" onchange="changeRawEventsPageSize(this.value)" style="background: #3a3a3a; color: #fff; border: 1px solid #4a4a4a; padding: 5px 10px; border-radius: 4px; font-size: 12px;">
                        <option value="10" ${currentRawEventsPageSize === 10 ? 'selected' : ''}>10ê°œ ë³´ê¸°</option>
                        <option value="20" ${currentRawEventsPageSize === 20 ? 'selected' : ''}>20ê°œ ë³´ê¸°</option>
                        <option value="30" ${currentRawEventsPageSize === 30 ? 'selected' : ''}>30ê°œ ë³´ê¸°</option>
                        <option value="50" ${currentRawEventsPageSize === 50 ? 'selected' : ''}>50ê°œ ë³´ê¸°</option>
                        <option value="100" ${currentRawEventsPageSize === 100 ? 'selected' : ''}>100ê°œ ë³´ê¸°</option>
                    </select>
                </div>
                <div class="user-cumulative-table">
                    <div>DATE</div>
                    <div>USER</div>
                    <div>KIND</div>
                    <div>MAX_MODEL</div>
                    <div>MODEL</div>
                    <div>COST</div>
                </div>
                ${pageEvents.map(event => {
                    const date = new Date(parseInt(event.timestamp));
                    const dateText = date.toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric', 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                    
                    return `
                        <div class="user-cumulative-row">
                            <div>${dateText}</div>
                            <div class="user-email">${event.userEmail}</div>
                            <div>${(event.kindLabel || 'Unknown').substring(0, 15)}${(event.kindLabel || '').length > 15 ? '...' : ''}</div>
                            <div>${event.maxMode ? 'Yes' : 'No'}</div>
                            <div>${(event.model || 'auto').substring(0, 10)}${(event.model || '').length > 10 ? '...' : ''}</div>
                            <div>${event.requestsCosts || 0}</div>
                        </div>
                    `;
                }).join('')}
                ${totalPages > 1 ? `
                    <div style="padding: 15px 20px; background-color: #2a2a2a; border-top: 1px solid #3a3a3a; display: flex; justify-content: center; align-items: center; gap: 10px;">
                        ${generateRawEventsPagination(totalPages)}
                    </div>
                ` : ''}
            `;
            
            tableContainer.innerHTML = tableHtml;
            
            console.log(`Raw Events í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì™„ë£Œ: í˜ì´ì§€ ${currentRawEventsPage}/${totalPages}, ${pageEvents.length}ê°œ ì´ë²¤íŠ¸ í‘œì‹œ`);
        }

        // Raw Events í˜ì´ì§€ë„¤ì´ì…˜ ìƒì„±
        function generateRawEventsPagination(totalPages) {
            let pagination = '';
            
            // ì´ì „ ë²„íŠ¼
            if (currentRawEventsPage > 1) {
                pagination += `<button onclick="changeRawEventsPage(${currentRawEventsPage - 1})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">â€¹</button>`;
            }
            
            // í˜ì´ì§€ ë²ˆí˜¸ë“¤
            let startPage = Math.max(1, currentRawEventsPage - 2);
            let endPage = Math.min(totalPages, currentRawEventsPage + 2);
            
            // ì²« í˜ì´ì§€ê°€ ë²”ìœ„ì— ì—†ìœ¼ë©´ ì¶”ê°€
            if (startPage > 1) {
                pagination += `<button onclick="changeRawEventsPage(1)" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">1</button>`;
                if (startPage > 2) {
                    pagination += `<span style="color: #7a7a7a; padding: 0 5px;">...</span>`;
                }
            }
            
            // í˜„ì¬ ë²”ìœ„ì˜ í˜ì´ì§€ë“¤
            for (let i = startPage; i <= endPage; i++) {
                const isActive = i === currentRawEventsPage;
                pagination += `<button onclick="changeRawEventsPage(${i})" style="background: ${isActive ? '#4a9eff' : '#3a3a3a'}; border: 1px solid ${isActive ? '#4a9eff' : '#4a4a4a'}; color: ${isActive ? 'white' : '#e1e1e1'}; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: ${isActive ? '600' : 'normal'};">${i}</button>`;
            }
            
            // ë§ˆì§€ë§‰ í˜ì´ì§€ê°€ ë²”ìœ„ì— ì—†ìœ¼ë©´ ì¶”ê°€
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    pagination += `<span style="color: #7a7a7a; padding: 0 5px;">...</span>`;
                }
                pagination += `<button onclick="changeRawEventsPage(${totalPages})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">${totalPages}</button>`;
            }
            
            // ë‹¤ìŒ ë²„íŠ¼
            if (currentRawEventsPage < totalPages) {
                pagination += `<button onclick="changeRawEventsPage(${currentRawEventsPage + 1})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">â€º</button>`;
            }
            
            return pagination;
        }

        // Raw Events í˜ì´ì§€ ë³€ê²½
        function changeRawEventsPage(page) {
            currentRawEventsPage = page;
            renderRawEventsTableWithPagination();
        }

        // Raw Events í˜ì´ì§€ í¬ê¸° ë³€ê²½
        function changeRawEventsPageSize(pageSize) {
            currentRawEventsPageSize = parseInt(pageSize);
            currentRawEventsPage = 1; // í˜ì´ì§€ í¬ê¸° ë³€ê²½ì‹œ ì²« í˜ì´ì§€ë¡œ ì´ë™
            renderRawEventsTableWithPagination();
        }

        // í•„í„°ë§ëœ Raw Events í…Œì´ë¸” ë Œë”ë§ (í˜ì´ì§€ë„¤ì´ì…˜ í¬í•¨)
        function renderFilteredRawEventsTable(filteredEvents, container) {
            if (!container || !filteredEvents) return;
            
            // í˜ì´ì§€ë„¤ì´ì…˜ ì„¤ì • - ê¸°ì¡´ ì„¤ì •ì´ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ê¸°ë³¸ê°’
            const pageSize = window.currentFilteredEventsPageSize || 20;
            const currentPage = window.currentFilteredEventsPage || 1;
            const totalPages = Math.ceil(filteredEvents.length / pageSize);
            
            // í˜„ì¬ í˜ì´ì§€ì˜ ì´ë²¤íŠ¸ë§Œ ì¶”ì¶œ
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = Math.min(startIndex + pageSize, filteredEvents.length);
            const pageEvents = filteredEvents.slice(startIndex, endIndex);
            
            console.log(`ğŸ“„ í•„í„°ë§ëœ Raw Events í˜ì´ì§€ë„¤ì´ì…˜: ${startIndex + 1}-${endIndex} of ${filteredEvents.length} (í˜ì´ì§€ ${currentPage}/${totalPages})`);
            
            // ì¼ë°˜ í…Œì´ë¸”ê³¼ ë™ì¼í•œ êµ¬ì¡°ë¡œ HTML ìƒì„± (í˜ì´ì§€ë„¤ì´ì…˜ í¬í•¨)
            const tableHtml = `
                <div class="user-cumulative-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <span>ğŸ“‹ All Raw Events - ê²€ìƒ‰ ê²°ê³¼ (${startIndex + 1}-${endIndex} of ${filteredEvents.length})</span>
                    <select onchange="changeFilteredEventsPageSize(this.value)" style="background: #3a3a3a; color: #fff; border: 1px solid #4a4a4a; padding: 5px 10px; border-radius: 4px; font-size: 12px;">
                        <option value="10" ${pageSize === 10 ? 'selected' : ''}>10ê°œ ë³´ê¸°</option>
                        <option value="20" ${pageSize === 20 ? 'selected' : ''}>20ê°œ ë³´ê¸°</option>
                        <option value="30" ${pageSize === 30 ? 'selected' : ''}>30ê°œ ë³´ê¸°</option>
                        <option value="50" ${pageSize === 50 ? 'selected' : ''}>50ê°œ ë³´ê¸°</option>
                        <option value="100" ${pageSize === 100 ? 'selected' : ''}>100ê°œ ë³´ê¸°</option>
                    </select>
                </div>
                <div class="user-cumulative-table">
                    <div>DATE</div>
                    <div>USER</div>
                    <div>KIND</div>
                    <div>MAX_MODEL</div>
                    <div>MODEL</div>
                    <div>COST</div>
                </div>
                ${pageEvents.map(event => {
                    const date = new Date(parseInt(event.timestamp));
                    const dateText = date.toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric', 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                    
                    return `
                        <div class="user-cumulative-row">
                            <div>${dateText}</div>
                            <div class="user-email">${event.userEmail}</div>
                            <div>${(event.kindLabel || 'Unknown').substring(0, 15)}${(event.kindLabel || '').length > 15 ? '...' : ''}</div>
                            <div>${event.maxMode ? 'Yes' : 'No'}</div>
                            <div>${(event.model || 'auto').substring(0, 10)}${(event.model || '').length > 10 ? '...' : ''}</div>
                            <div>${event.requestsCosts || 0}</div>
                        </div>
                    `;
                }).join('')}
                ${totalPages > 1 ? `
                    <div style="padding: 15px 20px; background-color: #2a2a2a; border-top: 1px solid #3a3a3a; display: flex; justify-content: center; align-items: center; gap: 10px;">
                        ${generateFilteredEventsPagination(totalPages, currentPage)}
                    </div>
                ` : ''}
            `;
            
            container.innerHTML = tableHtml;
            
            // í•„í„°ë§ëœ ì´ë²¤íŠ¸ ë°ì´í„° ì €ì¥ (í˜ì´ì§€ë„¤ì´ì…˜ìš©)
            window.currentFilteredEvents = filteredEvents;
            window.currentFilteredEventsPage = currentPage;
            window.currentFilteredEventsPageSize = pageSize;
            
            console.log(`í•„í„°ë§ëœ Raw Events í…Œì´ë¸” ë Œë”ë§ ì™„ë£Œ: ${filteredEvents.length}ê°œ ì´ë²¤íŠ¸ (í˜ì´ì§€ ${currentPage}/${totalPages}, í˜ì´ì§€ë‹¹ ${pageSize}ê°œ)`);
        }

        // ë¹ˆ Raw Events í…Œì´ë¸” ë Œë”ë§
        function renderEmptyRawEventsTable(container, searchedEmails) {
            if (!container) return;
            
            const emailList = searchedEmails.join(', ');
            
            const tableHtml = `
                <div class="user-cumulative-header">
                    <span>ğŸ“‹ All Raw Events - ê²€ìƒ‰ ê²°ê³¼ (0ê°œ)</span>
                </div>
                <div class="user-cumulative-table">
                    <div>DATE</div>
                    <div>USER</div>
                    <div>KIND</div>
                    <div>MAX_MODEL</div>
                    <div>MODEL</div>
                    <div>COST</div>
                </div>
                <div style="padding: 40px 20px; text-align: center; color: #7a7a7a; background-color: #1a1a1a; grid-column: 1 / -1;">
                    <h3 style="color: #e1e1e1; margin-bottom: 10px;">ê²€ìƒ‰ëœ ì‚¬ìš©ìì˜ í™œë™ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                    <p style="margin-bottom: 15px;">ê²€ìƒ‰ ëŒ€ìƒ: <strong style="color: #4a9eff;">${emailList}</strong></p>
                    <p style="font-size: 14px; line-height: 1.4;">
                        â€¢ í•´ë‹¹ ì‚¬ìš©ìê°€ ì„ íƒëœ ê¸°ê°„ì— í™œë™í•˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤<br>
                        â€¢ ë‹¤ë¥¸ ë‚ ì§œ ë²”ìœ„ë¥¼ ì„ íƒí•´ë³´ì„¸ìš”<br>
                        â€¢ ë˜ëŠ” ë‹¤ë¥¸ ì‚¬ìš©ìë¥¼ ê²€ìƒ‰í•´ë³´ì„¸ìš”
                    </p>
                </div>
            `;
            
            container.innerHTML = tableHtml;
            console.log(`ë¹ˆ Raw Events í…Œì´ë¸” ë Œë”ë§ ì™„ë£Œ (ê²€ìƒ‰ ëŒ€ìƒ: ${emailList})`);
        }

        // í•„í„°ë§ëœ ì´ë²¤íŠ¸ í˜ì´ì§€ë„¤ì´ì…˜ ìƒì„± (ì¼ë°˜ í…Œì´ë¸”ê³¼ ë™ì¼í•œ êµ¬ì¡°)
        function generateFilteredEventsPagination(totalPages, currentPage) {
            let pagination = '';
            
            // ì´ì „ í˜ì´ì§€ ë²„íŠ¼
            if (currentPage > 1) {
                pagination += `<button onclick="changeFilteredEventsPage(${currentPage - 1})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">â€¹</button>`;
            }
            
            // í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼ë“¤
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, currentPage + 2);
            
            // ì‹œì‘ í˜ì´ì§€ê°€ 1ì´ ì•„ë‹ˆë©´ ì²« í˜ì´ì§€ ë²„íŠ¼ ì¶”ê°€
            if (startPage > 1) {
                pagination += `<button onclick="changeFilteredEventsPage(1)" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">1</button>`;
                if (startPage > 2) {
                    pagination += `<span style="color: #7a7a7a; padding: 0 5px;">...</span>`;
                }
            }
            
            // í˜ì´ì§€ ë²ˆí˜¸ë“¤
            for (let i = startPage; i <= endPage; i++) {
                const isActive = i === currentPage;
                pagination += `<button onclick="changeFilteredEventsPage(${i})" style="background: ${isActive ? '#4a9eff' : '#3a3a3a'}; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">${i}</button>`;
            }
            
            // ë í˜ì´ì§€ê°€ totalPagesê°€ ì•„ë‹ˆë©´ ë§ˆì§€ë§‰ í˜ì´ì§€ ë²„íŠ¼ ì¶”ê°€
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    pagination += `<span style="color: #7a7a7a; padding: 0 5px;">...</span>`;
                }
                pagination += `<button onclick="changeFilteredEventsPage(${totalPages})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">${totalPages}</button>`;
            }
            
            // ë‹¤ìŒ í˜ì´ì§€ ë²„íŠ¼
            if (currentPage < totalPages) {
                pagination += `<button onclick="changeFilteredEventsPage(${currentPage + 1})" style="background: #3a3a3a; border: 1px solid #4a4a4a; color: #e1e1e1; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">â€º</button>`;
            }
            
            return pagination;
        }

        // í•„í„°ë§ëœ ì´ë²¤íŠ¸ í˜ì´ì§€ ë³€ê²½
        function changeFilteredEventsPage(page) {
            if (!window.currentFilteredEvents) {
                console.log('âš ï¸ í•„í„°ë§ëœ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            window.currentFilteredEventsPage = page;
            const filteredEvents = window.currentFilteredEvents;
            const container = document.querySelector('#usage .user-cumulative-info:last-child');
            
            console.log(`ğŸ“„ í•„í„°ë§ëœ Raw Events í˜ì´ì§€ ë³€ê²½: í˜ì´ì§€ ${page}ë¡œ ì´ë™`);
            console.log(`ğŸ“„ ì»¨í…Œì´ë„ˆ ë°œê²¬: ${!!container}, í•„í„°ë§ëœ ì´ë²¤íŠ¸ ìˆ˜: ${filteredEvents.length}`);
            
            if (container) {
                // renderFilteredRawEventsTable í•¨ìˆ˜ë¥¼ ì¬ì‚¬ìš©
                renderFilteredRawEventsTable(filteredEvents, container);
            } else {
                console.error('âŒ Raw Events ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        // í•„í„°ë§ëœ ì´ë²¤íŠ¸ í˜ì´ì§€ í¬ê¸° ë³€ê²½
        function changeFilteredEventsPageSize(newPageSize) {
            console.log(`ğŸ”§ changeFilteredEventsPageSize í˜¸ì¶œë¨: ${newPageSize}`);
            console.log(`ğŸ“Š í˜„ì¬ ìƒíƒœ: currentFilteredEvents=${!!window.currentFilteredEvents}, currentFilteredEventsPage=${window.currentFilteredEventsPage}, currentFilteredEventsPageSize=${window.currentFilteredEventsPageSize}`);
            
            if (!window.currentFilteredEvents) {
                console.log('âš ï¸ í•„í„°ë§ëœ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            window.currentFilteredEventsPageSize = parseInt(newPageSize);
            window.currentFilteredEventsPage = 1; // í˜ì´ì§€ í¬ê¸° ë³€ê²½ì‹œ ì²« í˜ì´ì§€ë¡œ ì´ë™
            
            const filteredEvents = window.currentFilteredEvents;
            const container = document.querySelector('#usage .user-cumulative-info:last-child');
            
            console.log(`ğŸ“„ í•„í„°ë§ëœ Raw Events í˜ì´ì§€ í¬ê¸° ë³€ê²½: ${newPageSize}ê°œë¡œ ë³€ê²½, ì²« í˜ì´ì§€ë¡œ ì´ë™`);
            console.log(`ğŸ“„ ì»¨í…Œì´ë„ˆ ë°œê²¬: ${!!container}, í•„í„°ë§ëœ ì´ë²¤íŠ¸ ìˆ˜: ${filteredEvents.length}`);
            
            if (container) {
                // renderFilteredRawEventsTable í•¨ìˆ˜ë¥¼ ì¬ì‚¬ìš©
                renderFilteredRawEventsTable(filteredEvents, container);
            } else {
                console.error('âŒ Raw Events ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }
        
        // ë””ë²„ê¹…ìš© ì „ì—­ í•¨ìˆ˜
        window.debugFilteredEvents = function() {
            console.log('=== í•„í„°ë§ëœ ì´ë²¤íŠ¸ ìƒíƒœ ë””ë²„ê¹… ===');
            console.log('currentFilteredEvents:', window.currentFilteredEvents ? window.currentFilteredEvents.length + 'ê°œ' : 'null');
            console.log('currentFilteredEventsPage:', window.currentFilteredEventsPage);
            console.log('currentFilteredEventsPageSize:', window.currentFilteredEventsPageSize);
            console.log('ì»¨í…Œì´ë„ˆ:', document.querySelector('#usage .user-cumulative-info:last-child'));
            console.log('==============================');
        };



        // Usage ë©¤ë²„ ê²€ìƒ‰ ê¸°ëŠ¥ (ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ì™€ All Raw Events í…Œì´ë¸” ì—°ë™)
        function filterUsageMembers(searchTerm) {
            const searchLower = searchTerm.toLowerCase().trim();
            
            console.log(`ğŸ” Usage ë©¤ë²„ ê²€ìƒ‰ ì‹œì‘: "${searchTerm}"`);
            
            // ê²€ìƒ‰ì–´ê°€ ë¹„ì–´ìˆìœ¼ë©´ ëª¨ë“  í–‰ í‘œì‹œ
            if (searchLower === '') {
                const allRows = document.querySelectorAll('#usage .user-cumulative-row');
                allRows.forEach(row => {
                    row.style.display = 'grid';
                });
                
                // ì „ì²´ ì´ë²¤íŠ¸ ë¡œê·¸ í…Œì´ë¸”ë„ í•¨ê»˜ ê°±ì‹ 
                if (currentRawEventsData && currentRawEventsData.length > 0) {
                    // í•„í„°ë§ëœ ì´ë²¤íŠ¸ ë³€ìˆ˜ë“¤ ì •ë¦¬
                    delete window.currentFilteredEvents;
                    delete window.currentFilteredEventsPage;
                    delete window.currentFilteredEventsPageSize;
                    
                    renderRawEventsTableWithPagination();
                    console.log('âœ… ê²€ìƒ‰ì–´ ì—†ìŒ - ì „ì²´ Raw Events í˜ì´ì§€ë„¤ì´ì…˜ ë³µì›');
                }
                
                console.log('âœ… ê²€ìƒ‰ì–´ ì—†ìŒ - ëª¨ë“  í–‰ í‘œì‹œ ë° ì „ì²´ ì´ë²¤íŠ¸ ë¡œê·¸ ê°±ì‹ ');
                return;
            }
            
            // ì´ë©”ì¼ ì£¼ì†Œì¸ì§€ í™•ì¸ (@ í¬í•¨ ì—¬ë¶€ë¡œ íŒë‹¨)
            const isEmailSearch = searchLower.includes('@');
            
            // ëª¨ë“  Usage ì„¹ì…˜ì˜ user-cumulative-info ì»¨í…Œì´ë„ˆ ê°€ì ¸ì˜¤ê¸°
            const userInfoContainers = document.querySelectorAll('#usage .user-cumulative-info');
            
            if (userInfoContainers.length === 0) {
                console.log('âš ï¸ Usage ì„¹ì…˜ì˜ user-cumulative-info ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            console.log(`ğŸ“‹ ë°œê²¬ëœ í…Œì´ë¸” ì»¨í…Œì´ë„ˆ: ${userInfoContainers.length}ê°œ`);
            
            // ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ í…Œì´ë¸” (ì²« ë²ˆì§¸ ì»¨í…Œì´ë„ˆ)ê³¼ All Raw Events í…Œì´ë¸” (ë‘ ë²ˆì§¸ ì»¨í…Œì´ë„ˆ) êµ¬ë¶„
            const userCumulativeContainer = userInfoContainers[0]; // ì²« ë²ˆì§¸: ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´
            const rawEventsContainer = userInfoContainers[1]; // ë‘ ë²ˆì§¸: All Raw Events
            
            // 1. ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ í…Œì´ë¸”ì—ì„œ í•„í„°ë§í•˜ê³  ë§¤ì¹­ëœ ì´ë©”ì¼ ìˆ˜ì§‘
            const matchedEmails = new Set();
            
            // ì •í™•í•œ ì´ë©”ì¼ ë§¤ì¹­ì´ ìˆëŠ”ì§€ ë¨¼ì € í™•ì¸
            let hasExactMatch = false;
            if (isEmailSearch) {
                const allEmailElements = userCumulativeContainer.querySelectorAll('.user-cumulative-row .user-email, .user-cumulative-row div:nth-child(2)');
                hasExactMatch = Array.from(allEmailElements).some(element => 
                    element.textContent.toLowerCase().trim() === searchLower
                );
                console.log(`ğŸ” ì •í™•í•œ ì´ë©”ì¼ ë§¤ì¹­ í™•ì¸: ${hasExactMatch ? 'ë°œê²¬ë¨' : 'ì—†ìŒ'}`);
            }
            
            // ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´ í…Œì´ë¸” í•„í„°ë§
            const userCumulativeRows = userCumulativeContainer.querySelectorAll('.user-cumulative-row');
            console.log(`ğŸ“Š ì‚¬ìš©ìë³„ ëˆ„ì  ì‚¬ìš©ëŸ‰ ì •ë³´: ${userCumulativeRows.length}ê°œ í–‰ ë°œê²¬`);
            
            userCumulativeRows.forEach(row => {
                if (row.children.length < 2) return; // ì¶©ë¶„í•œ ì»¬ëŸ¼ì´ ì—†ìœ¼ë©´ ìŠ¤í‚µ
                
                const name = row.children[0].textContent.toLowerCase().trim();
                const email = row.children[1].textContent.toLowerCase().trim();
                
                let shouldShow = false;
                
                if (isEmailSearch) {
                    if (hasExactMatch) {
                        // ì •í™•í•œ ë§¤ì¹­ì´ ìˆìœ¼ë©´ ì •í™•í•œ ë§¤ì¹­ë§Œ í‘œì‹œ
                        shouldShow = email === searchLower;
                    } else {
                        // ì •í™•í•œ ë§¤ì¹­ì´ ì—†ìœ¼ë©´ ë¶€ë¶„ ë§¤ì¹­ í—ˆìš©
                        shouldShow = email.includes(searchLower);
                    }
                } else {
                    // ì¼ë°˜ ê²€ìƒ‰: ì´ë¦„ ë˜ëŠ” ì´ë©”ì¼ ë¶€ë¶„ ë§¤ì¹­
                    shouldShow = name.includes(searchLower) || email.includes(searchLower);
                }
                
                if (shouldShow) {
                    row.style.display = 'grid';
                    // ë§¤ì¹­ëœ ì´ë©”ì¼ì„ ìˆ˜ì§‘ (ì›ë³¸ ì´ë©”ì¼ ì €ì¥)
                    const originalEmail = row.children[1].textContent.trim();
                    matchedEmails.add(originalEmail);
                } else {
                    row.style.display = 'none';
                }
            });
            
            console.log(`ğŸ“§ ë§¤ì¹­ëœ ì´ë©”ì¼: ${Array.from(matchedEmails).join(', ')}`);
            
            // 2. All Raw Events í…Œì´ë¸” ì—°ë™ í•„í„°ë§ (ì „ì²´ ë°ì´í„°ì—ì„œ ê²€ìƒ‰)
            if (rawEventsContainer && currentRawEventsData && currentRawEventsData.length > 0) {
                console.log(`ğŸ“‹ All Raw Events ì „ì²´ ë°ì´í„°: ${currentRawEventsData.length}ê°œ ì´ë²¤íŠ¸`);
                console.log(`ğŸ” ë§¤ì¹­ ëŒ€ìƒ ì´ë©”ì¼: ${Array.from(matchedEmails).join(', ')}`);
                
                // ê²€ìƒ‰ì–´ê°€ ìˆìœ¼ë©´ ë§¤ì¹­ëœ ì´ë©”ì¼ì˜ ì´ë²¤íŠ¸ë§Œ í•„í„°ë§
                if (matchedEmails.size > 0) {
                    // ìƒˆë¡œìš´ ê²€ìƒ‰ ì‹œì‘ ì‹œ í˜ì´ì§€ë„¤ì´ì…˜ ë³€ìˆ˜ ì´ˆê¸°í™”
                    window.currentFilteredEventsPage = 1;
                    window.currentFilteredEventsPageSize = window.currentFilteredEventsPageSize || 20;
                    
                    const filteredEvents = currentRawEventsData.filter(event => {
                        const eventUserEmail = event.userEmail?.trim() || '';
                        
                        // ì •í™•í•œ ì´ë©”ì¼ ë§¤ì¹­ë§Œ ìˆ˜í–‰ (ëŒ€ì†Œë¬¸ì ë¬´ì‹œ)
                        return Array.from(matchedEmails).some(email => {
                            const emailLower = email.toLowerCase().trim();
                            const eventEmailLower = eventUserEmail.toLowerCase().trim();
                            return emailLower === eventEmailLower;
                        });
                    });
                    
                    console.log(`âœ… í•„í„°ë§ëœ Raw Events: ${filteredEvents.length}ê°œ`);
                    
                    if (filteredEvents.length > 0) {
                        // í•„í„°ë§ëœ ë°ì´í„°ë¡œ í…Œì´ë¸” ë‹¤ì‹œ ë Œë”ë§
                        renderFilteredRawEventsTable(filteredEvents, rawEventsContainer);
                        console.log(`âœ… ${filteredEvents.length}ê°œì˜ ë§¤ì¹­ëœ ì´ë²¤íŠ¸ë¥¼ í‘œì‹œí–ˆìŠµë‹ˆë‹¤.`);
                        console.log(`ğŸ“Š ì „ì—­ ë³€ìˆ˜ ìƒíƒœ: currentFilteredEvents=${!!window.currentFilteredEvents}, currentFilteredEventsPage=${window.currentFilteredEventsPage}, currentFilteredEventsPageSize=${window.currentFilteredEventsPageSize}`);
                    } else {
                        // ë§¤ì¹­ëœ ì´ë²¤íŠ¸ê°€ ì—†ìœ¼ë©´ ë¹ˆ í…Œì´ë¸” í‘œì‹œ
                        renderEmptyRawEventsTable(rawEventsContainer, Array.from(matchedEmails));
                        console.log('âš ï¸ ë§¤ì¹­ëœ ì‚¬ìš©ìì˜ Raw Eventsê°€ ì—†ìŠµë‹ˆë‹¤.');
                        console.log('ğŸ’¡ í•´ë‹¹ ì‚¬ìš©ìê°€ ì„ íƒëœ ê¸°ê°„ì— í™œë™í•˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                    }
                } else {
                    // ê²€ìƒ‰ì–´ê°€ ì—†ìœ¼ë©´ ì›ë˜ í˜ì´ì§€ë„¤ì´ì…˜ ë°©ì‹ìœ¼ë¡œ ë³µì›
                    renderRawEventsTableWithPagination();
                    console.log('âœ… ê²€ìƒ‰ì–´ ì—†ìŒ - ì „ì²´ Raw Events í˜ì´ì§€ë„¤ì´ì…˜ ë³µì›');
                }
            } else {
                console.log('âš ï¸ All Raw Events ì»¨í…Œì´ë„ˆ ë˜ëŠ” ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                console.log(`   - ì»¨í…Œì´ë„ˆ ì¡´ì¬: ${!!rawEventsContainer}`);
                console.log(`   - ë°ì´í„° ì¡´ì¬: ${!!currentRawEventsData}`);
                console.log(`   - ë°ì´í„° ê¸¸ì´: ${currentRawEventsData?.length || 0}`);
            }
            
            const matchingType = isEmailSearch ? (hasExactMatch ? 'ì •í™•í•œ ì´ë©”ì¼ ë§¤ì¹­' : 'ì´ë©”ì¼ ë¶€ë¶„ ë§¤ì¹­') : 'ë¶€ë¶„ ë§¤ì¹­';
            console.log(`âœ… Usage ê²€ìƒ‰ ì™„ë£Œ: "${searchTerm}" - ${matchingType}ìœ¼ë¡œ ë‘ í…Œì´ë¸” ì—°ë™ í•„í„°ë§ ì™„ë£Œ (ë§¤ì¹­ëœ ì‚¬ìš©ì ${matchedEmails.size}ëª…)`);
            
            // ê²€ìƒ‰ ì™„ë£Œ í›„ ëŒ€ê¸° ì¤‘ì¸ ì´ë©”ì¼ ê²€ìƒ‰ í”Œë˜ê·¸ ì œê±°
            if (window.pendingEmailSearch) {
                console.log(`ğŸ”„ ì´ë©”ì¼ ê²€ìƒ‰ í”Œë˜ê·¸ ì œê±°: ${window.pendingEmailSearch}`);
                delete window.pendingEmailSearch;
            }
        }

        // ë©¤ë²„ ì •ë ¬ ê¸°ëŠ¥
        let currentSortField = 'requests';
        let currentSortDirection = 'desc';

        function sortMembers(field) {
            const dataTable = document.querySelector('#members .data-table');
            const rows = Array.from(dataTable.querySelectorAll('.table-row'));
           
            // ì •ë ¬ ë°©í–¥ í† ê¸€
            if (currentSortField === field) {
                currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                currentSortField = field;
                currentSortDirection = 'asc';
            }
           
            // ì •ë ¬ í•¨ìˆ˜
            rows.sort((a, b) => {
                let aValue, bValue;
               
                switch(field) {
                    case 'name':
                        aValue = a.children[0].textContent.toLowerCase();
                        bValue = b.children[0].textContent.toLowerCase();
                        break;
                    case 'email':
                        aValue = a.children[1].textContent.toLowerCase();
                        bValue = b.children[1].textContent.toLowerCase();
                        break;
                    case 'requests':
                        aValue = parseInt(a.children[2].textContent.replace(/,/g, '')) || 0;
                        bValue = parseInt(b.children[2].textContent.replace(/,/g, '')) || 0;
                        break;
                    case 'spend':
                        aValue = parseFloat(a.children[3].textContent.replace('$', '')) || 0;
                        bValue = parseFloat(b.children[3].textContent.replace('$', '')) || 0;
                        break;
                    case 'role':
                        aValue = a.children[4].textContent.toLowerCase();
                        bValue = b.children[4].textContent.toLowerCase();
                        break;
                    default:
                        return 0;
                }
               
                if (currentSortDirection === 'asc') {
                    return aValue > bValue ? 1 : -1;
                } else {
                    return aValue < bValue ? 1 : -1;
                }
            });
           
            // ì •ë ¬ëœ í–‰ë“¤ì„ ë‹¤ì‹œ ì¶”ê°€
            rows.forEach(row => dataTable.appendChild(row));
           
            // í—¤ë” ì—…ë°ì´íŠ¸
            updateSortHeaders(field);
        }

        // ì •ë ¬ í—¤ë” ì—…ë°ì´íŠ¸
        function updateSortHeaders(field) {
            const headers = document.querySelectorAll('#members .table-header > div');
            headers.forEach((header, index) => {
                if (index < 5) { // ë§ˆì§€ë§‰ ë¹ˆ ì—´ ì œì™¸
                    const text = header.textContent.replace(/[â†‘â†“]/, '');
                    if (index === 0 && field === 'name') header.textContent = text + (currentSortDirection === 'asc' ? ' â†‘' : ' â†“');
                    else if (index === 1 && field === 'email') header.textContent = text + (currentSortDirection === 'asc' ? ' â†‘' : ' â†“');
                    else if (index === 2 && field === 'requests') header.textContent = text + (currentSortDirection === 'asc' ? ' â†‘' : ' â†“');
                    else if (index === 3 && field === 'spend') header.textContent = text + (currentSortDirection === 'asc' ? ' â†‘' : ' â†“');
                    else if (index === 4 && field === 'role') header.textContent = text + (currentSortDirection === 'asc' ? ' â†‘' : ' â†“');
                    else header.textContent = text + ' â†•';
                }
            });
        }

        // ê²€ìƒ‰ì°½ ì™¸ë¶€ í´ë¦­ ì‹œ ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ ìˆ¨ê¸°ê¸°
        document.addEventListener('click', function(e) {
            const autocompleteDropdowns = document.querySelectorAll('.autocomplete-dropdown');
            const searchContainers = document.querySelectorAll('.search-container');
            
            let clickedInsideSearch = false;
            searchContainers.forEach(container => {
                if (container.contains(e.target)) {
                    clickedInsideSearch = true;
                }
            });
            
            if (!clickedInsideSearch) {
                autocompleteDropdowns.forEach(dropdown => {
                    dropdown.style.display = 'none';
                });
            }
        });

        // ìµœì í™”ëœ í˜ì´ì§€ ì´ˆê¸°í™” (Progressive Loading)
        document.addEventListener('DOMContentLoaded', async function() {
            PerformanceMonitor.start('í˜ì´ì§€ ì „ì²´ ë¡œë“œ');
            console.log('ğŸš€ ìµœì í™”ëœ ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì‹œì‘');
           
            try {
                // 1ë‹¨ê³„: ì¦‰ì‹œ ìŠ¤ì¼ˆë ˆí†¤ UI í‘œì‹œ (0ms)
                SkeletonUI.show('overview');
                updatePerformanceIndicator('loading', 'UI ì´ˆê¸°í™”');
                console.log('ğŸ’€ ìŠ¤ì¼ˆë ˆí†¤ UI í‘œì‹œ ì™„ë£Œ');
               
                // 2ë‹¨ê³„: ê¸°ë³¸ UI ì´ˆê¸°í™” (ì¦‰ì‹œ)
                initOverviewStats();
               
                // Overview í•„í„° ê¸°ë³¸ê°’ì„ 30ì¼ë¡œ ì„¤ì •
                document.querySelectorAll('#overview .chart-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector('#overview .chart-btn[data-days="30"]').classList.add('active');
                
                // ì´ˆê¸° í•„í„° ê¸°ê°„ í‘œì‹œ ì„¤ì • (30ì¼)
                const initialDateRange = getDateRange(30);
                updateFilterPeriodDisplay(initialDateRange.startDate, initialDateRange.endDate);
               
                createOverviewChart(); // ë¹ˆ ì°¨íŠ¸ ë¨¼ì € í‘œì‹œ
                window.overviewChartInitialized = true; // ì°¨íŠ¸ ì´ˆê¸°í™” í”Œë˜ê·¸ ì„¤ì •
                
                // ê¸°ë³¸ ì°¨íŠ¸ íƒ­ í™œì„±í™” (ì¼ë³„ í™œë™ ì¶”ì´)
                switchChart('activity-trend');
               
                // 3ë‹¨ê³„: ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë°ì´í„° ë¡œë“œ ì‹œì‘ (ë¹„ë™ê¸°)
                console.log('ğŸ“¡ ë°±ê·¸ë¼ìš´ë“œ ë°ì´í„° ë¡œë“œ ì‹œì‘...');
               
                // ìºì‹œ í™•ì¸ ë° ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥í•œ ë°ì´í„°ê°€ ìˆë‹¤ë©´ ë¨¼ì € í‘œì‹œ
                if (DataCache.isValid('members') && DataCache.members) {
                    console.log('ğŸš€ ìºì‹œëœ ë©¤ë²„ ë°ì´í„°ë¡œ ì¦‰ì‹œ ê¸°ë³¸ UI ì—…ë°ì´íŠ¸');
                    updatePerformanceIndicator('cached', 'ìºì‹œ ì‚¬ìš©');
                    const totalMembers = DataCache.members.teamMembers?.length || 0;
                    updateStatsCards(totalMembers, 0, 0); // ê¸°ë³¸ê°’ìœ¼ë¡œ ë¨¼ì € í‘œì‹œ
                } else {
                    updatePerformanceIndicator('loading', 'API í˜¸ì¶œ');
                }
               
                // 4ë‹¨ê³„: ì‹¤ì œ API ë°ì´í„° ë¡œë“œ ë° ì—…ë°ì´íŠ¸
                await refreshAllRealData();
               
                // ì´ˆê¸° ë¡œë“œ ì™„ë£Œ í›„ ê¸°ë³¸ ì„ íƒ ìƒíƒœ ì„¤ì • (ì „ì²´ ë©¤ë²„)
                console.log('ì´ˆê¸° ë¡œë“œ ì™„ë£Œ í›„ ì „ì²´ ë©¤ë²„ ê¸°ë³¸ ì„ íƒ');
                document.querySelectorAll('.overview-stat-box').forEach(box => {
                    box.classList.remove('selected');
                });
                document.querySelector('.overview-stat-box[data-type="total"]').classList.add('selected');
                currentFilterType = 'total';
                
                // ë‚ ì§œ ì…ë ¥ í•„ë“œ ë³€ê²½ ì‹œ ìë™ ìƒˆë¡œê³ ì¹¨ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                setupAutoRefreshEvents();
                
                // ë‚ ì§œ ì…ë ¥ í•„ë“œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                setupDateInputEvents();
                
                // Overview ì„¹ì…˜ì„ ìµœì´ˆ ë°©ë¬¸í•œ ê²ƒìœ¼ë¡œ í‘œì‹œ
                sectionVisited.overview = true;
               
                const totalLoadTime = PerformanceMonitor.end('í˜ì´ì§€ ì „ì²´ ë¡œë“œ');
                updatePerformanceIndicator('ready', `${totalLoadTime}ms`);
                console.log('âœ… ìµœì í™”ëœ ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì™„ë£Œ!');
               
            } catch (error) {
                PerformanceMonitor.end('í˜ì´ì§€ ì „ì²´ ë¡œë“œ');
                updatePerformanceIndicator('error', error.message.substring(0, 20));
                console.error('âŒ ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
               
                // ì—ëŸ¬ ë°œìƒ ì‹œì—ë„ ê¸°ë³¸ UIëŠ” í‘œì‹œ
                const errorMessage = `
                    <div style="text-align: center; padding: 50px; color: #ff6b6b;">
                        <h3>âš ï¸ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</h3>
                        <p>${error.message}</p>
                        <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #4a9eff; color: white; border: none; border-radius: 4px; cursor: pointer;">
                            ìƒˆë¡œê³ ì¹¨
                        </button>
                    </div>
                `;
               
                const overviewSection = document.getElementById('overview');
                if (overviewSection) {
                    overviewSection.innerHTML = errorMessage;
                }
            }
        });

        // ìºì‹œ ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜ (ë²„íŠ¼ìš©)
        function forceCacheRefresh() {
            console.log('ğŸ—‘ï¸ ìºì‹œ ê°•ì œ ìƒˆë¡œê³ ì¹¨ ì‹œì‘');
            DataCache.clear();
            location.reload();
        }

        // Refresh ì‹¤í–‰ ìƒíƒœ ê´€ë¦¬ (ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€)
        let isRefreshInProgress = false;

        // ì§„í–‰ë°” ì œì–´ í•¨ìˆ˜ë“¤
        function showRefreshProgress() {
            const progressContainer = document.querySelector('.refresh-progress');
            const progressBar = document.querySelector('.refresh-progress-bar');
            if (progressContainer && progressBar) {
                progressContainer.style.display = 'block';
                progressBar.style.width = '0%';
            }
        }

        function updateRefreshProgress(percentage) {
            const progressBar = document.querySelector('.refresh-progress-bar');
            if (progressBar) {
                progressBar.style.width = percentage + '%';
            }
        }

        function hideRefreshProgress() {
            const progressContainer = document.querySelector('.refresh-progress');
            if (progressContainer) {
                progressContainer.style.display = 'none';
            }
        }

        // Refresh ë©”ë‰´ í´ë¦­ í•¸ë“¤ëŸ¬ (ì™„ì „ ë°±ê·¸ë¼ìš´ë“œ ë™ì‘)
        async function handleRefreshClick() {
            // ì´ë¯¸ refreshê°€ ì§„í–‰ ì¤‘ì´ë©´ ë¬´ì‹œ
            if (isRefreshInProgress) {
                console.log('ğŸ”„ Refresh ì´ë¯¸ ì§„í–‰ ì¤‘ - ìš”ì²­ ë¬´ì‹œ');
                return;
            }

            // ì§„í–‰ë°” í‘œì‹œ
            showRefreshProgress();
            
            // Refresh ì‹œì‘ (ì‚¬ìš©ìì—ê²ŒëŠ” ì•„ë¬´ ë³€í™” ì—†ìŒ)
            isRefreshInProgress = true;
            
            try {
                console.log('ğŸ”„ Refresh ì‹œì‘ - ë°±ê·¸ë¼ìš´ë“œ ë°ì´í„° ê°±ì‹  (ì‚¬ìš©ì í™”ë©´ ë³€í™” ì—†ìŒ)');
                
                // í˜„ì¬ í™œì„±í™”ëœ ì„¹ì…˜ í™•ì¸
                const activeSection = document.querySelector('.content-section.active');
                const activeSectionId = activeSection ? activeSection.id : 'overview';
                
                console.log(`í˜„ì¬ í™œì„± ì„¹ì…˜: ${activeSectionId}`);
                
                // ë°±ê·¸ë¼ìš´ë“œì—ì„œ ëª¨ë“  ë°ì´í„° ìƒˆë¡œê³ ì¹¨ (ë³‘ë ¬ ì²˜ë¦¬)
                console.log('ğŸ“¡ ë°±ê·¸ë¼ìš´ë“œ API ë°ì´í„° ë¡œë“œ ì‹œì‘...');
                
                // ì§„í–‰ë°” ë‹¨ê³„ë³„ ì—…ë°ì´íŠ¸
                updateRefreshProgress(20);
                await refreshOverviewData();
                updateRefreshProgress(50);
                await refreshMembersData();
                updateRefreshProgress(80);
                await refreshUsageData();
                updateRefreshProgress(90);
                
                // í˜„ì¬ ì„¹ì…˜ì´ í™œì„±í™”ë˜ì–´ ìˆë‹¤ë©´ í™”ë©´ ì—…ë°ì´íŠ¸
                await updateCurrentSectionDisplay(activeSectionId);
                updateRefreshProgress(100);
                
                console.log('âœ… Refresh ì™„ë£Œ - ëª¨ë“  ë°ì´í„°ê°€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ê°±ì‹ ë¨');
                
            } catch (error) {
                console.error('âŒ Refresh ì‹¤íŒ¨:', error);
                // ì—ëŸ¬ ë°œìƒ ì‹œì—ë„ ì‚¬ìš©ì í™”ë©´ì—ëŠ” ë³€í™” ì—†ìŒ (ì½˜ì†”ì—ë§Œ ë¡œê·¸)
            } finally {
                // ì§„í–‰ë°” ìˆ¨ê¸°ê¸°
                setTimeout(() => {
                    hideRefreshProgress();
                }, 500);
                
                // Refresh ì™„ë£Œ ìƒíƒœë¡œ ë³€ê²½
                isRefreshInProgress = false;
            }
        }

        // Overview ë°ì´í„° ë°±ê·¸ë¼ìš´ë“œ ìƒˆë¡œê³ ì¹¨
        async function refreshOverviewData() {
            try {
                console.log('ğŸ“Š Overview ë°ì´í„° ë°±ê·¸ë¼ìš´ë“œ ê°±ì‹  ì¤‘...');
                await updateOverviewWithRealData();
                console.log('âœ… Overview ë°ì´í„° ê°±ì‹  ì™„ë£Œ');
            } catch (error) {
                console.error('âŒ Overview ë°ì´í„° ê°±ì‹  ì‹¤íŒ¨:', error);
                throw error;
            }
        }

        // Members ë°ì´í„° ë°±ê·¸ë¼ìš´ë“œ ìƒˆë¡œê³ ì¹¨
        async function refreshMembersData() {
            try {
                console.log('ğŸ‘¥ Members ë°ì´í„° ë°±ê·¸ë¼ìš´ë“œ ê°±ì‹  ì¤‘...');
                await updateMembersWithRealData();
                console.log('âœ… Members ë°ì´í„° ê°±ì‹  ì™„ë£Œ');
            } catch (error) {
                console.error('âŒ Members ë°ì´í„° ê°±ì‹  ì‹¤íŒ¨:', error);
                throw error;
            }
        }

        // Usage ë°ì´í„° ë°±ê·¸ë¼ìš´ë“œ ìƒˆë¡œê³ ì¹¨ (í™”ë©´ ë³€í™” ì—†ì´ ìºì‹œë§Œ ê°±ì‹ )
        async function refreshUsageData() {
            try {
                console.log('ğŸ“ˆ Usage ë°ì´í„° ë°±ê·¸ë¼ìš´ë“œ ê°±ì‹  ì¤‘ (í™”ë©´ ë³€í™” ì—†ìŒ)...');
                
                // ë‚ ì§œ ë²”ìœ„ ê³„ì‚°
                const dateRange = getDateRange(30);
                
                // API ë°ì´í„°ë§Œ ê°€ì ¸ì™€ì„œ ìºì‹œì— ì €ì¥ (í™”ë©´ ì—…ë°ì´íŠ¸ ì—†ìŒ)
                const [membersData, eventsData, usageData, spendingData] = await Promise.all([
                    getTeamMembers(),
                    getFilteredEvents(dateRange.startDate, dateRange.endDate),
                    getUsageData(dateRange.startDate, dateRange.endDate),
                    getTeamSpendingData()
                ]);
                
                // ìºì‹œì—ë§Œ ì €ì¥í•˜ê³  í™”ë©´ì€ ì—…ë°ì´íŠ¸í•˜ì§€ ì•ŠìŒ
                console.log('ğŸ’¾ Usage ë°ì´í„°ë¥¼ ìºì‹œì— ì €ì¥ (í™”ë©´ ì—…ë°ì´íŠ¸ ì•ˆí•¨)');
                
                // ì „ì—­ ë³€ìˆ˜ì— ë°ì´í„° ì €ì¥ (í™”ë©´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë“¤ í˜¸ì¶œí•˜ì§€ ì•ŠìŒ)
                // ì´ë ‡ê²Œ í•˜ë©´ ë°ì´í„°ëŠ” ìµœì‹ ìœ¼ë¡œ ìœ ì§€ë˜ì§€ë§Œ í™”ë©´ì€ ë³€ê²½ë˜ì§€ ì•ŠìŒ
                
                console.log('âœ… Usage ë°ì´í„° ë°±ê·¸ë¼ìš´ë“œ ê°±ì‹  ì™„ë£Œ (ìºì‹œë§Œ ì—…ë°ì´íŠ¸)');
            } catch (error) {
                console.error('âŒ Usage ë°ì´í„° ê°±ì‹  ì‹¤íŒ¨:', error);
                throw error;
            }
        }

        // í˜„ì¬ ì„¹ì…˜ í™”ë©´ ì—…ë°ì´íŠ¸ (ë°±ê·¸ë¼ìš´ë“œ ê°±ì‹  í›„)
        async function updateCurrentSectionDisplay(activeSectionId) {
            try {
                console.log(`ğŸ–¥ï¸ í˜„ì¬ ì„¹ì…˜ í™”ë©´ ì—…ë°ì´íŠ¸: ${activeSectionId}`);
                switch(activeSectionId) {
                    case 'overview':
                        await updateOverviewWithCurrentFilter();
                        break;
                    case 'members':
                        // MembersëŠ” ì´ë¯¸ refreshMembersData()ì—ì„œ ê°±ì‹ ë¨
                        // ì¶”ê°€ í™”ë©´ ì—…ë°ì´íŠ¸ ì—†ìŒ
                        break;
                    case 'usage':
                        // UsageëŠ” ë°±ê·¸ë¼ìš´ë“œì—ì„œë§Œ ë°ì´í„° ê°±ì‹ ë¨
                        // í™”ë©´ ì—…ë°ì´íŠ¸ í•˜ì§€ ì•ŠìŒ (ì‚¬ìš©ìê°€ ë³´ê³  ìˆëŠ” í™”ë©´ ìœ ì§€)
                        console.log('Usage ì„¹ì…˜: í™”ë©´ ì—…ë°ì´íŠ¸ ì•ˆí•¨ (ë°±ê·¸ë¼ìš´ë“œ ê°±ì‹ ë§Œ)');
                        break;
                    case 'settings':
                        // SettingsëŠ” ë³„ë„ API ë°ì´í„°ê°€ ì—†ìŒ
                        break;
                }
                console.log(`âœ… ${activeSectionId} ì„¹ì…˜ í™”ë©´ ì—…ë°ì´íŠ¸ ì™„ë£Œ`);
            } catch (error) {
                console.error(`âŒ ${activeSectionId} ì„¹ì…˜ í™”ë©´ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:`, error);
            }
        }

        // ìë™ ìƒˆë¡œê³ ì¹¨ ì´ë²¤íŠ¸ ì„¤ì •
        function setupAutoRefreshEvents() {
            console.log('ìë™ ìƒˆë¡œê³ ì¹¨ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì¤‘...');
            
            // Overview ë‚ ì§œ ì…ë ¥ í•„ë“œ
            const overviewStartDate = document.getElementById('start-date');
            const overviewEndDate = document.getElementById('end-date');
            
            if (overviewStartDate && overviewEndDate) {
                overviewStartDate.addEventListener('change', debounce(async () => {
                    if (overviewStartDate.value && overviewEndDate.value) {
                        console.log('Overview ì‹œì‘ ë‚ ì§œ ë³€ê²½ë¨ - ìë™ ìƒˆë¡œê³ ì¹¨');
                        await applyDateFilter();
                    }
                }, 500));
                
                overviewEndDate.addEventListener('change', debounce(async () => {
                    if (overviewStartDate.value && overviewEndDate.value) {
                        console.log('Overview ì¢…ë£Œ ë‚ ì§œ ë³€ê²½ë¨ - ìë™ ìƒˆë¡œê³ ì¹¨');
                        await applyDateFilter();
                    }
                }, 500));
            }
            
            // Usage ë‚ ì§œ ì…ë ¥ í•„ë“œ
            const usageStartDate = document.getElementById('usage-start-date');
            const usageEndDate = document.getElementById('usage-end-date');
            
            if (usageStartDate && usageEndDate) {
                usageStartDate.addEventListener('change', debounce(async () => {
                    if (usageStartDate.value && usageEndDate.value) {
                        console.log('Usage ì‹œì‘ ë‚ ì§œ ë³€ê²½ë¨ - ìë™ ìƒˆë¡œê³ ì¹¨');
                        await applyUsageDateFilter();
                    }
                }, 500));
                
                usageEndDate.addEventListener('change', debounce(async () => {
                    if (usageStartDate.value && usageEndDate.value) {
                        console.log('Usage ì¢…ë£Œ ë‚ ì§œ ë³€ê²½ë¨ - ìë™ ìƒˆë¡œê³ ì¹¨');
                        await applyUsageDateFilter();
                    }
                }, 500));
            }
            
            console.log('ìë™ ìƒˆë¡œê³ ì¹¨ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì™„ë£Œ');
        }

        // ë‚ ì§œ ì…ë ¥ í•„ë“œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ì„¤ì •
        function setupDateInputEvents() {
            console.log('ë‚ ì§œ ì…ë ¥ í•„ë“œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì¤‘...');
            
            // Overview ë‚ ì§œ ì…ë ¥ í•„ë“œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
            const overviewStartDate = document.getElementById('start-date');
            const overviewEndDate = document.getElementById('end-date');
            
            if (overviewStartDate && overviewEndDate) {
                // ì‹œì‘ ë‚ ì§œ ë³€ê²½ ì‹œ ì¦‰ì‹œ ë²”ìœ„ í‘œì‹œ ì—…ë°ì´íŠ¸
                overviewStartDate.addEventListener('input', () => {
                    if (overviewStartDate.value && overviewEndDate.value) {
                        const startDate = new Date(overviewStartDate.value).getTime();
                        const endDate = new Date(overviewEndDate.value).getTime() + (24 * 60 * 60 * 1000 - 1);
                        updateFilterPeriodDisplay(startDate, endDate);
                    }
                });
                
                // ì¢…ë£Œ ë‚ ì§œ ë³€ê²½ ì‹œ ì¦‰ì‹œ ë²”ìœ„ í‘œì‹œ ì—…ë°ì´íŠ¸
                overviewEndDate.addEventListener('input', () => {
                    if (overviewStartDate.value && overviewEndDate.value) {
                        const startDate = new Date(overviewStartDate.value).getTime();
                        const endDate = new Date(overviewEndDate.value).getTime() + (24 * 60 * 60 * 1000 - 1);
                        updateFilterPeriodDisplay(startDate, endDate);
                    }
                });
            }
            
            // Usage ë‚ ì§œ ì…ë ¥ í•„ë“œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
            const usageStartDate = document.getElementById('usage-start-date');
            const usageEndDate = document.getElementById('usage-end-date');
            
            if (usageStartDate && usageEndDate) {
                // ì‹œì‘ ë‚ ì§œ ë³€ê²½ ì‹œ ì¦‰ì‹œ ë²”ìœ„ í‘œì‹œ ì—…ë°ì´íŠ¸
                usageStartDate.addEventListener('input', () => {
                    if (usageStartDate.value && usageEndDate.value) {
                        const startDate = new Date(usageStartDate.value).getTime();
                        const endDate = new Date(usageEndDate.value).getTime() + (24 * 60 * 60 * 1000 - 1);
                        updateUsageFilterPeriodDisplay(startDate, endDate);
                    }
                });
                
                // ì¢…ë£Œ ë‚ ì§œ ë³€ê²½ ì‹œ ì¦‰ì‹œ ë²”ìœ„ í‘œì‹œ ì—…ë°ì´íŠ¸
                usageEndDate.addEventListener('input', () => {
                    if (usageStartDate.value && usageEndDate.value) {
                        const startDate = new Date(usageStartDate.value).getTime();
                        const endDate = new Date(usageEndDate.value).getTime() + (24 * 60 * 60 * 1000 - 1);
                        updateUsageFilterPeriodDisplay(startDate, endDate);
                    }
                });
            }
            
            console.log('ë‚ ì§œ ì…ë ¥ í•„ë“œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì™„ë£Œ');
        }

        // ë””ë°”ìš´ìŠ¤ í•¨ìˆ˜ (ì—°ì† í˜¸ì¶œ ë°©ì§€)
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }



        // Email Report ì„¤ì • - ì§ì ‘ ì…ë ¥ ì²´í¬ë°•ìŠ¤ í† ê¸€ í•¨ìˆ˜
        function toggleCustomEmailInput(checkbox) {
            const customEmailInput = document.getElementById('custom-email-input');
            if (checkbox.checked) {
                customEmailInput.style.display = 'block';
                console.log('ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ ì˜ì—­ì´ í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤.');
            } else {
                customEmailInput.style.display = 'none';
                console.log('ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ ì˜ì—­ì´ ìˆ¨ê²¨ì¡ŒìŠµë‹ˆë‹¤.');
            }
            updateRecipientCount();
        }

        // ìˆ˜ì‹ ì ìˆ˜ ê³„ì‚° ë° ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateRecipientCount() {
            let totalCount = 0;
            const adminCheckbox = document.getElementById('admin-checkbox');
            const allMembersCheckbox = document.getElementById('all-members-checkbox');
            const inactiveMembersCheckbox = document.getElementById('inactive-members-checkbox');
            const customEmailCheckbox = document.getElementById('custom-email-checkbox');
            const customEmails = document.getElementById('custom-emails');
            
            // ê´€ë¦¬ì ìˆ˜ ê³„ì‚°
            if (adminCheckbox && adminCheckbox.checked) {
                const adminCount = originalMembersData ? originalMembersData.filter(member => member.role === 'owner').length : 0;
                totalCount += adminCount;
            }
            
            // ì „ì²´ ë©¤ë²„ ìˆ˜ ê³„ì‚°
            if (allMembersCheckbox && allMembersCheckbox.checked) {
                const allMembersCount = originalMembersData ? originalMembersData.length : 0;
                totalCount += allMembersCount;
            }
            
            // ë¹„í™œì„± ë©¤ë²„ ìˆ˜ ê³„ì‚°
            if (inactiveMembersCheckbox && inactiveMembersCheckbox.checked) {
                const inactiveCount = originalMembersData ? originalMembersData.filter(member => member.spendData.premiumRequests === 0).length : 0;
                totalCount += inactiveCount;
            }
            
            // ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ ìˆ˜ ê³„ì‚°
            if (customEmailCheckbox && customEmailCheckbox.checked && customEmails && customEmails.value.trim()) {
                const emailList = customEmails.value.split(',').filter(email => email.trim().length > 0);
                totalCount += emailList.length;
            }
            
            // ìˆ˜ì‹ ì ìˆ˜ í‘œì‹œ ì—…ë°ì´íŠ¸
            const recipientCountElement = document.getElementById('recipient-count');
            if (recipientCountElement) {
                recipientCountElement.textContent = totalCount;
            }
            
            console.log(`ìˆ˜ì‹ ì ìˆ˜ ì—…ë°ì´íŠ¸: ${totalCount}ëª…`);
        }

        // Email Report ì„¤ì • - ë©”ì‹œì§€ ê¸€ì ìˆ˜ ì¹´ìš´í„° í•¨ìˆ˜
        function updateMessageCharCount() {
            const messageInput = document.getElementById('email-report-message');
            const charCount = document.getElementById('report-message-char-count');
            
            if (messageInput && charCount) {
                const maxLength = 1000;
                const currentLength = messageInput.value.length;
                
                // ê¸€ì ìˆ˜ ì—…ë°ì´íŠ¸
                charCount.textContent = currentLength;
                
                // ê¸€ì ìˆ˜ ì œí•œ
                if (currentLength > maxLength) {
                    messageInput.value = messageInput.value.substring(0, maxLength);
                    charCount.textContent = maxLength;
                }
                
                // ê¸€ì ìˆ˜ì— ë”°ë¥¸ ìƒ‰ìƒ ë³€ê²½
                if (currentLength >= maxLength * 0.9) {
                    charCount.style.color = '#ff9800'; // ê²½ê³  ìƒ‰ìƒ (90% ì´ìƒ)
                } else if (currentLength >= maxLength * 0.8) {
                    charCount.style.color = '#ff9800'; // ì£¼ì˜ ìƒ‰ìƒ (80% ì´ìƒ)
                } else {
                    charCount.style.color = '#7a7a7a'; // ê¸°ë³¸ ìƒ‰ìƒ
                }
            }
        }

        // ë©”ì‹œì§€ ì…ë ¥ë€ ë™ê¸°í™” í•¨ìˆ˜
        function syncMessageInputs(sourceId) {
            const emailReportMessage = document.getElementById('email-report-message');
            const emailMessageInput = document.getElementById('email-message-input');
            
            if (sourceId === 'email-report-message' && emailReportMessage && emailMessageInput) {
                // Email Report í…Œì´ë¸”ì˜ ì…ë ¥ë€ì—ì„œ ìˆ˜ì‹ ì ë³´ê¸° íŒì—…ì˜ ì…ë ¥ë€ìœ¼ë¡œ ë™ê¸°í™”
                emailMessageInput.value = emailReportMessage.value;
                
                // íŒì—…ì˜ ê¸€ì ìˆ˜ ì¹´ìš´í„°ë„ ì—…ë°ì´íŠ¸
                const popupCharCount = document.getElementById('message-char-count');
                if (popupCharCount) {
                    popupCharCount.textContent = emailReportMessage.value.length;
                }
                
                console.log('ë©”ì‹œì§€ ë™ê¸°í™”: Email Report â†’ ìˆ˜ì‹ ì ë³´ê¸° íŒì—…');
            } else if (sourceId === 'email-message-input' && emailMessageInput && emailReportMessage) {
                // ìˆ˜ì‹ ì ë³´ê¸° íŒì—…ì˜ ì…ë ¥ë€ì—ì„œ Email Report í…Œì´ë¸”ì˜ ì…ë ¥ë€ìœ¼ë¡œ ë™ê¸°í™”
                emailReportMessage.value = emailMessageInput.value;
                
                // Email Reportì˜ ê¸€ì ìˆ˜ ì¹´ìš´í„°ë„ ì—…ë°ì´íŠ¸
                updateMessageCharCount();
                
                console.log('ë©”ì‹œì§€ ë™ê¸°í™”: ìˆ˜ì‹ ì ë³´ê¸° íŒì—… â†’ Email Report');
            }
        }

        // ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ ë³´ê¸° í•¨ìˆ˜
        function showEmailScheduleList() {
            // ê¸°ì¡´ ëª¨ë‹¬ì´ ìˆìœ¼ë©´ ì œê±°
            const existingModal = document.getElementById('email-schedule-modal');
            if (existingModal) {
                existingModal.remove();
            }

            // ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ ë°ì´í„° (ì €ì¥ëœ ì˜ˆì•½ë§Œ í‘œì‹œ)
            let scheduleList = [];
            
            // ì €ì¥ëœ ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ê°€ ìˆìœ¼ë©´ ì¶”ê°€ (ê¸°ì¡´ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ í¬í•¨)
            if (window.emailScheduleList && window.emailScheduleList.length > 0) {
                // ê¸°ì¡´ ë°ì´í„°ì— currentSend í•„ë“œê°€ ì—†ëŠ” ê²½ìš° ì¶”ê°€ ë° ì‹œê°„ ê°±ì‹ 
                const migratedScheduleList = window.emailScheduleList.map(schedule => {
                    if (!schedule.currentSend) {
                        // currentSendê°€ ì—†ìœ¼ë©´ nextSendë¥¼ currentSendë¡œ ë³µì‚¬í•˜ê³  ìƒˆë¡œìš´ nextSend ê³„ì‚°
                        schedule.currentSend = schedule.nextSend;
                        const frequency = getFrequencyValue(schedule.frequency);
                        if (frequency) {
                            schedule.nextSend = calculateNextSendTimeFromCurrent(schedule.currentSend, frequency);
                        }
                        console.log(`ğŸ“‹ ê¸°ì¡´ ì˜ˆì•½ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜: ${schedule.title}`);
                    }
                    
                    // ì‹œê°„ ê°±ì‹ : ì´ë²ˆ ë°œì†¡ ì‹œê°„ì´ ê³¼ê±°ì¸ ê²½ìš° ê°±ì‹ 
                    updateScheduleTimeIfNeeded(schedule);
                    
                    return schedule;
                });
                scheduleList = scheduleList.concat(migratedScheduleList);
            }

            // ëª¨ë‹¬ HTML ìƒì„±
            const modalHTML = `
                <div id="email-schedule-modal" style="
                    display: block;
                    position: fixed;
                    z-index: 1000;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0,0,0,0.7);
                ">
                    <div style="
                        background-color: #2a2a2a;
                        margin: 5% auto;
                        padding: 25px;
                        border-radius: 8px;
                        width: 90%;
                        max-width: 800px;
                        box-shadow: 0 4px 20px rgba(0,0,0,0.5);
                        max-height: 85vh;
                        overflow-y: auto;
                        border: 1px solid #3a3a3a;
                    ">
                        <!-- ëª¨ë‹¬ í—¤ë” -->
                        <div style="
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            margin-bottom: 25px;
                            padding-bottom: 15px;
                            border-bottom: 1px solid #3a3a3a;
                        ">
                            <div style="color: #fff; font-size: 18px; font-weight: 600;">ë©”ì¼ ë°œì†¡ ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸</div>
                            <button onclick="closeEmailScheduleModal()" style="
                                background: none;
                                border: none;
                                color: #7a7a7a;
                                font-size: 20px;
                                cursor: pointer;
                                padding: 5px;
                                border-radius: 3px;
                                transition: color 0.2s ease;
                            " onmouseover="this.style.color='#fff'" onmouseout="this.style.color='#7a7a7a'">Ã—</button>
                        </div>

                        <!-- ê²€ìƒ‰ ë° í•„í„° -->
                        <div style="margin-bottom: 20px;">
                            <div style="
                                position: relative;
                                display: flex;
                                align-items: center;
                                background-color: #1a1a1a;
                                border: 1px solid #3a3a3a;
                                border-radius: 4px;
                                padding: 0 12px;
                                transition: all 0.2s ease;
                                margin-bottom: 15px;
                            " onfocus="this.style.backgroundColor='#2a2a2a'; this.style.borderColor='#4a9eff'" onblur="this.style.backgroundColor='#1a1a1a'; this.style.borderColor='#3a3a3a'">
                                <span style="
                                    color: #7a7a7a;
                                    margin-right: 8px;
                                    font-size: 14px;
                                ">ğŸ”</span>
                                <input 
                                    type="text" 
                                    id="schedule-search" 
                                    placeholder="ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ ê²€ìƒ‰..."
                                    style="
                                        flex: 1;
                                        padding: 10px 0;
                                        border: none;
                                        background: transparent;
                                        color: #e1e1e1;
                                        font-size: 14px;
                                        outline: none;
                                    "
                                >
                            </div>
                            
                            <!-- í•„í„° ë²„íŠ¼ -->
                            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                                <button class="analytics-btn" onclick="deleteAllSchedules()">ì „ì²´ ì‚­ì œ</button>
                                <button class="chart-btn active" data-filter="all" onclick="filterScheduleList('all')">ì „ì²´</button>
                                <button class="chart-btn" data-filter="active" onclick="filterScheduleList('active')">í™œì„±</button>
                                <button class="chart-btn" data-filter="inactive" onclick="filterScheduleList('inactive')">ë¹„í™œì„±</button>
                            </div>
                        </div>

                        <!-- ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ í…Œì´ë¸” -->
                        <div style="
                            background-color: #1a1a1a;
                            border-radius: 4px;
                            overflow: hidden;
                            margin-bottom: 20px;
                        ">
                            <!-- í…Œì´ë¸” í—¤ë” -->
                            <div style="
                                display: grid;
                                grid-template-columns: 2fr 1fr 1.2fr 1.2fr 1.5fr 0.8fr 0.8fr 0.8fr;
                                gap: 15px;
                                padding: 15px;
                                border-bottom: 1px solid #3a3a3a;
                                font-weight: 600;
                                color: #fff;
                                font-size: 14px;
                            ">
                                <div>ì œëª©</div>
                                <div>ì£¼ê¸°</div>
                                <div>ì´ë²ˆ ë°œì†¡</div>
                                <div>ë‹¤ìŒ ë°œì†¡</div>
                                <div>ìˆ˜ì‹ ì</div>
                                <div>í™œì„±</div>
                                <div>ë¹„í™œì„±</div>
                                <div>ì‚­ì œ</div>
                            </div>

                            <!-- í…Œì´ë¸” ë‚´ìš© -->
                            <div id="schedule-list-content">
                                ${scheduleList.map(item => `
                                    <div class="schedule-item" data-status="${item.status}" style="
                                        display: grid;
                                        grid-template-columns: 2fr 1fr 1.2fr 1.2fr 1.5fr 0.8fr 0.8fr 0.8fr;
                                        gap: 15px;
                                        padding: 15px;
                                        border-bottom: 1px solid #3a3a3a;
                                        color: #e1e1e1;
                                        font-size: 14px;
                                        transition: background-color 0.2s ease;
                                    " onmouseover="this.style.backgroundColor='#3a3a3a'" onmouseout="this.style.backgroundColor='transparent'">
                                        <div style="cursor: pointer;" onclick="showScheduleDetail(${item.id})">
                                            <div style="font-weight: 600; color: #fff; margin-bottom: 5px;">${item.title}</div>
                                            <div style="color: #7a7a7a; font-size: 12px;">${item.message}</div>
                                        </div>
                                        <div>${item.frequency}</div>
                                        <div style="color: #ff9800; font-weight: 600;">${item.currentSend || item.nextSend}</div>
                                        <div style="color: #7a7a7a;">${item.nextSend}</div>
                                        <div>${item.recipients}</div>
                                        <div style="text-align: center;">
                                            <input type="radio" name="status-${item.id}" value="active" ${item.status === 'í™œì„±' ? 'checked' : ''} 
                                                   onchange="updateScheduleStatus(${item.id}, 'í™œì„±')" style="
                                                width: 16px;
                                                height: 16px;
                                                accent-color: #4a9eff;
                                            ">
                                        </div>
                                        <div style="text-align: center;">
                                            <input type="radio" name="status-${item.id}" value="inactive" ${item.status === 'ë¹„í™œì„±' ? 'checked' : ''} 
                                                   onchange="updateScheduleStatus(${item.id}, 'ë¹„í™œì„±')" style="
                                                width: 16px;
                                                height: 16px;
                                                accent-color: #4a9eff;
                                            ">
                                        </div>
                                        <div style="text-align: center;">
                                            <button onclick="deleteSchedule(${item.id})" style="
                                                background: none;
                                                border: none;
                                                color: #ff4757;
                                                cursor: pointer;
                                                padding: 4px;
                                                font-size: 16px;
                                                font-weight: bold;
                                            ">Ã—</button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <!-- í•˜ë‹¨ ë²„íŠ¼ -->
                        <div style="display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #3a3a3a; padding-top: 20px;">
                            <div style="color: #7a7a7a; font-size: 14px;">
                                ì´ ${scheduleList.length}ê°œì˜ ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button class="analytics-btn" onclick="addNewSchedule()">ìƒˆ ì˜ˆì•½ ì¶”ê°€</button>
                                <button class="chart-btn" onclick="closeEmailScheduleModal()">ë‹«ê¸°</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // ëª¨ë‹¬ì„ í˜ì´ì§€ì— ì¶”ê°€
            document.body.insertAdjacentHTML('beforeend', modalHTML);

            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
            document.getElementById('email-schedule-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeEmailScheduleModal();
                }
            });

            // ê²€ìƒ‰ ê¸°ëŠ¥ ì¶”ê°€
            setTimeout(() => {
                const searchInput = document.getElementById('schedule-search');
                if (searchInput) {
                    searchInput.addEventListener('input', function() {
                        const searchTerm = this.value.toLowerCase();
                        const scheduleItems = document.querySelectorAll('#email-schedule-modal .schedule-item');
                        
                        scheduleItems.forEach(item => {
                            const text = item.textContent.toLowerCase();
                            if (text.includes(searchTerm)) {
                                item.style.display = 'grid';
                            } else {
                                item.style.display = 'none';
                            }
                        });
                    });
                }
            }, 100);
        }

        // ìˆ˜ì‹ ì ë³´ê¸° í•¨ìˆ˜
        function showEmailRecipients() {
            // ê¸°ì¡´ ëª¨ë‹¬ì´ ìˆìœ¼ë©´ ì œê±°
            const existingModal = document.getElementById('email-recipients-modal');
            if (existingModal) {
                existingModal.remove();
            }

            // í˜„ì¬ ì„¤ì • ê°’ë“¤ ìˆ˜ì§‘
            const frequency = document.getElementById('email-frequency-select');
            const timeInput = document.getElementById('email-time-input');
            
            const frequencyText = frequency ? frequency.options[frequency.selectedIndex].text : 'ë§¤ì£¼';
            
            // ì‹œê°„ ì…ë ¥ ì²˜ë¦¬
            let timeText = 'ì˜¤ì „ 9ì‹œ 00ë¶„';
            if (timeInput && timeInput.value) {
                const [hours, minutes] = timeInput.value.split(':');
                const hour = parseInt(hours);
                const minute = parseInt(minutes);
                
                if (hour < 12) {
                    timeText = `ì˜¤ì „ ${hour}ì‹œ ${minute.toString().padStart(2, '0')}ë¶„`;
                } else if (hour === 12) {
                    timeText = `ì˜¤í›„ 12ì‹œ ${minute.toString().padStart(2, '0')}ë¶„`;
                } else {
                    timeText = `ì˜¤í›„ ${hour - 12}ì‹œ ${minute.toString().padStart(2, '0')}ë¶„`;
                }
            }

            // ì„ íƒëœ ìˆ˜ì‹ ì ê·¸ë£¹ í™•ì¸ ë° ì‹¤ì œ ë©¤ë²„ ë°ì´í„° ìˆ˜ì§‘
            const selectedGroups = [];
            const adminCheckbox = document.getElementById('admin-checkbox');
            const allMembersCheckbox = document.getElementById('all-members-checkbox');
            const inactiveMembersCheckbox = document.getElementById('inactive-members-checkbox');
            const customEmailCheckbox = document.getElementById('custom-email-checkbox');
            
            let allRecipients = [];
            
            // ê´€ë¦¬ì ìˆ˜ì§‘
            if (adminCheckbox && adminCheckbox.checked) {
                const admins = originalMembersData ? originalMembersData.filter(member => member.role === 'owner') : [];
                allRecipients = allRecipients.concat(admins);
                selectedGroups.push('ê´€ë¦¬ì');
                console.log(`ê´€ë¦¬ì ${admins.length}ëª… ì¶”ê°€`);
            }
            
            // ì „ì²´ ë©¤ë²„ ìˆ˜ì§‘
            if (allMembersCheckbox && allMembersCheckbox.checked) {
                const allMembers = originalMembersData ? [...originalMembersData] : [];
                allRecipients = allRecipients.concat(allMembers);
                selectedGroups.push('ì „ì²´ ë©¤ë²„');
                console.log(`ì „ì²´ ë©¤ë²„ ${allMembers.length}ëª… ì¶”ê°€`);
            }
            
            // ë¹„í™œì„± ë©¤ë²„ ìˆ˜ì§‘
            if (inactiveMembersCheckbox && inactiveMembersCheckbox.checked) {
                const inactiveMembers = originalMembersData ? originalMembersData.filter(member => member.spendData.premiumRequests === 0) : [];
                allRecipients = allRecipients.concat(inactiveMembers);
                selectedGroups.push('ë¹„í™œì„± ë©¤ë²„');
                console.log(`ë¹„í™œì„± ë©¤ë²„ ${inactiveMembers.length}ëª… ì¶”ê°€`);
            }
            
            // ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ í™•ì¸
            const customEmails = document.getElementById('custom-emails');
            const customEmailList = customEmails && customEmails.value.trim() ? customEmails.value.trim() : '';
            
            if (customEmailCheckbox && customEmailCheckbox.checked && customEmailList) {
                const emailList = customEmailList.split(',').filter(email => email.trim().length > 0);
                emailList.forEach(email => {
                    allRecipients.push({
                        name: 'ì§ì ‘ ì…ë ¥',
                        email: email.trim(),
                        role: 'custom',
                        spendData: { premiumRequests: 0, spend: 0 }
                    });
                });
                selectedGroups.push('ì§ì ‘ ì…ë ¥');
                console.log(`ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ ${emailList.length}ê°œ ì¶”ê°€`);
            }
            
            // ì¤‘ë³µ ì œê±° (ì´ë©”ì¼ ê¸°ì¤€)
            const uniqueRecipients = [];
            const seenEmails = new Set();
            allRecipients.forEach(recipient => {
                if (!seenEmails.has(recipient.email)) {
                    seenEmails.add(recipient.email);
                    uniqueRecipients.push(recipient);
                }
            });
            
            console.log(`ì´ ${uniqueRecipients.length}ëª…ì˜ ê³ ìœ  ìˆ˜ì‹ ì ìˆ˜ì§‘ ì™„ë£Œ`);

            // ëª¨ë‹¬ HTML ìƒì„±
            const modalHTML = `
                <div id="email-recipients-modal" style="
                    display: block;
                    position: fixed;
                    z-index: 1000;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0,0,0,0.7);
                ">
                    <div style="
                        background-color: #2a2a2a;
                        margin: 5% auto;
                        padding: 25px;
                        border-radius: 8px;
                        width: 90%;
                        max-width: 700px;
                        box-shadow: 0 4px 20px rgba(0,0,0,0.5);
                        max-height: 85vh;
                        overflow-y: auto;
                        border: 1px solid #3a3a3a;
                    ">
                        <!-- ëª¨ë‹¬ í—¤ë” -->
                        <div style="
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            margin-bottom: 25px;
                            padding-bottom: 15px;
                            border-bottom: 1px solid #3a3a3a;
                        ">
                            <div style="color: #fff; font-size: 18px; font-weight: 600;">ìˆ˜ì‹ ì ë¯¸ë¦¬ë³´ê¸°</div>
                            <button onclick="closeEmailRecipientsModal()" style="
                                background: none;
                                border: none;
                                color: #7a7a7a;
                                font-size: 20px;
                                cursor: pointer;
                                padding: 5px;
                                border-radius: 3px;
                                transition: color 0.2s ease;
                            " onmouseover="this.style.color='#fff'" onmouseout="this.style.color='#7a7a7a'">Ã—</button>
                        </div>

                        <!-- ë°œì†¡ ì„¤ì • -->
                        <div style="margin-bottom: 25px;">
                            <div style="color: #fff; font-size: 16px; font-weight: 600; margin-bottom: 15px;">ë°œì†¡ ì„¤ì •</div>
                            <div style="
                                color: #b1b1b1;
                                font-size: 14px;
                                line-height: 1.6;
                            ">
                                <div style="
                                    margin-bottom: 8px;
                                    padding: 8px 12px;
                                    border: 1px solid #3a3a3a;
                                    border-radius: 4px;
                                    background-color: transparent;
                                ">â€¢ ì£¼ê¸°: <span style="color: #ff9800;">${frequencyText}</span></div>
                                <div style="
                                    margin-bottom: 8px;
                                    padding: 8px 12px;
                                    border: 1px solid #3a3a3a;
                                    border-radius: 4px;
                                    background-color: transparent;
                                ">â€¢ ì‹œê°„: <span style="color: #ff9800;">${timeText}</span></div>

                            </div>
                        </div>

                        <!-- ë°œì†¡ ë©”ì‹œì§€ -->
                        <div style="margin-bottom: 25px;">
                            <div style="color: #fff; font-size: 16px; font-weight: 600; margin-bottom: 15px;">ë°œì†¡ ë©”ì‹œì§€</div>
                            <div style="
                                position: relative;
                                background-color: #1a1a1a;
                                border: 1px solid #3a3a3a;
                                border-radius: 4px;
                                transition: all 0.2s ease;
                            ">
                                <textarea 
                                    id="email-message-input" 
                                    placeholder="ì´ë©”ì¼ì— í¬í•¨ë  ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
                                    style="
                                        width: 100%;
                                        height: 120px;
                                        padding: 12px;
                                        border: none;
                                        background: transparent;
                                        color: #ff9800;
                                        font-size: 14px;
                                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                                        line-height: 1.5;
                                        outline: none;
                                        resize: vertical;
                                        min-height: 120px;
                                        max-height: 200px;
                                    "
                                    onfocus="this.parentElement.style.backgroundColor='#2a2a2a'; this.parentElement.style.borderColor='#4a9eff'"
                                    onblur="this.parentElement.style.backgroundColor='#1a1a1a'; this.parentElement.style.borderColor='#3a3a3a'"
                                    oninput="syncMessageInputs('email-message-input')"
                                ></textarea>
                            </div>
                            <div style="
                                color: #7a7a7a;
                                font-size: 12px;
                                margin-top: 5px;
                                text-align: right;
                            ">
                                <span id="message-char-count">0</span>/1000 ê¸€ì
                            </div>
                        </div>

                        <!-- ìˆ˜ì‹ ì ê·¸ë£¹ -->
                        <div style="margin-bottom: 25px;">
                            <div style="color: #fff; font-size: 16px; font-weight: 600; margin-bottom: 15px;">ìˆ˜ì‹ ì ê·¸ë£¹</div>
                            
                            <!-- ìˆ˜ì‹ ì ê²€ìƒ‰ ì°½ -->
                            <div style="margin-bottom: 20px; position: relative;">
                                <div style="
                                    position: relative;
                                    display: flex;
                                    align-items: center;
                                    background-color: #1a1a1a;
                                    border: 1px solid #3a3a3a;
                                    border-radius: 4px;
                                    padding: 0 12px;
                                    transition: all 0.2s ease;
                                " onfocus="this.style.backgroundColor='#2a2a2a'; this.style.borderColor='#4a9eff'" onblur="this.style.backgroundColor='#1a1a1a'; this.style.borderColor='#3a3a3a'">
                                    <span style="
                                        color: #7a7a7a;
                                        margin-right: 8px;
                                        font-size: 14px;
                                    ">ğŸ”</span>
                                    <input 
                                        type="text" 
                                        id="recipient-search" 
                                        placeholder="ìˆ˜ì‹ ì ê²€ìƒ‰..."
                                        style="
                                            flex: 1;
                                            padding: 10px 0;
                                            border: none;
                                            background: transparent;
                                            color: #e1e1e1;
                                            font-size: 14px;
                                            outline: none;
                                        "
                                    >
                                    <button 
                                        id="clear-search" 
                                        onclick="clearRecipientSearch()"
                                        style="
                                            background: none;
                                            border: none;
                                            color: #7a7a7a;
                                            cursor: pointer;
                                            padding: 4px;
                                            font-size: 16px;
                                            margin-left: 8px;
                                            display: none;
                                        "
                                        onmouseover="this.style.color='#fff'" 
                                        onmouseout="this.style.color='#7a7a7a'"
                                    >Ã—</button>
                                </div>
                            </div>

                            ${generateRecipientGroups(selectedGroups, customEmailList)}
                            
                            <!-- ì´ ìˆ˜ì‹ ì ìˆ˜ í‘œì‹œ -->
                            <div style="
                                margin-top: 20px;
                                padding: 15px;
                                background-color: #1a1a1a;
                                border-radius: 4px;
                                border: 1px solid #3a3a3a;
                            ">
                                <div style="color: #fff; font-size: 16px; font-weight: 600; margin-bottom: 10px;">ğŸ“Š ìˆ˜ì‹ ì í†µê³„</div>
                                <div style="color: #b1b1b1; font-size: 14px; line-height: 1.6;">
                                    <div>â€¢ ì´ ìˆ˜ì‹ ì: <span style="color: #ff9800; font-weight: 600;">${uniqueRecipients.length}ëª…</span></div>
                                    <div>â€¢ ì¤‘ë³µ ì œê±°: <span style="color: #4a9eff; font-weight: 600;">${allRecipients.length - uniqueRecipients.length}ëª…</span></div>
                                    <div>â€¢ ì„ íƒëœ ê·¸ë£¹: <span style="color: #4a9eff; font-weight: 600;">${selectedGroups.join(', ')}</span></div>
                                </div>
                            </div>
                        </div>

                        <!-- í•˜ë‹¨ ë²„íŠ¼ -->
                        <div style="display: flex; justify-content: space-between; gap: 10px; border-top: 1px solid #3a3a3a; padding-top: 20px;">
                            <button onclick="sendEmailFromPreview()" class="analytics-btn" style="padding: 10px 20px;">ğŸ“§ ì¦‰ì‹œ ë°œì†¡</button>
                            <button onclick="closeEmailRecipientsModal()" class="chart-btn" style="padding: 10px 20px;">ë‹«ê¸°</button>
                        </div>
                    </div>
                </div>
            `;

            // ëª¨ë‹¬ì„ í˜ì´ì§€ì— ì¶”ê°€
            document.body.insertAdjacentHTML('beforeend', modalHTML);

            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
            document.getElementById('email-recipients-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeEmailRecipientsModal();
                }
            });

            // ìˆ˜ì‹ ì ê²€ìƒ‰ ê¸°ëŠ¥ ë° ë©”ì‹œì§€ ì…ë ¥ì°½ ê¸°ëŠ¥ ì¶”ê°€
            setTimeout(() => {
                const searchInput = document.getElementById('recipient-search');
                const clearButton = document.getElementById('clear-search');
                const messageInput = document.getElementById('email-message-input');
                const charCount = document.getElementById('message-char-count');
                
                // ìˆ˜ì‹ ì ê²€ìƒ‰ ê¸°ëŠ¥
                if (searchInput) {
                    searchInput.addEventListener('input', function() {
                        const searchTerm = this.value.toLowerCase();
                        const recipientRows = document.querySelectorAll('#email-recipients-modal .recipient-row');
                        
                        // X ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€
                        if (clearButton) {
                            clearButton.style.display = this.value ? 'block' : 'none';
                        }
                        
                        recipientRows.forEach(row => {
                            const text = row.textContent.toLowerCase();
                            if (text.includes(searchTerm)) {
                                row.style.display = 'grid';
                            } else {
                                row.style.display = 'none';
                            }
                        });
                    });
                }
                
                // ë©”ì‹œì§€ ì…ë ¥ì°½ ì´ˆê¸° ë™ê¸°í™” ë° ê¸€ì ìˆ˜ ì¹´ìš´í„° ê¸°ëŠ¥
                if (messageInput && charCount) {
                    const maxLength = 1000;
                    
                    // Email Report í…Œì´ë¸”ì˜ ë©”ì‹œì§€ë¥¼ íŒì—…ìœ¼ë¡œ ë™ê¸°í™”
                    const emailReportMessage = document.getElementById('email-report-message');
                    if (emailReportMessage && emailReportMessage.value) {
                        messageInput.value = emailReportMessage.value;
                        console.log('íŒì—… ì—´ë¦´ ë•Œ ë©”ì‹œì§€ ë™ê¸°í™”:', emailReportMessage.value);
                    }
                    
                    // ì´ˆê¸° ê¸€ì ìˆ˜ ì„¤ì •
                    charCount.textContent = messageInput.value.length;
                    
                    messageInput.addEventListener('input', function() {
                        const currentLength = this.value.length;
                        charCount.textContent = currentLength;
                        
                        // ê¸€ì ìˆ˜ ì œí•œ
                        if (currentLength > maxLength) {
                            this.value = this.value.substring(0, maxLength);
                            charCount.textContent = maxLength;
                        }
                        
                        // ê¸€ì ìˆ˜ì— ë”°ë¥¸ ìƒ‰ìƒ ë³€ê²½
                        if (currentLength >= maxLength * 0.9) {
                            charCount.style.color = '#ff9800'; // ê²½ê³  ìƒ‰ìƒ
                        } else if (currentLength >= maxLength * 0.8) {
                            charCount.style.color = '#ff9800'; // ì£¼ì˜ ìƒ‰ìƒ
                        } else {
                            charCount.style.color = '#7a7a7a'; // ê¸°ë³¸ ìƒ‰ìƒ
                        }
                    });
                }
            }, 100);
        }

        // ì´ ìˆ˜ì‹ ì ìˆ˜ ê³„ì‚° í•¨ìˆ˜
        function calculateTotalRecipients(selectedGroups, customEmailList) {
            let total = 0;
            
            // ì‹¤ì œ ë©¤ë²„ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ê·¸ë£¹ë³„ ìˆ˜ì‹ ì ìˆ˜ ê³„ì‚°
            selectedGroups.forEach(group => {
                switch(group) {
                    case 'ê´€ë¦¬ì':
                        const admins = originalMembersData ? originalMembersData.filter(member => member.role === 'owner') : [];
                        total += admins.length;
                        break;
                    case 'ì „ì²´ ë©¤ë²„':
                        const allMembers = originalMembersData ? [...originalMembersData] : [];
                        total += allMembers.length;
                        break;
                    case 'ë¹„í™œì„± ë©¤ë²„':
                        const inactiveMembers = originalMembersData ? originalMembersData.filter(member => member.spendData.premiumRequests === 0) : [];
                        total += inactiveMembers.length;
                        break;
                }
            });
            
            // ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ ìˆ˜ ì¶”ê°€
            if (customEmailList) {
                const emails = customEmailList.split(',').filter(email => email.trim().length > 0);
                total += emails.length;
            }
            
            return total;
        }

        // ìˆ˜ì‹ ì ê·¸ë£¹ HTML ìƒì„± í•¨ìˆ˜
        function generateRecipientGroups(selectedGroups, customEmailList) {
            let html = '';
            
            // ì‹¤ì œ ë©¤ë²„ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ê·¸ë£¹ë³„ ìˆ˜ì‹ ì í‘œì‹œ
            const adminCheckbox = document.getElementById('admin-checkbox');
            const allMembersCheckbox = document.getElementById('all-members-checkbox');
            const inactiveMembersCheckbox = document.getElementById('inactive-members-checkbox');
            const customEmailCheckbox = document.getElementById('custom-email-checkbox');
            
            // ê´€ë¦¬ì ê·¸ë£¹
            if (adminCheckbox && adminCheckbox.checked) {
                const admins = originalMembersData ? originalMembersData.filter(member => member.role === 'owner') : [];
                html += `
                    <div style="margin-bottom: 20px;">
                        <div style="color: #fff; font-size: 14px; font-weight: 600; margin-bottom: 10px;">â€¢ ê´€ë¦¬ì <span style="color: #fff;">(</span><span style="color: #fff; font-weight: 700;">${admins.length}ëª…</span><span style="color: #fff;">)</span></div>
                        <div style="
                            border: 1px solid #3a3a3a;
                            border-radius: 4px;
                            overflow: hidden;
                            max-height: 200px;
                            overflow-y: auto;
                            scrollbar-width: thin;
                            scrollbar-color: #2a2a2a #1a1a1a;
                        ">
                            ${admins.length > 0 ? admins.map(admin => `
                                <div class="recipient-row" style="
                                    display: grid;
                                    grid-template-columns: 1fr 2fr;
                                    border-bottom: 1px solid #3a3a3a;
                                ">
                                    <div style="padding: 10px; color: #ff9800; border-right: 1px solid #3a3a3a;">${admin.name || 'Unnamed'}</div>
                                    <div style="padding: 10px; color: #ff9800;">${admin.email}</div>
                                </div>
                            `).join('') : '<div style="padding: 10px; color: #7a7a7a; text-align: center;">ê´€ë¦¬ìê°€ ì—†ìŠµë‹ˆë‹¤.</div>'}
                        </div>
                    </div>
                `;
            }
            
            // ì „ì²´ ë©¤ë²„ ê·¸ë£¹
            if (allMembersCheckbox && allMembersCheckbox.checked) {
                const allMembers = originalMembersData ? [...originalMembersData] : [];
                html += `
                    <div style="margin-bottom: 20px;">
                        <div style="color: #fff; font-size: 14px; font-weight: 600; margin-bottom: 10px;">â€¢ ì „ì²´ ë©¤ë²„ <span style="color: #fff;">(</span><span style="color: #fff; font-weight: 700;">${allMembers.length}ëª…</span><span style="color: #fff;">)</span></div>
                        <div style="
                            border: 1px solid #3a3a3a;
                            border-radius: 4px;
                            overflow: hidden;
                            max-height: 200px;
                            overflow-y: auto;
                            scrollbar-width: thin;
                            scrollbar-color: #2a2a2a #1a1a1a;
                        ">
                            ${allMembers.length > 0 ? allMembers.map(member => `
                                <div class="recipient-row" style="
                                    display: grid;
                                    grid-template-columns: 1fr 2fr;
                                    border-bottom: 1px solid #3a3a3a;
                                ">
                                    <div style="padding: 10px; color: #4CAF50; border-right: 1px solid #3a3a3a;">${member.name || 'Unnamed'}</div>
                                    <div style="padding: 10px; color: #4CAF50;">${member.email}</div>
                                </div>
                            `).join('') : '<div style="padding: 10px; color: #7a7a7a; text-align: center;">ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤.</div>'}
                        </div>
                    </div>
                `;
            }
            
            // ë¹„í™œì„± ë©¤ë²„ ê·¸ë£¹
            if (inactiveMembersCheckbox && inactiveMembersCheckbox.checked) {
                const inactiveMembers = originalMembersData ? originalMembersData.filter(member => member.spendData.premiumRequests === 0) : [];
                html += `
                    <div style="margin-bottom: 20px;">
                        <div style="color: #fff; font-size: 14px; font-weight: 600; margin-bottom: 10px;">â€¢ ë¹„í™œì„± ë©¤ë²„ <span style="color: #fff;">(</span><span style="color: #fff; font-weight: 700;">${inactiveMembers.length}ëª…</span><span style="color: #fff;">)</span></div>
                        <div style="
                            border: 1px solid #3a3a3a;
                            border-radius: 4px;
                            overflow: hidden;
                            max-height: 200px;
                            overflow-y: auto;
                            scrollbar-width: thin;
                            scrollbar-color: #2a2a2a #1a1a1a;
                        ">
                            ${inactiveMembers.length > 0 ? inactiveMembers.map(member => `
                                <div class="recipient-row" style="
                                    display: grid;
                                    grid-template-columns: 1fr 2fr;
                                    border-bottom: 1px solid #3a3a3a;
                                ">
                                    <div style="padding: 10px; color: #7a7a7a; border-right: 1px solid #3a3a3a;">${member.name || 'Unnamed'}</div>
                                    <div style="padding: 10px; color: #7a7a7a;">${member.email}</div>
                                </div>
                            `).join('') : '<div style="padding: 10px; color: #7a7a7a; text-align: center;">ë¹„í™œì„± ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤.</div>'}
                        </div>
                    </div>
                `;
            }
            
            // ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ ê·¸ë£¹
            if (customEmailCheckbox && customEmailCheckbox.checked && customEmailList) {
                const emailList = customEmailList.split(',').filter(email => email.trim().length > 0);
                html += `
                    <div style="margin-bottom: 20px;">
                        <div style="color: #fff; font-size: 14px; font-weight: 600; margin-bottom: 10px;">â€¢ ì§ì ‘ ì…ë ¥ <span style="color: #fff;">(</span><span style="color: #fff; font-weight: 700;">${emailList.length}ê°œ</span><span style="color: #fff;">)</span></div>
                        <div style="
                            border: 1px solid #3a3a3a;
                            border-radius: 4px;
                            overflow: hidden;
                            max-height: 200px;
                            overflow-y: auto;
                            scrollbar-width: thin;
                            scrollbar-color: #2a2a2a #1a1a1a;
                        ">
                            ${emailList.length > 0 ? emailList.map(email => `
                                <div class="recipient-row" style="
                                    display: grid;
                                    grid-template-columns: 1fr 2fr;
                                    border-bottom: 1px solid #3a3a3a;
                                ">
                                    <div style="padding: 10px; color: #4a9eff; border-right: 1px solid #3a3a3a;">ì§ì ‘ ì…ë ¥</div>
                                    <div style="padding: 10px; color: #4a9eff;">${email.trim()}</div>
                                </div>
                            `).join('') : '<div style="padding: 10px; color: #7a7a7a; text-align: center;">ì§ì ‘ ì…ë ¥ëœ ì´ë©”ì¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>'}
                        </div>
                    </div>
                `;
            }
            
           
            
            
            return html;
        }

        // ë©¤ë²„ í–‰ ìƒì„± í•¨ìˆ˜
        function generateMemberRows(count, type) {
            let html = '';
            const names = ['ê¹€ì² ìˆ˜', 'ì´ì˜í¬', 'ë°•ë¯¼ìˆ˜', 'ì •ìˆ˜ì§„', 'ìµœë™í˜„', 'ìœ¤ì„œì—°', 'ê°•íƒœìš°', 'ì„ì§€ì˜', 'í•œìŠ¹ìš°', 'ì†¡ë¯¸ë¼'];
            const domains = ['samsung.com', 'samsung.co.kr'];
            
            for (let i = 0; i < count; i++) {
                const name = names[i % names.length] + (Math.floor(i / names.length) + 1);
                const domain = domains[i % domains.length];
                const email = `${name.toLowerCase().replace(/[ê°€-í£]/g, '')}@${domain}`;
                
                html += `
                    <div class="recipient-row" style="
                        display: grid;
                        grid-template-columns: 1fr 2fr;
                        ${i < count - 1 ? 'border-bottom: 1px solid #3a3a3a;' : ''}
                    ">
                        <div style="padding: 10px; color: #ff9800; border-right: 1px solid #3a3a3a;">${name}</div>
                        <div style="padding: 10px; color: #ff9800;">${email}</div>
                    </div>
                `;
            }
            
            return html;
        }

        // ê²€ìƒ‰ì°½ ì´ˆê¸°í™” í•¨ìˆ˜
        function clearRecipientSearch() {
            const searchInput = document.getElementById('recipient-search');
            const clearButton = document.getElementById('clear-search');
            
            if (searchInput) {
                searchInput.value = '';
                if (clearButton) {
                    clearButton.style.display = 'none';
                }
                
                // ëª¨ë“  í–‰ ë‹¤ì‹œ í‘œì‹œ
                const recipientRows = document.querySelectorAll('#email-recipients-modal .recipient-row');
                recipientRows.forEach(row => {
                    row.style.display = 'grid';
                });
            }
        }

        // ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
        function closeEmailScheduleModal() {
            const modal = document.getElementById('email-schedule-modal');
            if (modal) {
                modal.remove();
            }
        }



        // ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ í•„í„°ë§ í•¨ìˆ˜
        function filterScheduleList(filter) {
            const filterButtons = document.querySelectorAll('#email-schedule-modal [data-filter]');
            const scheduleItems = document.querySelectorAll('#email-schedule-modal .schedule-item');
            
            // í•„í„° ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            filterButtons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // ì•„ì´í…œ í•„í„°ë§
            scheduleItems.forEach(item => {
                if (filter === 'all') {
                    // ì „ì²´ ë³´ê¸°: ëª¨ë“  ì•„ì´í…œ í‘œì‹œ
                    item.style.display = 'grid';
                } else if (filter === 'active') {
                    // í™œì„± ë³´ê¸°: í™œì„± ë¼ë””ì˜¤ ë²„íŠ¼ì´ ì²´í¬ëœ ì•„ì´í…œë§Œ í‘œì‹œ
                    const activeRadio = item.querySelector('input[value="active"]');
                    if (activeRadio && activeRadio.checked) {
                    item.style.display = 'grid';
                } else {
                    item.style.display = 'none';
                    }
                } else if (filter === 'inactive') {
                    // ë¹„í™œì„± ë³´ê¸°: ë¹„í™œì„± ë¼ë””ì˜¤ ë²„íŠ¼ì´ ì²´í¬ëœ ì•„ì´í…œë§Œ í‘œì‹œ
                    const inactiveRadio = item.querySelector('input[value="inactive"]');
                    if (inactiveRadio && inactiveRadio.checked) {
                        item.style.display = 'grid';
                    } else {
                        item.style.display = 'none';
                    }
                }
            });
        }

        // ì˜ˆì•½ ìƒì„¸ ë³´ê¸° í•¨ìˆ˜
        function showScheduleDetail(id) {
            alert(`ì˜ˆì•½ ID ${id}ì˜ ìƒì„¸ ì •ë³´ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.`);
            // ì‹¤ì œë¡œëŠ” ìƒì„¸ ëª¨ë‹¬ì„ ë„ìš°ê±°ë‚˜ í˜ì´ì§€ë¥¼ ì´ë™
        }

        // ì˜ˆì•½ í¸ì§‘ í•¨ìˆ˜
        function editSchedule(id) {
            alert(`ì˜ˆì•½ ID ${id}ë¥¼ í¸ì§‘í•©ë‹ˆë‹¤.`);
            // ì‹¤ì œë¡œëŠ” í¸ì§‘ ëª¨ë‹¬ì„ ë„ìš°ê±°ë‚˜ í˜ì´ì§€ë¥¼ ì´ë™
        }

        // ì˜ˆì•½ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateScheduleStatus(id, status) {
                    // ì „ì—­ ë³€ìˆ˜ ì—…ë°ì´íŠ¸
                    if (window.emailScheduleList) {
                        const schedule = window.emailScheduleList.find(s => s.id === id);
                        if (schedule) {
                    schedule.status = status;
                    console.log(`ì˜ˆì•½ ìƒíƒœ ì—…ë°ì´íŠ¸: ${id} -> ${status}`);
                }
            }
        }

        // ì „ì²´ ì˜ˆì•½ ì‚­ì œ í•¨ìˆ˜
        function deleteAllSchedules() {
            // ì „ì²´ ì‚­ì œ í™•ì¸ ëª¨ë‹¬ ìƒì„±
            const modalHTML = `
                <div id="delete-all-confirm-modal" style="
                    display: block;
                    position: fixed;
                    z-index: 2000;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0,0,0,0.7);
                ">
                    <div style="
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        width: 90%;
                        max-width: 400px;
                        background-color: #1a1a1a;
                        border: 1px solid #3a3a3a;
                        border-radius: 8px;
                        padding: 30px;
                        text-align: center;
                        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
                    ">
                        <!-- ëª¨ë‹¬ í—¤ë” -->
                        <div style="
                            margin-bottom: 20px;
                            color: #fff;
                            font-size: 18px;
                            font-weight: 600;
                        ">ì „ì²´ ì˜ˆì•½ ì‚­ì œ</div>
                        
                        <!-- í™•ì¸ ë©”ì‹œì§€ -->
                        <div style="
                            margin-bottom: 25px;
                            color: #e1e1e1;
                            font-size: 14px;
                            line-height: 1.5;
                        ">ì •ë§ë¡œ ëª¨ë“  ì˜ˆì•½ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</div>
                        
                        <!-- ë²„íŠ¼ -->
                        <div style="display: flex; gap: 10px; justify-content: center;">
                            <button class="chart-btn" onclick="closeDeleteAllConfirmModal()" style="min-width: 80px;">ì·¨ì†Œ</button>
                            <button class="analytics-btn" onclick="confirmDeleteAllSchedules()" style="min-width: 80px;">í™•ì¸</button>
                        </div>
                    </div>
                </div>
            `;

            // ëª¨ë‹¬ì„ í˜ì´ì§€ì— ì¶”ê°€
            document.body.insertAdjacentHTML('beforeend', modalHTML);

            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
            document.getElementById('delete-all-confirm-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeDeleteAllConfirmModal();
                }
            });
        }

        // ì „ì²´ ì‚­ì œ í™•ì¸ ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
        function closeDeleteAllConfirmModal() {
            const modal = document.getElementById('delete-all-confirm-modal');
            if (modal) {
                modal.remove();
            }
        }

        // ì „ì²´ ì˜ˆì•½ ì‚­ì œ í™•ì¸ í•¨ìˆ˜
        function confirmDeleteAllSchedules() {
            // ëª¨ë‹¬ ë‹«ê¸°
            closeDeleteAllConfirmModal();
            
            // ëª¨ë“  ì˜ˆì•½ ì‚­ì œ
            window.emailScheduleList = [];
            
            // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
            showSimpleAlert('âœ… ëª¨ë“  ì˜ˆì•½ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            
            // ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ í™”ë©´ ìƒˆë¡œê³ ì¹¨
            setTimeout(() => {
                showEmailScheduleList();
            }, 1000);
        }

        // ì˜ˆì•½ ì‚­ì œ í•¨ìˆ˜
        function deleteSchedule(id) {
            // ì‚­ì œ í™•ì¸ ëª¨ë‹¬ ìƒì„±
            const modalHTML = `
                <div id="delete-confirm-modal" style="
                    display: block;
                    position: fixed;
                    z-index: 2000;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0,0,0,0.7);
                ">
                    <div style="
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        width: 90%;
                        max-width: 400px;
                        background-color: #1a1a1a;
                        border: 1px solid #3a3a3a;
                        border-radius: 8px;
                        padding: 30px;
                        text-align: center;
                        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
                    ">
                        <!-- ëª¨ë‹¬ í—¤ë” -->
                        <div style="
                            margin-bottom: 20px;
                            color: #fff;
                            font-size: 18px;
                            font-weight: 600;
                        ">ì˜ˆì•½ ì‚­ì œ</div>
                        
                        <!-- í™•ì¸ ë©”ì‹œì§€ -->
                        <div style="
                            margin-bottom: 25px;
                            color: #e1e1e1;
                            font-size: 14px;
                            line-height: 1.5;
                        ">ì •ë§ë¡œ ì´ ì˜ˆì•½ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</div>
                        
                        <!-- ë²„íŠ¼ -->
                        <div style="display: flex; gap: 10px; justify-content: center;">
                            <button class="chart-btn" onclick="closeDeleteConfirmModal()" style="min-width: 80px;">ì·¨ì†Œ</button>
                            <button class="analytics-btn" onclick="confirmDeleteSchedule(${id})" style="min-width: 80px;">í™•ì¸</button>
                        </div>
                    </div>
                </div>
            `;

            // ëª¨ë‹¬ì„ í˜ì´ì§€ì— ì¶”ê°€
            document.body.insertAdjacentHTML('beforeend', modalHTML);

            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
            document.getElementById('delete-confirm-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeDeleteConfirmModal();
                }
            });
        }

        // ì‚­ì œ í™•ì¸ ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
        function closeDeleteConfirmModal() {
            const modal = document.getElementById('delete-confirm-modal');
            if (modal) {
                modal.remove();
            }
        }

        // ì˜ˆì•½ ì‚­ì œ í™•ì¸ í•¨ìˆ˜
        function confirmDeleteSchedule(id) {
            // ëª¨ë‹¬ ë‹«ê¸°
            closeDeleteConfirmModal();
            
            // ì „ì—­ ë³€ìˆ˜ì—ì„œ ì‚­ì œ
                    if (window.emailScheduleList) {
                        window.emailScheduleList = window.emailScheduleList.filter(schedule => schedule.id !== id);
                    }
                    
            // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
            showSimpleAlert('âœ… ì˜ˆì•½ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            
            // ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ í™”ë©´ ìƒˆë¡œê³ ì¹¨
            setTimeout(() => {
                showEmailScheduleList();
            }, 1000);
            
                    console.log(`ì˜ˆì•½ ID ${id}ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }

        // ìƒˆ ì˜ˆì•½ ì¶”ê°€ í•¨ìˆ˜
        function addNewSchedule() {
            // ê¸°ì¡´ ëª¨ë‹¬ ë‹«ê¸°
            closeEmailScheduleModal();
            
            // ìƒˆ ì˜ˆì•½ ì…ë ¥ ëª¨ë‹¬ ìƒì„±
            const modalHTML = `
                <div id="new-schedule-modal" style="
                    display: block;
                    position: fixed;
                    z-index: 1000;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0,0,0,0.7);
                ">
                    <div style="
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        width: 95%;
                        max-width: 1200px;
                        max-height: 90vh;
                        background-color: #1a1a1a;
                        border: 1px solid #3a3a3a;
                        border-radius: 8px;
                        padding: 30px;
                        overflow-y: auto;
                    ">
                        <!-- ëª¨ë‹¬ í—¤ë” -->
                        <div style="
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            margin-bottom: 25px;
                            padding-bottom: 15px;
                            border-bottom: 1px solid #3a3a3a;
                        ">
                            <div style="color: #fff; font-size: 18px; font-weight: 600;">ìƒˆ ì˜ˆì•½ ì¶”ê°€</div>
                            <button onclick="closeNewScheduleModal()" style="
                                background: none;
                                border: none;
                                color: #7a7a7a;
                                font-size: 20px;
                                cursor: pointer;
                                padding: 5px;
                                border-radius: 3px;
                                transition: color 0.2s ease;
                            " onmouseover="this.style.color='#fff'" onmouseout="this.style.color='#7a7a7a'">Ã—</button>
                        </div>

                        <!-- ì˜ˆì•½ ì…ë ¥ í¼ -->
                        <div style="margin-bottom: 20px;">
                            <div style="color: #fff; font-size: 16px; font-weight: 600; margin-bottom: 15px;">ì˜ˆì•½ ì •ë³´</div>
                            
                            <!-- ì œëª© ì…ë ¥ -->
                            <div style="margin-bottom: 15px;">
                                <div style="color: #e1e1e1; font-size: 14px; margin-bottom: 8px;">ì œëª©</div>
                                <input type="text" id="new-schedule-title" placeholder="ì˜ˆì•½ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" style="
                                    width: 100%;
                                    padding: 10px 12px;
                                    background-color: #2a2a2a;
                                    border: 1px solid #3a3a3a;
                                    border-radius: 4px;
                                    color: #e1e1e1;
                                    font-size: 14px;
                                    outline: none;
                                " onfocus="this.style.borderColor='#4a9eff'" onblur="this.style.borderColor='#3a3a3a'">
                            </div>

                            <!-- ì£¼ê¸° ì„ íƒ -->
                            <div style="margin-bottom: 15px;">
                                <div style="color: #e1e1e1; font-size: 14px; margin-bottom: 8px;">ì£¼ê¸°</div>
                                <select id="new-schedule-frequency" style="
                                    width: 100%;
                                    padding: 10px 12px;
                                    background-color: #2a2a2a;
                                    border: 1px solid #3a3a3a;
                                    border-radius: 4px;
                                    color: #e1e1e1;
                                    font-size: 14px;
                                    outline: none;
                                " onfocus="this.style.borderColor='#4a9eff'" onblur="this.style.borderColor='#3a3a3a'">
                                    <option value="daily">ë§¤ì¼</option>
                                    <option value="weekly" selected>ë§¤ì£¼</option>
                                    <option value="monthly">ë§¤ì›”</option>
                                </select>
                            </div>

                            <!-- ì‹œê°„ ì…ë ¥ -->
                            <div style="margin-bottom: 15px;">
                                <div style="color: #e1e1e1; font-size: 14px; margin-bottom: 8px;">ì‹œê°„</div>
                                <input type="time" id="new-schedule-time" value="09:00" style="
                                    width: 100%;
                                    padding: 10px 12px;
                                    background-color: #2a2a2a;
                                    border: 1px solid #3a3a3a;
                                    border-radius: 4px;
                                    color: #e1e1e1;
                                    font-size: 14px;
                                    outline: none;
                                " onfocus="this.style.borderColor='#4a9eff'" onblur="this.style.borderColor='#3a3a3a'">
                            </div>

                            <!-- ìˆ˜ì‹ ì ê·¸ë£¹ ì„ íƒ -->
                            <div style="margin-bottom: 15px;">
                                <div style="color: #e1e1e1; font-size: 14px; margin-bottom: 8px;">ìˆ˜ì‹ ì ê·¸ë£¹</div>
                                <div style="
                                    background-color: #2a2a2a;
                                    border: 1px solid #3a3a3a;
                                    border-radius: 4px;
                                    padding: 12px;
                                ">
                                    <!-- ê´€ë¦¬ì ì²´í¬ë°•ìŠ¤ -->
                                    <div style="margin-bottom: 8px;">
                                        <label style="
                                            display: flex;
                                            align-items: center;
                                            cursor: pointer;
                                            color: #e1e1e1;
                                            font-size: 14px;
                                        ">
                                            <input type="checkbox" id="new-admin-checkbox" style="
                                                margin-right: 8px;
                                                width: 16px;
                                                height: 16px;
                                                accent-color: #4a9eff;
                                            ">
                                            ê´€ë¦¬ì
                                        </label>
                                    </div>
                                    
                                    <!-- ì „ì²´ ë©¤ë²„ ì²´í¬ë°•ìŠ¤ -->
                                    <div style="margin-bottom: 8px;">
                                        <label style="
                                            display: flex;
                                            align-items: center;
                                            cursor: pointer;
                                            color: #e1e1e1;
                                            font-size: 14px;
                                        ">
                                            <input type="checkbox" id="new-all-members-checkbox" style="
                                                margin-right: 8px;
                                                width: 16px;
                                                height: 16px;
                                                accent-color: #4a9eff;
                                            ">
                                            ì „ì²´ ë©¤ë²„
                                        </label>
                                    </div>
                                    
                                    <!-- ë¹„í™œì„± ë©¤ë²„ ì²´í¬ë°•ìŠ¤ -->
                                    <div style="margin-bottom: 8px;">
                                        <label style="
                                            display: flex;
                                            align-items: center;
                                            cursor: pointer;
                                            color: #e1e1e1;
                                            font-size: 14px;
                                        ">
                                            <input type="checkbox" id="new-inactive-members-checkbox" style="
                                                margin-right: 8px;
                                                width: 16px;
                                                height: 16px;
                                                accent-color: #4a9eff;
                                            ">
                                            ë¹„í™œì„± ë©¤ë²„
                                        </label>
                                    </div>
                                    
                                    <!-- ì§ì ‘ ì…ë ¥ ì²´í¬ë°•ìŠ¤ -->
                                    <div style="margin-bottom: 8px;">
                                        <label style="
                                            display: flex;
                                            align-items: center;
                                            cursor: pointer;
                                            color: #e1e1e1;
                                            font-size: 14px;
                                        ">
                                            <input type="checkbox" id="new-custom-email-checkbox" onclick="toggleNewCustomEmailInput()" style="
                                                margin-right: 8px;
                                                width: 16px;
                                                height: 16px;
                                                accent-color: #4a9eff;
                                            ">
                                            ì§ì ‘ ì…ë ¥
                                        </label>
                                    </div>
                                    
                                    <!-- ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ í…ìŠ¤íŠ¸ ì˜ì—­ (ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€) -->
                                    <div id="new-custom-email-container" style="display: none; margin-top: 8px;">
                                        <textarea id="new-custom-emails" placeholder="emailì„ ì§ì ‘ ì…ë ¥ í•˜ì„¸ìš”.(example1@samsung.com, example2@samsung.com)" style="
                                            width: 100%;
                                            padding: 8px 12px;
                                            background-color: #1a1a1a;
                                            border: 1px solid #3a3a3a;
                                            border-radius: 4px;
                                            color: #e1e1e1;
                                            font-size: 14px;
                                            outline: none;
                                            resize: vertical;
                                            min-height: 60px;
                                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                                        " onfocus="this.style.borderColor='#4a9eff'" onblur="this.style.borderColor='#3a3a3a'"></textarea>
                                    </div>
                                </div>
                            </div>

                            <!-- ë©”ì‹œì§€ ì…ë ¥ -->
                            <div style="margin-bottom: 20px;">
                                <div style="color: #e1e1e1; font-size: 14px; margin-bottom: 8px;">ë©”ì‹œì§€</div>
                                <textarea id="new-schedule-message" placeholder="ë°œì†¡í•  ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="
                                    width: 100%;
                                    height: 100px;
                                    padding: 10px 12px;
                                    background-color: #2a2a2a;
                                    border: 1px solid #3a3a3a;
                                    border-radius: 4px;
                                    color: #e1e1e1;
                                    font-size: 14px;
                                    outline: none;
                                    resize: vertical;
                                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                                " onfocus="this.style.borderColor='#4a9eff'" onblur="this.style.borderColor='#3a3a3a'"></textarea>
                            </div>
                        </div>

                        <!-- í•˜ë‹¨ ë²„íŠ¼ -->
                        <div style="display: flex; justify-content: flex-end; gap: 10px; border-top: 1px solid #3a3a3a; padding-top: 20px;">
                            <button class="chart-btn" onclick="closeNewScheduleModal()">ì·¨ì†Œ</button>
                            <button class="analytics-btn" onclick="saveNewSchedule()">ì €ì¥</button>
                        </div>
                    </div>
                </div>
            `;

            // ëª¨ë‹¬ì„ í˜ì´ì§€ì— ì¶”ê°€
            document.body.insertAdjacentHTML('beforeend', modalHTML);

            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
            document.getElementById('new-schedule-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeNewScheduleModal();
                }
            });
        }

        // ìƒˆ ì˜ˆì•½ ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
        function closeNewScheduleModal() {
            const modal = document.getElementById('new-schedule-modal');
            if (modal) {
                modal.remove();
            }
        }

        // ìƒˆ ì˜ˆì•½ ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ í† ê¸€ í•¨ìˆ˜
        function toggleNewCustomEmailInput() {
            const customEmailCheckbox = document.getElementById('new-custom-email-checkbox');
            const customEmailContainer = document.getElementById('new-custom-email-container');
            
            if (customEmailCheckbox && customEmailContainer) {
                if (customEmailCheckbox.checked) {
                    customEmailContainer.style.display = 'block';
                } else {
                    customEmailContainer.style.display = 'none';
                    // ì²´í¬ í•´ì œ ì‹œ ì…ë ¥ê°’ ì´ˆê¸°í™”
                    const customEmails = document.getElementById('new-custom-emails');
                    if (customEmails) {
                        customEmails.value = '';
                    }
                }
            }
        }

        // ìƒˆ ì˜ˆì•½ ì €ì¥ í•¨ìˆ˜
        function saveNewSchedule() {
            // ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
            const title = document.getElementById('new-schedule-title').value.trim();
            const frequencySelect = document.getElementById('new-schedule-frequency');
            const timeInput = document.getElementById('new-schedule-time');
            const message = document.getElementById('new-schedule-message').value.trim();

            // ì œëª© ê¸°ë³¸ê°’ ì„¤ì •
            const titleText = title || 'ì œëª© ì—†ìŒ';

            // ì„ íƒëœ ìˆ˜ì‹ ì ê·¸ë£¹ í™•ì¸
            const selectedGroups = [];
            const adminCheckbox = document.getElementById('new-admin-checkbox');
            const allMembersCheckbox = document.getElementById('new-all-members-checkbox');
            const inactiveMembersCheckbox = document.getElementById('new-inactive-members-checkbox');
            const customEmailCheckbox = document.getElementById('new-custom-email-checkbox');

            if (adminCheckbox && adminCheckbox.checked) {
                selectedGroups.push('ê´€ë¦¬ì');
            }
            if (allMembersCheckbox && allMembersCheckbox.checked) {
                selectedGroups.push('ì „ì²´ ë©¤ë²„');
            }
            if (inactiveMembersCheckbox && inactiveMembersCheckbox.checked) {
                selectedGroups.push('ë¹„í™œì„± ë©¤ë²„');
            }

            // ì§ì ‘ ì…ë ¥ì´ ì„ íƒëœ ê²½ìš° ìˆ˜ì‹ ì ê·¸ë£¹ì— ì¶”ê°€
            if (customEmailCheckbox && customEmailCheckbox.checked) {
                selectedGroups.push('ì§ì ‘ì…ë ¥');
            }

            if (selectedGroups.length === 0) {
                showSimpleAlert('âš ï¸ ìˆ˜ì‹ ì ê·¸ë£¹ì„ ìµœì†Œ í•˜ë‚˜ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            // ì§ì ‘ ì…ë ¥ ì²´í¬ ì‹œ ì´ë©”ì¼ ì£¼ì†Œ í™•ì¸
            const customEmails = document.getElementById('new-custom-emails');
            
            if (customEmailCheckbox && customEmailCheckbox.checked) {
                if (!customEmails || !customEmails.value.trim()) {
                    showSimpleAlert('âš ï¸ ì§ì ‘ ì…ë ¥ì„ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤.\nì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                    return;
                }
                
                // ì´ë©”ì¼ í˜•ì‹ ê°„ë‹¨ ê²€ì¦
                const emailList = customEmails.value.split(',');
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                for (let email of emailList) {
                    email = email.trim();
                    if (email && !emailRegex.test(email)) {
                        showSimpleAlert(`âš ï¸ ì˜¬ë°”ë¥´ì§€ ì•Šì€ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤: ${email}\n\nì˜¬ë°”ë¥¸ í˜•ì‹: example@samsung.com`, 'warning');
                        return;
                    }
                }
            }

            // ì£¼ê¸° í…ìŠ¤íŠ¸ ë³€í™˜
            const frequencyText = frequencySelect.options[frequencySelect.selectedIndex].text;
            const frequencyValue = frequencySelect.value;

            // ì‹œê°„ í…ìŠ¤íŠ¸ ë³€í™˜
            let timeText = 'ì˜¤ì „ 9ì‹œ 00ë¶„';
            let timeValue = '09:00';
            if (timeInput && timeInput.value) {
                const [hours, minutes] = timeInput.value.split(':');
                const hour = parseInt(hours);
                const minute = parseInt(minutes);
                timeValue = timeInput.value;
                
                if (hour < 12) {
                    timeText = `ì˜¤ì „ ${hour}ì‹œ ${minute.toString().padStart(2, '0')}ë¶„`;
                } else if (hour === 12) {
                    timeText = `ì˜¤í›„ 12ì‹œ ${minute.toString().padStart(2, '0')}ë¶„`;
                } else {
                    timeText = `ì˜¤í›„ ${hour - 12}ì‹œ ${minute.toString().padStart(2, '0')}ë¶„`;
                }
            }

            // ë©”ì‹œì§€ ê¸°ë³¸ê°’ ì„¤ì •
            const messageText = message || 'ì…ë ¥ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.';

            // ìˆ˜ì‹ ì ì •ë³´ ìˆ˜ì§‘
            const recipientsText = selectedGroups.join(', ');

            // ìƒˆ ì˜ˆì•½ ìƒì„±
            const newSchedule = {
                id: Date.now(),
                title: titleText,
                frequency: frequencyText,
                time: timeText,
                recipients: recipientsText,
                status: "í™œì„±",
                nextSend: calculateNextSendTime(frequencyValue, timeValue),
                message: messageText
            };

            // ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€
            if (!window.emailScheduleList) {
                window.emailScheduleList = [];
            }

            // ì¤‘ë³µ ë°ì´í„° ì²´í¬
            const isDuplicate = window.emailScheduleList.some(existingSchedule => {
                return existingSchedule.frequency === newSchedule.frequency &&
                       existingSchedule.time === newSchedule.time &&
                       existingSchedule.recipients === newSchedule.recipients &&
                       existingSchedule.message === newSchedule.message;
            });

            // ì¤‘ë³µì´ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ì¶”ê°€
            if (!isDuplicate) {
                window.emailScheduleList.push(newSchedule);
                
                // ëª¨ë‹¬ ë‹«ê¸°
                closeNewScheduleModal();
                
                // ì €ì¥ ì„±ê³µ ë©”ì‹œì§€
                showSimpleAlert('âœ… ìƒˆ ì˜ˆì•½ì´ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                console.log('ìƒˆ ì˜ˆì•½ ì¶”ê°€ ì™„ë£Œ', newSchedule);
                
                // ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ í™”ë©´ìœ¼ë¡œ ì´ë™
                setTimeout(() => {
                    showEmailScheduleList();
                }, 1000);
            } else {
                // ì¤‘ë³µì¸ ê²½ìš° ê²½ê³  ë©”ì‹œì§€
                showSimpleAlert('âš ï¸ ë™ì¼í•œ ì„¤ì •ì˜ ì˜ˆì•½ì´ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤.', 'warning');
            }
        }

        // ìˆ˜ì‹ ì ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
        function closeEmailRecipientsModal() {
            const modal = document.getElementById('email-recipients-modal');
            if (modal) {
                modal.remove();
            }
        }

        // ì‹œê°„ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateTimeInput() {
            const hourSelect = document.getElementById('email-hour-select');
            const minuteSelect = document.getElementById('email-minute-select');
            const timeInput = document.getElementById('email-time-input');
            
            if (hourSelect && minuteSelect && timeInput) {
                const hour = hourSelect.value.padStart(2, '0');
                const minute = minuteSelect.value.padStart(2, '0');
                timeInput.value = `${hour}:${minute}`;
                
                console.log(`â° ì‹œê°„ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸: ${hour}:${minute}`);
            }
        }

        // ì´ë²ˆ ë°œì†¡ ì‹œê°„ ê³„ì‚° í•¨ìˆ˜ (ì„¤ì • ì €ì¥ ì‹œ ì§€ì •ëœ ì‹œê°„)
        function calculateCurrentSendTime(frequency, time) {
            const now = new Date();
            const [hours, minutes] = time.split(':');
            let currentDate = new Date();
            
            // í˜„ì¬ ë‚ ì§œì— ì„¤ì •ëœ ì‹œê°„ ì ìš©
            currentDate.setHours(parseInt(hours), parseInt(minutes), 0, 0);
            
            // ë§Œì•½ í˜„ì¬ ì‹œê°„ì´ ì´ë¯¸ ì§€ë‚¬ìœ¼ë©´, ë‹¤ìŒ ì£¼ê¸°ë¡œ ì„¤ì •
            if (currentDate <= now) {
                switch(frequency) {
                    case 'daily':
                        // ë‚´ì¼ ê°™ì€ ì‹œê°„
                        currentDate.setDate(currentDate.getDate() + 1);
                        break;
                    case 'weekly':
                        // ë‹¤ìŒì£¼ ê°™ì€ ì‹œê°„
                        currentDate.setDate(currentDate.getDate() + 7);
                        break;
                    case 'monthly':
                        // ë‹¤ìŒë‹¬ ê°™ì€ ì‹œê°„
                        currentDate.setMonth(currentDate.getMonth() + 1);
                        break;
                }
            }
            
            return currentDate.toLocaleDateString('ko-KR') + ' ' + currentDate.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'});
        }

        // ì„¤ì • ì €ì¥ í•¨ìˆ˜
        async function saveEmailSettings() {
            // ì˜ˆì•½ ë©”ì¼ ë°œì†¡ ê´€ë¦¬ í† ê¸€ í™•ì¸
            const emailToggle = document.querySelector('#settings .toggle-switch');
            const isEmailSchedulerEnabled = emailToggle && !emailToggle.classList.contains('off');

            if (!isEmailSchedulerEnabled) {
                showSimpleAlert('âš ï¸ ì˜ˆì•½ ë©”ì¼ ë°œì†¡ ê´€ë¦¬ê°€ ë¹„í™œì„±í™” ìƒíƒœì…ë‹ˆë‹¤.\nì„¤ì •ì„ ì €ì¥í•˜ê¸° ì „ì— ì˜ˆì•½ ë©”ì¼ ë°œì†¡ ê´€ë¦¬ë¥¼ í™œì„±í™”í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            // ì„ íƒëœ ìˆ˜ì‹ ì ê·¸ë£¹ í™•ì¸ (ì§ì ‘ ì…ë ¥ ì œì™¸)
            const selectedGroups = [];
            const checkboxes = document.querySelectorAll('#settings input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    const labelText = checkbox.nextElementSibling.textContent.trim();
                    // ì§ì ‘ ì…ë ¥ì€ selectedGroupsì—ì„œ ì œì™¸ (ë³„ë„ ì²˜ë¦¬)
                    if (labelText && labelText !== 'ì§ì ‘ ì…ë ¥') {
                        selectedGroups.push(labelText);
                    }
                }
            });

            // ì§ì ‘ ì…ë ¥ ì²´í¬ ì‹œ ì´ë©”ì¼ ì£¼ì†Œ í™•ì¸
            const customEmailCheckbox = document.querySelector('input[type="checkbox"][onclick*="toggleCustomEmailInput"]');
            const customEmails = document.getElementById('custom-emails');
            
            // ìˆ˜ì‹ ì ê·¸ë£¹ì´ë‚˜ ì§ì ‘ ì…ë ¥ ì¤‘ í•˜ë‚˜ë¼ë„ ì„ íƒë˜ì–´ì•¼ í•¨
            const hasCustomEmail = customEmailCheckbox && customEmailCheckbox.checked && customEmails && customEmails.value.trim();
            
            if (selectedGroups.length === 0 && !hasCustomEmail) {
                showSimpleAlert('âš ï¸ ìˆ˜ì‹ ì ê·¸ë£¹ì„ ì„ íƒí•˜ê±°ë‚˜ ì§ì ‘ ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }
            
            if (hasCustomEmail) {
                // ì´ë©”ì¼ í˜•ì‹ ê°„ë‹¨ ê²€ì¦
                const emailList = customEmails.value.split(',');
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                for (let email of emailList) {
                    email = email.trim();
                    if (email && !emailRegex.test(email)) {
                        showSimpleAlert(`âš ï¸ ì˜¬ë°”ë¥´ì§€ ì•Šì€ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤: ${email}\n\nì˜¬ë°”ë¥¸ í˜•ì‹: example@samsung.com`, 'warning');
                        return;
                    }
                }
            }



            // ë©”ì‹œì§€ ì…ë ¥ í™•ì¸ ë° ê¸°ë³¸ê°’ ì„¤ì •
            const messageInput = document.getElementById('email-report-message');
            let messageText = messageInput ? messageInput.value.trim() : '';
            
            // ë©”ì‹œì§€ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ë©”ì‹œì§€ ì„¤ì •
            if (!messageText) {
                messageText = 'ì…ë ¥ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.';
            }

            // í˜„ì¬ ì„¤ì • ê°’ë“¤ ìˆ˜ì§‘
            const frequency = document.getElementById('email-frequency-select');
            const timeInput = document.getElementById('email-time-input');
            
            const frequencyText = frequency ? frequency.options[frequency.selectedIndex].text : 'ë§¤ì£¼';
            const frequencyValue = frequency ? frequency.value : 'weekly';
            
            // ì‹œê°„ ì…ë ¥ ì²˜ë¦¬
            let timeText = 'ì˜¤ì „ 9ì‹œ 00ë¶„';
            let timeValue = '09:00';
            if (timeInput && timeInput.value) {
                const [hours, minutes] = timeInput.value.split(':');
                const hour = parseInt(hours);
                const minute = parseInt(minutes);
                timeValue = timeInput.value;
                
                if (hour < 12) {
                    timeText = `ì˜¤ì „ ${hour}ì‹œ ${minute.toString().padStart(2, '0')}ë¶„`;
                } else if (hour === 12) {
                    timeText = `ì˜¤í›„ 12ì‹œ ${minute.toString().padStart(2, '0')}ë¶„`;
                } else {
                    timeText = `ì˜¤í›„ ${hour - 12}ì‹œ ${minute.toString().padStart(2, '0')}ë¶„`;
                }
            }

            // ìˆ˜ì‹ ì ì •ë³´ ìˆ˜ì§‘
            let recipientsText = selectedGroups.join(', ');
            
            if (hasCustomEmail) {
                // ì§ì ‘ ì…ë ¥ì´ ì²´í¬ë˜ê³  ì´ë©”ì¼ì´ ìˆëŠ” ê²½ìš°ì—ë§Œ ì¶”ê°€
                recipientsText += recipientsText ? ', ì§ì ‘ì…ë ¥' : 'ì§ì ‘ì…ë ¥';
            }

            // ì´ë²ˆ ë°œì†¡ ì‹œê°„ ê³„ì‚° (í˜„ì¬ ì„¤ì •ëœ ì‹œê°„)
            const currentSendTime = calculateCurrentSendTime(frequencyValue, timeValue);

            // ìƒˆ ì˜ˆì•½ ìƒì„±
            const newSchedule = {
                id: Date.now(), // ê³ ìœ  ID ìƒì„±
                title: `${frequencyText} ë¦¬í¬íŠ¸`,
                frequency: frequencyText,
                time: timeText,
                recipients: recipientsText,
                status: "í™œì„±",
                currentSend: currentSendTime, // ì´ë²ˆ ë°œì†¡ ì‹œê°„
                nextSend: calculateNextSendTime(frequencyValue, timeValue),
                message: messageText
            };

            // ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€ (ì „ì—­ ë³€ìˆ˜ë¡œ ê´€ë¦¬)
            if (!window.emailScheduleList) {
                window.emailScheduleList = [];
            }

            // ì¤‘ë³µ ë°ì´í„° ì²´í¬
            const isDuplicate = window.emailScheduleList.some(existingSchedule => {
                return existingSchedule.frequency === newSchedule.frequency &&
                       existingSchedule.time === newSchedule.time &&
                       existingSchedule.recipients === newSchedule.recipients &&
                       existingSchedule.message === newSchedule.message;
            });

            // ì¤‘ë³µì´ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ì¶”ê°€
            if (!isDuplicate) {
            window.emailScheduleList.push(newSchedule);

                // ì €ì¥ ì„±ê³µ ë©”ì‹œì§€ - ì‹¬í”Œí•œ íŒì—…ìœ¼ë¡œ ë³€ê²½
                showSimpleAlert('âœ… Email Report ì„¤ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nìƒˆë¡œìš´ ì˜ˆì•½ì´ ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            console.log('Email Report ì„¤ì • ì €ì¥ ì™„ë£Œ', newSchedule);
            } else {
                // ì¤‘ë³µì¸ ê²½ìš° ì•„ë¬´ëŸ° ë°˜ì‘ ì—†ìŒ (ì¡°ìš©íˆ ë¬´ì‹œ)
                console.log('ì¤‘ë³µëœ ì„¤ì •ì´ë¯€ë¡œ ì €ì¥í•˜ì§€ ì•ŠìŒ:', newSchedule);
            }
        }

        // ì‹¬í”Œí•œ ì•Œë¦¼ íŒì—… í•¨ìˆ˜
        function showSimpleAlert(message, type = 'info') {
            // ê¸°ì¡´ ì•Œë¦¼ ì œê±°
            const existingAlert = document.querySelector('.simple-alert');
            if (existingAlert) {
                existingAlert.remove();
            }

            // ì•Œë¦¼ íƒ€ì…ë³„ ìŠ¤íƒ€ì¼ ì„¤ì •
            let bgColor, textColor, icon;
            switch(type) {
                case 'success':
                    bgColor = '#4CAF50';
                    textColor = '#fff';
                    icon = 'âœ…';
                    break;
                case 'warning':
                    bgColor = '#ff9800';
                    textColor = '#fff';
                    icon = 'âš ï¸';
                    break;
                case 'error':
                    bgColor = '#f44336';
                    textColor = '#fff';
                    icon = 'âŒ';
                    break;
                default:
                    bgColor = '#4a9eff';
                    textColor = '#fff';
                    icon = 'â„¹ï¸';
            }

            // ì•Œë¦¼ ìš”ì†Œ ìƒì„±
            const alertElement = document.createElement('div');
            alertElement.className = 'simple-alert';
            alertElement.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background-color: ${bgColor};
                color: ${textColor};
                padding: 15px 20px;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                max-width: 400px;
                word-wrap: break-word;
                line-height: 1.4;
                animation: slideInRight 0.3s ease-out;
            `;
            alertElement.innerHTML = `${icon} ${message}`;

            // ì• ë‹ˆë©”ì´ì…˜ CSS ì¶”ê°€
            if (!document.querySelector('#simple-alert-styles')) {
                const style = document.createElement('style');
                style.id = 'simple-alert-styles';
                style.textContent = `
                    @keyframes slideInRight {
                        from {
                            transform: translateX(100%);
                            opacity: 0;
                        }
                        to {
                            transform: translateX(0);
                            opacity: 1;
                        }
                    }
                    @keyframes slideOutRight {
                        from {
                            transform: translateX(0);
                            opacity: 1;
                        }
                        to {
                            transform: translateX(100%);
                            opacity: 0;
                        }
                    }
                `;
                document.head.appendChild(style);
            }

            // ì•Œë¦¼ í‘œì‹œ
            document.body.appendChild(alertElement);

            // 3ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                if (alertElement.parentNode) {
                    alertElement.style.animation = 'slideOutRight 0.3s ease-out';
                    setTimeout(() => {
                        if (alertElement.parentNode) {
                            alertElement.remove();
                        }
                    }, 300);
                }
            }, 3000);
        }

        // ë‹¤ìŒ ë°œì†¡ ì‹œê°„ ê³„ì‚° í•¨ìˆ˜
        function calculateNextSendTime(frequency, time) {
            const now = new Date();
            const [hours, minutes] = time.split(':');
            let nextDate = new Date();
            
            // ì‹œê°„ ì„¤ì •
            nextDate.setHours(parseInt(hours), parseInt(minutes), 0, 0);
            
            // ì£¼ê¸°ì— ë”°ë¥¸ ë‚ ì§œ ì¡°ì •
            switch(frequency) {
                case 'daily':
                    // ë‹¤ìŒë‚ ë¡œ ì„¤ì •
                    nextDate.setDate(nextDate.getDate() + 1);
                    break;
                case 'weekly':
                    // ë‹¤ìŒì£¼ ê°™ì€ ìš”ì¼ë¡œ ì„¤ì •
                    nextDate.setDate(nextDate.getDate() + 7);
                    break;
                case 'monthly':
                    // ë‹¤ìŒë‹¬ ê°™ì€ ë‚ ì§œë¡œ ì„¤ì •
                    nextDate.setMonth(nextDate.getMonth() + 1);
                    break;
            }
            
            // í˜„ì¬ ì‹œê°„ë³´ë‹¤ ì´ì „ì´ë©´ ë‹¤ìŒ ì£¼ê¸°ë¡œ ì¡°ì •
            if (nextDate <= now) {
                switch(frequency) {
                    case 'daily':
                        nextDate.setDate(nextDate.getDate() + 1);
                        break;
                    case 'weekly':
                        nextDate.setDate(nextDate.getDate() + 7);
                        break;
                    case 'monthly':
                        nextDate.setMonth(nextDate.getMonth() + 1);
                        break;
                }
            }
            
            return nextDate.toLocaleDateString('ko-KR') + ' ' + nextDate.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'});
        }

        document.addEventListener('DOMContentLoaded', function() {
            
            // ê¸°ë³¸ ì„¤ì • í›„
            setTimeout(async () => {
                // ë“œë¡­ë‹¤ìš´ì—ì„œ ì´ˆê¸° ì°¨íŠ¸ ì„¤ì •
                const chartSelect = document.getElementById('chartSelect');
                if (chartSelect) {
                    chartSelect.value = 'activity-trend';
                    await switchChart('activity-trend');
                }
                console.log('=== í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤ì œ API ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹œì‘ ===');
                await refreshAllRealData(); // ìë™ ìƒˆë¡œê³ ì¹¨
                
                // ìˆ˜ì‹ ì ìˆ˜ ì´ˆê¸°í™”
                setTimeout(() => {
                    updateRecipientCount();
                }, 2000); // ë°ì´í„° ë¡œë“œ í›„ ìˆ˜ì‹ ì ìˆ˜ ê³„ì‚°

                // ì‹œê°„ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
                setTimeout(() => {
                    initializeTimeDropdowns();
                }, 1000); // UI ë¡œë“œ í›„ ì‹œê°„ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”

                // ì˜ˆì•½ ë©”ì¼ ë°œì†¡ ê´€ë¦¬ í† ê¸€ ìƒíƒœ ì´ˆê¸°í™”
                setTimeout(() => {
                    const emailToggle = document.querySelector('#settings .toggle-switch');
                    if (emailToggle) {
                        // ê¸°ë³¸ì ìœ¼ë¡œ í™œì„±í™” ìƒíƒœë¡œ ì‹œì‘
                        emailToggle.classList.remove('off');
                        emailSchedulerActive = true;
                        console.log('ğŸ“… ì˜ˆì•½ ë©”ì¼ ë°œì†¡ ê´€ë¦¬ í† ê¸€ ì´ˆê¸°í™”: í™œì„±í™” ìƒíƒœ');
                        
                        // ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œì‘
                        startEmailScheduler();
                    }
                }, 3000); // ë°ì´í„° ë¡œë“œ ì™„ë£Œ í›„ í† ê¸€ ìƒíƒœ ì´ˆê¸°í™”
            }, 100);
        });

        // ì¦‰ì‹œ ë°œì†¡ í•¨ìˆ˜
        async function sendEmailImmediately() {
            console.log('ğŸ“§ ì¦‰ì‹œ ë°œì†¡ ë²„íŠ¼ì´ í´ë¦­ë˜ì—ˆìŠµë‹ˆë‹¤.');
            
            // í˜„ì¬ ì„¤ì •ëœ ì •ë³´ ìˆ˜ì§‘
            const emailData = collectCurrentEmailSettings();
            
            if (!emailData) {
                return; // ì˜¤ë¥˜ê°€ ìˆìœ¼ë©´ í•¨ìˆ˜ ì¢…ë£Œ (collectCurrentEmailSettingsì—ì„œ ì•Œë¦¼ ì²˜ë¦¬)
            }
            
            // ë²„íŠ¼ ë¹„í™œì„±í™” ë° ë¡œë”© í‘œì‹œ
            const sendButton = event.target;
            const originalText = sendButton.innerHTML;
            sendButton.innerHTML = 'ğŸ“§ ë°œì†¡ ì¤‘...';
            sendButton.disabled = true;
            sendButton.style.opacity = '0.6';
            
            try {
                // SMTPë¥¼ í†µí•œ ë©”ì¼ ë°œì†¡
                await sendEmailViaSMTP(emailData);
                
                // ì„±ê³µ ë©”ì‹œì§€
                showSimpleAlert('âœ… ì´ë©”ì¼ì´ ì„±ê³µì ìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                console.log('âœ… ì¦‰ì‹œ ë°œì†¡ ì™„ë£Œ');
                
            } catch (error) {
                console.error('âŒ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨:', error);
                showSimpleAlert('âŒ ì´ë©”ì¼ ë°œì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
            } finally {
                // ë²„íŠ¼ ë³µì›
                sendButton.innerHTML = originalText;
                sendButton.disabled = false;
                sendButton.style.opacity = '1';
            }
        }

        // í˜„ì¬ ì„¤ì •ëœ ì •ë³´ ìˆ˜ì§‘ í•¨ìˆ˜
        function collectCurrentEmailSettings() {
            console.log('ğŸ“‹ í˜„ì¬ ì„¤ì • ì •ë³´ ìˆ˜ì§‘ ì‹œì‘');
            
            // ë©”ì‹œì§€ ìˆ˜ì§‘
            const messageInput = document.getElementById('email-report-message');
            let messageText = messageInput ? messageInput.value.trim() : '';
            
            // ë©”ì‹œì§€ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ë©”ì‹œì§€ ì„¤ì •
            if (!messageText) {
                messageText = 'ì‚¼ì„± AI Experience Group ëŒ€ì‹œë³´ë“œ ë¦¬í¬íŠ¸ì…ë‹ˆë‹¤.';
            }
            
            // ì²´í¬ë°•ìŠ¤ ìƒíƒœ í™•ì¸
            const adminCheckbox = document.getElementById('admin-checkbox');
            const allMembersCheckbox = document.getElementById('all-members-checkbox');
            const inactiveMembersCheckbox = document.getElementById('inactive-members-checkbox');
            const customEmailCheckbox = document.getElementById('custom-email-checkbox');
            
            const selectedRecipients = [];
            let allRecipientEmails = [];
            
            // ê´€ë¦¬ì ìˆ˜ì§‘
            if (adminCheckbox && adminCheckbox.checked) {
                const admins = originalMembersData ? originalMembersData.filter(member => member.role === 'owner') : [];
                const adminEmails = admins.map(admin => admin.email);
                allRecipientEmails = allRecipientEmails.concat(adminEmails);
                selectedRecipients.push('ê´€ë¦¬ì');
                console.log(`âœ“ ê´€ë¦¬ì ${admins.length}ëª… ì„ íƒ:`, adminEmails);
            }
            
            // ì „ì²´ ë©¤ë²„ ìˆ˜ì§‘
            if (allMembersCheckbox && allMembersCheckbox.checked) {
                const allMembers = originalMembersData ? [...originalMembersData] : [];
                const allMemberEmails = allMembers.map(member => member.email);
                allRecipientEmails = allRecipientEmails.concat(allMemberEmails);
                selectedRecipients.push('ì „ì²´ ë©¤ë²„');
                console.log(`âœ“ ì „ì²´ ë©¤ë²„ ${allMembers.length}ëª… ì„ íƒ:`, allMemberEmails);
            }
            
            // ë¹„í™œì„± ë©¤ë²„ ìˆ˜ì§‘
            if (inactiveMembersCheckbox && inactiveMembersCheckbox.checked) {
                const inactiveMembers = originalMembersData ? originalMembersData.filter(member => {
                    // spendDataê°€ ìˆëŠ” ê²½ìš°ì™€ ì—†ëŠ” ê²½ìš° ëª¨ë‘ ì²˜ë¦¬
                    if (member.spendData) {
                        return member.spendData.premiumRequests === 0;
                    }
                    return true; // spendDataê°€ ì—†ìœ¼ë©´ ë¹„í™œì„±ìœ¼ë¡œ ê°„ì£¼
                }) : [];
                const inactiveMemberEmails = inactiveMembers.map(member => member.email);
                allRecipientEmails = allRecipientEmails.concat(inactiveMemberEmails);
                selectedRecipients.push('ë¹„í™œì„± ë©¤ë²„');
                console.log(`âœ“ ë¹„í™œì„± ë©¤ë²„ ${inactiveMembers.length}ëª… ì„ íƒ:`, inactiveMemberEmails);
            }
            
            // ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ ì£¼ì†Œ ìˆ˜ì§‘
            const customEmails = document.getElementById('custom-emails');
            let customEmailList = [];
            
            if (customEmailCheckbox && customEmailCheckbox.checked && customEmails && customEmails.value.trim()) {
                const emails = customEmails.value.split(',').map(email => email.trim()).filter(email => email);
                customEmailList = emails;
                allRecipientEmails = allRecipientEmails.concat(customEmailList);
                console.log('ğŸ“§ ì§ì ‘ ì…ë ¥ëœ ì´ë©”ì¼:', customEmailList);
            }
            
            // ìˆ˜ì‹ ìê°€ ì—†ìœ¼ë©´ ì˜¤ë¥˜
            if (selectedRecipients.length === 0 && customEmailList.length === 0) {
                showSimpleAlert('âš ï¸ ìˆ˜ì‹ ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”. (ê´€ë¦¬ì, ì „ì²´ ë©¤ë²„, ë¹„í™œì„± ë©¤ë²„ ë˜ëŠ” ì§ì ‘ ì…ë ¥)', 'warning');
                return null;
            }
            
            // ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ì´ ìˆëŠ” ê²½ìš° ìœ íš¨ì„± ê²€ì‚¬
            if (customEmailList.length > 0) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                for (let email of customEmailList) {
                    if (!emailRegex.test(email)) {
                        showSimpleAlert(`âš ï¸ ì˜¬ë°”ë¥´ì§€ ì•Šì€ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤: ${email}`, 'warning');
                        return null;
                    }
                }
            }
            
            // ì¤‘ë³µ ì´ë©”ì¼ ì œê±°
            const uniqueEmails = [...new Set(allRecipientEmails)];
            console.log(`ğŸ“¬ ì´ ìˆ˜ì‹ ì ${uniqueEmails.length}ëª… (ì¤‘ë³µ ì œê±° í›„):`, uniqueEmails);
            
            return {
                message: messageText,
                selectedGroups: selectedRecipients,
                customEmails: customEmailList,
                allEmails: uniqueEmails, // ëª¨ë“  ìˆ˜ì‹ ì ì´ë©”ì¼ (ì¤‘ë³µ ì œê±°)
                timestamp: new Date().toLocaleString('ko-KR')
            };
        }

        // ìˆ˜ì‹ ì ë¯¸ë¦¬ë³´ê¸°ì—ì„œ ì¦‰ì‹œ ë°œì†¡í•˜ëŠ” í•¨ìˆ˜
        async function sendEmailFromPreview() {
            console.log('ğŸ“§ ë¯¸ë¦¬ë³´ê¸°ì—ì„œ ì¦‰ì‹œ ë°œì†¡ ë²„íŠ¼ì´ í´ë¦­ë˜ì—ˆìŠµë‹ˆë‹¤.');
            
            // ë¯¸ë¦¬ë³´ê¸° íŒì—…ì—ì„œ í˜„ì¬ ì„¤ì •ëœ ì •ë³´ ë‹¤ì‹œ ìˆ˜ì§‘
            const emailData = collectEmailDataFromPreview();
            
            if (!emailData) {
                return; // ì˜¤ë¥˜ê°€ ìˆìœ¼ë©´ í•¨ìˆ˜ ì¢…ë£Œ
            }
            
            // ë²„íŠ¼ ë¹„í™œì„±í™” ë° ë¡œë”© í‘œì‹œ
            const sendButton = event.target;
            const originalText = sendButton.innerHTML;
            sendButton.innerHTML = 'ğŸ“§ ë°œì†¡ ì¤‘...';
            sendButton.disabled = true;
            sendButton.style.opacity = '0.6';
            
            try {
                // SMTPë¥¼ í†µí•œ ë©”ì¼ ë°œì†¡
                await sendEmailViaSMTP(emailData);
                
                // ì„±ê³µ ë©”ì‹œì§€
                showSimpleAlert('âœ… ì´ë©”ì¼ì´ ì„±ê³µì ìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                console.log('âœ… ë¯¸ë¦¬ë³´ê¸°ì—ì„œ ì¦‰ì‹œ ë°œì†¡ ì™„ë£Œ');
                
                // ë¯¸ë¦¬ë³´ê¸° íŒì—… ë‹«ê¸°
                closeEmailRecipientsModal();
                
            } catch (error) {
                console.error('âŒ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨:', error);
                showSimpleAlert('âŒ ì´ë©”ì¼ ë°œì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
            } finally {
                // ë²„íŠ¼ ë³µì›
                sendButton.innerHTML = originalText;
                sendButton.disabled = false;
                sendButton.style.opacity = '1';
            }
        }

        // ë¯¸ë¦¬ë³´ê¸° íŒì—…ì—ì„œ ì´ë©”ì¼ ë°ì´í„° ìˆ˜ì§‘ í•¨ìˆ˜
        function collectEmailDataFromPreview() {
            console.log('ğŸ“‹ ë¯¸ë¦¬ë³´ê¸°ì—ì„œ í˜„ì¬ ì„¤ì • ì •ë³´ ìˆ˜ì§‘ ì‹œì‘');
            
            // ë©”ì‹œì§€ ìˆ˜ì§‘ (ë¯¸ë¦¬ë³´ê¸° íŒì—…ì˜ ë©”ì‹œì§€ ì…ë ¥ì°½ì—ì„œ)
            const messageInput = document.getElementById('email-preview-message');
            let messageText = messageInput ? messageInput.value.trim() : '';
            
            // ë©”ì‹œì§€ê°€ ì—†ìœ¼ë©´ ì›ë³¸ ì…ë ¥ì°½ì—ì„œ ê°€ì ¸ì˜¤ê¸°
            if (!messageText) {
                const originalMessageInput = document.getElementById('email-report-message');
                messageText = originalMessageInput ? originalMessageInput.value.trim() : '';
            }
            
            // ë©”ì‹œì§€ê°€ ì—¬ì „íˆ ì—†ìœ¼ë©´ ê¸°ë³¸ ë©”ì‹œì§€ ì„¤ì •
            if (!messageText) {
                messageText = 'ì‚¼ì„± AI Experience Group ëŒ€ì‹œë³´ë“œ ë¦¬í¬íŠ¸ì…ë‹ˆë‹¤.';
            }
            
            // í˜„ì¬ ì²´í¬ë°•ìŠ¤ ìƒíƒœë¥¼ ë‹¤ì‹œ í™•ì¸í•˜ì—¬ ìˆ˜ì‹ ì ìˆ˜ì§‘
            const adminCheckbox = document.getElementById('admin-checkbox');
            const allMembersCheckbox = document.getElementById('all-members-checkbox');
            const inactiveMembersCheckbox = document.getElementById('inactive-members-checkbox');
            const customEmailCheckbox = document.getElementById('custom-email-checkbox');
            
            const selectedRecipients = [];
            let allRecipientEmails = [];
            
            // ê´€ë¦¬ì ìˆ˜ì§‘
            if (adminCheckbox && adminCheckbox.checked) {
                const admins = originalMembersData ? originalMembersData.filter(member => member.role === 'owner') : [];
                const adminEmails = admins.map(admin => admin.email);
                allRecipientEmails = allRecipientEmails.concat(adminEmails);
                selectedRecipients.push('ê´€ë¦¬ì');
                console.log(`âœ“ ê´€ë¦¬ì ${admins.length}ëª… ì„ íƒ:`, adminEmails);
            }
            
            // ì „ì²´ ë©¤ë²„ ìˆ˜ì§‘
            if (allMembersCheckbox && allMembersCheckbox.checked) {
                const allMembers = originalMembersData ? [...originalMembersData] : [];
                const allMemberEmails = allMembers.map(member => member.email);
                allRecipientEmails = allRecipientEmails.concat(allMemberEmails);
                selectedRecipients.push('ì „ì²´ ë©¤ë²„');
                console.log(`âœ“ ì „ì²´ ë©¤ë²„ ${allMembers.length}ëª… ì„ íƒ:`, allMemberEmails);
            }
            
            // ë¹„í™œì„± ë©¤ë²„ ìˆ˜ì§‘
            if (inactiveMembersCheckbox && inactiveMembersCheckbox.checked) {
                const inactiveMembers = originalMembersData ? originalMembersData.filter(member => {
                    if (member.spendData) {
                        return member.spendData.premiumRequests === 0;
                    }
                    return true;
                }) : [];
                const inactiveMemberEmails = inactiveMembers.map(member => member.email);
                allRecipientEmails = allRecipientEmails.concat(inactiveMemberEmails);
                selectedRecipients.push('ë¹„í™œì„± ë©¤ë²„');
                console.log(`âœ“ ë¹„í™œì„± ë©¤ë²„ ${inactiveMembers.length}ëª… ì„ íƒ:`, inactiveMemberEmails);
            }
            
            // ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ ì£¼ì†Œ ìˆ˜ì§‘
            const customEmails = document.getElementById('custom-emails');
            let customEmailList = [];
            
            if (customEmailCheckbox && customEmailCheckbox.checked && customEmails && customEmails.value.trim()) {
                const emails = customEmails.value.split(',').map(email => email.trim()).filter(email => email);
                customEmailList = emails;
                allRecipientEmails = allRecipientEmails.concat(customEmailList);
                console.log('ğŸ“§ ì§ì ‘ ì…ë ¥ëœ ì´ë©”ì¼:', customEmailList);
            }
            
            // ìˆ˜ì‹ ìê°€ ì—†ìœ¼ë©´ ì˜¤ë¥˜
            if (selectedRecipients.length === 0 && customEmailList.length === 0) {
                showSimpleAlert('âš ï¸ ìˆ˜ì‹ ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”. (ê´€ë¦¬ì, ì „ì²´ ë©¤ë²„, ë¹„í™œì„± ë©¤ë²„ ë˜ëŠ” ì§ì ‘ ì…ë ¥)', 'warning');
                return null;
            }
            
            // ì§ì ‘ ì…ë ¥ ì´ë©”ì¼ì´ ìˆëŠ” ê²½ìš° ìœ íš¨ì„± ê²€ì‚¬
            if (customEmailList.length > 0) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                for (let email of customEmailList) {
                    if (!emailRegex.test(email)) {
                        showSimpleAlert(`âš ï¸ ì˜¬ë°”ë¥´ì§€ ì•Šì€ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤: ${email}`, 'warning');
                        return null;
                    }
                }
            }
            
            // ì¤‘ë³µ ì´ë©”ì¼ ì œê±°
            const uniqueEmails = [...new Set(allRecipientEmails)];
            console.log(`ğŸ“¬ ì´ ìˆ˜ì‹ ì ${uniqueEmails.length}ëª… (ì¤‘ë³µ ì œê±° í›„):`, uniqueEmails);
            
            return {
                message: messageText,
                selectedGroups: selectedRecipients,
                customEmails: customEmailList,
                allEmails: uniqueEmails,
                timestamp: new Date().toLocaleString('ko-KR'),
                source: 'preview' // ë¯¸ë¦¬ë³´ê¸°ì—ì„œ ë°œì†¡ë¨ì„ í‘œì‹œ
            };
        }

        // SMTPë¥¼ í†µí•œ ë©”ì¼ ë°œì†¡ í•¨ìˆ˜
        async function sendEmailViaSMTP(emailData) {
            console.log('ğŸ“¤ SMTPë¥¼ í†µí•œ ë©”ì¼ ë°œì†¡ ì‹œì‘');
            
            // ìˆ˜ì‹ ì ëª©ë¡ í…ìŠ¤íŠ¸ ìƒì„±
            let recipientText = '';
            if (emailData.selectedGroups.length > 0) {
                recipientText += `ì„ íƒëœ ê·¸ë£¹: ${emailData.selectedGroups.join(', ')}`;
                recipientText += ` (ì´ ${emailData.allEmails.length}ëª…)`;
            }
            if (emailData.customEmails.length > 0) {
                if (recipientText) recipientText += '\n';
                recipientText += `ì§ì ‘ ì…ë ¥ ì´ë©”ì¼: ${emailData.customEmails.join(', ')}`;
            }
            
            // ë°œì†¡ ë°ì´í„° ì¤€ë¹„
            const emailPayload = {
                to_emails: emailData.allEmails,
                subject: '[Samsung AI Dashboard] ì¦‰ì‹œ ë°œì†¡ ë¦¬í¬íŠ¸',
                message: emailData.message,
                recipients: recipientText,
                timestamp: emailData.timestamp,
                dashboard_url: window.location.href,
                recipient_count: emailData.allEmails ? emailData.allEmails.length : 0,
                source: emailData.source || 'scheduled',
                scheduleId: emailData.scheduleId,
                scheduleTitle: emailData.scheduleTitle
            };
            
            console.log('ğŸ“§ SMTP ë°œì†¡ ë°ì´í„°:', emailPayload);
            console.log(`ğŸ“¬ ë°œì†¡ ëŒ€ìƒ: ${emailData.allEmails ? emailData.allEmails.length : 0}ëª…`);
            console.log('ğŸ“§ ìˆ˜ì‹ ì ëª©ë¡:', emailData.allEmails);
            
            // SMTP ì„œë²„ë¡œ ë°œì†¡ ìš”ì²­
            try {
                const response = await fetch('/send-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(emailPayload)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                console.log('âœ… SMTP ë°œì†¡ ì„±ê³µ:', result);
                return result;
                
            } catch (error) {
                console.error('âŒ SMTP ë°œì†¡ ì‹¤íŒ¨:', error);
                throw new Error(`SMTP ë°œì†¡ ì‹¤íŒ¨: ${error.message}`);
            }
        }

        // =====================================================
        // ğŸ“… ìë™ ë©”ì¼ ë°œì†¡ ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œìŠ¤í…œ
        // =====================================================

        // ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ ê´€ë¦¬
        let emailSchedulerActive = false;
        let emailSchedulerInterval = null;
        let isSchedulerRunning = false;

        // ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œì‘ í•¨ìˆ˜
        function startEmailScheduler() {
            if (isSchedulerRunning) {
                console.log('ğŸ“… ì´ë©”ì¼ ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì´ë¯¸ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤.');
                return;
            }

            console.log('ğŸ“… ì´ë©”ì¼ ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.');
            isSchedulerRunning = true;

            // 1ë¶„ë§ˆë‹¤ ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ ê²€ì‚¬
            emailSchedulerInterval = setInterval(() => {
                checkAndSendScheduledEmails();
            }, 60000); // 60ì´ˆ = 1ë¶„

            // ì¦‰ì‹œ í•œ ë²ˆ ê²€ì‚¬
            checkAndSendScheduledEmails();
        }

        // ìŠ¤ì¼€ì¤„ëŸ¬ ì¤‘ì§€ í•¨ìˆ˜
        function stopEmailScheduler() {
            if (emailSchedulerInterval) {
                clearInterval(emailSchedulerInterval);
                emailSchedulerInterval = null;
                isSchedulerRunning = false;
                console.log('ğŸ“… ì´ë©”ì¼ ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì˜ˆì•½ëœ ì´ë©”ì¼ ê²€ì‚¬ ë° ë°œì†¡
        async function checkAndSendScheduledEmails() {
            console.log('=== ğŸ“… ì˜ˆì•½ ì´ë©”ì¼ ê²€ì‚¬ ì‹œì‘ ===');
            
            // í† ê¸€ ìƒíƒœ í™•ì¸
            if (!emailSchedulerActive) {
                console.log('ğŸ“… ì˜ˆì•½ ë©”ì¼ ë°œì†¡ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
                console.log(`   emailSchedulerActive: ${emailSchedulerActive}`);
                return;
            }

            if (!window.emailScheduleList || window.emailScheduleList.length === 0) {
                console.log('ğŸ“… ì˜ˆì•½ëœ ì´ë©”ì¼ì´ ì—†ìŠµë‹ˆë‹¤.');
                console.log(`   window.emailScheduleList: ${window.emailScheduleList}`);
                return;
            }

            const now = new Date();
            console.log(`ğŸ“… ì˜ˆì•½ ì´ë©”ì¼ ê²€ì‚¬ ì‹œì‘: ${now.toLocaleString('ko-KR')}`);
            console.log(`ğŸ“‹ ì „ì²´ ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸: ${window.emailScheduleList.length}ê°œ`);

            // í™œì„± ìƒíƒœì¸ ì˜ˆì•½ë§Œ ê²€ì‚¬
            const activeSchedules = window.emailScheduleList.filter(schedule => 
                schedule.status === 'í™œì„±'
            );

            console.log(`ğŸ“… í™œì„± ì˜ˆì•½ ${activeSchedules.length}ê°œ ê²€ì‚¬ ì¤‘...`);
            
            // ê° ì˜ˆì•½ì˜ ìƒì„¸ ì •ë³´ ì¶œë ¥
            window.emailScheduleList.forEach((schedule, index) => {
                console.log(`[${index}] ì œëª©: ${schedule.title}, ìƒíƒœ: ${schedule.status}, ì´ë²ˆ: ${schedule.currentSend}, ë‹¤ìŒ: ${schedule.nextSend}`);
            });

            for (const schedule of activeSchedules) {
                try {
                    // ì‹œê°„ ê°±ì‹  ì ìš©
                    updateScheduleTimeIfNeeded(schedule);
                    
                    const shouldSend = shouldSendEmailNow(schedule, now);
                    
                    if (shouldSend) {
                        console.log(`ğŸ“§ ì˜ˆì•½ ë°œì†¡ ì‹œì‘: ${schedule.title} (ID: ${schedule.id})`);
                        
                        // ì˜ˆì•½ì— ë”°ë¥¸ ì´ë©”ì¼ ë°ì´í„° ìˆ˜ì§‘
                        const emailData = await collectEmailDataFromSchedule(schedule);
                        
                        if (emailData) {
                            // ì´ë©”ì¼ ë°œì†¡
                            await sendEmailViaSMTP(emailData);
                            
                            // ë‹¤ìŒ ë°œì†¡ ì‹œê°„ ì—…ë°ì´íŠ¸
                            updateNextSendTime(schedule);
                            
                            console.log(`âœ… ì˜ˆì•½ ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ: ${schedule.title}`);
                            
                            // ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ íŒì—…ì´ ì—´ë ¤ìˆìœ¼ë©´ í…Œì´ë¸” ìƒˆë¡œê³ ì¹¨
                            refreshEmailScheduleList();
                            
                            // ì„±ê³µ ë¡œê·¸ë¥¼ UIì— í‘œì‹œ (ì˜µì…˜)
                            showScheduledEmailNotification(schedule, 'success');
                        } else {
                            console.error(`âŒ ì˜ˆì•½ ì´ë©”ì¼ ë°ì´í„° ìˆ˜ì§‘ ì‹¤íŒ¨: ${schedule.title}`);
                            showScheduledEmailNotification(schedule, 'error');
                        }
                    }
                } catch (error) {
                    console.error(`âŒ ì˜ˆì•½ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨: ${schedule.title}`, error);
                    showScheduledEmailNotification(schedule, 'error');
                }
            }
        }

        // í˜„ì¬ ì‹œê°„ì— ì´ë©”ì¼ì„ ë°œì†¡í•´ì•¼ í•˜ëŠ”ì§€ ê²€ì‚¬
        function shouldSendEmailNow(schedule, currentTime) {
            // currentSend ì‹œê°„ì„ ìš°ì„  ì²´í¬, ì—†ìœ¼ë©´ nextSend ì‚¬ìš©
            const targetSendTimeStr = schedule.currentSend || schedule.nextSend;
            const targetSendTime = parseNextSendTime(targetSendTimeStr);
            
            if (!targetSendTime) {
                console.warn(`âš ï¸ ë°œì†¡ ì‹œê°„ íŒŒì‹± ì‹¤íŒ¨: ${targetSendTimeStr}`);
                return false;
            }

            // ì‹œê°„ì„ ë¶„ ë‹¨ìœ„ê¹Œì§€ë§Œ ë¹„êµ (ì´ˆì™€ ë°€ë¦¬ì´ˆëŠ” 0ìœ¼ë¡œ ì„¤ì •)
            const currentMinute = new Date(currentTime);
            currentMinute.setSeconds(0, 0);
            
            const targetMinute = new Date(targetSendTime);
            targetMinute.setSeconds(0, 0);
            
            // ë¶„ ë‹¨ìœ„ê¹Œì§€ ì¼ì¹˜í•˜ë©´ ë°œì†¡
            const shouldSend = currentMinute.getTime() === targetMinute.getTime();

            // ë””ë²„ê¹…ì„ ìœ„í•œ ìƒì„¸ ë¡œê·¸
            console.log(`ğŸ” ë°œì†¡ ì‹œê°„ ê²€ì‚¬: ${schedule.title}`);
            console.log(`   í˜„ì¬ ì‹œê°„: ${currentTime.toLocaleString('ko-KR')} (ë¶„ë‹¨ìœ„: ${currentMinute.toLocaleString('ko-KR')})`);
            console.log(`   ëª©í‘œ ì‹œê°„: ${targetSendTime.toLocaleString('ko-KR')} (ë¶„ë‹¨ìœ„: ${targetMinute.toLocaleString('ko-KR')})`);
            console.log(`   ë¶„ ë‹¨ìœ„ ì¼ì¹˜: ${shouldSend}`);

            if (shouldSend) {
                console.log(`â° ë°œì†¡ ì‹œê°„ ë„ë‹¬: ${schedule.title} (ì´ë²ˆ ë°œì†¡: ${targetSendTimeStr}, í˜„ì¬: ${currentTime.toLocaleString('ko-KR')})`);
            }

            return shouldSend;
        }

        // nextSend ë¬¸ìì—´ì„ Date ê°ì²´ë¡œ ë³€í™˜
        function parseNextSendTime(nextSendStr) {
            try {
                console.log(`ğŸ”§ ì‹œê°„ íŒŒì‹± ì‹œë„: "${nextSendStr}"`);
                
                // "2025. 8. 7. ì˜¤ì „ 9:00" í˜•íƒœì˜ ë¬¸ìì—´ íŒŒì‹±
                const parts = nextSendStr.split(' ');
                console.log(`ğŸ”§ ë¶„í•  ê²°ê³¼:`, parts);
                
                if (parts.length < 5) {
                    console.warn(`âŒ ì‹œê°„ í˜•ì‹ ë¶€ì¡±: ${nextSendStr} (ë¶€ë¶„ ìˆ˜: ${parts.length})`);
                    return null;
                }
                
                const datePart = parts[0] + ' ' + parts[1] + ' ' + parts[2]; // "2025. 8. 7."
                const timePart = parts[4]; // "9:00"
                const ampm = parts[3]; // "ì˜¤ì „" or "ì˜¤í›„"

                console.log(`ğŸ”§ ë‚ ì§œ: ${datePart}, ì˜¤ì „/ì˜¤í›„: ${ampm}, ì‹œê°„: ${timePart}`);

                // ë‚ ì§œ íŒŒì‹±
                const dateMatch = datePart.match(/(\d{4})\.\s*(\d{1,2})\.\s*(\d{1,2})\./);
                if (!dateMatch) {
                    console.warn(`âŒ ë‚ ì§œ ë§¤ì¹­ ì‹¤íŒ¨: ${datePart}`);
                    return null;
                }

                const year = parseInt(dateMatch[1]);
                const month = parseInt(dateMatch[2]) - 1; // Date ê°ì²´ëŠ” 0ë¶€í„° ì‹œì‘
                const day = parseInt(dateMatch[3]);

                // ì‹œê°„ íŒŒì‹±
                const timeMatch = timePart.match(/(\d{1,2}):(\d{2})/);
                if (!timeMatch) {
                    console.warn(`âŒ ì‹œê°„ ë§¤ì¹­ ì‹¤íŒ¨: ${timePart}`);
                    return null;
                }

                let hour = parseInt(timeMatch[1]);
                const minute = parseInt(timeMatch[2]);

                // ì˜¤í›„ ì²˜ë¦¬
                if (ampm === 'ì˜¤í›„' && hour !== 12) {
                    hour += 12;
                } else if (ampm === 'ì˜¤ì „' && hour === 12) {
                    hour = 0;
                }

                const result = new Date(year, month, day, hour, minute, 0, 0);
                console.log(`âœ… ì‹œê°„ íŒŒì‹± ì„±ê³µ: ${nextSendStr} â†’ ${result.toLocaleString('ko-KR')}`);
                
                return result;
            } catch (error) {
                console.error(`âŒ nextSend ì‹œê°„ íŒŒì‹± ì˜¤ë¥˜ (${nextSendStr}):`, error);
                return null;
            }
        }

        // ì˜ˆì•½ì—ì„œ ì´ë©”ì¼ ë°ì´í„° ìˆ˜ì§‘
        async function collectEmailDataFromSchedule(schedule) {
            console.log(`ğŸ“‹ ì˜ˆì•½ì—ì„œ ì´ë©”ì¼ ë°ì´í„° ìˆ˜ì§‘: ${schedule.title}`);
            console.log(`ğŸ“‹ ìˆ˜ì‹ ì ê·¸ë£¹: ${schedule.recipients}`);
            console.log(`ğŸ“‹ originalMembersData ìƒíƒœ:`, originalMembersData ? `${originalMembersData.length}ëª…` : 'null');
            console.log(`ğŸ“‹ currentMembers ìƒíƒœ:`, currentMembers ? `${currentMembers.length}ëª…` : 'null');

            try {
                // ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë‹¤ì‹œ ê°€ì ¸ì˜¤ê¸°
                let membersData = originalMembersData || currentMembers;
                if (!membersData || membersData.length === 0) {
                    console.log('ğŸ“‹ ë©¤ë²„ ë°ì´í„°ê°€ ì—†ì–´ì„œ ë‹¤ì‹œ ê°€ì ¸ì˜µë‹ˆë‹¤...');
                    try {
                        const teamData = await getTeamMembers();
                        if (teamData && teamData.teamMembers) {
                            membersData = teamData.teamMembers;
                            console.log(`ğŸ“‹ ë©¤ë²„ ë°ì´í„° ìƒˆë¡œ ë¡œë“œ: ${membersData.length}ëª…`);
                        }
                    } catch (error) {
                        console.error('âŒ ë©¤ë²„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                        return null;
                    }
                }

                // ìˆ˜ì‹ ì ê·¸ë£¹ íŒŒì‹±
                const recipients = schedule.recipients.split(', ');
                const selectedRecipients = [];
                let allRecipientEmails = [];
                let customEmailList = [];

                // ê° ìˆ˜ì‹ ì ê·¸ë£¹ ì²˜ë¦¬
                for (const recipient of recipients) {
                    if (recipient === 'ê´€ë¦¬ì') {
                        const admins = membersData ? membersData.filter(member => member.role === 'owner') : [];
                        const adminEmails = admins.map(admin => admin.email);
                        allRecipientEmails = allRecipientEmails.concat(adminEmails);
                        selectedRecipients.push('ê´€ë¦¬ì');
                        console.log(`âœ“ ê´€ë¦¬ì ${admins.length}ëª… ì¶”ê°€`);
                    } else if (recipient === 'ì „ì²´ ë©¤ë²„') {
                        const allMembers = membersData ? [...membersData] : [];
                        const allMemberEmails = allMembers.map(member => member.email);
                        allRecipientEmails = allRecipientEmails.concat(allMemberEmails);
                        selectedRecipients.push('ì „ì²´ ë©¤ë²„');
                        console.log(`âœ“ ì „ì²´ ë©¤ë²„ ${allMembers.length}ëª… ì¶”ê°€`);
                    } else if (recipient === 'ë¹„í™œì„± ë©¤ë²„') {
                        const inactiveMembers = membersData ? membersData.filter(member => {
                            if (member.spendData) {
                                return member.spendData.premiumRequests === 0;
                            }
                            return true;
                        }) : [];
                        const inactiveMemberEmails = inactiveMembers.map(member => member.email);
                        allRecipientEmails = allRecipientEmails.concat(inactiveMemberEmails);
                        selectedRecipients.push('ë¹„í™œì„± ë©¤ë²„');
                        console.log(`âœ“ ë¹„í™œì„± ë©¤ë²„ ${inactiveMembers.length}ëª… ì¶”ê°€`);
                    } else if (recipient === 'ì§ì ‘ì…ë ¥') {
                        // ì§ì ‘ ì…ë ¥ëœ ì´ë©”ì¼ì€ ë³„ë„ ì²˜ë¦¬ í•„ìš”
                        console.log(`âš ï¸ ì§ì ‘ì…ë ¥ ì´ë©”ì¼ì€ í˜„ì¬ ì˜ˆì•½ì—ì„œ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.`);
                    }
                }

                // ì¤‘ë³µ ì´ë©”ì¼ ì œê±°
                const uniqueEmails = [...new Set(allRecipientEmails)];
                console.log(`ğŸ“¬ ì´ ìˆ˜ì‹ ì ${uniqueEmails.length}ëª… (ì¤‘ë³µ ì œê±° í›„)`);

                if (uniqueEmails.length === 0) {
                    console.warn('âš ï¸ ìˆ˜ì‹ ìê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return null;
                }

                return {
                    message: schedule.message || 'ì˜ˆì•½ëœ ì‚¼ì„± AI Experience Group ëŒ€ì‹œë³´ë“œ ë¦¬í¬íŠ¸ì…ë‹ˆë‹¤.',
                    selectedGroups: selectedRecipients,
                    customEmails: customEmailList,
                    allEmails: uniqueEmails,
                    timestamp: new Date().toLocaleString('ko-KR'),
                    source: 'scheduled',
                    scheduleId: schedule.id,
                    scheduleTitle: schedule.title
                };

            } catch (error) {
                console.error('ì˜ˆì•½ ì´ë©”ì¼ ë°ì´í„° ìˆ˜ì§‘ ì˜¤ë¥˜:', error);
                return null;
            }
        }

        // ë°œì†¡ ì™„ë£Œ í›„ ì‹œê°„ ì—…ë°ì´íŠ¸ (ì´ë²ˆ ë°œì†¡ â†’ ë‹¤ìŒ ë°œì†¡ ì´ë™)
        function updateNextSendTime(schedule) {
            const frequency = getFrequencyValue(schedule.frequency);
            const time = getTimeValue(schedule.time);
            
            if (frequency && time) {
                // í˜„ì¬ ì‹œê°„ì„ ì´ë²ˆ ë°œì†¡ ì‹œê°„ìœ¼ë¡œ ì„¤ì •
                const now = new Date();
                schedule.currentSend = now.toLocaleDateString('ko-KR') + ' ' + now.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'});
                
                // ìƒˆë¡œìš´ ë‹¤ìŒ ë°œì†¡ ì‹œê°„ ê³„ì‚° (ì´ë²ˆ ë°œì†¡ ê¸°ì¤€ìœ¼ë¡œ í•œ ì£¼ê¸° í›„)
                schedule.nextSend = calculateNextSendTimeFromCurrent(schedule.currentSend, frequency);
                
                console.log(`â° ë°œì†¡ ì™„ë£Œ í›„ ì‹œê°„ ì—…ë°ì´íŠ¸: ${schedule.title}`);
                console.log(`   ì´ë²ˆ ë°œì†¡: ${schedule.currentSend}`);
                console.log(`   ë‹¤ìŒ ë°œì†¡: ${schedule.nextSend}`);
            }
        }

        // ì´ë²ˆ ë°œì†¡ ê¸°ì¤€ìœ¼ë¡œ ë‹¤ìŒ ë°œì†¡ ì‹œê°„ ê³„ì‚°
        function calculateNextSendTimeFromCurrent(currentSendStr, frequency) {
            try {
                // currentSend ì‹œê°„ì„ Date ê°ì²´ë¡œ ë³€í™˜
                const currentSendTime = parseNextSendTime(currentSendStr);
                if (!currentSendTime) {
                    console.error('currentSend ì‹œê°„ íŒŒì‹± ì‹¤íŒ¨:', currentSendStr);
                    return currentSendStr; // íŒŒì‹± ì‹¤íŒ¨ ì‹œ ê¸°ì¡´ ê°’ ìœ ì§€
                }

                // ì£¼ê¸°ì— ë”°ë¼ ë‹¤ìŒ ë°œì†¡ ì‹œê°„ ê³„ì‚°
                const nextSendTime = new Date(currentSendTime);
                switch(frequency) {
                    case 'daily':
                        // ë§¤ì¼: 1ì¼ í›„
                        nextSendTime.setDate(nextSendTime.getDate() + 1);
                        break;
                    case 'weekly':
                        // ë§¤ì£¼: 7ì¼ í›„
                        nextSendTime.setDate(nextSendTime.getDate() + 7);
                        break;
                    case 'monthly':
                        // ë§¤ì›”: 1ê°œì›” í›„ (ì •í™•í•œ ì›” ê³„ì‚°)
                        const currentMonth = nextSendTime.getMonth();
                        const currentYear = nextSendTime.getFullYear();
                        const currentDay = nextSendTime.getDate();
                        
                        // ë‹¤ìŒ ë‹¬ì˜ ê°™ì€ ë‚ ì§œë¡œ ì„¤ì •
                        let nextMonth = currentMonth + 1;
                        let nextYear = currentYear;
                        
                        if (nextMonth > 11) {
                            nextMonth = 0;
                            nextYear++;
                        }
                        
                        // ë‹¤ìŒ ë‹¬ì˜ ë§ˆì§€ë§‰ ë‚ ì„ í™•ì¸í•˜ì—¬ ë‚ ì§œ ì¡°ì •
                        const lastDayOfNextMonth = new Date(nextYear, nextMonth + 1, 0).getDate();
                        const adjustedDay = Math.min(currentDay, lastDayOfNextMonth);
                        
                        nextSendTime.setFullYear(nextYear, nextMonth, adjustedDay);
                        break;
                }

                console.log(`ğŸ“… ë‹¤ìŒ ë°œì†¡ ì‹œê°„ ê³„ì‚°: ${frequency} ì£¼ê¸°, í˜„ì¬: ${currentSendTime.toLocaleString('ko-KR')}, ë‹¤ìŒ: ${nextSendTime.toLocaleString('ko-KR')}`);

                return nextSendTime.toLocaleDateString('ko-KR') + ' ' + nextSendTime.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'});
            } catch (error) {
                console.error('ë‹¤ìŒ ë°œì†¡ ì‹œê°„ ê³„ì‚° ì˜¤ë¥˜:', error);
                return currentSendStr; // ì˜¤ë¥˜ ì‹œ ê¸°ì¡´ ê°’ ìœ ì§€
            }
        }

        // ì£¼ê¸° í…ìŠ¤íŠ¸ë¥¼ ê°’ìœ¼ë¡œ ë³€í™˜
        function getFrequencyValue(frequencyText) {
            switch(frequencyText) {
                case 'ë§¤ì¼': return 'daily';
                case 'ë§¤ì£¼': return 'weekly';
                case 'ë§¤ì›”': return 'monthly';
                default: return 'weekly';
            }
        }

        // ì‹œê°„ í…ìŠ¤íŠ¸ë¥¼ ê°’ìœ¼ë¡œ ë³€í™˜
        function getTimeValue(timeText) {
            try {
                // "ì˜¤ì „ 9ì‹œ 00ë¶„" í˜•íƒœë¥¼ "09:00" í˜•íƒœë¡œ ë³€í™˜
                const match = timeText.match(/(ì˜¤ì „|ì˜¤í›„)\s*(\d{1,2})ì‹œ\s*(\d{2})ë¶„/);
                if (!match) return '09:00';

                const ampm = match[1];
                let hour = parseInt(match[2]);
                const minute = match[3];

                if (ampm === 'ì˜¤í›„' && hour !== 12) {
                    hour += 12;
                } else if (ampm === 'ì˜¤ì „' && hour === 12) {
                    hour = 0;
                }

                return `${hour.toString().padStart(2, '0')}:${minute}`;
            } catch (error) {
                console.error('ì‹œê°„ ë³€í™˜ ì˜¤ë¥˜:', error);
                return '09:00';
            }
        }

        // ì˜ˆì•½ ì´ë©”ì¼ ë°œì†¡ ì•Œë¦¼ í‘œì‹œ
        function showScheduledEmailNotification(schedule, type) {
            let message = '';
            let alertType = 'info';

            switch(type) {
                case 'success':
                    message = `âœ… ì˜ˆì•½ ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ\n\n${schedule.title}\në‹¤ìŒ ë°œì†¡: ${schedule.nextSend}`;
                    alertType = 'success';
                    break;
                case 'error':
                    message = `âŒ ì˜ˆì•½ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨\n\n${schedule.title}\në‹¤ì‹œ ì‹œë„í•˜ê±°ë‚˜ ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.`;
                    alertType = 'error';
                    break;
            }

            // ì¡°ìš©í•œ ì•Œë¦¼ (ì½˜ì†”ì—ë§Œ ê¸°ë¡, UI ì•Œë¦¼ì€ ì„ íƒì‚¬í•­)
            console.log(`ğŸ“¢ ${message}`);
            
            // í•„ìš”ì‹œ UI ì•Œë¦¼ë„ í‘œì‹œ
            // showSimpleAlert(message, alertType);
        }

        // ì˜ˆì•½ ì‹œê°„ ê°±ì‹  í•¨ìˆ˜ (ì´ë²ˆ ë°œì†¡ ì‹œê°„ì´ ê³¼ê±°ì¸ ê²½ìš°)
        function updateScheduleTimeIfNeeded(schedule) {
            const now = new Date();
            const currentSendTime = parseNextSendTime(schedule.currentSend);
            
            if (!currentSendTime) {
                console.warn(`âš ï¸ ì´ë²ˆ ë°œì†¡ ì‹œê°„ íŒŒì‹± ì‹¤íŒ¨: ${schedule.currentSend}`);
                return;
            }
            
            // ì´ë²ˆ ë°œì†¡ ì‹œê°„ì´ í˜„ì¬ë³´ë‹¤ ê³¼ê±°ì¸ ê²½ìš° ê°±ì‹ 
            if (currentSendTime < now) {
                console.log(`â° ì˜ˆì•½ ì‹œê°„ ê°±ì‹  í•„ìš”: ${schedule.title}`);
                console.log(`   í˜„ì¬ ì‹œê°„: ${now.toLocaleString('ko-KR')}`);
                console.log(`   ì´ë²ˆ ë°œì†¡ ì‹œê°„: ${currentSendTime.toLocaleString('ko-KR')}`);
                
                // ì´ë²ˆ ë°œì†¡ <- ë‹¤ìŒ ë°œì†¡
                schedule.currentSend = schedule.nextSend;
                
                // ë‹¤ìŒ ë°œì†¡ <- ë‹¤ìŒ ë°œì†¡ + ì£¼ê¸°
                const frequency = getFrequencyValue(schedule.frequency);
                if (frequency) {
                    schedule.nextSend = calculateNextSendTimeFromCurrent(schedule.currentSend, frequency);
                }
                
                console.log(`   ê°±ì‹  í›„ ì´ë²ˆ ë°œì†¡: ${schedule.currentSend}`);
                console.log(`   ê°±ì‹  í›„ ë‹¤ìŒ ë°œì†¡: ${schedule.nextSend}`);
            }
        }

        // ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ íŒì—… í…Œì´ë¸” ìƒˆë¡œê³ ì¹¨ (ë©”ì¼ ë°œì†¡ í›„ ì‚¬ìš©)
        function refreshEmailScheduleList() {
            const modal = document.getElementById('email-schedule-modal');
            if (modal) {
                console.log('ğŸ”„ ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ íŒì—… í…Œì´ë¸” ìƒˆë¡œê³ ì¹¨ ì¤‘...');
                
                // ì‹œê°„ ê°±ì‹  ì ìš©
                if (window.emailScheduleList) {
                    window.emailScheduleList.forEach(schedule => {
                        updateScheduleTimeIfNeeded(schedule);
                    });
                }
                
                // í…Œì´ë¸” ë‚´ìš©ë§Œ ì—…ë°ì´íŠ¸ (ëª¨ë‹¬ì€ ìœ ì§€)
                const tableContent = document.getElementById('schedule-list-content');
                if (tableContent && window.emailScheduleList) {
                    const scheduleList = window.emailScheduleList;
                    
                    // í…Œì´ë¸” ë‚´ìš© ì¬ìƒì„±
                    tableContent.innerHTML = scheduleList.map(item => `
                        <div class="schedule-item" data-status="${item.status}" style="
                            display: grid;
                            grid-template-columns: 2fr 1fr 1.2fr 1.2fr 1.5fr 0.8fr 0.8fr 0.8fr;
                            gap: 15px;
                            padding: 15px;
                            border-bottom: 1px solid #3a3a3a;
                            color: #e1e1e1;
                            font-size: 14px;
                            transition: background-color 0.2s ease;
                        " onmouseover="this.style.backgroundColor='#3a3a3a'" onmouseout="this.style.backgroundColor='transparent'">
                            <div style="cursor: pointer;" onclick="showScheduleDetail(${item.id})">
                                <div style="font-weight: 600; color: #fff; margin-bottom: 5px;">${item.title}</div>
                                <div style="color: #7a7a7a; font-size: 12px;">${item.message}</div>
                            </div>
                            <div>${item.frequency}</div>
                            <div style="color: #ff9800; font-weight: 600;">${item.currentSend || item.nextSend}</div>
                            <div style="color: #7a7a7a;">${item.nextSend}</div>
                            <div>${item.recipients}</div>
                            <div style="text-align: center;">
                                <input type="radio" name="status-${item.id}" value="active" ${item.status === 'í™œì„±' ? 'checked' : ''} 
                                       onchange="updateScheduleStatus(${item.id}, 'í™œì„±')" style="
                                    width: 16px;
                                    height: 16px;
                                    accent-color: #4a9eff;
                                ">
                            </div>
                            <div style="text-align: center;">
                                <input type="radio" name="status-${item.id}" value="inactive" ${item.status === 'ë¹„í™œì„±' ? 'checked' : ''} 
                                       onchange="updateScheduleStatus(${item.id}, 'ë¹„í™œì„±')" style="
                                    width: 16px;
                                    height: 16px;
                                    accent-color: #4a9eff;
                                ">
                            </div>
                            <div style="text-align: center;">
                                <button onclick="deleteSchedule(${item.id})" style="
                                    background: none;
                                    border: none;
                                    color: #ff4757;
                                    cursor: pointer;
                                    padding: 4px;
                                    font-size: 16px;
                                    font-weight: bold;
                                ">Ã—</button>
                            </div>
                        </div>
                    `).join('');
                    
                    // ì´ ê°œìˆ˜ ì—…ë°ì´íŠ¸
                    const totalCountElement = modal.querySelector('.pagination-info span');
                    if (totalCountElement) {
                        totalCountElement.textContent = scheduleList.length;
                    }
                    
                    console.log('âœ… ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ íŒì—… í…Œì´ë¸” ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');
                }
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹œê°„ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
        function initializeTimeDropdowns() {
            const timeInput = document.getElementById('email-time-input');
            const hourSelect = document.getElementById('email-hour-select');
            const minuteSelect = document.getElementById('email-minute-select');
            
            if (timeInput && hourSelect && minuteSelect) {
                const [hours, minutes] = timeInput.value.split(':');
                hourSelect.value = hours;
                minuteSelect.value = minutes;
                
                console.log(`â° ì‹œê°„ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”: ${hours}:${minutes}`);
            }
        }

        // ë””ë²„ê¹…: ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ í™•ì¸ í•¨ìˆ˜
        function checkSchedulerStatus() {
            console.log('=== ğŸ“… ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ ì ê²€ ===');
            console.log(`ìŠ¤ì¼€ì¤„ëŸ¬ ì‹¤í–‰ ì¤‘: ${isSchedulerRunning}`);
            console.log(`ìŠ¤ì¼€ì¤„ëŸ¬ í™œì„±í™”: ${emailSchedulerActive}`);
            console.log(`ìŠ¤ì¼€ì¤„ëŸ¬ ì¸í„°ë²Œ: ${emailSchedulerInterval}`);
            
            if (window.emailScheduleList) {
                console.log(`ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ ê°œìˆ˜: ${window.emailScheduleList.length}`);
                window.emailScheduleList.forEach((schedule, index) => {
                    console.log(`[${index}] ${schedule.title}: ${schedule.status}, ì´ë²ˆ: ${schedule.currentSend}, ë‹¤ìŒ: ${schedule.nextSend}`);
                });
            } else {
                console.log('ì˜ˆì•½ ë¦¬ìŠ¤íŠ¸ ì—†ìŒ');
            }
            
            const emailToggle = document.querySelector('#settings .toggle-switch');
            if (emailToggle) {
                console.log(`í† ê¸€ ìƒíƒœ: ${emailToggle.classList.contains('off') ? 'ë¹„í™œì„±' : 'í™œì„±'}`);
            }
            
            // ë‹¤ìŒ ì‹¤í–‰ ì‹œê°„ í™•ì¸
            const now = new Date();
            console.log(`í˜„ì¬ ì‹œê°„: ${now.toLocaleString('ko-KR')}`);
        }

        // ë””ë²„ê¹…: í…ŒìŠ¤íŠ¸ ì˜ˆì•½ ë©”ì¼ ë°œì†¡ ê°•ì œ ì‹¤í–‰
        function forceCheckScheduledEmails() {
            console.log('ğŸ”§ ê°•ì œ ì˜ˆì•½ ë©”ì¼ ê²€ì‚¬ ì‹¤í–‰');
            checkAndSendScheduledEmails();
        }

        // ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡ (ì½˜ì†”ì—ì„œ í˜¸ì¶œ ê°€ëŠ¥)
        window.checkSchedulerStatus = checkSchedulerStatus;
        window.forceCheckScheduledEmails = forceCheckScheduledEmails;

    </script>
</body>
</html>
